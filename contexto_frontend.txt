--- ESTRUCTURA DEL PROYECTO FRONTEND ---
â”œâ”€â”€ .env
â”œâ”€â”€ .gitignore
â”œâ”€â”€ cypress.config.ts
â”œâ”€â”€ index.html
â”œâ”€â”€ package.json
â”œâ”€â”€ postcss.config.js
â”œâ”€â”€ README.md
â”œâ”€â”€ src
â”‚   â”œâ”€â”€ App.vue
â”‚   â”œâ”€â”€ components
â”‚   â”‚   â”œâ”€â”€ common
â”‚   â”‚   â”‚   â”œâ”€â”€ CropperControls.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ CropperPreview.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ DropZone.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ ImageCropper.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ PhotoPreview.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ PhotoUploadButton.vue
â”‚   â”‚   â”‚   â””â”€â”€ UploadProgress.vue
â”‚   â”‚   â”œâ”€â”€ dashboard
â”‚   â”‚   â”‚   â”œâ”€â”€ MainContent.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ NavigationItem.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ NotificationsBell.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ padres
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ cards
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ChildProfileCard.vue
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ParentNavbar.vue
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ParentSidebar.vue
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ PhotoPreview.vue
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ PhotoUploadModal.vue
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ sesiones
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ SessionUltimaNotificacion.vue
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ UserDropdown.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ SearchBar.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ Sidebar.vue
â”‚   â”‚   â”‚   â””â”€â”€ TopNavbar.vue
â”‚   â”‚   â”œâ”€â”€ forms
â”‚   â”‚   â”‚   â”œâ”€â”€ DraftManager.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ multi-step
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ components
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ BusquedaPadre.vue
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ CrearNuevoPadre.vue
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ DataField.vue
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ListaPadresExistentes.vue
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ReviewSection.vue
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ NneMultiStepForm.vue
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ pasos
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ Paso1StepPersonal.vue
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ Paso2Location.vue
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ Paso3School.vue
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ Paso4Medical.vue
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ Paso5SpecialNeeds.vue
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ Paso6Therapy.vue
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ Paso7Guardian.vue
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ Paso8Parents.vue
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ Paso9Review.vue
â”‚   â”‚   â”‚   â””â”€â”€ sesiones
â”‚   â”‚   â”‚       â””â”€â”€ NuevaSession.vue
â”‚   â”‚   â”œâ”€â”€ gestion
â”‚   â”‚   â”‚   â”œâ”€â”€ autonomia
â”‚   â”‚   â”‚   â”œâ”€â”€ comunicacion
â”‚   â”‚   â”‚   â”œâ”€â”€ detonantes
â”‚   â”‚   â”‚   â”œâ”€â”€ hitosLogros
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ MilestoneHistoryList.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ p.cognitivos
â”‚   â”‚   â”‚   â”œâ”€â”€ regulacion
â”‚   â”‚   â”‚   â”œâ”€â”€ rutinas
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ comparison
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ComparisonChart.vue
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ComparisonMetricsGrid.vue
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ComparisonView.vue
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ RecommendationCard.vue
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ RoutineSelector.vue
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ WinnerBadge.vue
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ core
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ BasicInfoPanel.vue
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ RoutineActionMenu.vue
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ RoutineCard.vue
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ RoutineCopyDialog.vue
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ RoutineForm.vue
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ RoutineStatusBadge.vue
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ RoutineTypeSelector.vue
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ schedules
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ shared
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ConfirmDialog.vue
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ DrawerLayout.vue
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ EmptyState.vue
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ErrorState.vue
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ HelpTooltip.vue
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ LoadingState.vue
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ToastNotification.vue
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ steps
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ strategies
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ wizard
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ RoutineCreationWizard.vue
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ WizardProgressBar.vue
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ WizardStep1Basic.vue
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ WizardStep2Schedules.vue
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ WizardStep3Steps.vue
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ WizardStep4Strategies.vue
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ WizardStep5Review.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ sensorial
â”‚   â”‚   â”‚   â”œâ”€â”€ sesiones
â”‚   â”‚   â”‚   â””â”€â”€ tareas
â”‚   â”‚   â”œâ”€â”€ HelloWorld.vue
â”‚   â”‚   â”œâ”€â”€ layout
â”‚   â”‚   â”‚   â””â”€â”€ Breadcrumbs.vue
â”‚   â”‚   â”œâ”€â”€ modal
â”‚   â”‚   â”‚   â”œâ”€â”€ BaseModal.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ sesiones
â”‚   â”‚   â”‚   â””â”€â”€ SessionWarningModal.vue
â”‚   â”‚   â”œâ”€â”€ ninos
â”‚   â”‚   â”‚   â”œâ”€â”€ FiltraNinos.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ PaginadorNino.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ SubComponentes
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ BusquedaFiltros.vue
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ metricasCard
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ MetricCard.vue
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ MetricCardGrid.vue
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ MetricClinicalCard.vue
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ MetricDemographicCard.vue
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ MetricOperationalCard.vue
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ MetricSummaryCard.vue
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ TablaDesktopRow.vue
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ TablaMobileCard.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ TablaFiltro.vue
â”‚   â”‚   â”‚   â””â”€â”€ toggleActivarSuspender.vue
â”‚   â”‚   â”œâ”€â”€ profile
â”‚   â”‚   â”‚   â”œâ”€â”€ header
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ EncabezadoConFoto.vue
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ PerfilHeader.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ profile
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ modals
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ DiagnosticoModal.vue
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ InteresModal.vue
â”‚   â”‚   â”‚   â””â”€â”€ tabcontent
â”‚   â”‚   â”‚       â”œâ”€â”€ card
â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ informaciongeneral
â”‚   â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ ContactoEmergencia.vue
â”‚   â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ HistorialMedico.vue
â”‚   â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ HistorialTerapias.vue
â”‚   â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ InformacionBasica.vue
â”‚   â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ InformacionEscolar.vue
â”‚   â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ InformacionMedica.vue
â”‚   â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ InformacionPersonal.vue
â”‚   â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ InformacionTutor.vue
â”‚   â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ InteresesPrincipales.vue
â”‚   â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ NecesidadesEspeciales.vue
â”‚   â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ RegistroDiagnostico.vue
â”‚   â”‚   â”‚       â”‚   â”‚   â””â”€â”€ RegistroPIE.vue
â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ progresometricas
â”‚   â”‚   â”‚       â”‚   â”‚   â””â”€â”€ ProgresoMetricas.vue
â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ ReportesRapido.vue
â”‚   â”‚   â”‚       â”‚   â””â”€â”€ sesionesterapia
â”‚   â”‚   â”‚       â”‚       â””â”€â”€ SesionesTerapia.vue
â”‚   â”‚   â”‚       â”œâ”€â”€ documentos
â”‚   â”‚   â”‚       â”‚   â””â”€â”€ DocumentosArchivos.vue
â”‚   â”‚   â”‚       â”œâ”€â”€ reportes
â”‚   â”‚   â”‚       â”‚   â””â”€â”€ ReporteCompleto.vue
â”‚   â”‚   â”‚       â””â”€â”€ TabContent.vue
â”‚   â”‚   â”œâ”€â”€ sesiones
â”‚   â”‚   â”‚   â”œâ”€â”€ documentacion-sesion
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ CabeceraDocumentacion.vue
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ GestionObjetivosSesion.vue
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ SeccionEstadoAsistencia.vue
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ SeccionIntervenciones.vue
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ SeccionNotasClinicas.vue
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ SeccionPlanificacionFutura.vue
â”‚   â”‚   â”‚   â””â”€â”€ VerDetalleSesion.vue
â”‚   â”‚   â”œâ”€â”€ toastglobal
â”‚   â”‚   â”‚   â””â”€â”€ ToastContainer.vue
â”‚   â”‚   â”œâ”€â”€ ui
â”‚   â”‚   â”‚   â”œâ”€â”€ alertas
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Alert.vue
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ AlertModal.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ ConfirmModal.vue
â”‚   â”‚   â”‚   â””â”€â”€ NotificationModal.vue
â”‚   â”‚   â””â”€â”€ utils
â”‚   â”‚       â”œâ”€â”€ paginator.vue
â”‚   â”‚       â””â”€â”€ PreloaderChanger.vue
â”‚   â”œâ”€â”€ components.css
â”‚   â”œâ”€â”€ composables
â”‚   â”‚   â”œâ”€â”€ padres
â”‚   â”‚   â”‚   â””â”€â”€ useLatestUpdate.ts
â”‚   â”‚   â”œâ”€â”€ useAuth.ts
â”‚   â”‚   â”œâ”€â”€ useCropper.ts
â”‚   â”‚   â”œâ”€â”€ useFormDraft.ts
â”‚   â”‚   â”œâ”€â”€ useInactivityLogout.ts
â”‚   â”‚   â”œâ”€â”€ useMetricas.ts
â”‚   â”‚   â”œâ”€â”€ useNneFacade.ts
â”‚   â”‚   â”œâ”€â”€ usePaginator.ts
â”‚   â”‚   â”œâ”€â”€ usePhotoUpload.ts
â”‚   â”‚   â”œâ”€â”€ useRutValidation.ts
â”‚   â”‚   â””â”€â”€ useRutValidationForChild.ts
â”‚   â”œâ”€â”€ env.d.ts
â”‚   â”œâ”€â”€ exceptions
â”‚   â”‚   â””â”€â”€ apiError.ts
â”‚   â”œâ”€â”€ layouts
â”‚   â”‚   â”œâ”€â”€ DashboardLayout.vue
â”‚   â”‚   â””â”€â”€ ParentLayout.vue
â”‚   â”œâ”€â”€ main.ts
â”‚   â”œâ”€â”€ router
â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â”œâ”€â”€ parent.routes.ts
â”‚   â”‚   â””â”€â”€ therapist.routes.ts
â”‚   â”œâ”€â”€ services
â”‚   â”‚   â”œâ”€â”€ authService.ts
â”‚   â”‚   â”œâ”€â”€ childService.ts
â”‚   â”‚   â”œâ”€â”€ filtroService.ts
â”‚   â”‚   â”œâ”€â”€ formPersistenceService.ts
â”‚   â”‚   â”œâ”€â”€ hitosService.ts
â”‚   â”‚   â”œâ”€â”€ http.ts
â”‚   â”‚   â”œâ”€â”€ metricasService.ts
â”‚   â”‚   â”œâ”€â”€ nneService.ts
â”‚   â”‚   â”œâ”€â”€ padres
â”‚   â”‚   â”‚   â”œâ”€â”€ parentService.ts
â”‚   â”‚   â”‚   â””â”€â”€ sesiones
â”‚   â”‚   â”œâ”€â”€ photoService.ts
â”‚   â”‚   â”œâ”€â”€ profileService.ts
â”‚   â”‚   â”œâ”€â”€ rutinas
â”‚   â”‚   â”‚   â””â”€â”€ routinesApi.ts
â”‚   â”‚   â””â”€â”€ sessionService.ts
â”‚   â”œâ”€â”€ store
â”‚   â”‚   â”œâ”€â”€ alertModalStore.ts
â”‚   â”‚   â”œâ”€â”€ alertStore.ts
â”‚   â”‚   â”œâ”€â”€ childStore.ts
â”‚   â”‚   â”œâ”€â”€ formDraftStore.ts
â”‚   â”‚   â”œâ”€â”€ ninoActivoStore.ts
â”‚   â”‚   â”œâ”€â”€ notificationStore.ts
â”‚   â”‚   â”œâ”€â”€ padres
â”‚   â”‚   â”‚   â””â”€â”€ sesiones
â”‚   â”‚   â””â”€â”€ rutinas
â”‚   â”‚       â”œâ”€â”€ routinesStore.ts
â”‚   â”‚       â””â”€â”€ routineWizardStore.ts
â”‚   â”œâ”€â”€ style.css
â”‚   â”œâ”€â”€ type
â”‚   â”‚   â”œâ”€â”€ cropper.types.ts
â”‚   â”‚   â”œâ”€â”€ formDraft.ts
â”‚   â”‚   â”œâ”€â”€ hitoServiceInterface.ts
â”‚   â”‚   â”œâ”€â”€ metricas.ts
â”‚   â”‚   â”œâ”€â”€ nne.ts
â”‚   â”‚   â”œâ”€â”€ parent.ts
â”‚   â”‚   â”œâ”€â”€ PhotoUpload.ts
â”‚   â”‚   â”œâ”€â”€ rutinas
â”‚   â”‚   â”‚   â””â”€â”€ rutinas.ts
â”‚   â”‚   â””â”€â”€ user.ts
â”‚   â”œâ”€â”€ utils
â”‚   â”‚   â””â”€â”€ rutValidator.ts
â”‚   â””â”€â”€ views
â”‚       â”œâ”€â”€ auth
â”‚       â”‚   â””â”€â”€ LoginView.vue
â”‚       â”œâ”€â”€ dashboard
â”‚       â”‚   â”œâ”€â”€ ConfiguracionView.vue
â”‚       â”‚   â”œâ”€â”€ DashboardView.vue
â”‚       â”‚   â”œâ”€â”€ DocumentarSesionView.vue
â”‚       â”‚   â”œâ”€â”€ EstablecimientosView.vue
â”‚       â”‚   â”œâ”€â”€ HistosView.vue
â”‚       â”‚   â”œâ”€â”€ IngresoNneDashboard.vue
â”‚       â”‚   â”œâ”€â”€ padres
â”‚       â”‚   â”‚   â”œâ”€â”€ ConfiguracionView.vue
â”‚       â”‚   â”‚   â”œâ”€â”€ DashboardView.vue
â”‚       â”‚   â”‚   â”œâ”€â”€ HijoDetalleView.vue
â”‚       â”‚   â”‚   â”œâ”€â”€ MedicacionView.vue
â”‚       â”‚   â”‚   â”œâ”€â”€ MensajesView.vue
â”‚       â”‚   â”‚   â”œâ”€â”€ MisHijosView.vue
â”‚       â”‚   â”‚   â”œâ”€â”€ RegistroDiarioView.vue
â”‚       â”‚   â”‚   â”œâ”€â”€ ReportesView.vue
â”‚       â”‚   â”‚   â””â”€â”€ RutinasView.vue
â”‚       â”‚   â”œâ”€â”€ PerfilSeguimientoPersonal.vue
â”‚       â”‚   â”œâ”€â”€ perfil_nino
â”‚       â”‚   â”‚   â”œâ”€â”€ AutonomiaView.vue
â”‚       â”‚   â”‚   â”œâ”€â”€ CognitivoView.vue
â”‚       â”‚   â”‚   â”œâ”€â”€ ComunicacionView.vue
â”‚       â”‚   â”‚   â”œâ”€â”€ DetonantesCrisisView.vue
â”‚       â”‚   â”‚   â”œâ”€â”€ HabilidadesSocialesView.vue
â”‚       â”‚   â”‚   â”œâ”€â”€ HitosLogrosView.vue
â”‚       â”‚   â”‚   â”œâ”€â”€ PerfilNinoLayout.vue
â”‚       â”‚   â”‚   â”œâ”€â”€ RegulacionView.vue
â”‚       â”‚   â”‚   â”œâ”€â”€ rutinas
â”‚       â”‚   â”‚   â”‚   â”œâ”€â”€ RoutineDetailView.vue
â”‚       â”‚   â”‚   â”‚   â”œâ”€â”€ RutinasAgendaView.vue
â”‚       â”‚   â”‚   â”‚   â”œâ”€â”€ RutinasAnalyticsView.vue
â”‚       â”‚   â”‚   â”‚   â”œâ”€â”€ RutinasComparisonView.vue
â”‚       â”‚   â”‚   â”‚   â””â”€â”€ RutinasListView.vue
â”‚       â”‚   â”‚   â”œâ”€â”€ RutinasView.vue
â”‚       â”‚   â”‚   â”œâ”€â”€ SensorialView.vue
â”‚       â”‚   â”‚   â”œâ”€â”€ SesionesNinoView.vue
â”‚       â”‚   â”‚   â””â”€â”€ TareasView.vue
â”‚       â”‚   â”œâ”€â”€ ReportesView.vue
â”‚       â”‚   â””â”€â”€ SessionesView.vue
â”‚       â””â”€â”€ errors
â”‚           â””â”€â”€ NotFoundView.vue
â”œâ”€â”€ tailwind.config.js
â”œâ”€â”€ tests
â”‚   â”œâ”€â”€ pasos
â”‚   â”‚   â”œâ”€â”€ Paso1StepPersonal.spec.js
â”‚   â”‚   â””â”€â”€ Paso1StepPersonal.spec.ts
â”‚   â””â”€â”€ setup.ts
â”œâ”€â”€ tsconfig.app.json
â”œâ”€â”€ tsconfig.app.tsbuildinfo
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ tsconfig.node.json
â”œâ”€â”€ tsconfig.tsbuildinfo
â”œâ”€â”€ vite.config.d.ts
â””â”€â”€ vite.config.ts


--- CONTENIDO DE LOS ARCHIVOS ---

============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\cypress.config.ts
============================================================
/* cypress.config.ts */
import { defineConfig } from 'cypress'

export default defineConfig({
  e2e: {
    baseUrl: 'http://localhost:5173',
    specPattern: 'cypress/e2e/**/*.cy.{js,jsx,ts,tsx}',
    supportFile: 'cypress/support/e2e.ts',
    viewportWidth: 1280,
    viewportHeight: 720,
    defaultCommandTimeout: 15000,
    requestTimeout: 10000,
    responseTimeout: 30000,
    pageLoadTimeout: 60000,
    setupNodeEvents(on, config) {
      return config
    },
  },
  env: {
    API_BASE_URL: 'http://127.0.0.1:8000/api',
    TEST_EMAIL: 'camila.terapeuta@divermind.com',
    TEST_PASSWORD: 'pangaleluney2013'
  }
})
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\index.html
============================================================
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DIVERMIND</title>
  </head>
  <body>
    <div id="app"></div>
    <script type="module" src="/src/main.ts"></script>
  </body>
</html>

============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\package.json
============================================================
{
  "name": "divermindtemplate",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vue-tsc -b && vite build",
    "preview": "vite preview",
    "test": "vitest",
    "cy:open": "cypress open",
    "cy:run": "cypress run",
    "cy:run:firefox": "cypress run --browser firefox",
    "cy:run:login": "cypress run --browser firefox --spec cypress/e2e/auth/login.cy.ts",
    "test:e2e": "npm run dev & npm run cy:run:firefox"
  },
  "dependencies": {
    "@formkit/themes": "^1.6.9",
    "@formkit/vue": "^1.6.9",
    "@headlessui/vue": "^1.7.23",
    "@heroicons/vue": "^2.2.0",
    "@tailwindcss/forms": "^0.5.10",
    "@tailwindcss/line-clamp": "^0.4.4",
    "@tailwindcss/typography": "^0.5.19",
    "@vue/server-renderer": "^3.5.21",
    "@vueuse/core": "^14.0.0",
    "axios": "^1.12.2",
    "chart.js": "^4.5.0",
    "date-fns": "^2.30.0",
    "pinia": "^3.0.3",
    "sortablejs": "^1.15.6",
    "v-calendar": "^3.1.2",
    "vue": "^3.5.21",
    "vue-advanced-cropper": "^2.8.9",
    "vue-chartjs": "^5.3.2",
    "vue-draggable-next": "^2.3.0",
    "vue-lazyload-next": "^0.0.2",
    "vue-router": "^4.5.1"
  },
  "devDependencies": {
    "@types/cypress": "^0.1.6",
    "@types/node": "^24.3.1",
    "@vitejs/plugin-vue": "^6.0.1",
    "@vue/test-utils": "^2.4.6",
    "@vue/tsconfig": "^0.7.0",
    "autoprefixer": "^10.4.21",
    "cypress": "^15.4.0",
    "jsdom": "^27.0.0",
    "postcss": "^8.5.6",
    "tailwindcss": "^3.4.17",
    "typescript": "^5.9.3",
    "vite": "^7.1.2",
    "vitest": "^3.2.4",
    "vue-tsc": "^3.1.0"
  }
}

============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\postcss.config.js
============================================================
export default {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}

============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\App.vue
============================================================
<!-- src/App.vue -->
<template>
  <RouterView />
  <AlertModal /> <!-- Componente de modal de alertas -->  
  <Alert /> <!-- Componente de alertas global -->
</template>

<script setup lang="ts">
import Alert from '@/components/ui/alertas/Alert.vue'
import AlertModal from '@/components/ui/alertas/AlertModal.vue'
</script>

============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\common\CropperControls.vue
============================================================

============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\common\CropperPreview.vue
============================================================

============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\common\DropZone.vue
============================================================
<!-- src/components/common/DropZone.vue -->
<template>
  <div
    @drop.prevent="handleDrop"
    @dragover.prevent="isDragging = true"
    @dragleave.prevent="isDragging = false"
    @click="triggerFileInput"
    :class="[
      'border-2 border-dashed rounded-xl p-12 text-center cursor-pointer transition-all duration-200',
      isDragging 
        ? 'border-sky-500 bg-sky-50 scale-105' 
        : 'border-gray-300 hover:border-sky-400 hover:bg-gray-50'
    ]"
  >
    <!-- Icono -->
    <div class="flex justify-center mb-4">
      <PhotoIcon :class="[
        'w-16 h-16 transition-colors',
        isDragging ? 'text-sky-500' : 'text-gray-400'
      ]" />
    </div>

    <!-- Texto principal -->
    <p class="text-lg font-medium text-gray-700 mb-2">
      {{ isDragging ? 'Â¡Suelta la foto aquÃ­!' : 'Arrastra una foto aquÃ­' }}
    </p>
    
    <!-- Texto secundario -->
    <p class="text-sm text-gray-500 mb-4">
      o haz clic para seleccionar
    </p>

    <!-- Info de formatos -->
    <div class="text-xs text-gray-400 space-y-1">
      <p>Formatos: JPG, PNG, WebP</p>
      <p>TamaÃ±o mÃ¡ximo: {{ maxSizeMB }} MB</p>
    </div>

    <!-- Input file oculto -->
    <input
      ref="fileInput"
      type="file"
      :accept="accept"
      @change="handleFileSelect"
      class="hidden"
    />
  </div>
</template>

<script setup lang="ts">
import { ref } from 'vue'
import { PhotoIcon } from '@heroicons/vue/24/outline'

interface Props {
  accept?: string
  maxSizeMB?: number
}

const props = withDefaults(defineProps<Props>(), {
  accept: 'image/jpeg,image/png,image/webp',
  maxSizeMB: 10
})

const emit = defineEmits<{
  'file-selected': [file: File]
  'file-error': [error: string]
}>()

const fileInput = ref<HTMLInputElement | null>(null)
const isDragging = ref(false)

const validateFile = (file: File): string | null => {
  // Validar tipo
  if (!props.accept.split(',').some(type => file.type === type.trim())) {
    return 'Formato de archivo no permitido. Usa JPG, PNG o WebP.'
  }

  // Validar tamaÃ±o
  const sizeMB = file.size / (1024 * 1024)
  if (sizeMB > props.maxSizeMB) {
    return `El archivo es muy grande. MÃ¡ximo ${props.maxSizeMB} MB.`
  }

  return null
}

const processFile = (file: File) => {
  const error = validateFile(file)
  if (error) {
    emit('file-error', error)
  } else {
    emit('file-selected', file)
  }
}

const handleDrop = (e: DragEvent) => {
  isDragging.value = false
  const files = e.dataTransfer?.files
  if (files && files.length > 0) {
    processFile(files[0])
  }
}

const handleFileSelect = (e: Event) => {
  const input = e.target as HTMLInputElement
  const files = input.files
  if (files && files.length > 0) {
    processFile(files[0])
  }
}

const triggerFileInput = () => {
  fileInput.value?.click()
}
</script>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\common\ImageCropper.vue
============================================================
<!-- src/components/common/ImageCropper.vue -->
<template>
  <div class="image-cropper-container">
    
    <!-- CROPPER -->
    <div class="cropper-wrapper">
      <Cropper
        ref="cropperRef"
        class="cropper"
        :src="imageUrl"
        :stencil-props="{
          aspectRatio: aspectRatio,
          movable: true,
          resizable: true,
        }"
        :stencil-component="stencilComponent"
        :canvas="{
          minWidth: minWidth,
          minHeight: minHeight,
          maxWidth: maxWidth,
          maxHeight: maxHeight
        }"
        image-restriction="stencil"
      />
    </div>
    
    <!-- CONTROLES -->
    <div class="controls-wrapper">
      
      <!-- Zoom -->
      <div class="control-group">
        <label class="control-label">ğŸ” Zoom</label>
        <div class="flex items-center gap-3">
          <button @click="zoomOut" class="control-btn" :disabled="isProcessing" type="button">
            <MinusIcon class="w-4 h-4" />
          </button>
          <div class="flex-1 bg-gray-200 rounded-full h-2">
            <div 
              class="bg-sky-500 h-2 rounded-full transition-all"
              :style="{ width: `${zoom}%` }"
            ></div>
          </div>
          <button @click="zoomIn" class="control-btn" :disabled="isProcessing" type="button">
            <PlusIcon class="w-4 h-4" />
          </button>
        </div>
      </div>
      
      <!-- RotaciÃ³n -->
      <div class="control-group">
        <label class="control-label">ğŸ”„ Rotar</label>
        <div class="flex gap-2">
          <button @click="rotate(-90)" class="control-btn flex-1" :disabled="isProcessing" type="button">
            <ArrowPathIcon class="w-4 h-4 transform rotate-180" />
            <span class="ml-1">90Â° â†</span>
          </button>
          <button @click="rotate(90)" class="control-btn flex-1" :disabled="isProcessing" type="button">
            <span class="mr-1">90Â° â†’</span>
            <ArrowPathIcon class="w-4 h-4" />
          </button>
        </div>
      </div>
      
      <!-- Reset -->
      <button @click="reset" class="reset-btn" :disabled="isProcessing" type="button">
        <ArrowPathIcon class="w-4 h-4" />
        Restablecer
      </button>
      
    </div>
    
    <!-- FOOTER ACTIONS -->
    <div class="footer-actions">
      <button @click="handleCancel" class="btn-cancel" :disabled="isProcessing" type="button">
        Cancelar
      </button>
      <button @click="handleContinue" class="btn-continue" :disabled="isProcessing" type="button">
        <span v-if="isProcessing">Procesando...</span>
        <span v-else>Continuar â†’</span>
      </button>
    </div>
    
  </div>
</template>

<script setup lang="ts">
import { ref, computed, onMounted, onUnmounted } from 'vue'
import { Cropper, CircleStencil, RectangleStencil } from 'vue-advanced-cropper'
import 'vue-advanced-cropper/dist/style.css'
import { MinusIcon, PlusIcon, ArrowPathIcon } from '@heroicons/vue/24/outline'

interface Props {
  imageFile: File
  aspectRatio?: number
  cropShape?: 'circle' | 'rect'
  minWidth?: number
  minHeight?: number
  maxWidth?: number
  maxHeight?: number
}

const props = withDefaults(defineProps<Props>(), {
  aspectRatio: 1,
  cropShape: 'circle',
  minWidth: 150,
  minHeight: 150,
  maxWidth: 1200,
  maxHeight: 1200
})

const emit = defineEmits<{
  'crop-complete': [blob: Blob]
  'cancel': []
}>()

// Refs
const cropperRef = ref<any>(null)
const imageUrl = ref<string>('')
const zoom = ref(50)
const isProcessing = ref(false)

// Computed
const stencilComponent = computed(() => {
  return props.cropShape === 'circle' ? CircleStencil : RectangleStencil
})

// MÃ©todos
const zoomIn = () => {
  if (cropperRef.value) {
    cropperRef.value.zoom(1.2)
    zoom.value = Math.min(zoom.value + 10, 100)
  }
}

const zoomOut = () => {
  if (cropperRef.value) {
    cropperRef.value.zoom(0.8)
    zoom.value = Math.max(zoom.value - 10, 0)
  }
}

const rotate = (degrees: number) => {
  if (cropperRef.value) {
    cropperRef.value.rotate(degrees)
  }
}

const reset = () => {
  if (cropperRef.value) {
    cropperRef.value.reset()
    zoom.value = 50
  }
}

const handleCancel = () => {
  console.log('[ImageCropper] âŒ Cancelando')
  emit('cancel')
}

const handleContinue = async () => {
  if (!cropperRef.value) {
    console.error('[ImageCropper] âŒ Cropper ref no disponible')
    return
  }
  
  try {
    isProcessing.value = true
    
    console.log('[ImageCropper] ğŸ”„ Obteniendo resultado...')
    
    const { canvas } = cropperRef.value.getResult()
    
    if (!canvas) {
      throw new Error('No se pudo obtener canvas del cropper')
    }
    
    // Convertir canvas a Blob
    const blob = await new Promise<Blob>((resolve, reject) => {
      canvas.toBlob(
        (b: Blob | null) => {
          if (b) {
            console.log('[ImageCropper] âœ… Blob creado:', {
              size: `${(b.size / 1024).toFixed(2)} KB`,
              type: b.type
            })
            resolve(b)
          } else {
            reject(new Error('No se pudo crear Blob desde canvas'))
          }
        },
        'image/jpeg',
        0.85
      )
    })
    
    emit('crop-complete', blob)
    
  } catch (error) {
    console.error('[ImageCropper] âŒ Error obteniendo resultado:', error)
    alert('Error al procesar la imagen. Intenta de nuevo.')
  } finally {
    isProcessing.value = false
  }
}

// Lifecycle
onMounted(() => {
  imageUrl.value = URL.createObjectURL(props.imageFile)
  console.log('[ImageCropper] âœ… Montado, URL creada')
})

onUnmounted(() => {
  if (imageUrl.value) {
    URL.revokeObjectURL(imageUrl.value)
    console.log('[ImageCropper] ğŸ—‘ï¸ URL revocada')
  }
})
</script>

<style scoped>
.image-cropper-container {
  @apply space-y-6;
}

.cropper-wrapper {
  @apply relative w-full h-96 bg-gray-100 rounded-lg overflow-hidden border-2 border-gray-200;
}

.cropper {
  @apply w-full h-full;
}

/* Estilo para crop circular */
:deep(.vue-circle-stencil) {
  border-radius: 50%;
}

.controls-wrapper {
  @apply space-y-4 p-4 bg-gray-50 rounded-lg;
}

.control-group {
  @apply space-y-2;
}

.control-label {
  @apply text-sm font-medium text-gray-700;
}

.control-btn {
  @apply p-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 hover:border-sky-500 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center;
}

.reset-btn {
  @apply w-full flex items-center justify-center gap-2 px-4 py-2 bg-white border border-gray-300 hover:bg-gray-50 hover:border-sky-500 text-gray-700 rounded-lg transition-all;
}

.footer-actions {
  @apply flex gap-3 pt-4 border-t;
}

.btn-cancel {
  @apply flex-1 px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors disabled:opacity-50;
}

.btn-continue {
  @apply flex-1 px-4 py-2 bg-gradient-to-r from-sky-500 to-blue-600 hover:from-sky-600 hover:to-blue-700 text-white font-medium rounded-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed;
}
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\common\PhotoPreview.vue
============================================================
<!-- src/components/dashboard/padres/PhotoPreview.vue -->
<template>
  <div class="grid grid-cols-2 gap-6">
    <div class="text-center">
      <p class="text-sm font-medium text-gray-700 mb-2">Antes</p>
      <div class="w-40 h-40 mx-auto rounded-full overflow-hidden bg-gray-200">
        <img v-if="originalUrl" :src="originalUrl" class="w-full h-full object-cover" />
      </div>
    </div>
    <div class="text-center">
      <p class="text-sm font-medium text-gray-700 mb-2">DespuÃ©s</p>
      <div class="w-40 h-40 mx-auto rounded-full overflow-hidden bg-gray-200">
        <img :src="newImageUrl" class="w-full h-full object-cover" />
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { computed } from 'vue'

const props = defineProps<{
  originalUrl: string | null
  newImageBlob: Blob
  childName: string
}>()

const newImageUrl = computed(() => URL.createObjectURL(props.newImageBlob))
</script>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\common\PhotoUploadButton.vue
============================================================
<!-- src/components/common/PhotoUploadButton.vue -->
<template>
  <button
    :class="buttonClasses"
    :disabled="loading"
    @click="handleClick"
    :title="tooltip"
  >
    <!-- Icono dinÃ¡mico -->
    <component
      :is="loading ? ArrowPathIcon : CameraIcon"
      :class="[
        'transition-transform duration-200',
        iconSizeClass,
        loading && 'animate-spin'
      ]"
    />
    
    <!-- Label (solo si no es variant icon) -->
    <span v-if="variant !== 'icon' && label" class="font-medium">
      {{ loading ? loadingText : label }}
    </span>
  </button>
</template>

<script setup lang="ts">
import { computed } from 'vue'
import { CameraIcon, ArrowPathIcon } from '@heroicons/vue/24/outline'

interface Props {
  variant?: 'primary' | 'secondary' | 'icon'
  size?: 'sm' | 'md' | 'lg'
  label?: string
  loadingText?: string
  loading?: boolean
  tooltip?: string
}

const props = withDefaults(defineProps<Props>(), {
  variant: 'primary',
  size: 'md',
  label: 'Cambiar foto',
  loadingText: 'Subiendo...',
  loading: false,
  tooltip: 'Subir foto de perfil'
})

const emit = defineEmits<{
  click: []
}>()

const handleClick = () => {
  if (!props.loading) {
    emit('click')
  }
}

// Clases dinÃ¡micas segÃºn variant
const buttonClasses = computed(() => {
  const base = [
    'inline-flex items-center justify-center gap-2',
    'transition-all duration-200',
    'focus:outline-none focus:ring-2 focus:ring-offset-2',
    'disabled:opacity-50 disabled:cursor-not-allowed'
  ]

  const sizes = {
    sm: 'px-3 py-1.5 text-sm rounded-lg',
    md: 'px-4 py-2 text-base rounded-lg',
    lg: 'px-5 py-3 text-lg rounded-xl'
  }

  const variants = {
    primary: [
      'bg-gradient-to-r from-sky-500 to-blue-600',
      'text-white font-medium shadow-md',
      'hover:from-sky-600 hover:to-blue-700 hover:shadow-lg hover:scale-105',
      'focus:ring-sky-500'
    ],
    secondary: [
      'bg-white text-gray-700 border-2 border-gray-300',
      'hover:bg-gray-50 hover:border-sky-500 hover:text-sky-600',
      'focus:ring-gray-400'
    ],
    icon: [
      'w-10 h-10 rounded-full',
      'bg-white/90 backdrop-blur-sm text-gray-700',
      'hover:bg-sky-500 hover:text-white hover:scale-110',
      'shadow-md hover:shadow-lg',
      'focus:ring-sky-500'
    ]
  }

  return [
    ...base,
    sizes[props.size],
    ...(props.variant === 'icon' ? variants.icon : variants[props.variant])
  ]
})

const iconSizeClass = computed(() => {
  const sizes = {
    sm: 'w-4 h-4',
    md: 'w-5 h-5',
    lg: 'w-6 h-6'
  }
  return sizes[props.size]
})
</script>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\common\UploadProgress.vue
============================================================
<!-- src/components/common/UploadProgress.vue -->
<template>
  <div class="text-center py-8">
    <div class="mb-4">
      <svg class="w-16 h-16 mx-auto animate-spin text-sky-500" fill="none" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
      </svg>
    </div>
    <p class="text-lg font-medium text-gray-900">{{ message }}</p>
    <div class="mt-4 max-w-xs mx-auto">
      <div class="w-full bg-gray-200 rounded-full h-2">
        <div
          :style="{ width: `${progress}%` }"
          class="bg-sky-500 h-2 rounded-full transition-all duration-300"
        ></div>
      </div>
      <p class="text-sm text-gray-600 mt-2">{{ progress }}%</p>
    </div>
  </div>
</template>

<script setup lang="ts">
defineProps<{
  progress: number
  status: 'uploading' | 'processing' | 'complete'
  message: string
}>()
</script>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\dashboard\MainContent.vue
============================================================
<template>
 <!--  ruta de este archivo src\components\dashboard\MainContent.vue -->
  <main class="flex-1 overflow-hidden">
    <!-- Contenedor principal con transiciones suaves -->
    <div class="h-full flex flex-col">
      
      <!-- Breadcrumb opcional -->
      <div v-if="showBreadcrumb" class="px-4 py-2 bg-gray-50 border-b border-gray-200">
        <nav class="flex items-center space-x-2 text-sm">
          <router-link to="/" class="text-blue-600 hover:text-blue-800 transition-colors duration-150">
            Inicio
          </router-link>
          <ChevronRightIcon class="h-4 w-4 text-gray-400" />
          <span class="text-gray-600">{{ currentPage }}</span>
        </nav>
      </div>

      <!-- Ãrea de contenido adaptable -->
      <div class="flex-1 overflow-y-auto bg-gray-50">
        <div class="min-h-full">
          
          <!-- Contenedor responsive -->
          <div class="container mx-auto px-4 py-6 lg:px-6 xl:px-8">
            
            <!-- Header de pÃ¡gina con animaciÃ³n -->
            <Transition
              enter-active-class="transition ease-out duration-300"
              enter-from-class="opacity-0 translate-y-4"
              enter-to-class="opacity-100 translate-y-0"
              leave-active-class="transition ease-in duration-200"
              leave-from-class="opacity-100 translate-y-0"
              leave-to-class="opacity-0 translate-y-4"
              mode="out-in"
            >
              <div :key="$route.name" class="mb-6">
                <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between">
                  <div class="mb-4 sm:mb-0">
                    <h1 class="text-2xl lg:text-3xl font-bold text-gray-900">
                      {{ pageTitle }}
                    </h1>
                    <p v-if="pageDescription" class="mt-1 text-gray-600">
                      {{ pageDescription }}
                    </p>
                  </div>
                  
                  <!-- Acciones de pÃ¡gina -->
                  <div v-if="$slots.actions" class="flex items-center space-x-3">
                    <slot name="actions" />
                  </div>
                </div>
              </div>
            </Transition>

            <!-- Contenido principal con transiciÃ³n -->
            <Transition
              enter-active-class="transition ease-out duration-300 delay-75"
              enter-from-class="opacity-0 translate-y-4"
              enter-to-class="opacity-100 translate-y-0"
              leave-active-class="transition ease-in duration-200"
              leave-from-class="opacity-100 translate-y-0"
              leave-to-class="opacity-0 translate-y-4"
              mode="out-in"
            >
              <div :key="$route.path" class="space-y-6">
                
                <!-- Grid adaptable para contenido -->
                <div class="grid grid-cols-1 gap-6" 
                     :class="gridClasses">
                  
                  <!-- Slot principal para el contenido -->
                  <div class="space-y-6">
                    <slot />
                  </div>
                  
                  <!-- Sidebar opcional -->
                  <div v-if="$slots.sidebar" class="space-y-6">
                    <slot name="sidebar" />
                  </div>
                </div>
                
                <!-- Ãrea inferior opcional -->
                <div v-if="$slots.footer" class="mt-8 pt-6 border-t border-gray-200">
                  <slot name="footer" />
                </div>
              </div>
            </Transition>
          </div>
        </div>
      </div>
      
      <!-- Barra de estado/progreso opcional -->
      <div v-if="$slots.statusBar" class="border-t border-gray-200 bg-white px-4 py-2">
        <slot name="statusBar" />
      </div>
    </div>

    <!-- Loading overlay -->
    <Transition
      enter-active-class="transition ease-out duration-200"
      enter-from-class="opacity-0"
      enter-to-class="opacity-100"
      leave-active-class="transition ease-in duration-150"
      leave-from-class="opacity-100"
      leave-to-class="opacity-0"
    >
      <div v-if="isLoading" class="absolute inset-0 bg-white bg-opacity-75 flex items-center justify-center z-50">
        <div class="flex items-center space-x-3">
          <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"></div>
          <span class="text-gray-600">{{ loadingMessage }}</span>
        </div>
      </div>
    </Transition>
    
    <!-- Error state -->
    <Transition
      enter-active-class="transition ease-out duration-200"
      enter-from-class="opacity-0 translate-y-4"
      enter-to-class="opacity-100 translate-y-0"
      leave-active-class="transition ease-in duration-150"
      leave-from-class="opacity-100 translate-y-0"
      leave-to-class="opacity-0 translate-y-4"
    >
      <div v-if="hasError" class="absolute inset-0 bg-white flex items-center justify-center z-40">
        <div class="text-center max-w-md mx-auto px-4">
          <ExclamationTriangleIcon class="h-12 w-12 text-red-500 mx-auto mb-4" />
          <h3 class="text-lg font-semibold text-gray-900 mb-2">{{ errorTitle }}</h3>
          <p class="text-gray-600 mb-4">{{ errorMessage }}</p>
          <button @click="retryAction" 
                  class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors duration-150">
            Reintentar
          </button>
        </div>
      </div>
    </Transition>
  </main>
</template>

<script setup lang="ts">
import { computed, onMounted, onUnmounted } from 'vue'
import { useRoute } from 'vue-router'
import { ChevronRightIcon, ExclamationTriangleIcon } from '@heroicons/vue/24/outline'

interface Props {
  showBreadcrumb?: boolean
  isLoading?: boolean
  loadingMessage?: string
  hasError?: boolean
  errorTitle?: string
  errorMessage?: string
  gridLayout?: 'single' | 'sidebar' | 'two-column' | 'three-column'
}

const props = withDefaults(defineProps<Props>(), {
  showBreadcrumb: false,
  isLoading: false,
  loadingMessage: 'Cargando...',
  hasError: false,
  errorTitle: 'Error inesperado',
  errorMessage: 'Ha ocurrido un error. Por favor, intÃ©ntalo de nuevo.',
  gridLayout: 'single'
})

const emit = defineEmits(['retry'])

const route = useRoute()

// ConfiguraciÃ³n de tÃ­tulos y descripciones por pÃ¡gina
const pageConfig = {
  'dashboard': {
    title: 'Dashboard',
    description: 'Resumen general del sistema'
  },
  'ingreso-nna': {
    title: 'Ingreso NNA',
    description: 'Registro de nuevos niÃ±os, niÃ±as y adolescentes'
  },
  'histos': {
    title: 'Historiales',
    description: 'Historial clÃ­nico y seguimiento de casos'
  },
  'sessiones': {
    title: 'Sesiones',
    description: 'GestiÃ³n y programaciÃ³n de sesiones terapÃ©uticas'
  },
  'reportes': {
    title: 'Reportes',
    description: 'Informes y estadÃ­sticas del sistema'
  },
  'configuracion': {
    title: 'ConfiguraciÃ³n',
    description: 'Ajustes y configuraciÃ³n del sistema'
  },
  'establecimientos': {
    title: 'Establecimientos',
    description: 'GestiÃ³n de centros educacionales'
  }
}

const currentPage = computed(() => {
  const config = pageConfig[route.name as keyof typeof pageConfig]
  return config?.title || 'PÃ¡gina'
})

const pageTitle = computed(() => {
  const config = pageConfig[route.name as keyof typeof pageConfig]
  return config?.title || 'Dashboard'
})

const pageDescription = computed(() => {
  const config = pageConfig[route.name as keyof typeof pageConfig]
  return config?.description || ''
})

const gridClasses = computed(() => {
  const layouts = {
    single: 'lg:grid-cols-1',
    sidebar: 'lg:grid-cols-4',
    'two-column': 'lg:grid-cols-2',
    'three-column': 'lg:grid-cols-3'
  }
  return layouts[props.gridLayout]
})

const retryAction = () => {
  emit('retry')
}

// Manejo de redimensionamiento para responsividad
const handleResize = () => {
  // AquÃ­ puedes agregar lÃ³gica especÃ­fica para el redimensionamiento
}

onMounted(() => {
  window.addEventListener('resize', handleResize)
})

onUnmounted(() => {
  window.removeEventListener('resize', handleResize)
})
</script>

<style scoped>
/* Estilos especÃ­ficos para el contenido principal */
.container {
  width: 100%;
  max-width: 1400px;
}

/* OptimizaciÃ³n para pantallas pequeÃ±as */
@media (max-width: 640px) {
  .container {
    padding-left: 1rem;
    padding-right: 1rem;
  }
}

/* OptimizaciÃ³n para tablets */
@media (min-width: 768px) and (max-width: 1024px) {
  .container {
    padding-left: 1.5rem;
    padding-right: 1.5rem;
  }
}

/* OptimizaciÃ³n para televisores y pantallas grandes */
@media (min-width: 1920px) {
  .container {
    max-width: 1600px;
  }
}

/* Smooth scrolling */
.overflow-y-auto {
  scrollbar-width: thin;
  scrollbar-color: #cbd5e0 #f7fafc;
}

.overflow-y-auto::-webkit-scrollbar {
  width: 6px;
}

.overflow-y-auto::-webkit-scrollbar-track {
  background: #f7fafc;
}

.overflow-y-auto::-webkit-scrollbar-thumb {
  background-color: #cbd5e0;
  border-radius: 3px;
}

.overflow-y-auto::-webkit-scrollbar-thumb:hover {
  background-color: #a0aec0;
}
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\dashboard\NavigationItem.vue
============================================================
<template>
<!--   ruta de este archivo es src\components\dashboard\NavigationItem.vue -->
  <router-link 
    :to="item.to" 
    class="flex items-center px-4 py-3 text-gray-300 hover:bg-[#3c5690] hover:text-white transition-colors duration-200"
    :class="{'justify-center': !isSidebarOpen}"
    active-class="bg-[#3c5690] text-white"
  >
    <component 
      :is="resolveIcon(item.icon)" 
      class="h-5 w-5" 
      :class="{'mr-3': isSidebarOpen}"
    />
    <span v-if="isSidebarOpen" class="text-sm">{{ item.name }}</span>
  </router-link>
</template>

<script setup lang="ts">
import { 
  HomeIcon, 
  UserPlusIcon, 
  DocumentTextIcon, 
  ChartBarIcon, 
  Cog6ToothIcon, 
  BuildingStorefrontIcon,
  ChatBubbleLeftRightIcon 
} from '@heroicons/vue/24/outline'

defineProps<{
  item: {
    name: string
    to: object
    icon: string
  }
  isSidebarOpen: boolean
}>()

const resolveIcon = (iconName: string) => {
  const icons: { [key: string]: any } = {
    HomeIcon,
    UserPlusIcon,
    DocumentTextIcon,
    ChartBarIcon,
    Cog6ToothIcon,
    BuildingStorefrontIcon,
    ChatBubbleLeftRightIcon
  }
  return icons[iconName] || HomeIcon
}
</script>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\dashboard\NotificationsBell.vue
============================================================
<template>
  <div class="relative">
    <!-- BotÃ³n de notificaciones -->
    <button 
      @click="toggleNotifications"
      class="relative p-2 rounded-full text-gray-500 hover:text-gray-600 hover:bg-gray-100 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500"
      :class="{ 'animate-pulse': hasUnreadNotifications }"
    >
      <BellIcon class="h-6 w-6" />
      
      <!-- Badge de notificaciones no leÃ­das -->
      <Transition
        enter-active-class="transition ease-out duration-200"
        enter-from-class="transform scale-0"
        enter-to-class="transform scale-100"
        leave-active-class="transition ease-in duration-150"
        leave-from-class="transform scale-100"
        leave-to-class="transform scale-0"
      >
        <span v-if="unreadCount > 0" 
              class="absolute -top-1 -right-1 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-white bg-red-500 rounded-full animate-bounce">
          {{ unreadCount > 99 ? '99+' : unreadCount }}
        </span>
      </Transition>
    </button>

    <!-- Panel de notificaciones -->
    <Transition
      enter-active-class="transition ease-out duration-200"
      enter-from-class="opacity-0 scale-95 translate-y-1"
      enter-to-class="opacity-100 scale-100 translate-y-0"
      leave-active-class="transition ease-in duration-150"
      leave-from-class="opacity-100 scale-100 translate-y-0"
      leave-to-class="opacity-0 scale-95 translate-y-1"
    >
      <div v-if="showNotifications" 
           class="absolute right-0 mt-2 w-80 bg-white rounded-lg shadow-xl border border-gray-200 z-50 max-h-96 overflow-hidden">
        
        <!-- Header -->
        <div class="px-4 py-3 border-b border-gray-200 flex items-center justify-between">
          <h3 class="text-lg font-medium text-gray-900">Notificaciones</h3>
          <div class="flex items-center space-x-2">
            <button v-if="hasUnreadNotifications"
                    @click="markAllAsRead"
                    class="text-sm text-blue-600 hover:text-blue-800 transition-colors duration-150">
              Marcar todas como leÃ­das
            </button>
            <button @click="toggleNotifications" 
                    class="p-1 rounded-full hover:bg-gray-100 transition-colors duration-150">
              <XMarkIcon class="h-4 w-4 text-gray-500" />
            </button>
          </div>
        </div>

        <!-- Lista de notificaciones -->
        <div class="max-h-80 overflow-y-auto">
          <div v-if="notifications.length === 0" 
               class="p-6 text-center text-gray-500">
            <BellIcon class="h-12 w-12 mx-auto text-gray-300 mb-2" />
            <p>No hay notificaciones</p>
          </div>
          
          <div v-else class="divide-y divide-gray-100">
            <div v-for="notification in notifications" 
                 :key="notification.id"
                 @click="handleNotificationClick(notification)"
                 class="p-4 hover:bg-gray-50 cursor-pointer transition-colors duration-150"
                 :class="{ 'bg-blue-50': !notification.read }">
              
              <div class="flex items-start space-x-3">
                <div class="flex-shrink-0">
                  <div class="w-2 h-2 rounded-full mt-2"
                       :class="notification.read ? 'bg-gray-300' : 'bg-blue-500'"></div>
                </div>
                
                <div class="flex-1 min-w-0">
                  <div class="flex items-center justify-between">
                    <p class="text-sm font-medium text-gray-900 truncate"
                       :class="{ 'font-semibold': !notification.read }">
                      {{ notification.title }}
                    </p>
                    <span class="text-xs text-gray-500 whitespace-nowrap ml-2">
                      {{ formatTime(notification.time) }}
                    </span>
                  </div>
                  
                  <p class="text-sm text-gray-600 mt-1">
                    {{ notification.message }}
                  </p>
                  
                  <div v-if="notification.type" 
                       class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium mt-2"
                       :class="getTypeStyles(notification.type)">
                    <component :is="getTypeIcon(notification.type)" 
                               class="h-3 w-3 mr-1" />
                    {{ getTypeLabel(notification.type) }}
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Footer -->
        <div class="px-4 py-3 border-t border-gray-200 bg-gray-50">
          <button class="w-full text-center text-sm text-blue-600 hover:text-blue-800 font-medium transition-colors duration-150">
            Ver todas las notificaciones
          </button>
        </div>
      </div>
    </Transition>
  </div>
</template>

<script setup lang="ts">
import { ref, computed, onMounted, onUnmounted } from 'vue'
import { 
  BellIcon, 
  XMarkIcon,
  CalendarIcon,
  UserIcon,
  ExclamationTriangleIcon,
  InformationCircleIcon
} from '@heroicons/vue/24/outline'

interface Notification {
  id: string
  title: string
  message: string
  time: Date
  read: boolean
  type?: 'session' | 'user' | 'warning' | 'info'
  action?: () => void
}

const showNotifications = ref(false)
const notifications = ref<Notification[]>([
  {
    id: '1',
    title: 'SesiÃ³n programada',
    message: 'SesiÃ³n con TomÃ¡s Valenzuela TEA programada para las 15:00',
    time: new Date(Date.now() - 30 * 60 * 1000), // hace 30 minutos
    read: false,
    type: 'session'
  },
  {
    id: '2',
    title: 'Nueva derivaciÃ³n',
    message: 'Pedro Fuentes ha sido derivado a tu atenciÃ³n',
    time: new Date(Date.now() - 2 * 60 * 60 * 1000), // hace 2 horas
    read: false,
    type: 'user'
  },
  {
    id: '3',
    title: 'Recordatorio importante',
    message: 'Actualizar informes pendientes antes del viernes',
    time: new Date(Date.now() - 24 * 60 * 60 * 1000), // hace 1 dÃ­a
    read: true,
    type: 'warning'
  },
  {
    id: '4',
    title: 'Sistema actualizado',
    message: 'Nueva versiÃ³n disponible con mejoras de rendimiento',
    time: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000), // hace 3 dÃ­as
    read: true,
    type: 'info'
  }
])

const unreadCount = computed(() => 
  notifications.value.filter(n => !n.read).length
)

const hasUnreadNotifications = computed(() => unreadCount.value > 0)

const toggleNotifications = () => {
  showNotifications.value = !showNotifications.value
}

const markAllAsRead = () => {
  notifications.value.forEach(notification => {
    notification.read = true
  })
}

const handleNotificationClick = (notification: Notification) => {
  notification.read = true
  
  if (notification.action) {
    notification.action()
  }
  
  // AquÃ­ podrÃ­as agregar lÃ³gica para navegar a una pÃ¡gina especÃ­fica
  // basada en el tipo de notificaciÃ³n
}

const formatTime = (time: Date) => {
  const now = new Date()
  const diffInMinutes = Math.floor((now.getTime() - time.getTime()) / (1000 * 60))
  
  if (diffInMinutes < 1) return 'Ahora'
  if (diffInMinutes < 60) return `${diffInMinutes}m`
  if (diffInMinutes < 1440) return `${Math.floor(diffInMinutes / 60)}h`
  return `${Math.floor(diffInMinutes / 1440)}d`
}

const getTypeIcon = (type: string) => {
  const icons = {
    session: CalendarIcon,
    user: UserIcon,
    warning: ExclamationTriangleIcon,
    info: InformationCircleIcon
  }
  return icons[type as keyof typeof icons] || InformationCircleIcon
}

const getTypeStyles = (type: string) => {
  const styles = {
    session: 'bg-purple-100 text-purple-800',
    user: 'bg-blue-100 text-blue-800',
    warning: 'bg-yellow-100 text-yellow-800',
    info: 'bg-gray-100 text-gray-800'
  }
  return styles[type as keyof typeof styles] || 'bg-gray-100 text-gray-800'
}

const getTypeLabel = (type: string) => {
  const labels = {
    session: 'SesiÃ³n',
    user: 'Usuario',
    warning: 'Importante',
    info: 'InformaciÃ³n'
  }
  return labels[type as keyof typeof labels] || 'NotificaciÃ³n'
}

// Cerrar panel al hacer clic fuera
const handleClickOutside = (event: Event) => {
  const target = event.target as Element
  if (!target.closest('.relative')) {
    showNotifications.value = false
  }
}

onMounted(() => {
  document.addEventListener('click', handleClickOutside)
})

onUnmounted(() => {
  document.removeEventListener('click', handleClickOutside)
})

// Simular nuevas notificaciones cada cierto tiempo (para demo)
setInterval(() => {
  if (Math.random() > 0.95) { // 5% de probabilidad cada segundo
    notifications.value.unshift({
      id: Date.now().toString(),
      title: 'Nueva notificaciÃ³n',
      message: 'Esta es una notificaciÃ³n de ejemplo',
      time: new Date(),
      read: false,
      type: 'info'
    })
  }
}, 10000) // cada 10 segundos
</script>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\dashboard\padres\cards\ChildProfileCard.vue
============================================================

============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\dashboard\padres\ParentNavbar.vue
============================================================
<template>
  <nav 
    :class="[
      'sticky top-0 z-30 transition-all duration-300',
      'bg-white border-b border-gray-200',
      'shadow-sm backdrop-blur-sm bg-white/95'
    ]"
  >
    <div class="flex items-center justify-between px-6 py-4">
      <!-- Left: Breadcrumbs -->
      <div class="flex items-center space-x-4 animate-slide-in-left">
        <button
          @click="$emit('toggle-sidebar')"
          class="p-2 rounded-lg hover:bg-gray-100 transition-colors duration-200 lg:hidden"
        >
          <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
          </svg>
        </button>
        
        <!-- ğŸ”¥ Indicador de rol con color personalizado -->
        <div class="hidden lg:flex items-center space-x-2">
          <div class="w-2 h-2 rounded-full bg-parent-500 animate-pulse-soft"></div>
          <span class="text-sm font-medium text-parent-700">Portal Familia</span>
        </div>
      </div>

      <!-- Right: Actions -->
      <div class="flex items-center space-x-4 animate-slide-in-right">
        <!-- Notificaciones -->
        <button
          class="relative p-2 rounded-lg hover:bg-gray-100 transition-all duration-200 hover:scale-110"
        >
          <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
          </svg>
          <!-- Badge -->
          <span class="absolute top-1 right-1 w-2 h-2 bg-parent-500 rounded-full animate-pulse-soft"></span>
        </button>

        <!-- 
          AQUÃ ESTÃ LA CORRECCIÃ“N:
          He eliminado el <div class="relative"> y el <button> duplicados.
          Ahora solo estÃ¡ el componente <UserDropdown>.
        -->
        <UserDropdown
          :user-name="userName"
          :user-initials="userInitials"
          @logout="handleLogout"
        />
      </div>
    </div>
  </nav>
</template>

<script setup lang="ts">
import { computed } from 'vue'
import { useRouter } from 'vue-router' // <-- Se importa useRouter
import { useAuth } from '@/composables/useAuth'
import UserDropdown from './UserDropdown.vue' // <-- Importa el nuevo componente

defineProps<{
  isSidebarOpen: boolean
}>()

defineEmits<{
  'toggle-sidebar': []
}>()

const { user , logout } = useAuth() // <-- Corregido
const router = useRouter() // <-- Se instancia el router

const userName = computed(() => user.value?.name || 'Usuario')
const userInitials = computed(() => {
  const name = userName.value
  const parts = name.split(' ')
  return parts.map(p => p[0]).join('').slice(0, 2).toUpperCase()
})

// 3. Crea la funciÃ³n que maneja el evento 'logout'
const handleLogout = async () => {
  try {
    await logout()
    router.push('/login') // Redirige al login
  } catch (error) {
    console.error('Error al cerrar sesiÃ³n:', error)
  }
}
</script>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\dashboard\padres\ParentSidebar.vue
============================================================
<!-- src/components/dashboard/padres/ParentSidebar.vue -->
<template>
  <aside
    :class="[
      'fixed top-0 left-0 h-screen transition-all duration-300 ease-smooth z-40',
      isOpen ? 'w-64' : 'w-16',
      // ğŸ”¥ GRADIENTE SUAVE (mÃ¡s claro y amigable)
      'bg-gradient-to-b from-sky-500 to-blue-600',
      'shadow-xl'
    ]"
  >
    <!-- Header con Logo -->
    <div class="flex items-center justify-between p-4 border-b border-white/20">
      <div 
        v-if="isOpen"
        class="flex items-center space-x-3"
      >
        <!-- Logo/Icono -->
        <div class="w-10 h-10 rounded-xl bg-white/20 backdrop-blur-sm flex items-center justify-center shadow-lg">
          <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
          </svg>
        </div>
        <div>
          <h1 class="text-white font-bold text-lg">Portal</h1>
          <p class="text-blue-100 text-xs">Familia</p>
        </div>
      </div>
      
      <!-- BotÃ³n Collapse -->
      <button
        @click="$emit('toggle')"
        :class="[
          'p-2 rounded-lg bg-white/20 hover:bg-white/30 text-white',
          'transition-all duration-200 hover:scale-110',
          !isOpen && 'mx-auto'
        ]"
        :title="isOpen ? 'Contraer menÃº' : 'Expandir menÃº'"
      >
        <ChevronDoubleLeftIcon 
          :class="['w-5 h-5 transition-transform duration-300', { 'rotate-180': !isOpen }]"
        />
      </button>
    </div>

    <!-- Navigation Items -->
    <nav class="flex-1 p-4 space-y-1 overflow-y-auto custom-scrollbar">
      <router-link
        v-for="item in menuItems"
        :key="item.name"
        :to="item.route"
        v-slot="{ isActive }"
        class="block"
      >
        <div
          :class="[
            'flex items-center p-3 rounded-xl transition-all duration-200',
            'hover:bg-white/15 group',
            isActive 
              ? 'bg-white/25 text-white shadow-md backdrop-blur-sm' 
              : 'text-blue-50 hover:text-white',
            !isOpen && 'justify-center',
            isOpen && 'space-x-3'
          ]"
          :title="!isOpen ? item.label : ''"
        >
          <!-- Icon -->
          <component
            :is="item.icon"
            :class="[
              'w-6 h-6 flex-shrink-0 transition-transform duration-200',
              isActive ? 'scale-110' : 'group-hover:scale-110'
            ]"
          />
          
          <!-- Label -->
          <span
            v-if="isOpen"
            class="font-medium text-sm flex-1"
          >
            {{ item.label }}
          </span>
          
          <!-- Badge -->
          <span
            v-if="isOpen && item.badge && item.badge > 0"
            class="ml-auto px-2 py-0.5 text-xs font-bold rounded-full bg-white text-blue-600 shadow-sm"
          >
            {{ item.badge }}
          </span>
        </div>
      </router-link>
    </nav>

    <!-- Footer con Usuario -->
    <div class="p-4 border-t border-white/20">
      <div 
        :class="[
          'flex items-center p-3 rounded-xl bg-white/15 backdrop-blur-sm',
          'transition-all duration-200 hover:bg-white/25 cursor-pointer group',
          !isOpen && 'justify-center',
          isOpen && 'space-x-3'
        ]"
        @click="toggleUserMenu"
      >
        <!-- Avatar -->
        <div class="w-10 h-10 rounded-full bg-white flex items-center justify-center text-blue-600 font-bold flex-shrink-0 shadow-md">
          {{ userInitials }}
        </div>
        
        <!-- Info Usuario -->
        <div v-if="isOpen" class="flex-1 min-w-0">
          <p class="text-white text-sm font-medium truncate">{{ userName }}</p>
          <p class="text-blue-100 text-xs">Padre/Apoderado</p>
        </div>
        
        <!-- Flecha -->
        <ChevronDownIcon
          v-if="isOpen"
          :class="[
            'w-4 h-4 text-blue-100 flex-shrink-0 transition-transform duration-200',
            showUserMenu && 'rotate-180'
          ]"
        />
      </div>
      
      <!-- Mini Menu (Logout) -->
      <transition name="fade-scale">
        <div
          v-if="showUserMenu && isOpen"
          class="mt-2 p-2 rounded-xl bg-white/10 backdrop-blur-sm animate-slide-up"
        >
          <button
            @click="handleLogout"
            class="w-full flex items-center space-x-2 p-2 rounded-lg hover:bg-white/15 text-blue-50 hover:text-white transition-all duration-200 group"
          >
            <ArrowRightOnRectangleIcon class="w-5 h-5 group-hover:translate-x-0.5 transition-transform" />
            <span class="text-sm font-medium">Cerrar SesiÃ³n</span>
          </button>
        </div>
      </transition>
    </div>
  </aside>
</template>

<script setup lang="ts">
import { ref, computed } from 'vue'
import { useAuth } from '@/composables/useAuth'
import { useRouter } from 'vue-router'

// ğŸ”¥ IMPORTACIÃ“N CORRECTA DE HEROICONS V2
import {
  HomeIcon,
  UsersIcon,
  ClipboardDocumentListIcon,
  ClipboardDocumentCheckIcon,
  BeakerIcon,
  ChatBubbleLeftRightIcon,
  DocumentTextIcon,
  Cog6ToothIcon,
  ChevronDoubleLeftIcon,
  ChevronDownIcon,
  ArrowRightOnRectangleIcon
} from '@heroicons/vue/24/outline'

// Props
defineProps<{
  isOpen: boolean
}>()

// Emits
defineEmits<{
  toggle: []
}>()

// Composables
const { user, logout } = useAuth()
const router = useRouter()

// Estado local
const showUserMenu = ref(false)

// Computed
const userName = computed(() => user.value?.name || 'Usuario')
const userInitials = computed(() => {
  const name = userName.value
  const parts = name.split(' ')
  return parts.map(p => p[0]).join('').slice(0, 2).toUpperCase()
})

// MÃ©todos
const toggleUserMenu = () => {
  showUserMenu.value = !showUserMenu.value
}

const handleLogout = async () => {
  try {
    await logout()
    router.push({ name: 'login' })
  } catch (error) {
    console.error('Error al cerrar sesiÃ³n:', error)
  }
}

// ğŸ”¥ CONFIGURACIÃ“N DE MENÃš (Iconos importados directamente)
const menuItems = [
  {
    name: 'dashboard',
    label: 'Inicio',
    route: { name: 'parent-dashboard' },
    icon: HomeIcon,
    badge: 0
  },
  {
    name: 'mis-hijos',
    label: 'Mis Hijos',
    route: { name: 'parent-mis-hijos' },
    icon: UsersIcon,
    badge: 0
  },
  {
    name: 'registro-diario',
    label: 'Registro Diario',
    route: { name: 'parent-registro-diario' },
    icon: ClipboardDocumentListIcon,
    badge: 0
  },
  {
    name: 'rutinas',
    label: 'Rutinas',
    route: { name: 'parent-rutinas' },
    icon: ClipboardDocumentCheckIcon,
    badge: 0
  },
  {
    name: 'medicacion',
    label: 'MedicaciÃ³n',
    route: { name: 'parent-medicacion' },
    icon: BeakerIcon,
    badge: 0
  },
  {
    name: 'mensajes',
    label: 'Mensajes',
    route: { name: 'parent-mensajes' },
    icon: ChatBubbleLeftRightIcon,
    badge: 3 // TODO: Hacer dinÃ¡mico
  },
  {
    name: 'reportes',
    label: 'Reportes',
    route: { name: 'parent-reportes' },
    icon: DocumentTextIcon,
    badge: 0
  },
  {
    name: 'configuracion',
    label: 'ConfiguraciÃ³n',
    route: { name: 'parent-configuracion' },
    icon: Cog6ToothIcon,
    badge: 0
  }
]
</script>

<style scoped>
/* Scrollbar personalizado (mÃ¡s suave) */
.custom-scrollbar::-webkit-scrollbar {
  width: 6px;
}

.custom-scrollbar::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 10px;
}

.custom-scrollbar::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 10px;
  transition: background 0.2s;
}

.custom-scrollbar::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* Transiciones */
.fade-scale-enter-active,
.fade-scale-leave-active {
  transition: all 0.2s ease;
}

.fade-scale-enter-from {
  opacity: 0;
  transform: scale(0.95) translateY(-10px);
}

.fade-scale-leave-to {
  opacity: 0;
  transform: scale(0.95) translateY(-10px);
}

/* AnimaciÃ³n slide up */
@keyframes slideUp {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.animate-slide-up {
  animation: slideUp 0.3s ease-out;
}
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\dashboard\padres\PhotoPreview.vue
============================================================
<template>
    
</template>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\dashboard\padres\PhotoUploadModal.vue
============================================================
<!-- src/components/dashboard/padres/PhotoUploadModal.vue -->
<template>
  <BaseModal
    v-model:show="isVisible"
    :title="modalTitle"
    size="lg"
    @close="handleClose"
  >
    <!-- CONTENIDO DEL MODAL -->
    <div class="space-y-6">
      
      <!-- PASO 1: SELECCIONAR ARCHIVO -->
      <div v-if="currentStep === 'select'">
        <DropZone
          @file-selected="handleFileSelected"
          @file-error="handleFileError"
          :accept="acceptedFormats"
          :max-size-mb="10"
        />
        
        <!-- Mensajes de error -->
        <div v-if="errorMessage" class="mt-4 p-4 bg-red-50 border border-red-200 rounded-lg">
          <div class="flex items-start gap-3">
            <ExclamationCircleIcon class="w-5 h-5 text-red-600 flex-shrink-0 mt-0.5" />
            <div>
              <p class="text-sm font-medium text-red-800">Error al cargar la imagen</p>
              <p class="text-sm text-red-600 mt-1">{{ errorMessage }}</p>
            </div>
          </div>
        </div>
      </div>

      <!-- PASO 2: EDITAR/CROP IMAGEN -->
      <div v-else-if="currentStep === 'edit' && selectedFile">
        <ImageCropper
          :image-file="selectedFile"
          :aspect-ratio="1"
          crop-shape="circle"
          @crop-complete="handleCropComplete"
          @cancel="resetToSelect"
        />
      </div>

      <!-- PASO 3: PREVIEW Y CONFIRMAR -->
      <div v-else-if="currentStep === 'confirm' && croppedImage">
        <PhotoPreview
          :original-url="currentPhotoUrl"
          :new-image-blob="croppedImage"
          :child-name="childName"
        />

        <!-- Checkbox de consentimiento -->
        <div class="mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg">
          <label class="flex items-start gap-3 cursor-pointer">
            <input
              v-model="consentGiven"
              type="checkbox"
              class="mt-1 w-4 h-4 text-sky-600 border-gray-300 rounded focus:ring-sky-500"
            />
            <div class="text-sm">
              <p class="font-medium text-gray-900">
                Autorizo el uso de esta fotografÃ­a
              </p>
              <p class="text-gray-600 mt-1">
                Esta foto serÃ¡ visible para el equipo terapÃ©utico asignado a {{ childName }}.
                <a href="#" class="text-sky-600 hover:text-sky-700 underline">
                  Leer polÃ­tica de privacidad
                </a>
              </p>
            </div>
          </label>
        </div>
      </div>

      <!-- PASO 4: UPLOADING -->
      <div v-else-if="currentStep === 'uploading'">
        <UploadProgress
          :progress="uploadProgress"
          :status="uploadStatus"
          :message="uploadMessage"
        />
      </div>

    </div>

    <!-- FOOTER CON BOTONES -->
    <template #footer>
      <div class="flex items-center justify-between gap-3">
        
        <!-- Botones segÃºn el paso actual -->
        <div v-if="currentStep === 'select'" class="w-full flex justify-end">
          <button
            @click="handleClose"
            class="px-4 py-2 text-gray-700 hover:text-gray-900 transition-colors"
          >
            Cancelar
          </button>
        </div>

        <!-- En paso 'edit' los botones estÃ¡n dentro de ImageCropper -->
        <div v-else-if="currentStep === 'edit'" class="w-full">
          <!-- Espacio vacÃ­o - botones estÃ¡n en ImageCropper -->
        </div>

        <div v-else-if="currentStep === 'confirm'" class="flex gap-3 w-full">
          <button
            @click="backToEdit"
            class="flex-1 px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors"
          >
            â† Editar otra vez
          </button>
          <button
            @click="handleUpload"
            :disabled="!consentGiven || isUploading"
            class="flex-1 px-4 py-2 bg-gradient-to-r from-sky-500 to-blue-600 hover:from-sky-600 hover:to-blue-700 text-white font-medium rounded-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed"
          >
            Guardar foto
          </button>
        </div>

        <div v-else-if="currentStep === 'uploading'" class="w-full">
          <!-- Sin botones durante upload -->
        </div>

      </div>
    </template>
  </BaseModal>
</template>

<script setup lang="ts">
import { ref, computed, watch } from 'vue'
import { ExclamationCircleIcon } from '@heroicons/vue/24/outline'
import BaseModal from '@/components/modal/BaseModal.vue'
import DropZone from '@/components/common/DropZone.vue'
import ImageCropper from '@/components/common/ImageCropper.vue'
import PhotoPreview from '@/components/dashboard/padres/PhotoPreview.vue'
import UploadProgress from '@/components/common/UploadProgress.vue'
import { usePhotoUpload } from '@/composables/usePhotoUpload'
import { useAlertStore } from '@/store/alertStore'

interface Props {
  visible: boolean
  childId: number
  childName: string
  currentPhotoUrl: string | null
}

const props = defineProps<Props>()

const emit = defineEmits<{
  'update:visible': [value: boolean]
  'success': [photoUrl: string]
}>()

// Estado local
const isVisible = computed({
  get: () => props.visible,
  set: (value) => emit('update:visible', value)
})

type Step = 'select' | 'edit' | 'confirm' | 'uploading'
const currentStep = ref<Step>('select')
const selectedFile = ref<File | null>(null)
const croppedImage = ref<Blob | null>(null)
const consentGiven = ref(false)
const errorMessage = ref<string | null>(null)
const acceptedFormats = 'image/jpeg,image/png,image/webp'

// Composable
const {
  isUploading,
  uploadProgress,
  uploadPhoto,
  validateFile,
  error: uploadError
} = usePhotoUpload(computed(() => props.childId))

const alert = useAlertStore()

// Computed
const modalTitle = computed(() => {
  const titles = {
    select: `Subir foto de ${props.childName}`,
    edit: 'Ajustar foto',
    confirm: 'Confirmar nueva foto',
    uploading: 'Subiendo foto...'
  }
  return titles[currentStep.value]
})

const uploadStatus = computed(() => {
  if (uploadProgress.value < 50) return 'uploading'
  if (uploadProgress.value < 100) return 'processing'
  return 'complete'
})

const uploadMessage = computed(() => {
  if (uploadProgress.value < 50) return 'Subiendo tu foto...'
  if (uploadProgress.value < 100) return 'Optimizando imagen...'
  return 'Â¡Listo!'
})

// MÃ©todos
const handleFileSelected = async (file: File) => {
  errorMessage.value = null
  
  console.log('[PhotoUploadModal] ğŸ“ Archivo seleccionado:', file.name, `(${(file.size / 1024 / 1024).toFixed(2)} MB)`)
  
  try {
    // Validar archivo
    const isValid = await validateFile(file)
    
    if (!isValid) {
      errorMessage.value = uploadError.value || 'Imagen invÃ¡lida'
      console.error('[PhotoUploadModal] âŒ ValidaciÃ³n fallÃ³:', errorMessage.value)
      return
    }
    
    // Si es vÃ¡lida, continuar al crop
    console.log('[PhotoUploadModal] âœ… ValidaciÃ³n exitosa, ir a editar')
    selectedFile.value = file
    currentStep.value = 'edit'
    
  } catch (error: any) {
    console.error('[PhotoUploadModal] âŒ Error validando:', error)
    errorMessage.value = error.message || 'Error al validar la imagen'
  }
}

const handleFileError = (error: string) => {
  errorMessage.value = error
  console.error('[PhotoUploadModal] âŒ Error en archivo:', error)
}

const handleCropComplete = (blob: Blob) => {
  console.log('[PhotoUploadModal] âœ‚ï¸ Crop completado:', {
    size: `${(blob.size / 1024).toFixed(2)} KB`,
    type: blob.type
  })
  
  // Verificar que el blob no estÃ© vacÃ­o
  if (blob.size < 1000) {
    console.error('[PhotoUploadModal] âŒ Blob muy pequeÃ±o:', blob.size, 'bytes')
    errorMessage.value = 'Error procesando imagen. El archivo resultante es invÃ¡lido. Intenta de nuevo.'
    currentStep.value = 'select'
    return
  }
  
  croppedImage.value = blob
  currentStep.value = 'confirm'
}

const resetToSelect = () => {
  console.log('[PhotoUploadModal] ğŸ”„ Reset a select')
  currentStep.value = 'select'
  selectedFile.value = null
  croppedImage.value = null
  errorMessage.value = null
}

const backToEdit = () => {
  console.log('[PhotoUploadModal] â¬…ï¸ Volver a editar')
  currentStep.value = 'edit'
  croppedImage.value = null
}

// src/components/dashboard/padres/PhotoUploadModal.vue

const handleUpload = async () => {
  if (!croppedImage.value || !consentGiven.value) {
    console.warn('[PhotoUploadModal] âš ï¸ Falta imagen o consentimiento')
    return
  }

  try {
    currentStep.value = 'uploading'
    
    console.log('[PhotoUploadModal] ğŸš€ Iniciando upload del Blob procesado:', {
      size: `${(croppedImage.value.size / 1024).toFixed(2)} KB`,
      type: croppedImage.value.type
    })
    
    // Subir blob directamente
    const photoUrl = await uploadPhoto(croppedImage.value)

    // Ã‰xito
    console.log('[PhotoUploadModal] âœ… Upload exitoso:', photoUrl)
    
    // ğŸ”¥ FIX: Cambiar step ANTES de cerrar
    currentStep.value = 'select'
    
    alert.success(
      'Â¡Foto actualizada!',
      `La foto de ${props.childName} se actualizÃ³ correctamente`
    )

    emit('success', photoUrl)
    
    // ğŸ”¥ FIX: PequeÃ±o delay para que el alert se muestre
    setTimeout(() => {
      handleClose()
    }, 100)

  } catch (error: any) {
    console.error('[PhotoUploadModal] âŒ Error en upload:', error)
    currentStep.value = 'confirm'
    alert.error(
      'Error al subir foto',
      uploadError.value || 'OcurriÃ³ un error al subir la foto. Intenta nuevamente.'
    )
  }
}

const handleClose = () => {
  if (currentStep.value === 'uploading') {
    console.warn('[PhotoUploadModal] âš ï¸ No se puede cerrar durante upload')
    return
  }
  
  console.log('[PhotoUploadModal] âŒ Cerrando modal')
  
  // Reset
  currentStep.value = 'select'
  selectedFile.value = null
  croppedImage.value = null
  consentGiven.value = false
  errorMessage.value = null
  
  isVisible.value = false
}

// Watch para reset cuando se cierra
watch(() => props.visible, (newVal) => {
  if (!newVal) {
    setTimeout(() => {
      currentStep.value = 'select'
      selectedFile.value = null
      croppedImage.value = null
      consentGiven.value = false
      errorMessage.value = null
    }, 300) // Esperar animaciÃ³n de cierre
  }
})
</script>

<style scoped>
/* Estilos especÃ­ficos si son necesarios */
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\dashboard\padres\sesiones\SessionUltimaNotificacion.vue
============================================================
<template>
  
  <div v-if="isLoading" class="mt-6 p-4 bg-gray-50 border-l-4 border-gray-300 rounded-r-lg animate-pulse">
    <p class="text-xs font-semibold text-gray-500 uppercase">
      ğŸ“¢ Cargando Ãºltima actualizaciÃ³n...
    </p>
    <div class="h-4 bg-gray-200 rounded w-3/4 mt-2"></div>
    <div class="h-3 bg-gray-200 rounded w-1/4 mt-2"></div>
  </div>

  <div v-else-if="latestUpdate" class="mt-6 p-4 bg-blue-50 border-l-4 border-blue-500 rounded-r-lg">
    <p class="text-xs font-semibold text-blue-900 uppercase tracking-wide mb-2">
      ğŸ“¢ Ãšltimo mensaje del terapeuta
    </p>
    <p class="text-sm text-gray-700 leading-relaxed italic">
      "{{ latestUpdate.message }}"
    </p>
    <p class="text-xs text-gray-500 mt-2">
      - {{ latestUpdate.therapist_full_name }} (SesiÃ³n de {{ latestUpdate.child_name }})
    </p>
    <p class="text-xs text-gray-400 mt-1">
      {{ formattedDate }}
    </p>
  </div>

  <div v-else-if="error" class="mt-6 p-4 bg-gray-50 border-l-4 border-gray-400 rounded-r-lg">
    <p class="text-xs font-semibold text-gray-700 uppercase">
      ğŸ“¢ Actualizaciones
    </p>
    <p class="text-sm text-gray-600">
      {{ error }}
    </p>
  </div>
  
  <div v-else>
    </div>

</template>

<script setup lang="ts">
import { computed } from 'vue'
import { useLatestUpdate } from '@/composables/padres/useLatestUpdate'
// Tu package.json confirma que tienes 'date-fns'
import { formatDistanceToNow } from 'date-fns' 
import { es } from 'date-fns/locale'

// 1. Usar el composable para obtener los datos
const { latestUpdate, isLoading, error } = useLatestUpdate()

// 2. Crear la fecha "hace 3 horas"
const formattedDate = computed(() => {
  if (latestUpdate.value?.session_date) {
    return formatDistanceToNow(new Date(latestUpdate.value.session_date), {
      addSuffix: true, // "hace 3 horas"
      locale: es       // en espaÃ±ol
    })
  }
  return ''
})
</script>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\dashboard\padres\UserDropdown.vue
============================================================
<template>
  <!-- 
    Este div 'relative' es el contenedor principal. 
    Usamos ref="dropdown" para detectar clics fuera de Ã©l.
  -->
  <div class="relative" ref="dropdown">
    <!-- 
      Este es el BOTÃ“N PRINCIPAL que pasaste. 
      Ahora tiene un @click para mostrar/ocultar el menÃº.
    -->
    <button
      @click="toggleDropdown"
      class="flex items-center space-x-3 p-2 rounded-lg hover:bg-gray-100 transition-all duration-200 hover:scale-105"
    >
      <div class="w-8 h-8 rounded-full bg-gradient-parent flex items-center justify-center text-white text-sm font-bold">
        {{ userInitials }}
      </div>
      <div class="hidden md:block text-left">
        <p class="text-sm font-medium text-gray-700">{{ userName }}</p>
        <p class="text-xs text-parent-600">Padre</p>
      </div>
      <!-- Icono de flecha (opcional) -->
      <svg class="w-4 h-4 text-gray-500 transition-transform duration-200" :class="{'rotate-180': isOpen}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
      </svg>
    </button>

    <!-- 
      Este es el MENÃš DESPLEGABLE.
      Aparece y desaparece con una transiciÃ³n.
    -->
    <transition
      enter-active-class="transition ease-out duration-100"
      enter-from-class="transform opacity-0 scale-95"
      enter-to-class="transform opacity-100 scale-100"
      leave-active-class="transition ease-in duration-75"
      leave-from-class="transform opacity-100 scale-100"
      leave-to-class="transform opacity-0 scale-95"
    >
      <div
        v-if="isOpen"
        class="absolute right-0 mt-2 w-56 origin-top-right bg-white rounded-lg shadow-xl ring-1 ring-black ring-opacity-5 focus:outline-none"
      >
        <div class="py-1">
          <!-- Item: Perfil -->
          <router-link
            to="/parent/profile"
            class="flex items-center w-full px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-colors"
            @click="isOpen = false"
          >
            <!-- Icono de Perfil (inline SVG) -->
            <svg class="w-5 h-5 mr-3 text-gray-500" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" />
            </svg>
            Mi Perfil
          </router-link>

          <!-- Item: ConfiguraciÃ³n -->
          <router-link
            to="/parent/settings"
            class="flex items-center w-full px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-colors"
            @click="isOpen = false"
          >
            <!-- Icono de ConfiguraciÃ³n (inline SVG) -->
            <svg class="w-5 h-5 mr-3 text-gray-500" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.532 1.532 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.532 1.532 0 01-.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd" />
            </svg>
            ConfiguraciÃ³n
          </router-link>

          <!-- Separador -->
          <div class="border-t border-gray-100"></div>

          <!-- Item: Salir -->
          <button
            @click="handleLogout"
            class="flex items-center w-full px-4 py-2 text-sm text-red-600 hover:bg-red-50 transition-colors"
          >
            <!-- Icono de Salir (inline SVG) -->
            <svg class="w-5 h-5 mr-3" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M3 3a1 1 0 00-1 1v12a1 1 0 102 0V4a1 1 0 00-1-1zm10.293 9.293a1 1 0 001.414 1.414l3-3a1 1 0 000-1.414l-3-3a1 1 0 10-1.414 1.414L14.586 9H7a1 1 0 100 2h7.586l-1.293 1.293z" clip-rule="evenodd" />
            </svg>
            Cerrar SesiÃ³n
          </button>
        </div>
      </div>
    </transition>
  </div>
</template>

<script setup lang="ts">
import { ref, onMounted, onUnmounted } from 'vue'

// --- PROPS ---
defineProps<{
  userName: string
  userInitials: string
}>()

// --- EMITS ---
// Este componente no maneja el logout, solo le avisa al padre (Navbar)
// que el usuario quiere salir.
const emit = defineEmits<{
  'logout': []
}>()

// --- ESTADO INTERNO ---
const isOpen = ref(false)
const dropdown = ref<HTMLElement | null>(null)

// --- FUNCIONES ---
const toggleDropdown = () => {
  isOpen.value = !isOpen.value
}

const handleLogout = () => {
  isOpen.value = false
  emit('logout')
}

// --- LÃ“GICA DE "CLICK-AWAY" ---
// Cierra el menÃº si el usuario hace clic fuera de Ã©l
const handleClickOutside = (event: MouseEvent) => {
  if (dropdown.value && !dropdown.value.contains(event.target as Node)) {
    isOpen.value = false
  }
}

// Agregamos el listener global cuando el componente se monta
onMounted(() => {
  document.addEventListener('click', handleClickOutside)
})

// Lo quitamos cuando se desmonta para evitar problemas de memoria
onUnmounted(() => {
  document.removeEventListener('click', handleClickOutside)
})
</script>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\dashboard\SearchBar.vue
============================================================
<template>
  <div class="relative">
    <div class="relative">
      <MagnifyingGlassIcon class="absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400" />
      <input
        v-model="searchQuery"
        @input="handleSearch"
        @focus="showResults = true"
        @blur="handleBlur"
        type="text"
        placeholder="Buscar en el sistema..."
        class="w-full pl-10 pr-4 py-2 bg-gray-50 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all duration-200"
      />
      <div v-if="isSearching" class="absolute right-3 top-1/2 transform -translate-y-1/2">
        <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-blue-500"></div>
      </div>
    </div>

    <!-- Resultados de bÃºsqueda -->
    <Transition
      enter-active-class="transition ease-out duration-200"
      enter-from-class="opacity-0 translate-y-1"
      enter-to-class="opacity-100 translate-y-0"
      leave-active-class="transition ease-in duration-150"
      leave-from-class="opacity-100 translate-y-0"
      leave-to-class="opacity-0 translate-y-1"
    >
      <div v-if="showResults && (searchResults.length > 0 || searchQuery.length > 0)" 
           class="absolute top-full left-0 right-0 mt-1 bg-white border border-gray-200 rounded-lg shadow-lg z-50 max-h-96 overflow-y-auto">
        <div v-if="searchQuery.length === 0" class="p-4 text-gray-500 text-center">
          Ingresa al menos un carÃ¡cter para buscar
        </div>
        
        <div v-else-if="searchResults.length === 0 && !isSearching" class="p-4 text-gray-500 text-center">
          No se encontraron resultados para "{{ searchQuery }}"
        </div>
        
        <div v-else class="divide-y divide-gray-100">
          <div v-for="result in searchResults" :key="result.id" 
               @mousedown="selectResult(result)"
               class="p-3 hover:bg-gray-50 cursor-pointer transition-colors duration-150">
            <div class="flex items-center space-x-3">
              <div class="flex-shrink-0">
                <component :is="getIcon(result.type)" class="h-5 w-5 text-gray-400" />
              </div>
              <div class="flex-1 min-w-0">
                <p class="text-sm font-medium text-gray-900 truncate">{{ result.title }}</p>
                <p class="text-sm text-gray-500 truncate">{{ result.subtitle }}</p>
              </div>
              <div class="flex-shrink-0">
                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium"
                      :class="getTypeColor(result.type)">
                  {{ getTypeLabel(result.type) }}
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </Transition>
  </div>
</template>

<script setup lang="ts">
import { ref, onUnmounted } from 'vue'
import { useRouter } from 'vue-router'
import { 
  MagnifyingGlassIcon,
  UserIcon,
  DocumentTextIcon,
  ChatBubbleLeftRightIcon,
  ChartBarIcon,
  BuildingStorefrontIcon,
  Cog6ToothIcon
} from '@heroicons/vue/24/outline'

interface SearchResult {
  id: string
  title: string
  subtitle: string
  type: 'user' | 'document' | 'session' | 'report' | 'establishment' | 'setting'
  route?: string
  action?: () => void
}

const router = useRouter()
const searchQuery = ref('')
const showResults = ref(false)
const isSearching = ref(false)
const searchTimeout = ref<number | undefined>()
// Mock data - en producciÃ³n vendrÃ­a de una API
const mockData: SearchResult[] = [
  { id: '1', title: 'TomÃ¡s Valenzuela', subtitle: 'Estudiante - 7Â° BÃ¡sico', type: 'user', route: '/histos' },
  { id: '2', title: 'Pedro Fuentes', subtitle: 'Estudiante - 5Â° BÃ¡sico - TEA', type: 'user', route: '/histos' },
  { id: '3', title: 'SesiÃ³n con MarÃ­a GonzÃ¡lez', subtitle: 'Programada para hoy 15:00', type: 'session', route: '/sessiones' },
  { id: '4', title: 'Reporte Mensual Marzo', subtitle: 'Informe de seguimiento', type: 'report', route: '/reportes' },
  { id: '5', title: 'Escuela San Pedro', subtitle: 'Establecimiento educacional', type: 'establishment', route: '/establecimientos' },
  { id: '6', title: 'ConfiguraciÃ³n de notificaciones', subtitle: 'Ajustes del sistema', type: 'setting', route: '/configuracion' }
]

const searchResults = ref<SearchResult[]>([])

const handleSearch = () => {
  isSearching.value = true
  
  if (searchTimeout.value) {
    clearTimeout(searchTimeout.value)
  }
  
  searchTimeout.value = setTimeout(() => {
    if (searchQuery.value.trim().length === 0) {
      searchResults.value = []
    } else {
      // Simular bÃºsqueda
      searchResults.value = mockData.filter(item =>
        item.title.toLowerCase().includes(searchQuery.value.toLowerCase()) ||
        item.subtitle.toLowerCase().includes(searchQuery.value.toLowerCase())
      )
    }
    isSearching.value = false
  }, 300)
}

const handleBlur = () => {
  // PequeÃ±o delay para permitir clicks en resultados
  setTimeout(() => {
    showResults.value = false
  }, 200)
}

const selectResult = (result: SearchResult) => {
  if (result.route) {
    router.push(result.route)
  } else if (result.action) {
    result.action()
  }
  
  searchQuery.value = result.title
  showResults.value = false
}

const getIcon = (type: string) => {
  const icons = {
    user: UserIcon,
    document: DocumentTextIcon,
    session: ChatBubbleLeftRightIcon,
    report: ChartBarIcon,
    establishment: BuildingStorefrontIcon,
    setting: Cog6ToothIcon
  }
  return icons[type as keyof typeof icons] || UserIcon
}

const getTypeColor = (type: string) => {
  const colors = {
    user: 'bg-blue-100 text-blue-800',
    document: 'bg-green-100 text-green-800',
    session: 'bg-purple-100 text-purple-800',
    report: 'bg-yellow-100 text-yellow-800',
    establishment: 'bg-indigo-100 text-indigo-800',
    setting: 'bg-gray-100 text-gray-800'
  }
  return colors[type as keyof typeof colors] || 'bg-gray-100 text-gray-800'
}

const getTypeLabel = (type: string) => {
  const labels = {
    user: 'Estudiante',
    document: 'Documento',
    session: 'SesiÃ³n',
    report: 'Reporte',
    establishment: 'Centro',
    setting: 'ConfiguraciÃ³n'
  }
  return labels[type as keyof typeof labels] || 'Desconocido'
}

onUnmounted(() => {
  if (searchTimeout.value) {
    clearTimeout(searchTimeout.value)
  }
})
</script>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\dashboard\Sidebar.vue
============================================================
<template>
 <!--  src\components\dashboard\Sidebar.vue -->
  <aside :class="sidebarClasses">
    <!-- Header del sidebar -->
    <div class="flex items-center justify-between p-4 border-b border-[#3c5690]">
      <Transition
        enter-active-class="transition ease-out duration-300"
        enter-from-class="opacity-0 scale-90"
        enter-to-class="opacity-100 scale-100"
        leave-active-class="transition ease-in duration-200"
        leave-from-class="opacity-100 scale-100"
        leave-to-class="opacity-0 scale-90"
      >
        <img v-if="isOpen" 
             :src="logo" 
             alt="divermind" 
             class="h-8 sidebar-logo transition-all duration-300" />
      </Transition>
      
      <button @click="$emit('toggle')" 
              class="p-2 rounded-lg hover:bg-[#3c5690] transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-400">
        <Transition
          enter-active-class="transition ease-out duration-200"
          enter-from-class="opacity-0 rotate-90"
          enter-to-class="opacity-100 rotate-0"
          leave-active-class="transition ease-in duration-150"
          leave-from-class="opacity-100 rotate-0"
          leave-to-class="opacity-0 -rotate-90"
          mode="out-in"
        >
          <Bars3CenterLeftIcon v-if="!isOpen" class="h-6 w-6" />
          <XMarkIcon v-else class="h-6 w-6" />
        </Transition>
      </button>
    </div>
    
    <!-- NavegaciÃ³n principal -->
    <nav class="mt-6 flex-1">
      <div class="space-y-1 px-2">
        <NavigationItem 
          v-for="item in navigation" 
          :key="item.name" 
          :item="item" 
          :isSidebarOpen="isOpen"
          class="nav-item"
        />
      </div>
    </nav>
    
    <!-- Footer del sidebar -->
    <div class="border-t border-[#3c5690] p-4">
      <Transition
        enter-active-class="transition ease-out duration-300 delay-100"
        enter-from-class="opacity-0 translate-y-2"
        enter-to-class="opacity-100 translate-y-0"
        leave-active-class="transition ease-in duration-200"
        leave-from-class="opacity-100 translate-y-0"
        leave-to-class="opacity-0 translate-y-2"
      >
        <div v-if="isOpen" class="sidebar-content">
          <div class="flex items-center space-x-3 text-gray-300">
            <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg flex items-center justify-center">
              <span class="text-sm font-semibold text-white">v2</span>
            </div>
            <div class="text-sm">
              <p class="font-medium">Sistema v2.1</p>
              <p class="text-xs text-gray-400">Actualizado</p>
            </div>
          </div>
        </div>
      </Transition>
    </div>
    
    <!-- Overlay para mÃ³vil -->
    <Transition
      enter-active-class="transition ease-out duration-200"
      enter-from-class="opacity-0"
      enter-to-class="opacity-100"
      leave-active-class="transition ease-in duration-150"
      leave-from-class="opacity-100"
      leave-to-class="opacity-0"
    >
      <div v-if="isOpen && isMobile" 
           @click="$emit('toggle')"
           class="fixed inset-0 bg-black bg-opacity-50 z-40 md:hidden"></div>
    </Transition>
  </aside>
</template>

<script setup lang="ts">
import { computed, onMounted, onUnmounted, ref } from 'vue'
import { Bars3CenterLeftIcon, XMarkIcon } from '@heroicons/vue/24/outline'
import NavigationItem from './NavigationItem.vue'
import logo from '@/assets/dashboard/logo-horizontal-dashboard.png'

// Importar el CSS mejorado
import '@/assets/css/dashboard-enhanced.css'

const props = defineProps<{
  isOpen: boolean
}>()

defineEmits(['toggle'])

const isMobile = ref(false)

// âœ… NAVEGACIÃ“N CORREGIDA - Mantener 'sessiones' con doble 's'
const navigation = [
Â  { name: 'Dashboard', to: { name: 'dashboard' }, icon: 'HomeIcon' },
Â  { name: 'GestiÃ³n NNA', to: { name: 'lista-nna' }, icon: 'UserGroupIcon' }, // O usa 'UserPlusIcon'
Â  { name: 'Histos', to: { name: 'histos' }, icon: 'DocumentTextIcon' },
  // âœ… CORREGIDO: El nombre de la ruta ahora es 'sesiones' (con una 's')
Â  { name: 'Sesiones', to: { name: 'sesiones' }, icon: 'ChatBubbleLeftRightIcon' },
Â  { name: 'Reportes', to: { name: 'reportes' }, icon: 'ChartBarIcon' },
Â  { name: 'ConfiguraciÃ³n', to: { name: 'configuracion' }, icon: 'Cog6ToothIcon' },
Â  { name: 'Establecimientos', to: { name: 'establecimientos' }, icon: 'BuildingStorefrontIcon' },
]

const sidebarClasses = computed(() => [
  'sidebar',
  'fixed inset-y-0 left-0 text-white transform transition-all duration-300 ease-out z-50 flex flex-col',
  {
    'sidebar-expanded': props.isOpen && !isMobile.value,
    'sidebar-collapsed': !props.isOpen && !isMobile.value,
    'sidebar-hidden': !props.isOpen && isMobile.value,
  }
])

// Detectar tamaÃ±o de pantalla
const checkScreenSize = () => {
  isMobile.value = window.innerWidth < 768
}

onMounted(() => {
  checkScreenSize()
  window.addEventListener('resize', checkScreenSize)
})

onUnmounted(() => {
  window.removeEventListener('resize', checkScreenSize)
})
</script>

<style scoped>
/* AÃ±adir gradiente al fondo del sidebar */
.sidebar {
  background: linear-gradient(135deg, #132441 0%, #1a2951 100%);
}

/* Mejorar la sombra */
.sidebar {
  box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
}
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\dashboard\TopNavbar.vue
============================================================
<template>
  <!-- src\components\dashboard\TopNavbar.vue -->
  <header class="bg-white shadow-lg border-b border-gray-200/60 backdrop-blur-sm relative z-40">
    <div class="flex items-center justify-between px-4 py-3 sm:px-6">
      
      <!-- Lado izquierdo: Toggle sidebar y tÃ­tulo -->
      <div class="flex items-center space-x-4">
        <button 
          @click="$emit('toggle-sidebar')" 
          class="group p-2 rounded-xl text-gray-500 hover:text-blue-600 hover:bg-blue-50 transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-blue-500/20 transform hover:scale-105"
        >
          <Bars3Icon class="h-6 w-6 transition-transform duration-200 group-hover:rotate-180" />
        </button>
        
        <div class="hidden sm:block">
          <h1 class="text-xl lg:text-2xl font-bold bg-gradient-to-r from-gray-800 to-gray-600 bg-clip-text text-transparent">
            {{ currentRouteName }}
          </h1>
          <p class="text-sm text-gray-500 mt-0.5">{{ getRouteDescription }}</p>
        </div>
      </div>
      
      <!-- Lado derecho: Buscador, notificaciones y perfil -->
      <div class="flex items-center space-x-3">
        
        <!-- Buscador desktop -->
        <div class="hidden md:block relative">
          <div class="w-80 lg:w-96">
            <SearchBar />
          </div>
        </div>
        
        <!-- BotÃ³n de bÃºsqueda mÃ³vil -->
        <button 
          @click="toggleMobileSearch"
          class="md:hidden p-2.5 rounded-xl text-gray-500 hover:text-blue-600 hover:bg-blue-50 transition-all duration-300 transform hover:scale-105"
        >
          <MagnifyingGlassIcon class="h-5 w-5" />
        </button>
        
        <!-- Separador visual -->
        <div class="hidden sm:block w-px h-6 bg-gray-200"></div>
        
        <!-- Notificaciones -->
        <div class="relative">
          <NotificationsBell />
        </div>
        
        <!-- Separador visual -->
        <div class="hidden sm:block w-px h-6 bg-gray-200"></div>
        
        <!-- MenÃº de perfil -->
        <div class="relative">
          <button 
            @click="toggleProfileMenu" 
            class="flex items-center space-x-3 p-2 rounded-xl hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500/20 transition-all duration-300 group"
            :class="{ 'bg-gray-50 ring-2 ring-blue-500/20': isProfileMenuOpen }"
          >
            <div class="relative">
              <img 
                :src="userImage" 
                class="h-9 w-9 rounded-full border-2 border-white shadow-md transition-all duration-300 group-hover:shadow-lg" 
                alt="User profile"
                @error="handleImageError"
              />
              <div class="absolute -bottom-1 -right-1 w-3 h-3 bg-green-400 border-2 border-white rounded-full animate-pulse"></div>
            </div>
            
            <div class="hidden md:block text-left">
              <span class="text-sm font-semibold text-gray-800">{{ userName }}</span>
              <div class="text-xs text-gray-500 flex items-center space-x-2">
                <span>{{ userRole }}</span>
                <span class="w-1 h-1 bg-gray-400 rounded-full"></span>
                <span class="text-green-600">En lÃ­nea</span>
              </div>
            </div>
            
            <ChevronDownIcon 
              class="h-4 w-4 text-gray-500 transition-all duration-300 group-hover:text-blue-600"
              :class="{ 'transform rotate-180 text-blue-600': isProfileMenuOpen }" 
            />
          </button>
          
          <!-- MenÃº desplegable de perfil -->
          <Transition
            enter-active-class="transition ease-out duration-300"
            enter-from-class="opacity-0 scale-95 translate-y-2"
            enter-to-class="opacity-100 scale-100 translate-y-0"
            leave-active-class="transition ease-in duration-200"
            leave-from-class="opacity-100 scale-100 translate-y-0"
            leave-to-class="opacity-0 scale-95 translate-y-2"
          >
            <div 
              v-if="isProfileMenuOpen" 
              class="absolute right-0 mt-3 w-72 bg-white rounded-2xl shadow-2xl ring-1 ring-black/5 z-50 overflow-hidden"
            >
              <!-- Header del perfil -->
              <div class="px-6 py-4 bg-gradient-to-r from-blue-50 to-indigo-50 border-b border-gray-100">
                <div class="flex items-center space-x-3">
                  <img 
                    :src="userImage" 
                    class="h-12 w-12 rounded-full border-3 border-white shadow-md" 
                    alt="User profile" 
                  />
                  <div>
                    <p class="text-base font-semibold text-gray-900">{{ userName }}</p>
                    <p class="text-sm text-gray-600">{{ userEmail }}</p>
                  </div>
                </div>
                
                <!-- Badges de estado y rol -->
                <div class="mt-3 flex items-center space-x-2">
                  <span 
                    class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium"
                    :class="userStatusClass"
                  >
                    <div class="w-1.5 h-1.5 bg-current rounded-full mr-2 animate-pulse"></div>
                    {{ userStatusText }}
                  </span>
                  <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                    {{ userRole }}
                  </span>
                </div>
              </div>
              
              <!-- Opciones del menÃº -->
              <div class="py-2">
                <a 
                  href="#" 
                  @click.prevent="handleProfileClick"
                  class="flex items-center px-6 py-3 text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-900 transition-all duration-200 group"
                >
                  <UserCircleIcon class="h-5 w-5 mr-3 text-gray-400 group-hover:text-blue-500 transition-colors duration-200" />
                  <span>Mi Perfil</span>
                  <ChevronRightIcon class="h-4 w-4 ml-auto text-gray-300 group-hover:text-blue-400 transition-colors duration-200" />
                </a>
                
                <a 
                  href="#" 
                  @click.prevent="handleSettingsClick"
                  class="flex items-center px-6 py-3 text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-900 transition-all duration-200 group"
                >
                  <Cog6ToothIcon class="h-5 w-5 mr-3 text-gray-400 group-hover:text-blue-500 transition-colors duration-200" />
                  <span>ConfiguraciÃ³n</span>
                  <ChevronRightIcon class="h-4 w-4 ml-auto text-gray-300 group-hover:text-blue-400 transition-colors duration-200" />
                </a>
                
                <a 
                  href="#" 
                  @click.prevent="handleHelpClick"
                  class="flex items-center px-6 py-3 text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-900 transition-all duration-200 group"
                >
                  <QuestionMarkCircleIcon class="h-5 w-5 mr-3 text-gray-400 group-hover:text-blue-500 transition-colors duration-200" />
                  <span>Ayuda y Soporte</span>
                  <ChevronRightIcon class="h-4 w-4 ml-auto text-gray-300 group-hover:text-blue-400 transition-colors duration-200" />
                </a>
              </div>
              
              <!-- Separador -->
              <div class="border-t border-gray-100"></div>
              
              <!-- Cerrar sesiÃ³n -->
              <div class="py-2">
                <button 
                  @click="handleLogout"
                  class="flex items-center w-full px-6 py-3 text-sm text-red-600 hover:bg-red-50 hover:text-red-700 transition-all duration-200 group"
                >
                  <ArrowRightOnRectangleIcon class="h-5 w-5 mr-3 text-red-500 group-hover:text-red-600 transition-colors duration-200" />
                  <span class="font-medium">Cerrar sesiÃ³n</span>
                </button>
              </div>
            </div>
          </Transition>
        </div>
      </div>
    </div>
    
    <!-- Buscador mÃ³vil expandible -->
    <Transition
      enter-active-class="transition ease-out duration-300"
      enter-from-class="opacity-0 -translate-y-4"
      enter-to-class="opacity-100 translate-y-0"
      leave-active-class="transition ease-in duration-200"
      leave-from-class="opacity-100 translate-y-0"
      leave-to-class="opacity-0 -translate-y-4"
    >
      <div 
        v-if="showMobileSearch" 
        class="md:hidden px-4 pb-4 border-t border-gray-200/60 bg-gradient-to-r from-gray-50 to-blue-50/30"
      >
        <div class="mt-3">
          <SearchBar />
        </div>
      </div>
    </Transition>
  </header>
</template>

<script setup lang="ts">
import { ref, computed, onMounted, onUnmounted } from 'vue'
import { useRoute, useRouter } from 'vue-router'
import { 
  Bars3Icon, 
  MagnifyingGlassIcon,
  ChevronDownIcon,
  ChevronRightIcon,
  UserCircleIcon,
  Cog6ToothIcon,
  QuestionMarkCircleIcon,
  ArrowRightOnRectangleIcon
} from '@heroicons/vue/24/outline'
import SearchBar from './SearchBar.vue'
import NotificationsBell from './NotificationsBell.vue'

// Importamos el composable de autenticaciÃ³n
import { useAuth } from '@/composables/useAuth'

// Props y emits
defineEmits(['toggle-sidebar'])

// Composables
const route = useRoute()
const router = useRouter()
const { logout } = useAuth()

// Estados reactivos
const isProfileMenuOpen = ref(false)
const showMobileSearch = ref(false)

// Datos del usuario autenticado
const userData = ref({
  name: '',
  email: '',
  role: '',
  status: 'online',
  image: ''
})

// Al montar, cargamos el usuario desde localStorage
onMounted(() => {
  const storedUser = localStorage.getItem('user')
  if (storedUser) {
    try {
      const parsedUser = JSON.parse(storedUser)
      userData.value = {
        name: parsedUser.name || 'Usuario',
        email: parsedUser.email || 'correo@ejemplo.com',
        // ğŸ‘‡ AquÃ­ usamos roles[0] porque tu backend devuelve un array
        role: parsedUser.roles?.[0] || 'Rol no asignado',
        status: 'online',
        image: parsedUser.image || ''
      }
    } catch (e) {
      console.error('Error al parsear usuario:', e)
    }
  }
})

// Computed properties
const currentRouteName = computed(() => {
  const routeNames: Record<string, string> = {
    'dashboard': 'Dashboard',
    'ingreso-nna': 'Ingreso NNA',
    'histos': 'Historiales',
    'sessiones': 'Sesiones',
    'reportes': 'Reportes',
    'configuracion': 'ConfiguraciÃ³n',
    'establecimientos': 'Establecimientos'
  }
  return routeNames[route.name as string] || 'Sistema'
})

const getRouteDescription = computed(() => {
  const descriptions: Record<string, string> = {
    'dashboard': 'Panel principal del sistema',
    'ingreso-nna': 'Registro de nuevos casos',
    'histos': 'GestiÃ³n de historiales clÃ­nicos',
    'sessiones': 'ProgramaciÃ³n de sesiones',
    'reportes': 'AnÃ¡lisis y estadÃ­sticas',
    'configuracion': 'Ajustes del sistema',
    'establecimientos': 'GestiÃ³n de centros'
  }
  return descriptions[route.name as string] || 'NavegaciÃ³n del sistema'
})

const userName = computed(() => userData.value.name)
const userEmail = computed(() => userData.value.email)
const userRole = computed(() => userData.value.role) // ğŸ‘ˆ rol dinÃ¡mico
const userImage = computed(() => 
  userData.value.image || 
  `https://ui-avatars.com/api/?name=${encodeURIComponent(userData.value.name || 'U')}&background=3B82F6&color=fff&size=128`
)

const userStatusClass = computed(() => {
  const statusClasses: Record<string, string> = {
    'online': 'bg-green-100 text-green-800',
    'away': 'bg-yellow-100 text-yellow-800',
    'busy': 'bg-red-100 text-red-800',
    'offline': 'bg-gray-100 text-gray-800'
  }
  return statusClasses[userData.value.status] || 'bg-gray-100 text-gray-800'
})

const userStatusText = computed(() => {
  const statusTexts: Record<string, string> = {
    'online': 'En lÃ­nea',
    'away': 'Ausente',
    'busy': 'Ocupado',
    'offline': 'Desconectado'
  }
  return statusTexts[userData.value.status] || 'Desconocido'
})

// MÃ©todos
const toggleProfileMenu = () => {
  isProfileMenuOpen.value = !isProfileMenuOpen.value
}

const toggleMobileSearch = () => {
  showMobileSearch.value = !showMobileSearch.value
}

const handleImageError = () => {
  userData.value.image = `https://ui-avatars.com/api/?name=${encodeURIComponent(userData.value.name || 'U')}&background=3B82F6&color=fff&size=128`
}

const handleProfileClick = () => {
  isProfileMenuOpen.value = false
  router.push({ name: 'profile' })
}

const handleSettingsClick = () => {
  isProfileMenuOpen.value = false
  router.push({ name: 'configuracion' })
}

const handleHelpClick = () => {
  isProfileMenuOpen.value = false
  console.log('Abrir ayuda')
}

const handleLogout = async () => {
  isProfileMenuOpen.value = false
  await logout()
}

// Cerrar menÃºs al hacer clic fuera
const handleClickOutside = (event: Event) => {
  const target = event.target as Element
  if (isProfileMenuOpen.value && !target.closest('.relative')) {
    isProfileMenuOpen.value = false
  }
  if (showMobileSearch.value && !target.closest('header')) {
    showMobileSearch.value = false
  }
}

// Cerrar menÃºs con tecla Escape
const handleKeyDown = (event: KeyboardEvent) => {
  if (event.key === 'Escape') {
    isProfileMenuOpen.value = false
    showMobileSearch.value = false
  }
}

onMounted(() => {
  document.addEventListener('click', handleClickOutside)
  document.addEventListener('keydown', handleKeyDown)
})

onUnmounted(() => {
  document.removeEventListener('click', handleClickOutside)
  document.removeEventListener('keydown', handleKeyDown)
})
</script>



<style scoped>
/* Estilos adicionales para mejorar la apariencia */
.backdrop-blur-sm {
  backdrop-filter: blur(4px);
}

/* Animaciones suaves para los elementos interactivos */
button {
  transform-origin: center;
}

/* Estilos para el scrollbar del menÃº de perfil */
.overflow-y-auto::-webkit-scrollbar {
  width: 4px;
}

.overflow-y-auto::-webkit-scrollbar-track {
  background: transparent;
}

.overflow-y-auto::-webkit-scrollbar-thumb {
  background-color: rgba(156, 163, 175, 0.3);
  border-radius: 2px;
}

.overflow-y-auto::-webkit-scrollbar-thumb:hover {
  background-color: rgba(156, 163, 175, 0.5);
}

/* Efectos de hover mÃ¡s suaves */
.group:hover .group-hover\:rotate-180 {
  transform: rotate(180deg);
}

.group:hover .group-hover\:scale-105 {
  transform: scale(1.05);
}

/* Gradientes de texto */
.bg-clip-text {
  -webkit-background-clip: text;
  background-clip: text;
}

/* Sombras personalizadas */
.shadow-2xl {
  box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
}
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\forms\DraftManager.vue
============================================================
<!-- src/components/forms/DraftManager.vue -->

<template>
  <div class="draft-manager">
    <!-- Indicador de estado de guardado -->
    <div v-if="showStatusIndicator" class="save-status-indicator" :class="statusClass">
      <div class="status-content">
        <span class="status-icon">
          <CheckCircleIcon v-if="lastSaveTime && !hasUnsavedChanges" class="h-4 w-4" />
          <ClockIcon v-else-if="hasUnsavedChanges" class="h-4 w-4 animate-pulse" />
          <ExclamationCircleIcon v-else class="h-4 w-4" />
        </span>
        <span class="status-text">
          <template v-if="lastSaveTime && !hasUnsavedChanges">
            Guardado {{ lastSavedText }}
          </template>
          <template v-else-if="hasUnsavedChanges">
            Guardando cambios...
          </template>
          <template v-else>
            No guardado
          </template>
        </span>
        <button
          v-if="hasUnsavedChanges"
          @click="forceSave"
          class="force-save-btn"
          title="Guardar ahora"
        >
          <ArrowDownTrayIcon class="h-3 w-3" />
        </button>
      </div>
    </div>

    <!-- Modal de recuperaciÃ³n de borrador -->
    <BaseModal
      v-if="showRecoveryModal"
      v-model:show="showRecoveryModal"
      title="Borrador encontrado"
      size="lg"
      @close="handleRecoveryClose"
    >
      <div class="recovery-modal-content">
        <div class="recovery-header">
          <div class="recovery-icon">
            <DocumentTextIcon class="h-12 w-12 text-blue-500" />
          </div>
          <div class="recovery-info">
            <h3 class="recovery-title">Â¿Continuar con el borrador anterior?</h3>
            <p class="recovery-description">
              Encontramos un borrador no guardado de este formulario.
            </p>
          </div>
        </div>

        <div class="draft-details">
          <div class="draft-detail">
            <strong>Paso:</strong> {{ latestDraft?.metadata?.step || 'N/A' }}
          </div>
          <div class="draft-detail">
            <strong>Ãšltima modificaciÃ³n:</strong> {{ formatDate(latestDraft?.metadata?.updatedAt) }}
          </div>
          <div v-if="draftPreview" class="draft-detail">
            <strong>Vista previa:</strong> {{ draftPreview }}
          </div>
        </div>

        <div class="recovery-actions">
          <button
            @click="handleRecover"
            class="btn btn-primary recovery-btn"
            :disabled="!latestDraft"
          >
            <ArrowPathIcon class="h-4 w-4 mr-2" />
            Continuar con borrador
          </button>
          <button
            @click="handleDiscard"
            class="btn btn-secondary discard-btn"
          >
            <TrashIcon class="h-4 w-4 mr-2" />
            Descartar borrador
          </button>
          <button
            @click="handleCompare"
            class="btn btn-outline compare-btn"
            :disabled="!latestDraft"
          >
            <EyeIcon class="h-4 w-4 mr-2" />
            Comparar cambios
          </button>
        </div>
      </div>
    </BaseModal>

    <!-- Modal de comparaciÃ³n de cambios -->
    <BaseModal
      v-if="showCompareModal"
      v-model:show="showCompareModal"
      title="Comparar cambios"
      size="xl"
    >
      <div class="compare-modal-content">
        <div class="compare-grid">
          <div class="compare-section">
            <h4 class="compare-title">Borrador guardado</h4>
            <div class="compare-data">
              <pre>{{ JSON.stringify(compareDraftData, null, 2) }}</pre>
            </div>
          </div>
          <div class="compare-section">
            <h4 class="compare-title">Formulario actual</h4>
            <div class="compare-data">
              <pre>{{ JSON.stringify(compareCurrentData, null, 2) }}</pre>
            </div>
          </div>
        </div>
        
        <div class="compare-actions">
          <button @click="useDraft" class="btn btn-primary">
            Usar borrador guardado
          </button>
          <button @click="useCurrent" class="btn btn-secondary">
            Usar formulario actual
          </button>
          <button @click="mergeChanges" class="btn btn-outline">
            Combinar cambios
          </button>
        </div>
      </div>
    </BaseModal>
  </div>
</template>

<script setup lang="ts">
import { ref, computed, onMounted, watch } from 'vue'
import { useFormDraftStore } from '@/store/formDraftStore'
import BaseModal from '@/components/modal/BaseModal.vue'
import {
  CheckCircleIcon,
  ClockIcon,
  ExclamationCircleIcon,
  ArrowDownTrayIcon,
  DocumentTextIcon,
  ArrowPathIcon,
  TrashIcon,
  EyeIcon
} from '@heroicons/vue/24/outline'

interface Props {
  formId: string
  showStatus?: boolean
  currentData?: any
  currentStep?: number
}

const props = withDefaults(defineProps<Props>(), {
  showStatus: true,
  currentData: () => ({}),
  currentStep: 1
})

const emit = defineEmits<{
  (e: 'recover', data: any, step: number): void
  (e: 'discard'): void
  (e: 'save'): void
}>()

const store = useFormDraftStore()
const showRecoveryModal = ref(false)
const showCompareModal = ref(false)
const compareDraftData = ref({})
const compareCurrentData = ref({})

// Computed
const latestDraft = computed(() => {
  const drafts = store.getDraftsByFormId(props.formId)
  return drafts.length > 0 ? drafts[0] : null
})

const hasDrafts = computed(() => store.hasDraftsForForm(props.formId))
const lastSavedText = computed(() => store.lastSavedText)
const lastSaveTime = computed(() => store.lastSavedAt)

// âœ… CORREGIDO: Acceso seguro a recoveryOptions
const recoveryOptions = computed(() => store.recoveryOptions || {
  allowRecovery: true,
  showRecoveryModal: true,
  autoRecover: false
})

const hasUnsavedChanges = computed(() => {
  // Esta lÃ³gica deberÃ­a venir del composable useFormDraft
  return false // Placeholder
})

const showStatusIndicator = computed(() => props.showStatus)
const statusClass = computed(() => ({
  'status-saved': lastSaveTime.value && !hasUnsavedChanges.value,
  'status-saving': hasUnsavedChanges.value,
  'status-unsaved': !lastSaveTime.value && !hasUnsavedChanges.value
}))

const draftPreview = computed(() => {
  if (!latestDraft.value) return ''
  
  const data = latestDraft.value.data
  if (data.first_name && data.last_name) {
    return `${data.first_name} ${data.last_name}`
  }
  if (data.email) {
    return data.email
  }
  return 'Borrador sin tÃ­tulo'
})

// MÃ©todos
const formatDate = (date: Date | undefined) => {
  if (!date) return 'N/A'
  return new Intl.DateTimeFormat('es-CL', {
    dateStyle: 'short',
    timeStyle: 'short'
  }).format(date)
}

const handleRecover = () => {
  if (latestDraft.value) {
    emit('recover', latestDraft.value.data, latestDraft.value.metadata.step)
    showRecoveryModal.value = false
  }
}

const handleDiscard = () => {
  store.clearFormDrafts(props.formId)
  emit('discard')
  showRecoveryModal.value = false
}

const handleCompare = () => {
  if (latestDraft.value) {
    compareDraftData.value = latestDraft.value.data
    compareCurrentData.value = props.currentData
    showRecoveryModal.value = false
    showCompareModal.value = true
  }
}

const handleRecoveryClose = () => {
  showRecoveryModal.value = false
}

const useDraft = () => {
  if (latestDraft.value) {
    emit('recover', latestDraft.value.data, latestDraft.value.metadata.step)
  }
  showCompareModal.value = false
}

const useCurrent = () => {
  store.clearFormDrafts(props.formId)
  showCompareModal.value = false
}

const mergeChanges = () => {
  // LÃ³gica para combinar cambios (implementaciÃ³n bÃ¡sica)
  const merged = { ...compareCurrentData.value, ...compareDraftData.value }
  emit('recover', merged, latestDraft.value?.metadata.step || 1)
  showCompareModal.value = false
}

const forceSave = () => {
  emit('save')
}

// Lifecycle
onMounted(() => {
  // âœ… CORREGIDO: Acceso seguro con optional chaining
  if (hasDrafts.value && recoveryOptions.value?.showRecoveryModal) {
    setTimeout(() => {
      showRecoveryModal.value = true
    }, 500)
  }
})

// Watchers
watch(() => props.formId, (newFormId) => {
  // âœ… CORREGIDO: Acceso seguro con optional chaining
  if (store.hasDraftsForForm(newFormId) && recoveryOptions.value?.showRecoveryModal) {
    showRecoveryModal.value = true
  }
})
</script>

<style scoped>
.draft-manager {
  @apply relative;
}

.save-status-indicator {
  @apply fixed bottom-4 right-4 z-40 rounded-lg border px-3 py-2 text-sm shadow-lg transition-all duration-300;
}

.status-saved {
  @apply bg-green-50 border-green-200 text-green-800;
}

.status-saving {
  @apply bg-blue-50 border-blue-200 text-blue-800;
}

.status-unsaved {
  @apply bg-yellow-50 border-yellow-200 text-yellow-800;
}

.status-content {
  @apply flex items-center gap-2;
}

.status-icon {
  @apply flex-shrink-0;
}

.status-text {
  @apply font-medium;
}

.force-save-btn {
  @apply p-1 rounded hover:bg-white hover:bg-opacity-20 transition-colors;
}

.recovery-modal-content {
  @apply space-y-6;
}

.recovery-header {
  @apply flex items-start gap-4;
}

.recovery-icon {
  @apply flex-shrink-0;
}

.recovery-info {
  @apply flex-1;
}

.recovery-title {
  @apply text-lg font-semibold text-gray-900 mb-1;
}

.recovery-description {
  @apply text-gray-600;
}

.draft-details {
  @apply bg-gray-50 rounded-lg p-4 space-y-2;
}

.draft-detail {
  @apply text-sm text-gray-700;
}

.recovery-actions {
  @apply flex flex-col gap-3;
}

.recovery-btn {
  @apply bg-blue-600 hover:bg-blue-700 text-white;
}

.recovery-btn:disabled {
  @apply opacity-50 cursor-not-allowed;
}

.discard-btn {
  @apply bg-red-600 hover:bg-red-700 text-white;
}

.compare-btn {
  @apply border-gray-300 text-gray-700 hover:bg-gray-50;
}

.compare-btn:disabled {
  @apply opacity-50 cursor-not-allowed;
}

.compare-modal-content {
  @apply space-y-6;
}

.compare-grid {
  @apply grid grid-cols-1 md:grid-cols-2 gap-6;
}

.compare-section {
  @apply space-y-3;
}

.compare-title {
  @apply text-sm font-medium text-gray-900;
}

.compare-data {
  @apply bg-gray-50 rounded-lg p-4 max-h-60 overflow-auto;
}

.compare-data pre {
  @apply text-xs;
}

.compare-actions {
  @apply flex gap-3 justify-end;
}

.btn {
  @apply px-4 py-2 rounded-lg font-medium transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2;
}

.btn-primary {
  @apply bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500;
}

.btn-secondary {
  @apply bg-gray-600 text-white hover:bg-gray-700 focus:ring-gray-500;
}

.btn-outline {
  @apply border border-gray-300 text-gray-700 hover:bg-gray-50 focus:ring-blue-500;
}

@media (max-width: 768px) {
  .save-status-indicator {
    @apply bottom-2 right-2 left-2;
  }
  
  .recovery-actions {
    @apply grid grid-cols-1;
  }
  
  .compare-actions {
    @apply flex-col;
  }
  
  .compare-grid {
    @apply grid-cols-1;
  }
}
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\forms\multi-step\components\BusquedaPadre.vue
============================================================
<!-- src/components/forms/multi-step/components/BusquedaPadre.vue -->
<template>
  <div class="form-section">
    <h4>ğŸ” Buscar Padres Existentes</h4>
    
    <!-- BÃºsqueda por RUT -->
    <div class="search-container">
      <FormKit
        type="text"
        name="parent_search_rut"
        label="Buscar por RUT"
        placeholder="Ej: 12.345.678-9"
        v-model="searchRut"
        validation="matches:/^(\d{1,2}\.\d{3}\.\d{3}-[\dkK])?$/"
        validation-visibility="live"
        :validation-messages="{
          matches: 'Formato de RUT invÃ¡lido (ej: 12.345.678-9)'
        }"
        help="Ingrese el RUT para buscar un padre existente"
      />
      
      <button
        type="button"
        class="btn btn-primary"
        :disabled="!searchRut || isSearching"
        @click="searchByRut"
      >
        <span v-if="isSearching">Buscando...</span>
        <span v-else>ğŸ” Buscar</span>
      </button>
    </div>

    <!-- BÃºsqueda por Email -->
    <div class="search-container">
      <FormKit
        type="email"
        name="parent_search_email"
        label="Buscar por Email"
        placeholder="Ej: padre@email.com"
        v-model="searchEmail"
        validation="email"
        validation-visibility="live"
        :validation-messages="{
          email: 'Formato de email invÃ¡lido'
        }"
        help="Ingrese el email para buscar un padre existente"
      />
      
      <button
        type="button"
        class="btn btn-primary"
        :disabled="!searchEmail || isSearching"
        @click="searchByEmail"
      >
        <span v-if="isSearching">Buscando...</span>
        <span v-else>ğŸ” Buscar</span>
      </button>
    </div>

    <!-- BÃºsqueda por Nombre -->
    <div class="search-container">
      <FormKit
        type="text"
        name="parent_search_name"
        label="Buscar por Nombre"
        placeholder="Ej: MarÃ­a GonzÃ¡lez"
        v-model="searchName"
        validation="length:2,50"
        validation-visibility="live"
        :validation-messages="{
          length: 'Debe tener entre 2 y 50 caracteres'
        }"
        help="Ingrese nombre o apellido para buscar"
      />
      
      <button
        type="button"
        class="btn btn-primary"
        :disabled="!searchName || isSearching"
        @click="searchByName"
      >
        <span v-if="isSearching">Buscando...</span>
        <span v-else>ğŸ” Buscar</span>
      </button>
    </div>

    <!-- BÃºsqueda por Username -->
    <div class="search-container">
      <FormKit
        type="text"
        name="parent_search_username"
        label="Buscar por Username"
        placeholder="Ej: mario.gonzalez"
        v-model="searchUsername"
        validation="length:3,30"
        validation-visibility="live"
        :validation-messages="{
          length: 'Debe tener entre 3 y 30 caracteres'
        }"
        help="Ingrese username para buscar"
      />
      
      <button
        type="button"
        class="btn btn-primary"
        :disabled="!searchUsername || isSearching"
        @click="searchByUsername"
      >
        <span v-if="isSearching">Buscando...</span>
        <span v-else>ğŸ” Buscar</span>
      </button>
    </div>

    <!-- Resultados de bÃºsqueda -->
    <div v-if="searchResults.length > 0" class="search-results">
      <h5>Resultados de BÃºsqueda:</h5>
      <div class="parent-cards">
        <div 
          v-for="parent in searchResults" 
          :key="parent.id"
          class="parent-card"
        >
          <div class="parent-info">
            <h6>{{ parent.first_name }} {{ parent.last_name }}</h6>
            <p>RUT: {{ parent.rut }}</p>
            <p>Email: {{ parent.email }}</p>
            <p v-if="parent.username">Username: {{ parent.username }}</p>
            <p v-if="parent.phone">TelÃ©fono: {{ parent.phone }}</p>
          </div>
          <button
            type="button"
            class="btn btn-success btn-sm"
            :disabled="isParentSelected(parent.id)"
            @click="selectParent(parent)"
          >
            {{ isParentSelected(parent.id) ? 'âœ“ Seleccionado' : '+ Agregar' }}
          </button>
        </div>
      </div>
    </div>

    <!-- Mensaje de estado de bÃºsqueda (solo para info visual) -->
    <div v-if="localSearchMessage" class="search-message" :class="localSearchMessageType">
      {{ localSearchMessage }}
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref } from 'vue'
import { searchParentsApi } from '@/services/nneService'
import type { ParentUser } from '@/type/nne'
import { useAlertModalStore } from '@/store/alertModalStore'

interface Props {
  selectedParents: ParentUser[]
}

interface Emits {
  (e: 'parent-selected', parent: ParentUser): void
  (e: 'search-complete', results: ParentUser[]): void
  (e: 'search-error', error: string): void
}

const props = defineProps<Props>()
const emit = defineEmits<Emits>()
const alertModal = useAlertModalStore()

// Estado de bÃºsqueda
const searchRut = ref('')
const searchEmail = ref('')
const searchName = ref('')
const searchUsername = ref('')
const searchResults = ref<ParentUser[]>([])
const isSearching = ref(false)

// Mensaje local solo para feedback visual en el componente
const localSearchMessage = ref('')
const localSearchMessageType = ref<'success' | 'error' | 'info'>('info')

// Computed para verificar si un padre estÃ¡ seleccionado
const isParentSelected = (parentId: number) => {
  return props.selectedParents.some(p => p.id === parentId)
}

// MÃ©todo de bÃºsqueda mejorado con manejo robusto de errores
const searchParent = async (query: string, searchType: string) => {
  if (!query.trim()) {
    alertModal.info('BÃºsqueda vacÃ­a', 'Por favor ingrese un tÃ©rmino de bÃºsqueda')
    localSearchMessage.value = 'Por favor ingrese un tÃ©rmino de bÃºsqueda'
    localSearchMessageType.value = 'info'
    return
  }

  isSearching.value = true
  localSearchMessage.value = ''
  searchResults.value = []
  
  try {
    console.log(`ğŸ” Buscando padres por ${searchType}:`, query)
    const results = await searchParentsApi(query)
    
    console.log(`ğŸ“Š Resultados recibidos:`, results)
    
    if (!results || !Array.isArray(results)) {
      throw new Error('La API devolviÃ³ una respuesta invÃ¡lida')
    }
    
    searchResults.value = results
    emit('search-complete', results)
    
    if (results.length > 0) {
      const message = `Se encontraron ${results.length} padre(s) con ${searchType}: "${query}"`
      alertModal.success('BÃºsqueda exitosa', message)
      localSearchMessage.value = `Encontrados: ${results.length} padre(s)`
      localSearchMessageType.value = 'success'
    } else {
      const message = `No se encontraron padres con ${searchType}: "${query}"`
      alertModal.info('Sin resultados', message)
      localSearchMessage.value = 'No se encontraron resultados'
      localSearchMessageType.value = 'info'
    }
  } catch (error) {
    console.error('âŒ Error en bÃºsqueda de padres:', error)
    
    // Determinar el mensaje de error especÃ­fico
    let errorMessage = 'Error al buscar. Intente nuevamente.'
    let alertTitle = 'Error en bÃºsqueda'
    
    if (error instanceof Error) {
      if (error.message.includes('conexiÃ³n') || error.message.includes('internet')) {
        errorMessage = 'Error de conexiÃ³n. Verifique su internet.'
        alertTitle = 'Error de conexiÃ³n'
      } else if (error.message.includes('invÃ¡lida')) {
        errorMessage = 'El servidor devolviÃ³ una respuesta inesperada.'
        alertTitle = 'Error del servidor'
      } else if (error.message.includes('ParÃ¡metros')) {
        errorMessage = 'TÃ©rmino de bÃºsqueda invÃ¡lido.'
        alertTitle = 'BÃºsqueda invÃ¡lida'
      } else {
        errorMessage = error.message
      }
    }
    
    alertModal.error(alertTitle, errorMessage)
    localSearchMessage.value = errorMessage
    localSearchMessageType.value = 'error'
    searchResults.value = []
    emit('search-error', error instanceof Error ? error.message : 'Error desconocido')
  } finally {
    isSearching.value = false
  }
}

// MÃ©todos especÃ­ficos de bÃºsqueda
const searchByRut = () => searchParent(searchRut.value, 'RUT')
const searchByEmail = () => searchParent(searchEmail.value, 'email')
const searchByName = () => searchParent(searchName.value, 'nombre')
const searchByUsername = () => searchParent(searchUsername.value, 'username')

// Seleccionar padre
const selectParent = (parent: ParentUser) => {
  if (!isParentSelected(parent.id)) {
    emit('parent-selected', parent)
    
    // Mostrar alerta modal de Ã©xito
    alertModal.success(
      'Padre agregado', 
      `${parent.first_name} ${parent.last_name} ha sido agregado exitosamente`
    )
    
    // Limpiar resultados despuÃ©s de seleccionar
    searchResults.value = []
    localSearchMessage.value = 'Padre agregado exitosamente'
    localSearchMessageType.value = 'success'
    
    // Limpiar campos de bÃºsqueda despuÃ©s de un delay
    setTimeout(() => {
      searchRut.value = ''
      searchEmail.value = ''
      searchName.value = ''
      searchUsername.value = ''
      localSearchMessage.value = ''
    }, 2000)
  } else {
    alertModal.info(
      'Padre ya seleccionado', 
      'Este padre ya se encuentra en la lista de seleccionados'
    )
  }
}

// Limpiar bÃºsqueda
const clearSearch = () => {
  searchRut.value = ''
  searchEmail.value = ''
  searchName.value = ''
  searchUsername.value = ''
  searchResults.value = []
  localSearchMessage.value = ''
}

// Exponer mÃ©todos para uso externo si es necesario
defineExpose({
  clearSearch,
  searchByRut,
  searchByEmail,
  searchByName
})
</script>

<style scoped>
.search-container {
  display: flex;
  gap: 1rem;
  align-items: end;
  margin-bottom: 1rem;
}

.search-container .formkit-outer {
  flex: 1;
}

.search-results {
  margin-top: 1.5rem;
  padding: 1rem;
  background: white;
  border-radius: 6px;
  border: 1px solid #d1d5db;
}

.search-results h5 {
  margin: 0 0 1rem 0;
  color: #374151;
  font-size: 1rem;
}

.parent-cards {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
}

.parent-card {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1rem;
  background: #f9fafb;
  border: 1px solid #e5e7eb;
  border-radius: 6px;
  transition: all 0.2s ease;
}

.parent-card:hover {
  background: #f3f4f6;
  transform: translateY(-1px);
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.parent-info h6 {
  margin: 0 0 0.5rem 0;
  color: #1f2937;
  font-size: 1rem;
  font-weight: 600;
}

.parent-info p {
  margin: 0.25rem 0;
  color: #6b7280;
  font-size: 0.875rem;
}

.search-message {
  margin-top: 1rem;
  padding: 0.75rem;
  border-radius: 6px;
  font-size: 0.875rem;
  text-align: center;
}

.search-message.success {
  background: #d1fae5;
  color: #065f46;
  border: 1px solid #a7f3d0;
}

.search-message.error {
  background: #fee2e2;
  color: #991b1b;
  border: 1px solid #fecaca;
}

.search-message.info {
  background: #dbeafe;
  color: #1e40af;
  border: 1px solid #bfdbfe;
}

.btn {
  padding: 0.75rem 1.5rem;
  border-radius: 6px;
  font-weight: 500;
  border: none;
  cursor: pointer;
  transition: all 0.2s;
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  min-height: 44px;
}

.btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none !important;
}

.btn-primary {
  background: #3b82f6;
  color: white;
}

.btn-primary:hover:not(:disabled) {
  background: #2563eb;
  transform: translateY(-1px);
}

.btn-success {
  background: #10b981;
  color: white;
}

.btn-success:hover:not(:disabled) {
  background: #059669;
  transform: translateY(-1px);
}

.btn-sm {
  padding: 0.5rem 1rem;
  font-size: 0.875rem;
  min-height: 36px;
}

/* Responsive */
@media (max-width: 768px) {
  .search-container {
    flex-direction: column;
    align-items: stretch;
  }
  
  .parent-card {
    flex-direction: column;
    align-items: stretch;
    gap: 1rem;
    text-align: center;
  }
}
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\forms\multi-step\components\CrearNuevoPadre.vue
============================================================
<!-- src/components/forms/multi-step/components/CrearNuevoPadre.vue -->
<template>
  <div class="form-section">
    <h4>â• Crear Nuevo Padre/Tutor</h4>
    
    <button
      type="button"
      class="btn btn-outline"
      @click="toggleCreateForm"
    >
      {{ showCreateForm ? 'âŒ Cancelar CreaciÃ³n' : 'ğŸ‘¤ Crear Nuevo Padre' }}
    </button>

    <div v-if="showCreateForm" class="create-parent-form">
      <FormKit
        type="form"
        id="createParentForm"
        v-model="formData"
        :actions="false"
        @submit="createNewParent"
      >
        <div class="form-grid">
          <FormKit
            type="text"
            name="first_name"
            label="Nombres *"
            placeholder="Ej: MarÃ­a JosÃ©"
            validation="required|length:2,50"
            validation-visibility="live"
            :validation-messages="{
              required: 'Los nombres son requeridos',
              length: 'Debe tener entre 2 y 50 caracteres'
            }"
          />

          <FormKit
            type="text"
            name="last_name"
            label="Apellidos *"
            placeholder="Ej: GonzÃ¡lez PÃ©rez"
            validation="required|length:2,50"
            validation-visibility="live"
            :validation-messages="{
              required: 'Los apellidos son requeridos',
              length: 'Debe tener entre 2 y 50 caracteres'
            }"
          />

          <!-- Campo RUT Mejorado -->
          <div class="formkit-outer">
            <label class="formkit-label" for="rut">
              RUT * 
              <button 
                v-if="rutValue && rutValidation?.isValid && !isCheckingAvailability"
                type="button" 
                @click="forceRutRecheck"
                class="recheck-btn"
                title="Volver a verificar disponibilidad"
              >
                ğŸ”„
              </button>
            </label>
            
            <input
              :value="rutValue"
              type="text"
              name="rut"
              placeholder="Ej: 12.345.678-9"
              class="formkit-input"
              :class="{
                'formkit-input-checking': rutStatus === 'checking',
                'formkit-input-error': rutStatus === 'error',
                'formkit-input-success': rutStatus === 'valid',
                'formkit-input-warning': rutStatus === 'duplicate',
                'formkit-input-partial': rutStatus === 'partial'
              }"
              @blur="onRutBlur"
              @input="onRutInput"
            />
            
            <div v-if="rutStatus === 'checking'" class="formkit-help formkit-help-checking">
              <div class="loading-spinner"></div>
              ğŸ” Verificando disponibilidad del RUT...
            </div>
            
            <div v-else-if="rutStatus === 'error'" class="formkit-messages">
              <div class="formkit-message">{{ rutErrorMessage }}</div>
            </div>
            
            <div v-else-if="rutStatus === 'valid'" class="formkit-help formkit-help-success">
              âœ… RUT vÃ¡lido y disponible para registro
            </div>
            
            <div v-else-if="rutStatus === 'duplicate'" class="formkit-help formkit-help-warning">
              âš ï¸ El RUT ya estÃ¡ registrado en el sistema
              <button type="button" @click="forceRutRecheck" class="text-link">
                Â¿Corregiste el RUT? Volver a verificar
              </button>
            </div>
            
            <div v-else-if="rutStatus === 'partial'" class="formkit-help formkit-help-partial">
              âœï¸ ContinÃºe escribiendo el RUT...
            </div>
            
            <div v-else class="formkit-help">
              Ingrese RUT con formato: 12.345.678-9
            </div>
          </div>

          <FormKit
            type="email"
            name="email"
            label="Email *"
            placeholder="padre@email.com"
            validation="required|email"
            validation-visibility="live"
            :validation-messages="{
              required: 'El email es requerido',
              email: 'Formato de email invÃ¡lido'
            }"
            @blur="handleEmailBlur"
          />

          <FormKit
            type="text"
            name="username"
            label="Nombre de Usuario *"
            placeholder="Ej: maria.gonzalez"
            validation="required|length:3,30"
            validation-visibility="live"
            :validation-messages="{
              required: 'El nombre de usuario es requerido',
              length: 'Debe tener entre 3 y 30 caracteres'
            }"
          />

<FormKit
  type="tel"
  name="phone"
  label="TelÃ©fono"
  placeholder="+56912345678 o 912345678"
  validation="phoneValidation"
  validation-visibility="live"
  :validation-messages="{
    matches: 'Formato de telÃ©fono invÃ¡lido'
  }"
  @blur="formatearTelefono"
/>

         

          <FormKit
            type="password"
            name="password"
            label="ContraseÃ±a *"
            placeholder="Ingrese una contraseÃ±a segura"
            validation="required|length:8,100"
            validation-visibility="live"
            :validation-messages="{
              required: 'La contraseÃ±a es requerida',
              length: 'La contraseÃ±a debe tener al menos 8 caracteres'
            }"
          />

          <FormKit
            type="password"
            name="password_confirm"
            label="Confirmar ContraseÃ±a *"
            placeholder="Repita la contraseÃ±a"
            validation="required|confirm"
            validation-visibility="live"
            :validation-messages="{
              required: 'Debe confirmar la contraseÃ±a',
              confirm: 'Las contraseÃ±as no coinciden'
            }"
          />
        </div>

        <div class="create-actions">
          <button
            type="submit"
            class="btn btn-success"
            :disabled="!canSubmit"
          >
            <span v-if="isCreating">Creando...</span>
            <span v-else-if="isCheckingAvailability">â³ Verificando RUT...</span>
            <span v-else>âœ… Crear y Agregar Padre</span>
          </button>
        </div>
      </FormKit>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, reactive, computed, nextTick, watch } from 'vue'
import { createParentApi } from '@/services/nneService'
import { useAlertModalStore } from '@/store/alertModalStore'
import type { ParentUser, ParentUserCreate } from '@/type/nne'
import { useRutValidation } from '@/composables/useRutValidation'
import { 
  parseApiError, 
  getUserFriendlyErrorMessage,
  type ApiError
} from '@/exceptions/apiError'

interface Emits {
  (e: 'parent-created', parent: ParentUser): void
}

const emit = defineEmits<Emits>()
const alertModal = useAlertModalStore()

const showCreateForm = ref(false)
const isCreating = ref(false)
const isDevelopment = ref(import.meta.env?.MODE === 'development')

// Timeout para verificaciÃ³n automÃ¡tica del RUT
let rutCheckTimeout: number | null = null

const {
  rutValue,
  rutValidation,
  isCheckingAvailability,
  availabilityError,
  isAvailable,
  validateRutSync,
  checkRutAvailability,
  recheckAvailability,
  formatCurrentRut,
  setRutValue,
  isValid: rutIsValid,
  isPartial: isPartialRut,
  errorMessage: rutErrorMessage
} = useRutValidation()

const formData = reactive({
  first_name: '',
  last_name: '',
  email: '',
  password: '',
  phone: '',
  username: '',
  password_confirm: ''
})

// âœ… CORREGIDO: Nueva lÃ³gica mÃ¡s clara para habilitar el botÃ³n

const canSubmit = computed(() => {
  const allFieldsFilled = Boolean(
    formData.first_name &&
    formData.last_name &&
    formData.email &&
    formData.password &&
    rutValue.value &&
    formData.username &&
    formData.password_confirm &&
    formData.password === formData.password_confirm
  )

  const rutValidAndAvailable = rutIsValid.value && isAvailable.value === true
  const notChecking = !isCheckingAvailability.value
  const notCreating = !isCreating.value

  console.log('ğŸ” Estado del botÃ³n:', {
    allFieldsFilled,
    rutValidAndAvailable,
    notChecking,
    notCreating,
    canSubmit: allFieldsFilled && rutValidAndAvailable && notChecking && notCreating
  })

  return allFieldsFilled && rutValidAndAvailable && notChecking && notCreating
})

const hasRutError = computed(() => {
  return (!rutValidation.value?.isValid && !isPartialRut.value) || 
         !!availabilityError.value
})

const rutStatus = computed(() => {
  if (isCheckingAvailability.value) return 'checking'
  if (hasRutError.value) return 'error'
  if (rutValidation.value?.isValid && isAvailable.value === true) return 'valid'
  if (rutValidation.value?.isValid && isAvailable.value === false) return 'duplicate'
  if (isPartialRut.value) return 'partial'
  return 'idle'
})

watch(() => formData.email, (newEmail) => {
  if (newEmail && !formData.username) {
    const usernameFromEmail = newEmail.split('@')[0]
    formData.username = usernameFromEmail.replace(/[^a-zA-Z0-9._-]/g, '')
  }
})

const handleEmailBlur = async () => {
  await nextTick()
  setTimeout(() => {
    const emailInput = document.querySelector('[name="email"]') as HTMLInputElement
    if (emailInput) {
      emailInput.dispatchEvent(new Event('input', { bubbles: true }))
    }
  }, 100)
}

// âœ… OPTIMIZADO: Evitar verificaciones mÃºltiples
const onRutInput = (event: Event) => {
  const input = event.target as HTMLInputElement
  const value = input.value
  
  setRutValue(value)
  
  // Limpiar timeout anterior
  if (rutCheckTimeout) {
    clearTimeout(rutCheckTimeout)
  }
  
  const validation = validateRutSync(value)
  
  // Solo verificar disponibilidad cuando el RUT estÃ© completo y vÃ¡lido
  if (validation.isValid && !validation.isPartial && validation.rutNormalized) {
    console.log('âš¡ RUT completo detectado, programando verificaciÃ³n...')
    rutCheckTimeout = window.setTimeout(() => {
      checkRutAvailability(value)
    }, 800) // 800ms de delay para evitar llamadas excesivas
  }
}

const onRutBlur = async (event: Event) => {
  const input = event.target as HTMLInputElement
  let rut = input.value.trim()
  
  if (!rut) return
  
  // Limpiar timeout si existe
  if (rutCheckTimeout) {
    clearTimeout(rutCheckTimeout)
    rutCheckTimeout = null
  }
  
  try {
    const rutFormateado = formatCurrentRut()
    if (rutFormateado !== rut) {
      input.value = rutFormateado
      setRutValue(rutFormateado)
      rut = rutFormateado
    }
    
    const validation = validateRutSync(rut)
    
    // Solo verificar si es vÃ¡lido y no estÃ¡ en proceso de escritura
    if (validation.isValid && validation.rutNormalized && !isPartialRut.value) {
      console.log('ğŸ” Verificando disponibilidad en blur...')
      await checkRutAvailability(rut)
    }
  } catch (error) {
    console.error('Error validando RUT:', error)
  }
}

const forceRutRecheck = async () => {
  if (rutValue.value && rutValidation.value?.isValid) {
    console.log('ğŸ”„ Re-verificando RUT manualmente...')
    await recheckAvailability()
  }
}

const formatearTelefono = (event: Event) => {
  const input = event.target as HTMLInputElement
  let telefono = input.value.trim()
  
  if (!telefono) return
  
  try {
    const soloNumeros = telefono.replace(/\D/g, '')
    
    if (soloNumeros.length < 8) return
    
    if (soloNumeros.startsWith('569') && soloNumeros.length === 11) {
      const numeroFormateado = `+${soloNumeros}`
      input.value = numeroFormateado
      formData.phone = numeroFormateado
    } else if (soloNumeros.startsWith('9') && soloNumeros.length === 9) {
      const numeroFormateado = `+56${soloNumeros}`
      input.value = numeroFormateado
      formData.phone = numeroFormateado
    } else if (soloNumeros.length === 8) {
      const numeroFormateado = `+56${soloNumeros}`
      input.value = numeroFormateado
      formData.phone = numeroFormateado
    } else if (isDevelopment.value && soloNumeros.length >= 8) {
      if (!telefono.startsWith('+')) {
        const numeroFormateado = `+${soloNumeros}`
        input.value = numeroFormateado
        formData.phone = numeroFormateado
      }
    }
  } catch (error) {
    console.error('Error formateando telÃ©fono:', error)
  }
}

const getFieldDisplayName = (fieldName: string): string => {
  const fieldNames: Record<string, string> = {
    'first_name': 'Nombres',
    'last_name': 'Apellidos',
    'email': 'Email',
    'rut': 'RUT',
    'phone': 'TelÃ©fono',
    'username': 'Nombre de usuario',
    'password': 'ContraseÃ±a',
    'password_confirm': 'Confirmar contraseÃ±a'
  }
  
  return fieldNames[fieldName] || fieldName
}

const getDetailedErrorInfo = (error: ApiError): { title: string; message: string } => {
  if (error.isValidationError && error.fieldErrors && error.fieldErrors.length > 0) {
    const fieldMessages = error.fieldErrors.map(fieldError => {
      const fieldName = getFieldDisplayName(fieldError.field)
      return `â€¢ ${fieldName}: ${fieldError.message}`
    }).join('\n')
    
    return {
      title: 'Errores de validaciÃ³n',
      message: `Por favor corrija los siguientes errores:\n\n${fieldMessages}`
    }
  }
  
  if (error.isConflictError) {
    return {
      title: 'Registro duplicado',
      message: `No se pudo crear el padre porque ya existe un registro con los mismos datos.\n\n${getUserFriendlyErrorMessage(error)}`
    }
  }
  
  if (error.hasFieldError('rut')) {
    const rutError = error.getFieldError('rut')
    return {
      title: 'Error en RUT',
      message: `Problema con el RUT ingresado:\n\n${rutError?.message || getUserFriendlyErrorMessage(error)}`
    }
  }
  
  return {
    title: 'Error',
    message: getUserFriendlyErrorMessage(error)
  }
}

const toggleCreateForm = () => {
  showCreateForm.value = !showCreateForm.value
  if (!showCreateForm.value) {
    clearForm()
  }
}

const clearForm = () => {
  formData.first_name = ''
  formData.last_name = ''
  formData.email = ''
  formData.password = ''
  formData.phone = ''
  formData.username = ''
  formData.password_confirm = ''
  setRutValue('')
  
  // Limpiar timeout si existe
  if (rutCheckTimeout) {
    clearTimeout(rutCheckTimeout)
    rutCheckTimeout = null
  }
}

const createNewParent = async () => {
  if (!rutIsValid.value) {
    alertModal.error(
      'Error en RUT',
      rutErrorMessage.value || 'El RUT ingresado no es vÃ¡lido.'
    )
    return
  }

  if (isAvailable.value !== true) {
    alertModal.error(
      'RUT no disponible',
      'El RUT ya estÃ¡ registrado o no ha sido verificado correctamente.'
    )
    return
  }
  
  isCreating.value = true
  
  try {
    const rutNormalizado = rutValidation.value?.rutNormalized!

    const payload: ParentUserCreate = {
      first_name: formData.first_name.trim(),
      last_name: formData.last_name.trim(),
      email: formData.email.trim(),
      password: formData.password,
      rut: rutNormalizado,
      phone: formData.phone ? formData.phone.trim() : undefined,
      username: formData.username.trim()
    }

    console.log('ğŸ“¤ Enviando datos para crear padre...')
    const response = await createParentApi(payload)
    
    console.log('âœ… Respuesta del servidor:', response)
    
    // Extraer el padre creado de la respuesta
    // La API puede devolver: response.data o response directamente
    const newParent = response.data || response
    
    // Emitir evento con el padre creado
    emit('parent-created', newParent)
    
    // Mostrar alerta de Ã©xito
    alertModal.success(
      'Padre creado exitosamente', 
      `El padre ${newParent.first_name} ${newParent.last_name} (RUT: ${newParent.rut}) ha sido creado y agregado correctamente al sistema.`
    )
    
    // Limpiar formulario y cerrar
    clearForm()
    showCreateForm.value = false
    
  } catch (error: any) {
    console.error('âŒ Error en createNewParent:', error)
    
    const parsedError = parseApiError(error)
    const errorInfo = getDetailedErrorInfo(parsedError)
    alertModal.error(errorInfo.title, errorInfo.message)
  } finally {
    isCreating.value = false
  }
}

defineExpose({
  toggleCreateForm,
  clearForm
})
</script>

<style scoped>
.form-section {
  margin-bottom: 2rem;
  padding: 1.5rem;
  background: #f8fafc;
  border-radius: 8px;
  border: 1px solid #e2e8f0;
}

.form-section h4 {
  margin: 0 0 1.5rem 0;
  color: #374151;
  font-size: 1.125rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.create-parent-form {
  margin-top: 1.5rem;
  padding: 1.5rem;
  background: white;
  border-radius: 6px;
  border: 1px solid #e5e7eb;
  border-left: 4px solid #10b981;
  animation: slideDown 0.3s ease-out;
}

.form-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 1rem;
  margin-bottom: 1.5rem;
}

.create-actions {
  display: flex;
  justify-content: flex-end;
  gap: 1rem;
}

.btn {
  padding: 0.75rem 1.5rem;
  border-radius: 6px;
  font-weight: 500;
  border: none;
  cursor: pointer;
  transition: all 0.2s;
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
}

.btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.btn-outline {
  background: white;
  color: #374151;
  border: 1px solid #d1d5db;
}

.btn-outline:hover:not(:disabled) {
  background: #f9fafb;
}

.btn-success {
  background: #10b981;
  color: white;
}

.btn-success:hover:not(:disabled) {
  background: #059669;
}

.recheck-btn {
  background: none;
  border: none;
  cursor: pointer;
  padding: 0;
  margin-left: 0.5rem;
  font-size: 1rem;
}

.text-link {
  background: none;
  border: none;
  color: #3b82f6;
  text-decoration: underline;
  cursor: pointer;
  padding: 0;
  margin-left: 0.5rem;
}

.loading-spinner {
  display: inline-block;
  width: 12px;
  height: 12px;
  border: 2px solid #e5e7eb;
  border-top-color: #3b82f6;
  border-radius: 50%;
  animation: spin 0.6s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

@keyframes slideDown {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@media (max-width: 768px) {
  .form-grid {
    grid-template-columns: 1fr;
  }
  
  .create-actions {
    justify-content: stretch;
  }
  
  .create-actions .btn {
    flex: 1;
  }
}

:deep(.formkit-outer) {
  margin-bottom: 1rem;
}

:deep(.formkit-label) {
  font-weight: 600;
  color: #374151;
  margin-bottom: 0.5rem;
  display: block;
}

:deep(.formkit-help) {
  font-size: 0.75rem;
  color: #6b7280;
  margin-top: 0.25rem;
}

:deep(.formkit-help-success) {
  color: #10b981;
  font-weight: 500;
}

:deep(.formkit-help-checking) {
  color: #3b82f6;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

:deep(.formkit-help-warning) {
  color: #f59e0b;
}

:deep(.formkit-help-partial) {
  color: #6b7280;
  font-style: italic;
}

:deep(.formkit-messages) {
  list-style: none;
  padding: 0;
  margin: 0.25rem 0 0 0;
}

:deep(.formkit-message) {
  font-size: 0.75rem;
  color: #dc2626;
}

:deep(.formkit-input) {
  width: 100%;
  padding: 0.75rem;
  border: 1px solid #d1d5db;
  border-radius: 6px;
  font-size: 0.875rem;
  transition: all 0.2s;
}

:deep(.formkit-input:focus) {
  outline: none;
  border-color: #3b82f6;
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

:deep(.formkit-input-error) {
  border-color: #dc2626;
}

:deep(.formkit-input-success) {
  border-color: #10b981;
}

:deep(.formkit-input-warning) {
  border-color: #f59e0b;
}

:deep(.formkit-input-checking) {
  border-color: #3b82f6;
}

:deep(.formkit-input-partial) {
  border-color: #9ca3af;
}
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\forms\multi-step\components\DataField.vue
============================================================
<!-- src\components\forms\multi-step\components\DataField.vue -->
<template>
  <div class="data-field" :class="{ 'col-span-full': isLong }">
    <label class="field-label">{{ label }}</label>
    <div class="field-value" :class="{ 'long-text': isLong }">
      {{ value || 'No especificado' }}
    </div>
  </div>
</template>

<script setup lang="ts">
interface Props {
  label: string
  value: string
  isLong?: boolean
}

defineProps<Props>()
</script>

<style scoped>
.data-field {
  @apply space-y-1;
}

.field-label {
  @apply block text-sm font-medium text-gray-700;
}

.field-value {
  @apply block text-sm text-gray-900 p-2 bg-white border border-gray-200 rounded;
}

.field-value.long-text {
  @apply whitespace-pre-wrap min-h-[60px] max-h-32 overflow-y-auto;
}

.col-span-full {
  @apply md:col-span-2;
}
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\forms\multi-step\components\ListaPadresExistentes.vue
============================================================
<!-- src/components/forms/multi-step/components/ListaPadresExistentes.vue -->
<template>
  <div class="existing-parents-section">
    <h4>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Padres Existentes en el Sistema</h4>
    
    <!-- Controles de bÃºsqueda y filtro -->
    <div class="controls-container">
      <FormKit
        type="text"
        name="filter_parents"
        placeholder="Filtrar por nombre, RUT o email..."
        v-model="filterText"
        :classes="{
          input: 'filter-input'
        }"
        @input="handleFilterInput"
      />
      
      <button
        type="button"
        class="btn btn-outline"
        @click="toggleShowAll"
        :disabled="loading"
      >
        <span v-if="loading">â³</span>
        {{ showAll ? 'Ocultar Lista' : 'Mostrar Todos' }}
      </button>
      
      <button
        type="button"
        class="btn btn-primary"
        @click="refreshParents"
        :disabled="loading"
      >
        ğŸ”„ Actualizar
      </button>
    </div>

    <!-- InformaciÃ³n de paginaciÃ³n -->
    <div v-if="showAll && totalCount > 0" class="pagination-info">
      <span class="total-count">
        {{ totalCount }} padre(s) en total â€¢ PÃ¡gina {{ currentPage }} de {{ totalPages }}
      </span>
      <span class="selected-count" v-if="selectedCount > 0">
        {{ selectedCount }} seleccionado(s)
      </span>
    </div>

    <!-- Estado de carga -->
    <div v-if="loading" class="loading-state">
      <div class="loading-spinner"></div>
      <span>{{ loadingMessage }}</span>
    </div>

    <!-- Lista de padres -->
    <div v-else-if="showAll && parentsList.length > 0" class="parents-list">
      <div class="parents-grid">
        <div 
          v-for="parent in parentsList"
          :key="parent.id"
          class="parent-card"
          :class="{ 'selected': isParentSelected(parent.id) }"
        >
          <div class="parent-avatar">
            {{ getInitials(parent.first_name, parent.last_name) }}
          </div>
          
          <div class="parent-info">
            <h5 class="parent-name">
              {{ parent.first_name }} {{ parent.last_name }}
            </h5>
            <div class="parent-details">
              <div class="detail-item">
                <span class="label">RUT:</span>
                <span class="value">{{ parent.rut }}</span>
              </div>
              <div class="detail-item">
                <span class="label">Email:</span>
                <span class="value">{{ parent.email }}</span>
              </div>
              <div class="detail-item" v-if="parent.phone">
                <span class="label">TelÃ©fono:</span>
                <span class="value">{{ parent.phone }}</span>
              </div>
              <div class="detail-item">
                <span class="label">Username:</span>
                <span class="value">{{ parent.username }}</span>
              </div>
              <div class="detail-item" v-if="parent.estado">
                <span class="label">Estado:</span>
                <span class="value status-badge" :class="parent.estado">
                  {{ parent.estado }}
                </span>
              </div>
            </div>
          </div>

          <div class="parent-actions">
            <button
              type="button"
              class="btn btn-sm"
              :class="isParentSelected(parent.id) ? 'btn-danger' : 'btn-success'"
              @click="toggleParentSelection(parent)"
              :disabled="loading"
            >
              {{ isParentSelected(parent.id) ? 'âŒ Quitar' : 'âœ… Agregar' }}
            </button>
          </div>
        </div>
      </div>

      <!-- PaginaciÃ³n -->
      <div v-if="totalPages > 1" class="pagination">
        <button
          type="button"
          class="btn btn-outline btn-sm"
          :disabled="currentPage === 1 || loading"
          @click="changePage(currentPage - 1)"
        >
          â† Anterior
        </button>
        
        <span class="page-info">
          PÃ¡gina {{ currentPage }} de {{ totalPages }}
        </span>
        
        <button
          type="button"
          class="btn btn-outline btn-sm"
          :disabled="currentPage === totalPages || loading"
          @click="changePage(currentPage + 1)"
        >
          Siguiente â†’
        </button>
      </div>
    </div>

    <!-- Estado vacÃ­o -->
    <div v-else-if="showAll && parentsList.length === 0" class="empty-state">
      <div class="empty-icon">ğŸ‘¤</div>
      <h5>No se encontraron padres</h5>
      <p v-if="filterText">
        No hay padres que coincidan con "{{ filterText }}"
      </p>
      <p v-else>
        No hay padres registrados en el sistema
      </p>
      <button
        type="button"
        class="btn btn-primary btn-sm"
        @click="refreshParents"
      >
        ğŸ”„ Reintentar
      </button>
    </div>

    <!-- InformaciÃ³n de selecciÃ³n -->
    <div v-if="selectedCount > 0" class="selection-info">
      <div class="selected-parents-summary">
        <strong>Padres seleccionados:</strong>
        <span class="selected-list">
          {{ selectedParentsList }}
        </span>
      </div>
      <button
        type="button"
        class="btn btn-danger btn-sm"
        @click="clearSelection"
        :disabled="loading"
      >
        ğŸ—‘ï¸ Limpiar SelecciÃ³n
      </button>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, computed, onMounted, watch } from 'vue'
import { getParentsListApi } from '@/services/nneService' // âœ… Usar la nueva funciÃ³n
import type { ParentUser } from '@/types'
import { useAlertModalStore } from '@/store/alertModalStore'

interface Props {
  selectedParents: ParentUser[]
}

interface Emits {
  (e: 'parent-selected', parent: ParentUser): void
  (e: 'parent-removed', parentId: number): void
}

const props = defineProps<Props>()
const emit = defineEmits<Emits>()
const alertModal = useAlertModalStore()

// Estado
const parentsList = ref<ParentUser[]>([])
const loading = ref(false)
const filterText = ref('')
const showAll = ref(false)
const currentPage = ref(1)
const totalCount = ref(0)
const totalPages = ref(0)
const pageSize = 5 // âœ… MÃXIMO 5 POR PÃGINA

// Computed
const selectedCount = computed(() => props.selectedParents.length)

const selectedParentsList = computed(() => {
  return props.selectedParents
    .map(p => `${p.first_name} ${p.last_name}`)
    .join(', ')
})

const loadingMessage = computed(() => {
  if (filterText.value) {
    return `Buscando padres con "${filterText.value}"...`
  }
  return `Cargando pÃ¡gina ${currentPage.value} de padres...`
})

// MÃ©todos
const getInitials = (firstName: string, lastName: string): string => {
  const first = firstName?.charAt(0) || ''
  const last = lastName?.charAt(0) || ''
  return (first + last).toUpperCase()
}

const isParentSelected = (parentId: number): boolean => {
  return props.selectedParents.some(p => p.id === parentId)
}

const toggleParentSelection = (parent: ParentUser) => {
  if (isParentSelected(parent.id)) {
    emit('parent-removed', parent.id)
  } else {
    emit('parent-selected', parent)
  }
}

const clearSelection = () => {
  props.selectedParents.forEach(parent => {
    emit('parent-removed', parent.id)
  })
}

const toggleShowAll = () => {
  showAll.value = !showAll.value
  if (showAll.value) {
    loadParents(1) // Cargar primera pÃ¡gina
  } else {
    // Limpiar estado al ocultar
    parentsList.value = []
    totalCount.value = 0
    totalPages.value = 0
    currentPage.value = 1
    filterText.value = ''
  }
}

const refreshParents = async () => {
  if (showAll.value) {
    await loadParents(1) // Volver a la primera pÃ¡gina al refrescar
  }
}

const changePage = (page: number) => {
  if (page >= 1 && page <= totalPages.value) {
    currentPage.value = page
    loadParents(page)
  }
}

// âœ… NUEVO: Cargar padres con paginaciÃ³n desde el backend
const loadParents = async (page: number = 1) => {
  if (!showAll.value) return
  
  loading.value = true
  try {
    console.log(`ğŸ“¥ Cargando pÃ¡gina ${page} de padres...`, {
      filter: filterText.value,
      pageSize
    })
    
    const response = await getParentsListApi(page, pageSize, filterText.value)
    
    parentsList.value = response.results
    totalCount.value = response.count
    totalPages.value = response.total_pages
    currentPage.value = response.current_page
    
    console.log(`âœ… PÃ¡gina ${page} cargada:`, {
      padresCargados: response.results.length,
      total: response.count,
      paginas: response.total_pages
    })
    
    // Solo mostrar alerta en la primera carga
    if (page === 1 && !filterText.value) {
      alertModal.success(
        'Lista cargada', 
        `Se cargaron ${response.count} padres del sistema`
      )
    }
    
  } catch (error: any) {
    console.error('âŒ Error cargando padres:', error)
    
    let errorMessage = 'No se pudo cargar la lista de padres.'
    if (error.response?.status === 404) {
      errorMessage = 'El servicio de listado de padres no estÃ¡ disponible temporalmente.'
    } else if (error.message?.includes('network')) {
      errorMessage = 'Error de conexiÃ³n. Verifique su internet.'
    }
    
    alertModal.error('Error al cargar padres', errorMessage)
    
    // Resetear estado en caso de error
    parentsList.value = []
    totalCount.value = 0
    totalPages.value = 0
    
  } finally {
    loading.value = false
  }
}

// âœ… NUEVO: Manejar el filtro con debounce
let filterTimeout: number | null = null

const handleFilterInput = () => {
  if (filterTimeout) {
    clearTimeout(filterTimeout)
  }
  
  filterTimeout = window.setTimeout(() => {
    if (showAll.value) {
      // Al filtrar, volver a pÃ¡gina 1 y recargar con filtro
      currentPage.value = 1
      loadParents(1)
    }
  }, 500) // Debounce de 500ms
}

// Cargar datos cuando se active "Mostrar Todos"
watch(showAll, (newValue) => {
  if (newValue) {
    loadParents(1)
  }
})

// Exponer mÃ©todos para uso externo si es necesario
defineExpose({
  refreshParents,
  loadParents,
  toggleShowAll
})
</script>

<style scoped>
.existing-parents-section {
  margin-bottom: 2rem;
  padding: 1.5rem;
  background: #f8fafc;
  border-radius: 8px;
  border: 1px solid #e2e8f0;
}

.existing-parents-section h4 {
  margin: 0 0 1.5rem 0;
  color: #374151;
  font-size: 1.125rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.controls-container {
  display: flex;
  gap: 1rem;
  align-items: center;
  margin-bottom: 1.5rem;
  flex-wrap: wrap;
}

.controls-container .formkit-outer {
  flex: 1;
  min-width: 250px;
}

.filter-input {
  width: 100%;
}

.pagination-info {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1rem;
  padding: 0.75rem;
  background: #eff6ff;
  border-radius: 6px;
  border: 1px solid #dbeafe;
}

.pagination-info .total-count {
  font-weight: 600;
  color: #1e40af;
  font-size: 0.875rem;
}

.pagination-info .selected-count {
  background: #10b981;
  color: white;
  padding: 0.25rem 0.75rem;
  border-radius: 12px;
  font-size: 0.75rem;
  font-weight: 600;
}

.loading-state {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.75rem;
  padding: 3rem;
  color: #6b7280;
  background: white;
  border-radius: 8px;
  border: 1px solid #e5e7eb;
}

.loading-spinner {
  width: 24px;
  height: 24px;
  border: 3px solid #e5e7eb;
  border-top-color: #3b82f6;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

.parents-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
  gap: 1rem;
  margin-bottom: 1.5rem;
}

.parent-card {
  display: flex;
  align-items: center;
  gap: 1rem;
  padding: 1.25rem;
  background: white;
  border: 2px solid #e5e7eb;
  border-radius: 8px;
  transition: all 0.2s ease;
  cursor: pointer;
}

.parent-card:hover {
  border-color: #3b82f6;
  transform: translateY(-2px);
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.parent-card.selected {
  border-color: #10b981;
  background: #f0fdf4;
}

.parent-avatar {
  width: 50px;
  height: 50px;
  border-radius: 50%;
  background: #3b82f6;
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  font-size: 1rem;
  flex-shrink: 0;
}

.parent-card.selected .parent-avatar {
  background: #10b981;
}

.parent-info {
  flex: 1;
  min-width: 0;
}

.parent-name {
  margin: 0 0 0.75rem 0;
  color: #1f2937;
  font-size: 1.1rem;
  font-weight: 600;
}

.parent-details {
  display: flex;
  flex-direction: column;
  gap: 0.4rem;
}

.detail-item {
  display: flex;
  align-items: flex-start;
  gap: 0.5rem;
}

.detail-item .label {
  font-size: 0.75rem;
  color: #6b7280;
  font-weight: 500;
  min-width: 70px;
  flex-shrink: 0;
}

.detail-item .value {
  font-size: 0.75rem;
  color: #374151;
  word-break: break-word;
  flex: 1;
}

.status-badge {
  padding: 0.125rem 0.5rem;
  border-radius: 12px;
  font-size: 0.7rem;
  font-weight: 600;
  text-transform: capitalize;
}

.status-badge.activo {
  background: #d1fae5;
  color: #065f46;
}

.status-badge.inactivo {
  background: #fef3c7;
  color: #92400e;
}

.status-badge.suspendido {
  background: #fee2e2;
  color: #991b1b;
}

.parent-actions {
  flex-shrink: 0;
}

.pagination {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 1.5rem;
  margin-top: 1.5rem;
  padding: 1.5rem;
  background: white;
  border-radius: 8px;
  border: 1px solid #e5e7eb;
}

.page-info {
  color: #374151;
  font-size: 0.875rem;
  font-weight: 500;
}

.empty-state {
  text-align: center;
  padding: 3rem 2rem;
  background: white;
  border-radius: 8px;
  border: 1px solid #e5e7eb;
}

.empty-icon {
  font-size: 4rem;
  margin-bottom: 1rem;
  opacity: 0.5;
}

.empty-state h5 {
  margin: 0 0 0.75rem 0;
  color: #374151;
  font-size: 1.125rem;
}

.empty-state p {
  margin: 0 0 1.5rem 0;
  color: #6b7280;
  font-size: 0.875rem;
  line-height: 1.5;
}

.selection-info {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 1.5rem;
  padding: 1.25rem;
  background: #eff6ff;
  border: 1px solid #3b82f6;
  border-radius: 8px;
}

.selected-parents-summary {
  flex: 1;
}

.selected-parents-summary strong {
  color: #1e40af;
  font-size: 0.875rem;
}

.selected-list {
  display: block;
  margin-top: 0.5rem;
  color: #1e40af;
  font-weight: 500;
  font-size: 0.875rem;
  line-height: 1.4;
}

.btn {
  padding: 0.5rem 1rem;
  border-radius: 6px;
  font-weight: 500;
  border: none;
  cursor: pointer;
  transition: all 0.2s;
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  font-size: 0.875rem;
}

.btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none !important;
}

.btn-primary {
  background: #3b82f6;
  color: white;
}

.btn-primary:hover:not(:disabled) {
  background: #2563eb;
  transform: translateY(-1px);
}

.btn-outline {
  background: white;
  color: #374151;
  border: 1px solid #d1d5db;
}

.btn-outline:hover:not(:disabled) {
  background: #f9fafb;
  border-color: #9ca3af;
}

.btn-success {
  background: #10b981;
  color: white;
}

.btn-success:hover:not(:disabled) {
  background: #059669;
  transform: translateY(-1px);
}

.btn-danger {
  background: #ef4444;
  color: white;
}

.btn-danger:hover:not(:disabled) {
  background: #dc2626;
  transform: translateY(-1px);
}

.btn-sm {
  padding: 0.375rem 0.75rem;
  font-size: 0.75rem;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* Responsive */
@media (max-width: 768px) {
  .controls-container {
    flex-direction: column;
    align-items: stretch;
  }
  
  .parents-grid {
    grid-template-columns: 1fr;
  }
  
  .parent-card {
    flex-direction: column;
    text-align: center;
    gap: 1rem;
  }
  
  .parent-details {
    align-items: center;
  }
  
  .detail-item {
    justify-content: center;
    text-align: center;
  }
  
  .selection-info {
    flex-direction: column;
    gap: 1rem;
    text-align: center;
  }
  
  .pagination {
    flex-direction: column;
    gap: 1rem;
    padding: 1rem;
  }
  
  .pagination-info {
    flex-direction: column;
    gap: 0.5rem;
    text-align: center;
  }
}

@media (max-width: 480px) {
  .existing-parents-section {
    padding: 1rem;
  }
  
  .parent-card {
    padding: 1rem;
  }
  
  .parent-avatar {
    width: 40px;
    height: 40px;
    font-size: 0.875rem;
  }
}
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\forms\multi-step\components\ReviewSection.vue
============================================================
<!-- src\components\forms\multi-step\components\ReviewSection.vue -->
<template>
  <div class="review-section" :class="{ 'is-open': isOpen, 'is-valid': isValid }">
    <button 
      @click="$emit('toggle')"
      class="section-header"
      type="button"
    >
      <div class="section-status">
        <div v-if="isValid" class="status-valid">âœ“</div>
        <div v-else class="status-invalid">âš </div>
      </div>
      <div class="section-title">
        <h4 class="title-text">{{ title }}</h4>
      </div>
      <div class="section-toggle">
        <ChevronDownIcon class="h-5 w-5 transform transition-transform" :class="{ 'rotate-180': isOpen }" />
      </div>
    </button>
    
    <div v-if="isOpen" class="section-content">
      <slot />
    </div>
  </div>
</template>

<script setup lang="ts">
import { ChevronDownIcon } from '@heroicons/vue/24/outline'

interface Props {
  title: string
  isValid: boolean
  isOpen: boolean
}

defineProps<Props>()
defineEmits<{
  toggle: []
}>()
</script>

<style scoped>
.review-section {
  @apply border border-gray-200 rounded-lg overflow-hidden;
}

.review-section.is-valid {
  @apply border-green-200;
}

.review-section:not(.is-valid) {
  @apply border-yellow-200;
}

.section-header {
  @apply w-full flex items-center space-x-4 p-4 bg-white hover:bg-gray-50 transition-colors duration-200;
}

.section-status {
  @apply flex-shrink-0;
}

.status-valid {
  @apply w-6 h-6 bg-green-100 text-green-600 rounded-full flex items-center justify-center text-sm font-bold;
}

.status-invalid {
  @apply w-6 h-6 bg-yellow-100 text-yellow-600 rounded-full flex items-center justify-center text-sm font-bold;
}

.section-title {
  @apply flex-1 text-left;
}

.title-text {
  @apply text-base font-semibold text-gray-900;
}

.section-toggle {
  @apply flex-shrink-0 text-gray-400;
}

.section-content {
  @apply border-t border-gray-200 bg-gray-50;
}
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\forms\multi-step\NneMultiStepForm.vue
============================================================
<!-- src/components/forms/multi-step/NneMultiStepForm.vue -->
<!-- FORMULARIO MULTIPASOS PRINCIPAL - CON PERSISTENCIA INTEGRADA -->
<template>
  <div class="multi-step-form">
    <!-- âœ… DRAFT MANAGER PARA PERSISTENCIA -->
    <DraftManager
      :form-id="'nne-multi-step-form'"
      :show-status="true"
      :current-data="formData"
      :current-step="currentStep"
      @recover="handleRecover"
      @discard="handleDiscard"
      @save="handleSave"
    />

    <!-- Progress Steps -->
    <div class="steps-header">
      <div 
        v-for="step in steps" 
        :key="step.number"
        :class="['step-indicator', {
          'active': currentStep === step.number,
          'completed': currentStep > step.number,
          'clickable': step.number < currentStep || step.number === currentStep
        }]"
        @click="goToStep(step.number)"
      >
        <div class="step-number">
          <span v-if="currentStep > step.number">âœ“</span>
          <span v-else>{{ step.number }}</span>
        </div>
        <div class="step-label">{{ step.label }}</div>
      </div>
    </div>

    <!-- âœ… INDICADOR DE RECUPERACIÃ“N -->
    <div v-if="isRecovering" class="recovery-notice">
      <div class="recovery-content">
        <ArrowPathIcon class="h-5 w-5 animate-spin" />
        <span>Recuperando borrador anterior...</span>
      </div>
    </div>

    <!-- Debug Info -->
    <div class="debug-info" v-if="showDebug">
      <h4>ğŸ› Debug Info:</h4>
      <p>Current Step: {{ currentStep }}</p>
      <p>Step Validity: {{ JSON.stringify(stepValidity) }}</p>
      <p>Can proceed: {{ getStepValidity(currentStep) }}</p>
      <p>Form Data usuarios: {{ formData.usuarios }}</p>
      <p>Has Unsaved Changes: {{ hasUnsavedChanges }}</p>
      <p>Is Recovering: {{ isRecovering }}</p>
      <button @click="showDebug = false" class="btn btn-sm">Ocultar Debug</button>
    </div>

    <!-- Step Content -->
    <div class="step-content">
      <!-- Paso 1: Datos Personales -->
      <Paso1StepPersonal
        v-if="currentStep === 1"
        :formData="paso1Data"
        @update:formData="updatePaso1Data"
        @validate="setStepValidity(1, $event)"
        ref="step1Ref"
      />
      
      <!-- Paso 2: UbicaciÃ³n -->
      <Paso2Location
        v-if="currentStep === 2"
        :formData="paso2Data"
        @update:formData="updatePaso2Data"
        @validate="setStepValidity(2, $event)"
        ref="step2Ref"
      />
      
      <!-- Paso 3: InformaciÃ³n Escolar -->
      <Paso3School
        v-if="currentStep === 3"
        :formData="paso3Data"
        @update:formData="updatePaso3Data"
        @validate="setStepValidity(3, $event)"
        ref="step3Ref"
      />
      
      <!-- Paso 4: Perfil MÃ©dico -->
      <Paso4Medical
        v-if="currentStep === 4"
        :formData="paso4Data"
        @update:formData="updatePaso4Data"
        @validate="setStepValidity(4, $event)"
        ref="step4Ref"
      />
      
      <!-- Paso 5: Necesidades Especiales -->
      <Paso5SpecialNeeds
        v-if="currentStep === 5"
        :formData="paso5Data"
        @update:formData="updatePaso5Data"
        @validate="setStepValidity(5, $event)"
        ref="step5Ref"
      />
      
      <!-- Paso 6: Historial Terapias -->
      <Paso6Therapy
        v-if="currentStep === 6"
        :formData="paso6Data"
        @update:formData="updatePaso6Data"
        @validate="setStepValidity(6, $event)"
        ref="step6Ref"
      />
      
      <!-- Paso 7: Consentimiento -->
      <Paso7Guardian
        v-if="currentStep === 7"
        :formData="paso7Data"
        @update:formData="updatePaso7Data"
        @validate="setStepValidity(7, $event)"
        ref="step7Ref"
      />
      
      <!-- Paso 8: Padres/Tutores -->
      <Paso8Parents
        v-if="currentStep === 8"
        :formData="formData"
        @update:formData="updateFormData"
        @validate="setStepValidity(8, $event)"
        ref="step8Ref"
      />
      
      <!-- Paso 9: RevisiÃ³n Final -->
      <Paso9Review
        v-if="currentStep === 9"
        :formData="formData"
        @validate="setStepValidity(9, $event)"
        ref="step9Ref"
      />
    </div>

    <!-- Navigation -->
    <div class="step-navigation">
      <button 
        v-if="currentStep > 1"
        class="btn btn-secondary"
        @click="previousStep"
        type="button"
      >
        â† Anterior
      </button>
      
      <div class="navigation-spacer">
        <button 
          @click="showDebug = !showDebug" 
          class="btn btn-outline btn-sm debug-toggle"
          type="button"
        >
          ğŸ› Debug
        </button>
        
        <button 
          @click="forceValidation" 
          class="btn btn-outline btn-sm"
          type="button"
        >
          ğŸ”„ Validar
        </button>

        <!-- âœ… INDICADOR DE GUARDADO -->
        <div v-if="hasUnsavedChanges" class="unsaved-indicator">
          <div class="saving-dots">
            <span></span>
            <span></span>
            <span></span>
          </div>
          <span class="text-xs text-gray-600">Guardando...</span>
        </div>
      </div>
      
      <button 
        v-if="currentStep < totalSteps"
        class="btn btn-primary"
        :disabled="!getStepValidity(currentStep)"
        :class="{ 'btn-disabled': !getStepValidity(currentStep) }"
        @click="nextStep"
        type="button"
      >
        <span v-if="getStepValidity(currentStep)">Siguiente â†’</span>
        <span v-else>âš ï¸ Complete los campos requeridos</span>
      </button>
      
      <button 
        v-if="currentStep === totalSteps"
        class="btn btn-success"
        :disabled="!getStepValidity(currentStep) || isSubmitting"
        :class="{ 'btn-disabled': !getStepValidity(currentStep) || isSubmitting }"
        @click="submitForm"
        type="button"
      >
        <span v-if="isSubmitting">â³ Enviando...</span>
        <span v-else-if="getStepValidity(currentStep)">âœ… Registrar NiÃ±o</span>
        <span v-else>âš ï¸ Complete la revisiÃ³n</span>
      </button>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, reactive, computed, onMounted, watch, nextTick } from 'vue'

// Importar los 9 componentes
import Paso1StepPersonal from './pasos/Paso1StepPersonal.vue'
import Paso2Location from './pasos/Paso2Location.vue'
import Paso3School from './pasos/Paso3School.vue'
import Paso4Medical from './pasos/Paso4Medical.vue'
import Paso5SpecialNeeds from './pasos/Paso5SpecialNeeds.vue'
import Paso6Therapy from './pasos/Paso6Therapy.vue'
import Paso7Guardian from './pasos/Paso7Guardian.vue'
import Paso8Parents from './pasos/Paso8Parents.vue'
import Paso9Review from './pasos/Paso9Review.vue'

// âœ… IMPORTAR SISTEMA DE PERSISTENCIA
import { useFormDraft } from '@/composables/useFormDraft'
import DraftManager from '@/components/forms/DraftManager.vue'
import { ArrowPathIcon } from '@heroicons/vue/24/outline'

// âœ… CORREGIDO: Interface con tipo explÃ­cito para stepValidity
interface StepValidityMap {
  [key: number]: boolean
}

// Interface para los datos del formulario
interface NneFormData {
  first_name: string
  last_name: string
  rut: string
  birth_date: string
  gender: string
  street: string
  street_number: string
  commune: any
  region: any
  establishment: any
  current_grade: string
  school_journey: string
  adaptation_notes: string
  allergies: string
  current_medication: string
  emergency_contact: string
  emergency_phone: string
  medical_notes: string
  has_special_needs: boolean
  special_needs_type: string
  autism_level: string
  pie_diagnosis: string
  pie_entry_date: string
  pie_status: string
  guardian_consent: boolean
  consent_date: string
  has_previous_therapies: boolean
  therapies_detail: string
  referred_by: string
  referred_by_detail: string
  attended_where: any
  usuarios: number[]
}

interface Props {
  editData?: Partial<NneFormData>
}

const props = defineProps<Props>()

const emit = defineEmits<{
  (e: 'submit', data: NneFormData): void
  (e: 'cancel'): void
}>()

// Referencias a los componentes
const step1Ref = ref<InstanceType<typeof Paso1StepPersonal> | null>(null)
const step2Ref = ref<InstanceType<typeof Paso2Location> | null>(null)
const step3Ref = ref<InstanceType<typeof Paso3School> | null>(null)
const step4Ref = ref<InstanceType<typeof Paso4Medical> | null>(null)
const step5Ref = ref<InstanceType<typeof Paso5SpecialNeeds> | null>(null)
const step6Ref = ref<InstanceType<typeof Paso6Therapy> | null>(null)
const step7Ref = ref<InstanceType<typeof Paso7Guardian> | null>(null)
const step8Ref = ref<InstanceType<typeof Paso8Parents> | null>(null)
const step9Ref = ref<InstanceType<typeof Paso9Review> | null>(null)

// ConfiguraciÃ³n de pasos
const steps = [
  { number: 1, label: 'Datos Personales' },
  { number: 2, label: 'UbicaciÃ³n' },
  { number: 3, label: 'Info. Escolar' },
  { number: 4, label: 'Perfil MÃ©dico' },
  { number: 5, label: 'Necesidades' },
  { number: 6, label: 'Terapias' },
  { number: 7, label: 'Consentimiento' },
  { number: 8, label: 'Padres' },
  { number: 9, label: 'RevisiÃ³n' }
]

const totalSteps = steps.length
const currentStep = ref(1)

// âœ… CORREGIDO: stepValidity con tipo explÃ­cito
const stepValidity = ref<StepValidityMap>({ 
  1: false, 2: false, 3: false, 4: false, 
  5: false, 6: false, 7: false, 8: false, 9: false 
})

const showDebug = ref(false)
const isSubmitting = ref(false)

// Datos del formulario
const formData = reactive<NneFormData>({
  first_name: '',
  last_name: '', 
  rut: '', 
  birth_date: '', 
  gender: 'unspecified',
  street: '', 
  street_number: '', 
  commune: null, 
  region: null,
  establishment: null,
  current_grade: '', 
  school_journey: '', 
  adaptation_notes: '',
  allergies: '', 
  current_medication: '', 
  emergency_contact: '',
  emergency_phone: '', 
  medical_notes: '',
  has_special_needs: false, 
  special_needs_type: '', 
  autism_level: 'no_review',
  pie_diagnosis: '', 
  pie_entry_date: '', 
  pie_status: '',
  guardian_consent: false, 
  consent_date: '',
  has_previous_therapies: false, 
  therapies_detail: '',
  referred_by: '', 
  referred_by_detail: '', 
  attended_where: null,
  usuarios: []
})

// ==========================
// âœ… INICIALIZAR SISTEMA DE PERSISTENCIA (MEJORADO)
// ==========================
const {
  formData: draftData,
  currentStep: draftStep,
  hasUnsavedChanges,
  isRecovering,
  lastSaveTime,
  hasExistingDrafts,
  canRecover,
  saveDraft,
  recoverDraft,
  clearAllDrafts,
  forceSave
} = useFormDraft({
  formId: 'nne-multi-step-form',
  autoSave: true,
  autoSaveDelay: 3000,
  draftExpiryDays: 7
})

// âœ… CORREGIDO: Estado de inicializaciÃ³n
const isInitialized = ref(false)

// âœ… CORREGIDO: InicializaciÃ³n mejorada para sincronizaciÃ³n
const initializeFormData = () => {
  console.log('ğŸ”„ Inicializando formData con datos del draft...')
  
  // Si hay datos en el draft, usarlos
  if (draftData?.value && Object.keys(draftData.value).length > 0) {
    console.log('ğŸ“¥ Cargando datos del draft:', draftData.value)
    Object.assign(formData, draftData.value)
  } else if (props.editData) {
    // Si no hay draft pero hay datos de ediciÃ³n, usarlos
    console.log('ğŸ“¥ Cargando datos de ediciÃ³n:', props.editData)
    Object.assign(formData, props.editData)
  }
  
  console.log('âœ… formData inicializado:', formData)
}

// ==========================
// âœ… SINCRONIZACIÃ“N MEJORADA ENTRE formData <-> draftData y pasos
// ==========================

// Watch para sincronizar formData -> draftData (cuando el usuario edita)
watch(() => formData, (newFormData) => {
  if (!isRecovering.value && isInitialized.value) {
    console.log('ğŸ“¤ Sincronizando formData -> draftData:', newFormData)
    Object.assign(draftData.value, newFormData)
  }
}, { deep: true, immediate: false })

// Watch para sincronizar draftData -> formData (durante recuperaciÃ³n)
watch(draftData, (newDraftData) => {
  if (isRecovering.value) {
    console.log('ğŸ“¥ Sincronizando draftData -> formData (recuperaciÃ³n):', newDraftData)
    Object.assign(formData, newDraftData)
  }
}, { deep: true })

// Sincronizar currentStep -> draftStep
watch(() => currentStep.value, (newStep) => {
  if (!isRecovering.value && isInitialized.value) {
    draftStep.value = newStep
    console.log('ğŸ”€ Sincronizando currentStep -> draftStep:', newStep)
  }
})

// Sincronizar draftStep -> currentStep (durante recuperaciÃ³n)
watch(draftStep, (newDraftStep) => {
  if (isRecovering.value) {
    currentStep.value = newDraftStep
    console.log('ğŸ”€ Sincronizando draftStep -> currentStep (recuperaciÃ³n):', newDraftStep)
  }
})

// âœ… CORREGIDO: Manejo mejorado de recuperaciÃ³n (manual / programÃ¡tico)
const handleRecover = async (data: any, step: number) => {
  console.log('ğŸ”„ Iniciando recuperaciÃ³n manual...', { step, data })
  try {
    // Asignar datos directamente al formData
    Object.assign(formData, data)
    currentStep.value = step

    console.log('âœ… Datos recuperados asignados al formData:', formData)
    console.log('âœ… Paso actualizado:', currentStep.value)
    
    // Forzar re-renderizado de los componentes y validaciones
    await nextTick()
    await forceValidation()

    console.log('âœ… RecuperaciÃ³n manual completada')
  } catch (error) {
    console.error('âŒ Error en recuperaciÃ³n manual:', error)
  }
}

const handleDiscard = () => {
  console.log('ğŸ—‘ï¸ Descartando borrador...')
  clearAllDrafts()
  
  // Resetear formulario a valores por defecto
  Object.keys(formData).forEach(key => {
    if (Array.isArray((formData as any)[key])) {
      ;(formData as any)[key] = []
    } else if (typeof (formData as any)[key] === 'object' && (formData as any)[key] !== null) {
      ;(formData as any)[key] = null
    } else if (key === 'gender') {
      ;(formData as any)[key] = 'unspecified'
    } else if (key === 'autism_level') {
      ;(formData as any)[key] = 'no_review'
    } else {
      ;(formData as any)[key] = ''
    }
  })
  currentStep.value = 1
  
  console.log('âœ… Formulario reseteado')
}

const handleSave = () => {
  console.log('ğŸ’¾ Guardado manual solicitado...')
  forceSave()
}

// ==========================
// FUNCIONES DE ACTUALIZACIÃ“N (deben estar antes de los computed)
// ==========================
const updatePaso1Data = (data: any) => {
  Object.assign(formData, {
    first_name: data.first_name,
    last_name: data.last_name,
    rut: data.rut,
    birth_date: data.birth_date,
    gender: data.gender
  })
}

const updatePaso2Data = (data: any) => {
  Object.assign(formData, {
    establishment: data.establishment,
    region: data.region,
    commune: data.commune,
    street: data.street,
    street_number: data.street_number
  })
}

const updatePaso3Data = (data: any) => {
  Object.assign(formData, {
    current_grade: data.current_grade,
    school_journey: data.school_journey,
    adaptation_notes: data.school_adaptation_notes
  })
}

const updatePaso4Data = (data: any) => {
  Object.assign(formData, {
    allergies: data.allergies,
    current_medication: data.current_medication,
    emergency_contact: data.emergency_contact,
    emergency_phone: data.emergency_phone,
    medical_notes: data.medical_notes
  })
}

const updatePaso5Data = (data: any) => {
  Object.assign(formData, {
    has_special_needs: data.has_special_needs,
    special_needs_type: data.special_needs_type,
    autism_level: data.autism_level,
    pie_diagnosis: data.pie_diagnosis,
    pie_entry_date: data.pie_entry_date,
    pie_status: data.pie_status
  })
}

const updatePaso6Data = (data: any) => {
  console.log('ğŸ“¥ Actualizando datos Paso 6:', data)
  Object.assign(formData, {
    has_previous_therapies: data.has_previous_therapies,
    therapies_detail: data.therapies_detail,
    referred_by: data.referred_by,
    referred_by_detail: data.referred_by_detail,
    attended_where: data.attended_where
  })
  console.log('âœ… formData.has_previous_therapies:', formData.has_previous_therapies)
}

const updatePaso7Data = (data: any) => {
  Object.assign(formData, {
    guardian_consent: data.guardian_consent,
    consent_date: data.consent_date
  })
}

// ==========================
// COMPUTED PROPERTIES para cada paso
// ==========================
const paso1Data = computed(() => ({
  first_name: formData.first_name,
  last_name: formData.last_name,
  rut: formData.rut,
  birth_date: formData.birth_date,
  gender: formData.gender
}))

const paso2Data = computed(() => ({
  establishment: formData.establishment,
  region: formData.region,
  commune: formData.commune,
  street: formData.street,
  street_number: formData.street_number
}))

const paso3Data = computed(() => ({
  current_grade: formData.current_grade,
  school_journey: formData.school_journey,
  school_adaptation_notes: formData.adaptation_notes
}))

const paso4Data = computed(() => ({
  allergies: formData.allergies,
  current_medication: formData.current_medication,
  emergency_contact: formData.emergency_contact,
  emergency_phone: formData.emergency_phone,
  medical_notes: formData.medical_notes
}))

const paso5Data = computed(() => ({
  has_special_needs: formData.has_special_needs,
  special_needs_type: formData.special_needs_type,
  autism_level: formData.autism_level,
  pie_diagnosis: formData.pie_diagnosis,
  pie_entry_date: formData.pie_entry_date,
  pie_status: formData.pie_status
}))

const paso6Data = computed(() => ({
  has_previous_therapies: formData.has_previous_therapies,
  therapies_detail: formData.therapies_detail,
  referred_by: formData.referred_by,
  referred_by_detail: formData.referred_by_detail,
  attended_where: formData.attended_where
}))

const paso7Data = computed(() => ({
  guardian_consent: formData.guardian_consent,
  consent_date: formData.consent_date
}))

// ==========================
// âœ… NUEVO: FunciÃ³n helper para obtener validez de paso de forma segura
// ==========================
const getStepValidity = (step: number): boolean => {
  return stepValidity.value[step] ?? false
}

// âœ… CORREGIDO: setStepValidity con tipo seguro
const setStepValidity = (step: number, isValid: boolean) => {
  console.log(`âœ… Step ${step} validity changed to:`, isValid)
  stepValidity.value = {
    ...stepValidity.value,
    [step]: isValid
  }
}

// âœ… NUEVO: Actualizar formData desde Paso8
const updateFormData = (data: any) => {
  console.log('ğŸ“¥ Actualizando formData desde paso 8:', data)
  Object.assign(formData, data)
  console.log('âœ… formData.usuarios actualizado:', formData.usuarios)
}

const forceValidation = async () => {
  console.log(`ğŸ” Forzando validaciÃ³n del paso ${currentStep.value}`)
  await nextTick()
  
  const currentStepRef = getCurrentStepRef()
  if (currentStepRef && typeof (currentStepRef as any).validate === 'function') {
    const isValid = (currentStepRef as any).validate()
    setStepValidity(currentStep.value, isValid)
  }
}

const getCurrentStepRef = () => {
  switch (currentStep.value) {
    case 1: return step1Ref.value
    case 2: return step2Ref.value  
    case 3: return step3Ref.value
    case 4: return step4Ref.value
    case 5: return step5Ref.value
    case 6: return step6Ref.value
    case 7: return step7Ref.value
    case 8: return step8Ref.value
    case 9: return step9Ref.value
    default: return null
  }
}

const goToStep = async (step: number) => { 
  if (step >= 1 && step <= totalSteps && step <= currentStep.value) {
    currentStep.value = step
    await nextTick()
    setTimeout(() => forceValidation(), 200)
  }
}

const nextStep = async () => { 
  if (currentStep.value < totalSteps) {
    await forceValidation()
    await new Promise(resolve => setTimeout(resolve, 150))
    
    if (getStepValidity(currentStep.value)) {
      currentStep.value++
      setTimeout(() => forceValidation(), 300)
    } else {
      showDebug.value = true
    }
  }
}

const previousStep = () => { 
  if (currentStep.value > 1) {
    currentStep.value--
    setTimeout(() => forceValidation(), 100)
  }
}

// ==========================
// âœ… HELPER: Convertir a booleano
// ==========================
const convertToBoolean = (value: any): boolean => {
  if (typeof value === 'boolean') return value
  if (value === 'true') return true
  if (value === 'false') return false
  return Boolean(value)
}

// ==========================
// âœ… NUEVA FUNCIÃ“N: Preparar datos para el backend
// ==========================
const prepareDataForBackend = (data: NneFormData) => {
  console.log('ğŸ”„ Preparando datos para backend:', data)
  
  const prepared = {
    // Datos personales
    first_name: data.first_name,
    last_name: data.last_name,
    rut: data.rut,
    birth_date: data.birth_date,
    gender: data.gender || 'unspecified',
    
    // UbicaciÃ³n
    establishment: Number(data.establishment) || 0,
    region: Number(data.region) || 0,
    commune: Number(data.commune) || 0,
    street: data.street,
    street_number: data.street_number,
    
    // Escolar
    current_grade: data.current_grade,
    school_journey: data.school_journey || '',
    adaptation_notes: data.adaptation_notes || '',
    
    // MÃ©dico
    allergies: data.allergies || 'Ninguna',
    current_medication: data.current_medication || 'Ninguna',
    emergency_contact: data.emergency_contact,
    emergency_phone: data.emergency_phone,
    medical_notes: data.medical_notes || '',
    
    // Necesidades especiales - âœ… CONVERTIR A BOOLEANO
    has_special_needs: convertToBoolean(data.has_special_needs),
    special_needs_type: data.special_needs_type || 'none',
    autism_level: data.autism_level || 'no_review',
    
    // PIE
    pie_diagnosis: data.pie_diagnosis || '',
    pie_entry_date: data.pie_entry_date || null,
    pie_status: data.pie_status || '',
    
    // Consentimiento - âœ… CONVERTIR A BOOLEANO
    guardian_consent: convertToBoolean(data.guardian_consent),
    consent_date: data.consent_date || new Date().toISOString().split('T')[0],
    
    // Terapias - âœ… CONVERTIR A BOOLEANO
    has_previous_therapies: convertToBoolean(data.has_previous_therapies),
    therapies_detail: data.therapies_detail || '',
    referred_by: data.referred_by || '',
    referred_by_detail: data.referred_by_detail || '',
    attended_where: Number(data.attended_where) || 0,
    
    // Padres - âœ… ASEGURAR ARRAY DE NÃšMEROS
    usuarios: Array.isArray(data.usuarios) 
      ? data.usuarios.map(Number).filter(Boolean)
      : []
  }
  
  console.log('ğŸ“¤ Datos preparados:', prepared)
  return prepared
}

// ==========================
// âœ… CORREGIDO: submitForm con preparaciÃ³n de datos y LIMPIEZA DE BORRADORES
// ==========================
const submitForm = async () => {
  console.log('ğŸš€ ========== INICIO SUBMIT FORM ==========')
  console.log('ğŸ“Š Estado de validaciÃ³n completo:', stepValidity.value)
  console.log('ğŸ“‹ Datos del formulario ANTES de preparar:', JSON.stringify(formData, null, 2))
  console.log('ğŸ” Paso actual:', currentStep.value)
  console.log('ğŸ” Total de pasos:', totalSteps)
  console.log('ğŸ” Validez del Ãºltimo paso:', getStepValidity(totalSteps))
  
  if (!getStepValidity(totalSteps)) {
    console.error('âŒ SUBMIT BLOQUEADO: Paso 9 no estÃ¡ vÃ¡lido')
    console.error('âŒ Estado de validaciÃ³n del paso 9:', stepValidity.value[9])
    showDebug.value = true
    alert('âš ï¸ Por favor complete todos los campos requeridos en la revisiÃ³n final.')
    return
  }
  
  console.log('âœ… ValidaciÃ³n del paso 9 APROBADA, continuando...')
  isSubmitting.value = true
  
  try {
    await nextTick()
    
    // Preparar datos para el backend
    const dataToSubmit = prepareDataForBackend(formData)
    
    console.log('ğŸ“¤ ========== DATOS FINALES A ENVIAR ==========')
    console.log(JSON.stringify(dataToSubmit, null, 2))
    console.log('ğŸ“¤ Usuarios a asociar:', dataToSubmit.usuarios)
    console.log('ğŸ“¤ Has special needs:', dataToSubmit.has_special_needs, typeof dataToSubmit.has_special_needs)
    console.log('ğŸ“¤ Guardian consent:', dataToSubmit.guardian_consent, typeof dataToSubmit.guardian_consent)
    console.log('ğŸ“¤ Has previous therapies:', dataToSubmit.has_previous_therapies, typeof dataToSubmit.has_previous_therapies)
    console.log('================================================')
    
    console.log('ğŸ¯ Emitiendo evento submit...')
    emit('submit', dataToSubmit as NneFormData)
    
    // âœ… LIMPIAR BORRADORES DESPUÃ‰S DE ENVÃO EXITOSO
    clearAllDrafts()
    console.log('ğŸ§¹ Borradores limpiados despuÃ©s del envÃ­o exitoso')
    
    console.log('âœ… Evento submit emitido correctamente')
    
  } catch (error) {
    console.error('âŒ ========== ERROR EN SUBMIT ==========>')
    console.error('Error completo:', error)
    console.error('Stack:', error instanceof Error ? error.stack : 'No stack available')
    console.error('==========================================')
    alert(`âŒ Error al enviar el formulario: ${error instanceof Error ? error.message : 'Error desconocido'}`)
  } finally {
    isSubmitting.value = false
    console.log('ğŸ ========== FIN SUBMIT FORM ==========')
  }
}

// ==========================
// MOUNT y WATCHERS GLOBALES
// ==========================
onMounted(async () => {
  console.log('ğŸš€ Montando NneMultiStepForm...')

  // Cargar datos de ediciÃ³n si existen (inmediatamente para evitar sobrescritura por draft)
  if (props.editData && Object.keys(props.editData).length > 0) {
    console.log('ğŸ“¥ Cargando props.editData en onMounted:', props.editData)
    Object.assign(formData, props.editData)
  }

  // PequeÃ±o delay para permitir que useFormDraft se inicialice
  setTimeout(() => {
    initializeFormData()
    isInitialized.value = true
    console.log('âœ… NneMultiStepForm inicializado completamente')
  }, 100)
  
  await nextTick()
  setTimeout(() => forceValidation(), 800)
})

watch(currentStep, async () => {
  await nextTick()
  setTimeout(() => forceValidation(), 200)
})

defineExpose({
  forceValidation,
  getCurrentStep: () => currentStep.value,
  getStepValidity: () => stepValidity.value
})
</script>

<style scoped>
.multi-step-form {
  min-height: 100vh;
  background: #f8fafc;
  padding: 2rem;
}

.steps-header {
  display: grid;
  grid-template-columns: repeat(9, 1fr);
  gap: 0.5rem;
  background: white;
  border-radius: 0.75rem;
  padding: 1.5rem 1rem;
  margin-bottom: 2rem;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  border: 1px solid #e2e8f0;
}

.step-indicator {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  padding: 0.5rem 0.25rem;
  border-radius: 0.5rem;
  transition: all 0.3s ease;
  cursor: default;
  min-width: 0;
}

.step-indicator.clickable {
  cursor: pointer;
}

.step-indicator.clickable:hover {
  background-color: #f8fafc;
}

.step-indicator.active {
  background-color: #eff6ff;
}

.step-indicator.completed .step-number {
  background-color: #10b981;
  color: white;
}

.step-number {
  width: 2rem;
  height: 2rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: #f3f4f6;
  color: #6b7280;
  font-weight: 600;
  font-size: 0.875rem;
  transition: all 0.3s ease;
  flex-shrink: 0;
}

.step-indicator.active .step-number {
  background-color: #3b82f6;
  color: white;
}

.step-label {
  font-size: 0.75rem;
  font-weight: 500;
  color: #6b7280;
  text-align: center;
  line-height: 1.2;
  word-wrap: break-word;
  overflow-wrap: break-word;
  hyphens: auto;
}

.step-indicator.active .step-label {
  color: #3b82f6;
  font-weight: 600;
}

.step-indicator.completed .step-label {
  color: #10b981;
}

.step-content {
  background: white;
  border-radius: 0.75rem;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  border: 1px solid #e2e8f0;
  margin-bottom: 2rem;
  min-height: 400px;
  padding: 2rem;
}

.step-navigation {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: white;
  border-radius: 0.75rem;
  padding: 1.5rem 2rem;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  border: 1px solid #e2e8f0;
}

.navigation-spacer {
  display: flex;
  gap: 0.5rem;
  align-items: center;
}

/* âœ… ESTILOS PARA INDICADOR DE RECUPERACIÃ“N */
.recovery-notice {
  @apply bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4;
}

.recovery-content {
  @apply flex items-center gap-3 text-blue-700 font-medium;
}

/* âœ… ESTILOS PARA INDICADOR DE GUARDADO */
.unsaved-indicator {
  @apply flex items-center gap-2 px-3 py-1 bg-yellow-50 border border-yellow-200 rounded-lg;
}

.saving-dots {
  @apply flex space-x-1;
}

.saving-dots span {
  @apply w-1.5 h-1.5 bg-yellow-500 rounded-full animate-pulse;
}

.saving-dots span:nth-child(2) {
  animation-delay: 0.2s;
}

.saving-dots span:nth-child(3) {
  animation-delay: 0.4s;
}

.btn {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.75rem 1.5rem;
  border: none;
  border-radius: 0.5rem;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s;
  font-size: 0.875rem;
  white-space: nowrap;
}

.btn-primary {
  background: #3b82f6;
  color: white;
}

.btn-primary:hover:not(:disabled) {
  background: #2563eb;
}

.btn-secondary {
  background: #f3f4f6;
  color: #374151;
  border: 1px solid #d1d5db;
}

.btn-secondary:hover:not(:disabled) {
  background: #e5e7eb;
}

.btn-success {
  background-color: #10b981;
  color: white;
}

.btn-success:hover:not(:disabled) {
  background-color: #059669;
}

.btn-outline {
  background-color: transparent;
  color: #6b7280;
  border: 1px solid #d1d5db;
}

.btn-outline:hover:not(:disabled) {
  background-color: #f9fafb;
  border-color: #9ca3af;
}

.btn-disabled,
.btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.btn-sm {
  padding: 0.5rem 1rem;
  font-size: 0.875rem;
}

.debug-info {
  background: #fef3c7;
  border: 1px solid #f59e0b;
  border-radius: 0.5rem;
  padding: 1rem;
  margin-bottom: 1rem;
  font-family: monospace;
  font-size: 0.875rem;
}

.debug-info h4 {
  margin: 0 0 0.5rem 0;
  color: #92400e;
}

.debug-info p {
  margin: 0.25rem 0;
  color: #78350f;
}

@media (max-width: 1200px) {
  .steps-header {
    grid-template-columns: repeat(9, minmax(70px, 1fr));
    gap: 0.25rem;
    padding: 1rem 0.5rem;
  }
  
  .step-label {
    font-size: 0.65rem;
  }
  
  .step-number {
    width: 1.75rem;
    height: 1.75rem;
    font-size: 0.75rem;
  }
}

@media (max-width: 768px) {
  .multi-step-form {
    padding: 1rem;
  }
  
  .steps-header {
    grid-template-columns: repeat(9, 1fr);
    gap: 0.25rem;
    padding: 0.75rem 0.5rem;
  }
  
  .step-label {
    font-size: 0.6rem;
  }
  
  .step-number {
    width: 1.5rem;
    height: 1.5rem;
    font-size: 0.7rem;
  }
  
  .step-content {
    padding: 1rem;
  }
  
  .step-navigation {
    flex-direction: column;
    gap: 1rem;
    padding: 1rem;
  }
  
  .navigation-spacer {
    order: -1;
    width: 100%;
    justify-content: center;
  }
  
  .btn {
    width: 100%;
    justify-content: center;
  }

  .unsaved-indicator {
    justify-content: center;
    width: 100%;
  }
}

@media (max-width: 480px) {
  .steps-header {
    grid-template-columns: repeat(3, 1fr);
    grid-template-rows: repeat(3, 1fr);
    gap: 0.5rem;
    padding: 1rem;
  }
  
  .step-label {
    font-size: 0.7rem;
  }
  
  .step-number {
    width: 1.75rem;
    height: 1.75rem;
    font-size: 0.75rem;
  }
}
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\forms\multi-step\pasos\Paso1StepPersonal.vue
============================================================
<!-- src\components\forms\multi-step\pasos\Paso1StepPersonal.vue -->
<template>
  <div class="step-personal">
    <!-- Header del Paso -->
    <div class="step-header">
      <div class="step-number">1</div>
      <div class="step-title">
        <h2 class="text-2xl font-bold text-gray-900">Datos Personales</h2>
        <p class="text-gray-600 mt-1">InformaciÃ³n bÃ¡sica de identificaciÃ³n del niÃ±o/niÃ±a</p>
      </div>
    </div>

    <!-- Formulario -->
    <FormKit
      type="form"
      id="personal-form"
      :actions="false"
      v-model="localData"
      @input="handleFormChange"
      :config="{
        classes: {
          form: 'personal-form-grid'
        }
      }"
    >
      <!-- Grid de Campos -->
      <div class="form-grid">
        <!-- Nombres -->
        <div class="form-group">
          <FormKit
            type="text"
            name="first_name"
            label="Nombres *"
            placeholder="Ingresa los nombres del niÃ±o/niÃ±a"
            validation="required|length:2,100"
            :validation-messages="{
              required: 'Los nombres son obligatorios',
              length: 'Los nombres deben tener entre 2 y 100 caracteres'
            }"
            :classes="{
              outer: 'formkit-outer',
              label: 'formkit-label',
              input: 'formkit-input',
              help: 'formkit-help',
              message: 'formkit-message'
            }"
          />
        </div>

        <!-- Apellidos -->
        <div class="form-group">
          <FormKit
            type="text"
            name="last_name"
            label="Apellidos *"
            placeholder="Ingresa los apellidos del niÃ±o/niÃ±a"
            validation="required|length:2,100"
            :validation-messages="{
              required: 'Los apellidos son obligatorios',
              length: 'Los apellidos deben tener entre 2 y 100 caracteres'
            }"
            :classes="{
              outer: 'formkit-outer',
              label: 'formkit-label',
              input: 'formkit-input',
              help: 'formkit-help',
              message: 'formkit-message'
            }"
          />
        </div>

        <!-- RUT -->
        <div class="form-group">
          <FormKit
            type="text"
            name="rut"
            label="RUT *"
            placeholder="12.345.678-9"
            :validation="rutValidationRules"
            :validation-messages="rutValidationMessages"
            :classes="{
              outer: 'formkit-outer',
              label: 'formkit-label',
              input: 'formkit-input',
              help: 'formkit-help',
              message: 'formkit-message'
            }"
            @blur="handleRutBlur"
          />
          <div class="rut-helpers">
            <p class="text-xs text-gray-500 mt-1">Formato: 12.345.678-9</p>
            <div v-if="rutValidationState !== 'idle'" class="rut-validation-status" :class="rutValidationState">
              <span v-if="rutValidationState === 'valid'" class="flex items-center text-green-600 text-xs mt-1">
                <CheckCircleIcon class="h-4 w-4 mr-1" />
                RUT vÃ¡lido y disponible
              </span>
              <span v-if="rutValidationState === 'checking'" class="flex items-center text-blue-600 text-xs mt-1">
                <ClockIcon class="h-4 w-4 mr-1 animate-spin" />
                Verificando disponibilidad...
              </span>
              <span v-if="rutValidationState === 'error'" class="flex items-center text-red-600 text-xs mt-1">
                <ExclamationCircleIcon class="h-4 w-4 mr-1" />
                {{ rutErrorMessage }}
              </span>
            </div>
          </div>
        </div>

        <!-- Fecha de Nacimiento -->
        <div class="form-group">
          <FormKit
            type="date"
            name="birth_date"
            label="Fecha de Nacimiento *"
            validation="required"
            :validation-messages="{
              required: 'La fecha de nacimiento es obligatoria'
            }"
            :max="maxBirthDate"
            :classes="{
              outer: 'formkit-outer',
              label: 'formkit-label',
              input: 'formkit-input',
              help: 'formkit-help',
              message: 'formkit-message'
            }"
            @input="validateBirthDate"
          />
          <div v-if="dateError" class="text-red-600 text-sm mt-1">
            {{ dateError }}
          </div>
        </div>

        <!-- GÃ©nero -->
        <div class="form-group">
          <FormKit
            type="select"
            name="gender"
            label="GÃ©nero"
            :options="genderOptions"
            placeholder="Selecciona una opciÃ³n"
            :classes="{
              outer: 'formkit-outer',
              label: 'formkit-label',
              input: 'formkit-input',
              help: 'formkit-help',
              message: 'formkit-message'
            }"
          />
        </div>

        <!-- InformaciÃ³n de Edad Calculada -->
        <div class="form-group" v-if="calculatedAge !== null">
          <label class="formkit-label">Edad Calculada</label>
          <div class="age-display">
            <span class="age-value">{{ calculatedAge }} aÃ±os</span>
            <span class="age-info">(Basado en la fecha de nacimiento)</span>
          </div>
        </div>
      </div>

      <!-- InformaciÃ³n de ValidaciÃ³n -->
      <div class="validation-info" :class="{ 'is-valid': isStepValid }">
        <div class="validation-icon">
          <CheckCircleIcon v-if="isStepValid" class="h-5 w-5" />
          <ExclamationCircleIcon v-else class="h-5 w-5" />
        </div>
        <div class="validation-text">
          <span v-if="isStepValid">âœ“ Todos los campos requeridos estÃ¡n completos</span>
          <span v-else>âš  Complete los campos obligatorios marcados con *</span>
        </div>
      </div>
    </FormKit>
  </div>
</template>

<script setup lang="ts">
import { ref, computed, watch, onMounted } from 'vue'
import { CheckCircleIcon, ExclamationCircleIcon, ClockIcon } from '@heroicons/vue/24/outline'
import { validarRutProgresivo, formatearRut } from '@/utils/rutValidator'
import { checkRutAvailabilityApi, validateChildRutApi } from '@/services/nneService'

// Props y Emits
interface Props {
  formData: {
    first_name: string
    last_name: string
    rut: string
    birth_date: string
    gender: string
  }
}

interface Emits {
  (e: 'update:formData', data: Props['formData']): void
  (e: 'validate', isValid: boolean): void
}

const props = defineProps<Props>()
const emit = defineEmits<Emits>()

// Datos locales para el formulario
const localData = ref({
  first_name: '',
  last_name: '',
  rut: '',
  birth_date: '',
  gender: 'unspecified'
})

// Estado de validaciÃ³n de RUT
const rutValidationState = ref<'idle' | 'checking' | 'valid' | 'error'>('idle')
const rutErrorMessage = ref('')
const isRutAvailable = ref<boolean | null>(null)

// Estado de validaciÃ³n de fecha
const dateError = ref('')

// Debounce timer
let emitTimer: number | null = null

// Opciones para el select de gÃ©nero
const genderOptions = {
  unspecified: 'No especifica',
  male: 'Masculino',
  female: 'Femenino',
  other: 'Otro'
}

// Reglas de validaciÃ³n para RUT
const rutValidationRules = computed(() => {
  return 'required'
})

// Mensajes de validaciÃ³n para RUT
const rutValidationMessages = {
  required: 'El RUT es obligatorio para el registro de niÃ±os'
}

// Fecha mÃ¡xima permitida (hoy)
const maxBirthDate = computed(() => {
  const today = new Date()
  const year = today.getFullYear()
  const month = String(today.getMonth() + 1).padStart(2, '0')
  const day = String(today.getDate()).padStart(2, '0')
  return `${year}-${month}-${day}`
})

// ValidaciÃ³n de fecha de nacimiento
const validateBirthDate = (value: string | undefined) => {
  dateError.value = ''
  
  if (!value) {
    return
  }
  
  const selectedDate = new Date(value + 'T00:00:00')
  const today = new Date()
  today.setHours(0, 0, 0, 0)
  
  if (selectedDate >= today) {
    dateError.value = 'La fecha debe ser anterior a hoy'
  }
  
  // Emitir validaciÃ³n despuÃ©s de validar fecha
  debouncedEmit()
}

// ValidaciÃ³n personalizada de RUT
const customRutValidation = async (value: string) => {
  if (!value) {
    rutValidationState.value = 'error'
    rutErrorMessage.value = 'El RUT es obligatorio'
    isRutAvailable.value = false
    return false
  }

  // ValidaciÃ³n de formato
  const formatValidation = validarRutProgresivo(value)
  if (!formatValidation.isValid && !formatValidation.isPartial) {
    rutValidationState.value = 'error'
    rutErrorMessage.value = formatValidation.message || 'Formato de RUT invÃ¡lido'
    isRutAvailable.value = false
    return false
  }

  // Si es un RUT parcial (en escritura), no validar disponibilidad aÃºn
  if (formatValidation.isPartial) {
    rutValidationState.value = 'idle'
    rutErrorMessage.value = ''
    isRutAvailable.value = null
    return false
  }

  // ValidaciÃ³n de disponibilidad en backend
  if (formatValidation.isValid && formatValidation.rutNormalized) {
    rutValidationState.value = 'checking'
    
    try {
      const validationResult = await validateChildRutApi(formatValidation.rutNormalized)
      
      if (validationResult.isValid && validationResult.isAvailable) {
        rutValidationState.value = 'valid'
        rutErrorMessage.value = ''
        isRutAvailable.value = true
        return true
      } else {
        rutValidationState.value = 'error'
        rutErrorMessage.value = validationResult.message || 'RUT no disponible'
        isRutAvailable.value = false
        return false
      }
    } catch (error: any) {
      console.error('Error validando RUT:', error)
      rutValidationState.value = 'error'
      rutErrorMessage.value = 'Error al verificar el RUT. Intente nuevamente.'
      isRutAvailable.value = false
      return false
    }
  }

  return false
}

// Manejar blur del campo RUT
const handleRutBlur = async (event: any) => {
  const rutValue = event.target.value
  if (rutValue) {
    const formattedRut = formatearRut(rutValue)
    if (formattedRut !== rutValue) {
      localData.value.rut = formattedRut
    }
    
    await customRutValidation(formattedRut)
    immediateEmit()
  }
}

// Calcula la edad basada en la fecha de nacimiento
const calculatedAge = computed(() => {
  if (!localData.value.birth_date) return null
  
  const birthDate = new Date(localData.value.birth_date + 'T00:00:00')
  const today = new Date()
  let age = today.getFullYear() - birthDate.getFullYear()
  const monthDiff = today.getMonth() - birthDate.getMonth()
  
  if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
    age--
  }
  
  return age
})

// Valida si el paso estÃ¡ completo
const isStepValid = computed(() => {
  const hasBasicFields = localData.value.first_name?.length >= 2 && 
                        localData.value.last_name?.length >= 2 && 
                        localData.value.birth_date !== ''
  
  const hasValidRut = rutValidationState.value === 'valid' && isRutAvailable.value === true
  const hasValidDate = localData.value.birth_date !== '' && dateError.value === ''
  
  return hasBasicFields && hasValidRut && hasValidDate
})

// Emitir inmediatamente (sin debounce)
const immediateEmit = () => {
  const isValid = isStepValid.value
  console.log('ğŸ” Paso 1 - ValidaciÃ³n inmediata:', isValid)
  
  emit('update:formData', { ...localData.value })
  emit('validate', isValid)
}

// Emitir con debounce
const debouncedEmit = () => {
  if (emitTimer) {
    clearTimeout(emitTimer)
  }
  
  emitTimer = window.setTimeout(() => {
    const isValid = isStepValid.value
    console.log('ğŸ” Paso 1 - ValidaciÃ³n (debounced):', isValid, {
      first_name: localData.value.first_name?.length >= 2,
      last_name: localData.value.last_name?.length >= 2,
      birth_date: localData.value.birth_date !== '',
      rut: rutValidationState.value === 'valid',
      dateError: dateError.value === ''
    })
    
    emit('update:formData', { ...localData.value })
    emit('validate', isValid)
  }, 500)
}

// Maneja cambios en el formulario
const handleFormChange = () => {
  // Usar debounce para evitar sobrescritura mientras se escribe
  debouncedEmit()
}

// MÃ©todo para validaciÃ³n externa
const validate = async () => {
  // Forzar validaciÃ³n de RUT si existe
  if (localData.value.rut) {
    await customRutValidation(localData.value.rut)
  }
  
  // Validar fecha si existe
  if (localData.value.birth_date) {
    validateBirthDate(localData.value.birth_date)
  }
  
  await new Promise(resolve => setTimeout(resolve, 200))
  
  immediateEmit()
  return isStepValid.value
}

// Inicializar con datos del prop
onMounted(() => {
  if (props.formData) {
    localData.value = { ...props.formData }
    
    // Validar RUT inicial si existe
    if (localData.value.rut) {
      setTimeout(async () => {
        await customRutValidation(localData.value.rut)
        immediateEmit()
      }, 500)
    }
  }
  
  // Emitir validaciÃ³n inicial
  setTimeout(() => {
    immediateEmit()
  }, 100)
})

// Watch para cambios en el RUT
watch(() => localData.value.rut, (newRut, oldRut) => {
  if (newRut !== oldRut && newRut && newRut.length > 8) {
    setTimeout(async () => {
      await customRutValidation(newRut)
      immediateEmit()
    }, 500)
  }
})

// Exponer el mÃ©todo validate al componente padre
defineExpose({
  validate
})
</script>

<style scoped>
.step-personal {
  @apply space-y-6;
}

.step-header {
  @apply flex items-start space-x-4 mb-8 pb-6 border-b border-gray-200;
}

.step-number {
  @apply flex-shrink-0 w-10 h-10 bg-blue-600 text-white rounded-full flex items-center justify-center text-lg font-bold;
}

.step-title h2 {
  @apply text-2xl font-bold text-gray-900;
}

.step-title p {
  @apply text-gray-600 mt-1;
}

.form-grid {
  @apply grid grid-cols-1 md:grid-cols-2 gap-6;
}

.form-group {
  @apply space-y-2;
}

.rut-helpers {
  @apply mt-1;
}

.rut-validation-status.valid {
  @apply text-green-600;
}

.rut-validation-status.checking {
  @apply text-blue-600;
}

.rut-validation-status.error {
  @apply text-red-600;
}

.age-display {
  @apply p-3 bg-blue-50 border border-blue-200 rounded-lg;
}

.age-value {
  @apply block text-lg font-semibold text-blue-900;
}

.age-info {
  @apply block text-sm text-blue-600;
}

.validation-info {
  @apply mt-8 p-4 rounded-lg border flex items-center space-x-3 transition-colors duration-200;
}

.validation-info:not(.is-valid) {
  @apply bg-yellow-50 border-yellow-200 text-yellow-800;
}

.validation-info.is-valid {
  @apply bg-green-50 border-green-200 text-green-800;
}

.validation-icon {
  @apply flex-shrink-0;
}

.validation-text {
  @apply text-sm font-medium;
}
</style>

<style>
/* Estilos globales para FormKit en este componente */
.personal-form-grid {
  @apply space-y-6;
}

.formkit-outer {
  @apply mb-0;
}

.formkit-label {
  @apply block text-sm font-medium text-gray-700 mb-2;
}

.formkit-input {
  @apply block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm transition-colors duration-200;
}

.formkit-input:focus {
  @apply ring-2 ring-blue-500 ring-opacity-20;
}

.formkit-message {
  @apply mt-1 text-sm text-red-600;
}

.formkit-help {
  @apply mt-1 text-sm text-gray-500;
}

.formkit-input[type="date"] {
  @apply pr-10;
}

.formkit-input[type="select"] {
  @apply pr-10 bg-white;
}

.formkit-input[data-invalid="true"] {
  @apply border-red-300 focus:border-red-500 focus:ring-red-500;
}

.formkit-input[data-valid="true"] {
  @apply border-green-300 focus:border-green-500 focus:ring-green-500;
}

.formkit-input::placeholder {
  @apply text-gray-400;
}

.formkit-input:disabled {
  @apply bg-gray-50 text-gray-500 cursor-not-allowed;
}

@media (max-width: 768px) {
  .form-grid {
    @apply grid-cols-1 gap-4;
  }
  
  .step-header {
    @apply flex-col space-x-0 space-y-4;
  }
  
  .step-number {
    @apply w-8 h-8 text-base;
  }
}
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\forms\multi-step\pasos\Paso2Location.vue
============================================================
<!-- src/components/forms/multi-step/pasos/Paso2Location.vue -->
<template>
  <div class="step-location">
    <!-- Header del Paso -->
    <div class="step-header">
      <div class="step-number">2</div>
      <div class="step-title">
        <h2 class="text-2xl font-bold text-gray-900">UbicaciÃ³n y Establecimiento</h2>
        <p class="text-gray-600 mt-1">InformaciÃ³n de ubicaciÃ³n geogrÃ¡fica y establecimiento educacional</p>
      </div>
    </div>

    <!-- Formulario -->
    <FormKit
      type="form"
      id="location-form"
      :actions="false"
      v-model="formDataRaw"
      @input="handleFormInput"
    >
      <!-- Grid de Campos -->
      <div class="form-grid">
        <!-- RegiÃ³n -->
        <div class="form-group">
          <FormKit
            type="select"
            name="region"
            label="RegiÃ³n"
            placeholder="Selecciona una regiÃ³n"
            :options="regionOptions"
            validation="required"
            :validation-messages="{
              required: 'La regiÃ³n es obligatoria'
            }"
            @input="handleRegionChange"
            :disabled="loading.regions"
          />
          <div v-if="loading.regions" class="text-xs text-blue-500 mt-1">
            â³ Cargando regiones desde el servidor...
          </div>
          <div v-if="errors.regions" class="text-xs text-red-500 mt-1">
            âŒ {{ errors.regions }}
          </div>
        </div>

        <!-- Comuna -->
        <div class="form-group">
          <FormKit
            type="select"
            name="commune"
            label="Comuna"
            placeholder="Selecciona una comuna"
            :options="communeOptions"
            validation="required"
            :validation-messages="{
              required: 'La comuna es obligatoria'
            }"
            :disabled="!formDataLocal.region || loading.communes"
          />
          <div v-if="!formDataLocal.region" class="text-xs text-gray-500 mt-1">
            Primero selecciona una regiÃ³n
          </div>
          <div v-if="loading.communes" class="text-xs text-blue-500 mt-1">
            â³ Cargando comunas desde el servidor...
          </div>
          <div v-if="errors.communes" class="text-xs text-red-500 mt-1">
            âŒ {{ errors.communes }}
          </div>
        </div>

        <!-- Establecimiento Educacional - BÃšSQUEDA SIMPLIFICADA -->
        <div class="form-group">
          <FormKit
            type="select"
            name="establishment"
            label="Establecimiento Educacional"
            placeholder="Escribe para buscar establecimientos..."
            :options="establishmentOptions"
            validation="required"
            :validation-messages="{
              required: 'El establecimiento es obligatorio'
            }"
            :disabled="loading.establishments"
            @focus="handleEstablishmentFocus"
          />
          <div class="search-instructions">
            <div v-if="loading.establishments" class="text-xs text-blue-500 mt-1">
              â³ Buscando establecimientos educativos...
            </div>
            <div v-if="errors.establishments" class="text-xs text-red-500 mt-1">
              âŒ {{ errors.establishments }}
            </div>
            <div v-if="!loading.establishments && establishmentOptions.length > 1" class="text-xs text-green-600 mt-1">
              âœ… {{ establishmentOptions.length - 1 }} establecimientos educativos encontrados
            </div>
            <div v-if="!loading.establishments && establishmentOptions.length === 1" class="text-xs text-yellow-600 mt-1">
              ğŸ’¡ Escribe el nombre o RBD del establecimiento para buscar
            </div>
          </div>
        </div>

        <!-- Calle -->
        <div class="form-group">
          <FormKit
            type="text"
            name="street"
            label="Calle"
            placeholder="Ingresa el nombre de la calle"
            validation="required|length:2,255"
            :validation-messages="{
              required: 'La calle es obligatoria',
              length: 'La calle debe tener entre 2 y 255 caracteres'
            }"
          />
        </div>

        <!-- NÃºmero -->
        <div class="form-group">
          <FormKit
            type="text"
            name="street_number"
            label="NÃºmero"
            placeholder="Ej: 123, 456-A, S/N"
            validation="required|length:1,20"
            :validation-messages="{
              required: 'El nÃºmero es obligatorio',
              length: 'El nÃºmero debe tener entre 1 y 20 caracteres'
            }"
          />
        </div>

        <!-- DirecciÃ³n Completa (Preview) -->
        <div class="form-group col-span-full" v-if="fullAddress">
          <label class="formkit-label">DirecciÃ³n Completa</label>
          <div class="address-preview">
            <MapPinIcon class="h-5 w-5 text-blue-500" />
            <span class="address-text">{{ fullAddress }}</span>
          </div>
          <p class="text-xs text-gray-500 mt-2">
            Vista previa de la direcciÃ³n generada automÃ¡ticamente
          </p>
        </div>

        <!-- InformaciÃ³n del Establecimiento Seleccionado -->
        <div class="form-group col-span-full" v-if="selectedEstablishmentInfo">
          <label class="formkit-label">InformaciÃ³n del Establecimiento</label>
          <div class="establishment-info">
            <BuildingLibraryIcon class="h-5 w-5 text-green-500" />
            <div class="establishment-details">
              <strong>{{ selectedEstablishmentInfo.name }}</strong>
              <div class="establishment-meta">
                <span v-if="selectedEstablishmentInfo.rbd">RBD: {{ selectedEstablishmentInfo.rbd }}</span>
                <span v-if="selectedEstablishmentInfo.commune">â€¢ {{ selectedEstablishmentInfo.commune }}</span>
                <span v-if="selectedEstablishmentInfo.region">â€¢ {{ selectedEstablishmentInfo.region }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- InformaciÃ³n de ValidaciÃ³n -->
      <div class="validation-info" :class="{ 'is-valid': isStepValid }">
        <div class="validation-icon">
          <CheckCircleIcon v-if="isStepValid" class="h-5 w-5" />
          <ExclamationCircleIcon v-else class="h-5 w-5" />
        </div>
        <div class="validation-text">
          <span v-if="isStepValid">âœ“ Todos los campos de ubicaciÃ³n estÃ¡n completos</span>
          <span v-else>âš  Complete todos los campos obligatorios</span>
        </div>
      </div>

      <!-- Panel de Debug (solo desarrollo) -->
      <div v-if="showDebug" class="debug-panel mt-4 p-4 bg-gray-100 rounded-lg">
        <h4 class="font-bold mb-2">ğŸ› Debug Info:</h4>
        <p><strong>RegiÃ³n seleccionada:</strong> {{ formDataLocal.region }}</p>
        <p><strong>Comuna seleccionada:</strong> {{ formDataLocal.commune }}</p>
        <p><strong>Establecimiento:</strong> {{ formDataLocal.establishment }}</p>
        <p><strong>Regiones cargadas:</strong> {{ regionOptions.length }}</p>
        <p><strong>Comunas cargadas:</strong> {{ communeOptions.length }}</p>
        <p><strong>Establecimientos cargados:</strong> {{ establishmentOptions.length - 1 }}</p>
        <p><strong>Calle:</strong> {{ formDataLocal.street }}</p>
        <p><strong>NÃºmero:</strong> {{ formDataLocal.street_number }}</p>
      </div>
    </FormKit>
  </div>
</template>

<script setup lang="ts">
import { ref, computed, watch, onMounted } from 'vue'
import { CheckCircleIcon, ExclamationCircleIcon, MapPinIcon, BuildingLibraryIcon } from '@heroicons/vue/24/outline'
import nneService from '@/services/nneService'

// Interfaces
interface LocationData {
  establishment: number | null
  region: number | null
  commune: number | null
  street: string
  street_number: string
}

interface EstablishmentInfo {
  name: string
  rbd: string | null
  commune: string | null
  region: string | null
}

interface Props {
  formData: LocationData
}

interface Emits {
  (e: 'update:formData', data: LocationData): void
  (e: 'validate', isValid: boolean): void
}

const props = defineProps<Props>()
const emit = defineEmits<Emits>()

// Estado local del formulario
const formDataLocal = ref<LocationData>({
  establishment: null,
  region: null,
  commune: null,
  street: '',
  street_number: ''
})

const formDataRaw = ref<any>({})
const showDebug = ref(import.meta.env.DEV) // Solo mostrar debug en desarrollo

// âœ… OPCIONES DINÃMICAS DESDE EL BACKEND
const regionOptions = ref<Array<{value: number | string, label: string, attrs?: any}>>([
  { value: '', label: 'Cargando regiones...', attrs: { disabled: true } }
])

const communeOptions = ref<Array<{value: number | string, label: string, attrs?: any}>>([
  { value: '', label: 'Primero selecciona una regiÃ³n', attrs: { disabled: true } }
])

const establishmentOptions = ref<Array<{value: number | string, label: string, attrs?: any}>>([
  { value: '', label: 'Escribe para buscar establecimientos educativos...', attrs: { disabled: true } }
])

// InformaciÃ³n del establecimiento seleccionado
const selectedEstablishmentInfo = ref<EstablishmentInfo | null>(null)

// Estados de carga y errores
const loading = ref({
  regions: false,
  communes: false,
  establishments: false
})

const errors = ref({
  regions: '',
  communes: '',
  establishments: ''
})

// DirecciÃ³n completa calculada
const fullAddress = computed(() => {
  const { street, street_number, commune } = formDataLocal.value
  if (!street || !street_number || !commune) return ''
  
  const communeOption = communeOptions.value.find(c => c.value === commune)
  const communeName = communeOption?.label || 'Comuna seleccionada'
  
  return `${street} #${street_number}, ${communeName}`
})

// ValidaciÃ³n del paso
const isStepValid = computed(() => {
  const { establishment, region, commune, street, street_number } = formDataLocal.value
  
  const isValid = Boolean(
    establishment &&
    region && 
    commune &&
    street && street.trim().length >= 2 &&
    street_number && street_number.trim().length >= 1
  )
  
  console.log('ğŸ” ValidaciÃ³n Paso 2 - UbicaciÃ³n:', {
    establishment,
    region,
    commune,
    street: street?.length,
    street_number: street_number?.length,
    isValid
  })
  
  return isValid
})

// âœ… CARGAR DATOS DESDE EL BACKEND
const loadRegions = async () => {
  try {
    loading.value.regions = true
    errors.value.regions = ''
    
    console.log('ğŸ”„ Iniciando carga de regiones...')
    const regions = await nneService.getRegionsApi()
    
    regionOptions.value = [
      { value: '', label: 'Selecciona una regiÃ³n', attrs: { disabled: true } },
      ...regions
    ]
    
    console.log('âœ… Regiones cargadas desde backend:', regions.length)
    
  } catch (error: any) {
    console.error('âŒ Error cargando regiones:', error)
    errors.value.regions = error.message || 'Error al cargar regiones'
    regionOptions.value = [
      { value: '', label: 'Error al cargar regiones', attrs: { disabled: true } }
    ]
  } finally {
    loading.value.regions = false
  }
}

const loadCommunesByRegion = async (regionId: number) => {
  try {
    loading.value.communes = true
    errors.value.communes = ''
    
    console.log(`ğŸ”„ Cargando comunas para regiÃ³n ${regionId}...`)
    const communes = await nneService.getCommunesByRegionApi(regionId)
    
    communeOptions.value = [
      { value: '', label: 'Selecciona una comuna', attrs: { disabled: true } },
      ...communes
    ]
    
    console.log(`âœ… ${communes.length} comunas cargadas para regiÃ³n ${regionId}`)
    
  } catch (error: any) {
    console.error(`âŒ Error cargando comunas para regiÃ³n ${regionId}:`, error)
    errors.value.communes = error.message || 'Error al cargar comunas'
    communeOptions.value = [
      { value: '', label: 'Error al cargar comunas', attrs: { disabled: true } }
    ]
  } finally {
    loading.value.communes = false
  }
}

// âœ… NUEVA FUNCIÃ“N SIMPLIFICADA: Buscar establecimientos educativos
const searchEducationalEstablishments = async (query: string = '') => {
  try {
    loading.value.establishments = true
    errors.value.establishments = ''
    
    console.log(`ğŸ” Buscando establecimientos educativos: "${query}"`)
    
    if (!query || query.trim().length < 2) {
      // Si la bÃºsqueda es muy corta, cargar todos los establecimientos educativos
      const allEstablishments = await nneService.getAllEducationalEstablishmentsApi()
      
      if (allEstablishments.length === 0) {
        establishmentOptions.value = [
          { value: '', label: 'No se encontraron establecimientos educativos', attrs: { disabled: true } }
        ]
      } else {
        establishmentOptions.value = [
          { value: '', label: 'Selecciona un establecimiento educativo', attrs: { disabled: true } },
          ...allEstablishments
        ]
      }
      
      console.log(`âœ… ${allEstablishments.length} establecimientos educativos cargados`)
    } else {
      // BÃºsqueda por nombre o RBD
      const establishments = await nneService.searchEducationalEstablishmentsApi(query)
      
      if (establishments.length === 0) {
        establishmentOptions.value = [
          { value: '', label: 'No se encontraron establecimientos con esa bÃºsqueda', attrs: { disabled: true } }
        ]
      } else {
        establishmentOptions.value = [
          { value: '', label: `Resultados para "${query}"`, attrs: { disabled: true } },
          ...establishments
        ]
      }
      
      console.log(`âœ… ${establishments.length} establecimientos encontrados para "${query}"`)
    }
    
  } catch (error: any) {
    console.error('âŒ Error buscando establecimientos:', error)
    errors.value.establishments = error.message || 'Error al buscar establecimientos'
    establishmentOptions.value = [
      { value: '', label: 'Error al buscar establecimientos', attrs: { disabled: true } }
    ]
  } finally {
    loading.value.establishments = false
  }
}

// âœ… Cargar detalle del establecimiento seleccionado
const loadEstablishmentDetail = async (establishmentId: number) => {
  try {
    console.log(`ğŸ“‹ Cargando detalle del establecimiento ${establishmentId}...`)
    const establishment = await nneService.getEstablishmentDetailApi(establishmentId)
    
    selectedEstablishmentInfo.value = {
      name: establishment.name,
      rbd: establishment.rbd,
      commune: establishment.commune_detail?.name || null,
      region: establishment.region_detail?.name || null
    }
    
    console.log('âœ… Detalle del establecimiento cargado:', selectedEstablishmentInfo.value)
  } catch (error) {
    console.error(`âŒ Error cargando detalle del establecimiento ${establishmentId}:`, error)
    selectedEstablishmentInfo.value = null
  }
}

// âœ… MANEJO DE CAMBIO DE REGIÃ“N
const handleRegionChange = async (value: any) => {
  console.log('ğŸŒ RegiÃ³n seleccionada:', value, 'Tipo:', typeof value)
  
  // Convertir a nÃºmero y actualizar
  const regionId = value ? Number(value) : null
  formDataLocal.value.region = regionId
  
  // Reset comuna cuando cambia regiÃ³n
  formDataLocal.value.commune = null
  
  // Reset opciones de comuna
  communeOptions.value = [
    { value: '', label: 'Cargando comunas...', attrs: { disabled: true } }
  ]
  
  // Cargar comunas de la regiÃ³n seleccionada
  if (regionId) {
    await loadCommunesByRegion(regionId)
  } else {
    communeOptions.value = [
      { value: '', label: 'Primero selecciona una regiÃ³n', attrs: { disabled: true } }
    ]
  }
  
  // Emitir validaciÃ³n actualizada
  const isValid = isStepValid.value
  emit('validate', isValid)
}

// âœ… MANEJO DE FOCO EN ESTABLECIMIENTO
const handleEstablishmentFocus = async () => {
  console.log('ğŸ¯ Foco en campo de establecimiento')
  
  // Si no hay establecimientos cargados, cargarlos todos
  if (establishmentOptions.value.length <= 1) {
    await searchEducationalEstablishments('')
  }
}

// âœ… MANEJO DE INPUT DEL FORMULARIO
const handleFormInput = async (rawData: any) => {
  console.log('ğŸ“ Input del formulario (raw):', rawData)
  
  // ConversiÃ³n crÃ­tica: asegurar que los IDs sean nÃºmeros
  const processedData: LocationData = {
    establishment: rawData.establishment ? Number(rawData.establishment) : null,
    region: rawData.region ? Number(rawData.region) : null,
    commune: rawData.commune ? Number(rawData.commune) : null,
    street: rawData.street || '',
    street_number: rawData.street_number || ''
  }
  
  console.log('ğŸ”„ Datos procesados (con nÃºmeros):', processedData)
  
  // Actualizar datos locales
  formDataLocal.value = processedData
  
  // Si se seleccionÃ³ un establecimiento, cargar su detalle
  if (processedData.establishment && processedData.establishment !== formDataLocal.value.establishment) {
    await loadEstablishmentDetail(processedData.establishment)
  } else if (!processedData.establishment) {
    selectedEstablishmentInfo.value = null
  }
  
  // Emitir cambios al padre con tipos correctos
  emit('update:formData', processedData)
  
  // Emitir validaciÃ³n
  const isValid = isStepValid.value
  emit('validate', isValid)
}

// MÃ©todo de validaciÃ³n para exponer
const validate = () => {
  const isValid = isStepValid.value
  console.log('ğŸ” ValidaciÃ³n forzada Paso 2:', isValid)
  emit('validate', isValid)
  return isValid
}

// âœ… INICIALIZACIÃ“N MEJORADA
onMounted(async () => {
  console.log('ğŸš€ Paso 2 - UbicaciÃ³n montado con datos iniciales:', props.formData)
  
  // Cargar regiones asincrÃ³nicamente
  await loadRegions()
  
  // Cargar datos iniciales del formulario
  if (props.formData) {
    formDataLocal.value = {
      establishment: props.formData.establishment,
      region: props.formData.region,
      commune: props.formData.commune,
      street: props.formData.street || '',
      street_number: props.formData.street_number || ''
    }
    
    // Sincronizar datos crudos para FormKit
    formDataRaw.value = {
      establishment: props.formData.establishment,
      region: props.formData.region,
      commune: props.formData.commune,
      street: props.formData.street || '',
      street_number: props.formData.street_number || ''
    }
    
    // Si hay regiÃ³n, cargar sus comunas
    if (props.formData.region) {
      await loadCommunesByRegion(props.formData.region)
    }
    
    // Si hay establecimiento, cargar su detalle
    if (props.formData.establishment) {
      await loadEstablishmentDetail(props.formData.establishment)
    }
  }
  
  // Emitir validaciÃ³n inicial despuÃ©s de un pequeÃ±o delay
  setTimeout(() => {
    const isValid = isStepValid.value
    console.log('ğŸ“¢ ValidaciÃ³n inicial Paso 2:', isValid)
    emit('validate', isValid)
  }, 500)
})

// Watch para cambios desde el padre
watch(() => props.formData, async (newData) => {
  if (newData) {
    const currentStr = JSON.stringify(formDataLocal.value)
    const newStr = JSON.stringify(newData)
    
    if (currentStr !== newStr) {
      console.log('ğŸ“¥ ActualizaciÃ³n desde padre:', newData)
      
      // Actualizar con tipos correctos
      formDataLocal.value = {
        establishment: newData.establishment,
        region: newData.region,
        commune: newData.commune,
        street: newData.street || '',
        street_number: newData.street_number || ''
      }
      
      // Sincronizar datos crudos para FormKit
      formDataRaw.value = {
        establishment: newData.establishment,
        region: newData.region,
        commune: newData.commune,
        street: newData.street || '',
        street_number: newData.street_number || ''
      }
      
      // Si hay regiÃ³n, actualizar comunas
      if (newData.region) {
        await loadCommunesByRegion(newData.region)
      }
      
      // Si hay establecimiento, actualizar su detalle
      if (newData.establishment) {
        await loadEstablishmentDetail(newData.establishment)
      }
    }
  }
}, { deep: true })

// Exponer mÃ©todo validate
defineExpose({
  validate
})
</script>

<style scoped>
.step-location {
  @apply space-y-6;
}

.step-header {
  @apply flex items-start space-x-4 mb-8 pb-6 border-b border-gray-200;
}

.step-number {
  @apply flex-shrink-0 w-10 h-10 bg-blue-600 text-white rounded-full flex items-center justify-center text-lg font-bold;
}

.step-title h2 {
  @apply text-2xl font-bold text-gray-900;
}

.step-title p {
  @apply text-gray-600 mt-1;
}

.form-grid {
  @apply grid grid-cols-1 md:grid-cols-2 gap-6;
}

.col-span-full {
  @apply md:col-span-2;
}

.form-group {
  @apply space-y-2;
}

.search-instructions {
  @apply space-y-1;
}

.address-preview {
  @apply p-4 bg-blue-50 border border-blue-200 rounded-lg flex items-center space-x-3;
}

.address-text {
  @apply text-blue-900 font-medium;
}

.establishment-info {
  @apply p-4 bg-green-50 border border-green-200 rounded-lg flex items-start space-x-3;
}

.establishment-details {
  @apply flex-1;
}

.establishment-details strong {
  @apply text-green-900 font-medium block mb-1;
}

.establishment-meta {
  @apply text-sm text-green-700 space-x-2;
}

.validation-info {
  @apply mt-8 p-4 rounded-lg border flex items-center space-x-3 transition-colors duration-200;
}

.validation-info:not(.is-valid) {
  @apply bg-yellow-50 border-yellow-200 text-yellow-800;
}

.validation-info.is-valid {
  @apply bg-green-50 border-green-200 text-green-800;
}

.validation-icon {
  @apply flex-shrink-0;
}

.validation-text {
  @apply text-sm font-medium;
}

.debug-panel {
  @apply text-xs font-mono;
}

.debug-panel h4 {
  @apply text-sm font-bold text-gray-700;
}

.debug-panel p {
  @apply mb-1;
}
</style>

<style>
/* Estilos globales para FormKit */
#location-form .formkit-outer {
  @apply mb-0;
}

#location-form .formkit-label {
  @apply block text-sm font-medium text-gray-700 mb-2;
}

#location-form .formkit-input {
  @apply block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm transition-colors duration-200 bg-white;
}

#location-form .formkit-input:focus {
  @apply ring-2 ring-blue-500 ring-opacity-20;
}

#location-form .formkit-message {
  @apply mt-1 text-sm text-red-600;
}

#location-form .formkit-help {
  @apply mt-1 text-sm text-gray-500;
}

#location-form select.formkit-input {
  @apply pr-10 appearance-none bg-white cursor-pointer;
  background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
  background-position: right 0.5rem center;
  background-repeat: no-repeat;
  background-size: 1.5em 1.5em;
}

#location-form .formkit-input:disabled {
  @apply bg-gray-50 text-gray-500 cursor-not-allowed opacity-60;
}

#location-form .formkit-input[data-invalid="true"] {
  @apply border-red-300 focus:border-red-500 focus:ring-red-500;
}

#location-form .formkit-input[data-valid="true"] {
  @apply border-green-300 focus:border-green-500 focus:ring-green-500;
}

/* Responsive */
@media (max-width: 768px) {
  .form-grid {
    @apply grid-cols-1 gap-4;
  }
  
  .step-header {
    @apply flex-col space-x-0 space-y-4;
  }
  
  .step-number {
    @apply w-8 h-8 text-base;
  }
}
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\forms\multi-step\pasos\Paso3School.vue
============================================================
<!-- src\components\forms\multi-step\pasos\Paso3School.vue -->
<template>
  <div class="step-school">
    <!-- Header del Paso -->
    <div class="step-header">
      <div class="step-number">3</div>
      <div class="step-title">
        <h2 class="text-2xl font-bold text-gray-900">InformaciÃ³n Escolar</h2>
        <p class="text-gray-600 mt-1">Datos acadÃ©micos y de adaptaciÃ³n del niÃ±o/niÃ±a</p>
      </div>
    </div>

    <!-- Formulario -->
    <FormKit
      type="form"
      id="school-form"
      :actions="false"
      v-model="formDataRaw"
      @input="handleFormInput"
    >
      <!-- Grid de Campos -->
      <div class="form-grid">
        <!-- Curso/Nivel Actual -->
        <div class="form-group">
          <FormKit
            type="select"
            name="current_grade"
            label="Curso/Nivel Actual *"
            placeholder="Selecciona el curso actual"
            :options="gradeOptions"
            validation="required"
            :validation-messages="{
              required: 'El curso/nivel actual es obligatorio'
            }"
          />
          <div class="text-xs text-gray-500 mt-1">
            Nivel educativo actual del niÃ±o/niÃ±a
          </div>
        </div>

        <!-- Jornada Escolar -->
        <div class="form-group">
          <FormKit
            type="select"
            name="school_journey"
            label="Jornada Escolar"
            placeholder="Selecciona la jornada"
            :options="journeyOptions"
          />
          <div class="text-xs text-gray-500 mt-1">
            Jornada en la que asiste al establecimiento
          </div>
        </div>

        <!-- Observaciones de AdaptaciÃ³n -->
        <div class="form-group col-span-full">
          <FormKit
            type="textarea"
            name="school_adaptation_notes"
            label="Observaciones de AdaptaciÃ³n Escolar"
            placeholder="Describe el proceso de adaptaciÃ³n, comportamiento en el aula, relaciÃ³n con compaÃ±eros, etc."
            :rows="4"
          />
          <div class="text-xs text-gray-500 mt-1">
            Opcional - InformaciÃ³n relevante sobre la adaptaciÃ³n del niÃ±o en el entorno escolar
          </div>
        </div>

        <!-- InformaciÃ³n Resumen -->
        <div class="form-group col-span-full" v-if="showSchoolSummary">
          <label class="formkit-label">Resumen Escolar</label>
          <div class="school-summary">
            <div class="summary-item">
              <AcademicCapIcon class="h-5 w-5 text-blue-500" />
              <div class="summary-content">
                <span class="summary-label">Nivel Educativo:</span>
                <span class="summary-value">{{ currentGradeDisplay }}</span>
              </div>
            </div>
            <div class="summary-item" v-if="localData.school_journey">
              <ClockIcon class="h-5 w-5 text-green-500" />
              <div class="summary-content">
                <span class="summary-label">Jornada:</span>
                <span class="summary-value">{{ journeyDisplay }}</span>
              </div>
            </div>
            <div class="summary-item" v-if="localData.school_adaptation_notes">
              <ChatBubbleLeftRightIcon class="h-5 w-5 text-purple-500" />
              <div class="summary-content">
                <span class="summary-label">Observaciones:</span>
                <span class="summary-value truncate">{{ localData.school_adaptation_notes }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- InformaciÃ³n de ValidaciÃ³n -->
      <div class="validation-info" :class="{ 'is-valid': isStepValid }">
        <div class="validation-icon">
          <CheckCircleIcon v-if="isStepValid" class="h-5 w-5" />
          <ExclamationCircleIcon v-else class="h-5 w-5" />
        </div>
        <div class="validation-text">
          <span v-if="isStepValid">âœ“ La informaciÃ³n escolar estÃ¡ completa</span>
          <span v-else>âš  Complete el curso/nivel actual marcado con *</span>
        </div>
      </div>

      <!-- Panel de Debug (solo desarrollo) -->
      <div v-if="showDebug" class="debug-panel mt-4 p-4 bg-gray-100 rounded-lg">
        <h4 class="font-bold mb-2">ğŸ› Debug Info Paso 3:</h4>
        <p><strong>Current Grade:</strong> {{ localData.current_grade }}</p>
        <p><strong>School Journey:</strong> {{ localData.school_journey }}</p>
        <p><strong>Adaptation Notes:</strong> {{ localData.school_adaptation_notes }}</p>
        <p><strong>Step Valid:</strong> {{ isStepValid }}</p>
        <p><strong>Raw Form Data:</strong> {{ formDataRaw }}</p>
      </div>
    </FormKit>
  </div>
</template>

<script setup lang="ts">
import { ref, computed, watch, onMounted } from 'vue'
import { 
  CheckCircleIcon, 
  ExclamationCircleIcon, 
  AcademicCapIcon,
  ClockIcon,
  ChatBubbleLeftRightIcon 
} from '@heroicons/vue/24/outline'

// Interfaces
interface SchoolData {
  current_grade: string
  school_journey: string
  school_adaptation_notes: string
}

interface Props {
  formData: SchoolData
}

interface Emits {
  (e: 'update:formData', data: SchoolData): void
  (e: 'validate', isValid: boolean): void
}

const props = defineProps<Props>()
const emit = defineEmits<Emits>()

// Estado local del formulario
const localData = ref<SchoolData>({
  current_grade: '',
  school_journey: '',
  school_adaptation_notes: ''
})

const formDataRaw = ref<any>({})
const showDebug = ref(import.meta.env.DEV) // Solo mostrar debug en desarrollo

// Opciones para los selects
const gradeOptions = {
  '': 'Selecciona el curso',
  'Pre-kÃ­nder': 'Pre-kÃ­nder',
  'KÃ­nder': 'KÃ­nder',
  '1Â° BÃ¡sico': '1Â° BÃ¡sico',
  '2Â° BÃ¡sico': '2Â° BÃ¡sico', 
  '3Â° BÃ¡sico': '3Â° BÃ¡sico',
  '4Â° BÃ¡sico': '4Â° BÃ¡sico',
  '5Â° BÃ¡sico': '5Â° BÃ¡sico',
  '6Â° BÃ¡sico': '6Â° BÃ¡sico',
  '7Â° BÃ¡sico': '7Â° BÃ¡sico',
  '8Â° BÃ¡sico': '8Â° BÃ¡sico',
  '1Â° Medio': '1Â° Medio',
  '2Â° Medio': '2Â° Medio',
  '3Â° Medio': '3Â° Medio',
  '4Â° Medio': '4Â° Medio',
  'EducaciÃ³n Diferencial': 'EducaciÃ³n Diferencial',
  'Otro': 'Otro'
}

const journeyOptions = {
  '': 'Selecciona jornada',
  'morning': 'Jornada MaÃ±ana',
  'afternoon': 'Jornada Tarde', 
  'full_time': 'Jornada Completa',
  'extended': 'Jornada Extendida'
}

// Display values para el resumen
const currentGradeDisplay = computed(() => {
  return gradeOptions[localData.value.current_grade as keyof typeof gradeOptions] || 'No especificado'
})

const journeyDisplay = computed(() => {
  return journeyOptions[localData.value.school_journey as keyof typeof journeyOptions] || 'No especificada'
})

// Muestra el resumen cuando hay datos
const showSchoolSummary = computed(() => {
  return localData.value.current_grade || localData.value.school_journey || localData.value.school_adaptation_notes
})

// Valida si el paso estÃ¡ completo (solo curso es obligatorio)
const isStepValid = computed(() => {
  const isValid = localData.value.current_grade !== ''
  
  console.log('ğŸ” ValidaciÃ³n Paso 3 - Escolar:', {
    current_grade: localData.value.current_grade,
    school_journey: localData.value.school_journey,
    adaptation_notes: localData.value.school_adaptation_notes,
    isValid
  })
  
  return isValid
})

// âœ… MANEJO DE INPUT DEL FORMULARIO MEJORADO
const handleFormInput = (rawData: any) => {
  console.log('ğŸ“ Input del formulario Paso 3 (raw):', rawData)
  
  // Procesar datos del formulario
  const processedData: SchoolData = {
    current_grade: rawData.current_grade || '',
    school_journey: rawData.school_journey || '',
    school_adaptation_notes: rawData.school_adaptation_notes || ''
  }
  
  console.log('ğŸ”„ Datos procesados Paso 3:', processedData)
  
  // Actualizar datos locales
  localData.value = processedData
  
  // Emitir cambios al padre
  emit('update:formData', processedData)
  
  // Emitir validaciÃ³n
  emit('validate', isStepValid.value)
}

// MÃ©todo para validaciÃ³n externa
const validate = () => {
  const isValid = isStepValid.value
  console.log('ğŸ” ValidaciÃ³n forzada Paso 3:', isValid)
  emit('validate', isValid)
  return isValid
}

// âœ… INICIALIZACIÃ“N MEJORADA
onMounted(() => {
  console.log('ğŸš€ Paso 3 - Escolar montado con datos iniciales:', props.formData)
  
  // Cargar datos iniciales del formulario
  if (props.formData) {
    localData.value = {
      current_grade: props.formData.current_grade || '',
      school_journey: props.formData.school_journey || '',
      school_adaptation_notes: props.formData.school_adaptation_notes || ''
    }
    
    // Sincronizar datos crudos para FormKit
    formDataRaw.value = {
      current_grade: props.formData.current_grade || '',
      school_journey: props.formData.school_journey || '',
      school_adaptation_notes: props.formData.school_adaptation_notes || ''
    }
  }
  
  // Emitir validaciÃ³n inicial despuÃ©s de un pequeÃ±o delay
  setTimeout(() => {
    const isValid = isStepValid.value
    console.log('ğŸ“¢ ValidaciÃ³n inicial Paso 3:', isValid)
    emit('validate', isValid)
  }, 100)
})

// Watch para cambios en los props (en caso de ediciÃ³n)
watch(() => props.formData, (newData) => {
  if (newData) {
    const currentStr = JSON.stringify(localData.value)
    const newStr = JSON.stringify(newData)
    
    if (currentStr !== newStr) {
      console.log('ğŸ“¥ ActualizaciÃ³n desde padre Paso 3:', newData)
      
      // Actualizar datos locales
      localData.value = {
        current_grade: newData.current_grade || '',
        school_journey: newData.school_journey || '',
        school_adaptation_notes: newData.school_adaptation_notes || ''
      }
      
      // Sincronizar datos crudos para FormKit
      formDataRaw.value = {
        current_grade: newData.current_grade || '',
        school_journey: newData.school_journey || '',
        school_adaptation_notes: newData.school_adaptation_notes || ''
      }
    }
  }
}, { deep: true })

// Exponer el mÃ©todo validate al componente padre
defineExpose({
  validate
})
</script>

<style scoped>
.step-school {
  @apply space-y-6;
}

.step-header {
  @apply flex items-start space-x-4 mb-8 pb-6 border-b border-gray-200;
}

.step-number {
  @apply flex-shrink-0 w-10 h-10 bg-blue-600 text-white rounded-full flex items-center justify-center text-lg font-bold;
}

.step-title h2 {
  @apply text-2xl font-bold text-gray-900;
}

.step-title p {
  @apply text-gray-600 mt-1;
}

.form-grid {
  @apply grid grid-cols-1 md:grid-cols-2 gap-6;
}

.col-span-full {
  @apply md:col-span-2;
}

.form-group {
  @apply space-y-2;
}

.school-summary {
  @apply space-y-3 p-4 bg-gray-50 border border-gray-200 rounded-lg;
}

.summary-item {
  @apply flex items-start space-x-3;
}

.summary-content {
  @apply flex-1 min-w-0;
}

.summary-label {
  @apply block text-sm font-medium text-gray-700;
}

.summary-value {
  @apply block text-sm text-gray-900 mt-1;
}

.validation-info {
  @apply mt-8 p-4 rounded-lg border flex items-center space-x-3 transition-colors duration-200;
}

.validation-info:not(.is-valid) {
  @apply bg-yellow-50 border-yellow-200 text-yellow-800;
}

.validation-info.is-valid {
  @apply bg-green-50 border-green-200 text-green-800;
}

.validation-icon {
  @apply flex-shrink-0;
}

.validation-text {
  @apply text-sm font-medium;
}

.debug-panel {
  @apply text-xs font-mono;
}

.debug-panel h4 {
  @apply text-sm font-bold text-gray-700;
}

.debug-panel p {
  @apply mb-1;
}
</style>

<style>
/* Estilos globales para FormKit - CONSISTENTES CON PASOS ANTERIORES */
#school-form .formkit-outer {
  @apply mb-0;
}

#school-form .formkit-label {
  @apply block text-sm font-medium text-gray-700 mb-2;
}

#school-form .formkit-input {
  @apply block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm transition-colors duration-200 bg-white;
}

#school-form .formkit-input:focus {
  @apply ring-2 ring-blue-500 ring-opacity-20;
}

#school-form .formkit-message {
  @apply mt-1 text-sm text-red-600;
}

#school-form .formkit-help {
  @apply mt-1 text-sm text-gray-500;
}

#school-form select.formkit-input {
  @apply pr-10 appearance-none bg-white cursor-pointer;
  background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
  background-position: right 0.5rem center;
  background-repeat: no-repeat;
  background-size: 1.5em 1.5em;
}

#school-form .formkit-input:disabled {
  @apply bg-gray-50 text-gray-500 cursor-not-allowed opacity-60;
}

#school-form .formkit-input[data-invalid="true"] {
  @apply border-red-300 focus:border-red-500 focus:ring-red-500;
}

#school-form .formkit-input[data-valid="true"] {
  @apply border-green-300 focus:border-green-500 focus:ring-green-500;
}

/* Estilos especÃ­ficos para textarea */
#school-form .formkit-input[type="textarea"] {
  @apply min-h-[100px] resize-y;
}

/* Responsive */
@media (max-width: 768px) {
  .form-grid {
    @apply grid-cols-1 gap-4;
  }
  
  .step-header {
    @apply flex-col space-x-0 space-y-4;
  }
  
  .step-number {
    @apply w-8 h-8 text-base;
  }
  
  .school-summary {
    @apply p-3;
  }
}
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\forms\multi-step\pasos\Paso4Medical.vue
============================================================
<!-- src\components\forms\multi-step\pasos\Paso4Medical.vue -->
<template>
  <div class="step-medical">
    <!-- Header del Paso -->
    <div class="step-header">
      <div class="step-number">4</div>
      <div class="step-title">
        <h2 class="text-2xl font-bold text-gray-900">Perfil MÃ©dico</h2>
        <p class="text-gray-600 mt-1">InformaciÃ³n de salud y contacto de emergencia</p>
      </div>
    </div>

    <!-- Formulario -->
    <FormKit
      type="form"
      id="medical-form"
      :actions="false"
      v-model="formDataRaw"
      @input="handleFormInput"
    >
      <!-- Grid de Campos -->
      <div class="form-grid">
        <!-- Alergias -->
        <div class="form-group col-span-full">
          <FormKit
            type="textarea"
            name="allergies"
            label="Alergias"
            placeholder="Describa las alergias conocidas (alimentarias, medicamentos, ambientales, etc.)"
            :rows="3"
          />
          <div class="text-xs text-gray-500 mt-1">
            Ej: Penicilina, frutos secos, polvo, etc. Dejar vacÃ­o si no hay alergias conocidas.
          </div>
        </div>

        <!-- MedicaciÃ³n Actual -->
        <div class="form-group col-span-full">
          <FormKit
            type="textarea"
            name="current_medication"
            label="MedicaciÃ³n Actual"
            placeholder="Describa la medicaciÃ³n que estÃ¡ tomando actualmente"
            :rows="3"
          />
          <div class="text-xs text-gray-500 mt-1">
            Incluya dosis y frecuencia si es conocido. Dejar vacÃ­o si no toma medicaciÃ³n.
          </div>
        </div>

        <!-- Contacto de Emergencia -->
        <div class="form-group">
          <FormKit
            type="text"
            name="emergency_contact"
            label="Contacto de Emergencia *"
            placeholder="Nombre y parentesco del contacto"
            validation="required|length:2,100"
            :validation-messages="{
              required: 'El contacto de emergencia es obligatorio',
              length: 'El contacto debe tener entre 2 y 100 caracteres'
            }"
          />
          <div class="text-xs text-gray-500 mt-1">
            Ej: MarÃ­a GonzÃ¡lez (Madre)
          </div>
        </div>

        <!-- TelÃ©fono de Emergencia -->
        <div class="form-group">
          <FormKit
            type="tel"
            name="emergency_phone"
            label="TelÃ©fono de Emergencia *"
            placeholder="+56 9 1234 5678"
            validation="required|length:8,20"
            :validation-messages="{
              required: 'El telÃ©fono de emergencia es obligatorio',
              length: 'El telÃ©fono debe tener entre 8 y 20 caracteres'
            }"
          />
          <div class="text-xs text-gray-500 mt-1">
            Formato: +56 9 1234 5678 o 912345678
          </div>
        </div>

        <!-- Observaciones MÃ©dicas -->
        <div class="form-group col-span-full">
          <FormKit
            type="textarea"
            name="medical_notes"
            label="Observaciones MÃ©dicas Adicionales"
            placeholder="Otra informaciÃ³n mÃ©dica relevante (condiciones crÃ³nicas, cirugÃ­as previas, etc.)"
            :rows="4"
          />
          <div class="text-xs text-gray-500 mt-1">
            InformaciÃ³n adicional que considere importante para el cuidado del niÃ±o
          </div>
        </div>

        <!-- Resumen MÃ©dico -->
        <div class="form-group col-span-full" v-if="showMedicalSummary">
          <label class="formkit-label">Resumen MÃ©dico</label>
          <div class="medical-summary">
            <!-- Alergias -->
            <div class="summary-item" v-if="localData.allergies">
              <ExclamationTriangleIcon class="h-5 w-5 text-red-500" />
              <div class="summary-content">
                <span class="summary-label">Alergias:</span>
                <span class="summary-value">{{ localData.allergies }}</span>
              </div>
            </div>

            <!-- MedicaciÃ³n -->
            <div class="summary-item" v-if="localData.current_medication">
              <ClipboardIcon class="h-5 w-5 text-blue-500" />
              <div class="summary-content">
                <span class="summary-label">MedicaciÃ³n Actual:</span>
                <span class="summary-value">{{ localData.current_medication }}</span>
              </div>
            </div>

            <!-- Contacto de Emergencia -->
            <div class="summary-item" v-if="localData.emergency_contact || localData.emergency_phone">
              <PhoneIcon class="h-5 w-5 text-green-500" />
              <div class="summary-content">
                <span class="summary-label">Contacto Emergencia:</span>
                <span class="summary-value">
                  {{ localData.emergency_contact }}
                  <span v-if="localData.emergency_phone" class="block text-sm text-gray-600">
                    ğŸ“ {{ formatPhoneNumber(localData.emergency_phone) }}
                  </span>
                </span>
              </div>
            </div>

            <!-- Observaciones -->
            <div class="summary-item" v-if="localData.medical_notes">
              <DocumentTextIcon class="h-5 w-5 text-purple-500" />
              <div class="summary-content">
                <span class="summary-label">Observaciones:</span>
                <span class="summary-value">{{ localData.medical_notes }}</span>
              </div>
            </div>

            <!-- Estado General -->
            <div class="summary-status" :class="medicalStatusClass">
              <ShieldCheckIcon class="h-5 w-5" />
              <span class="status-text">{{ medicalStatusText }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- InformaciÃ³n de ValidaciÃ³n -->
      <div class="validation-info" :class="{ 'is-valid': isStepValid }">
        <div class="validation-icon">
          <CheckCircleIcon v-if="isStepValid" class="h-5 w-5" />
          <ExclamationCircleIcon v-else class="h-5 w-5" />
        </div>
        <div class="validation-text">
          <span v-if="isStepValid">âœ“ InformaciÃ³n mÃ©dica completa</span>
          <span v-else>âš  Complete los campos de contacto de emergencia marcados con *</span>
        </div>
      </div>

      <!-- Panel de Debug (solo desarrollo) -->
      <div v-if="showDebug" class="debug-panel mt-4 p-4 bg-gray-100 rounded-lg">
        <h4 class="font-bold mb-2">ğŸ› Debug Info Paso 4:</h4>
        <p><strong>Allergies:</strong> "{{ localData.allergies }}"</p>
        <p><strong>Current Medication:</strong> "{{ localData.current_medication }}"</p>
        <p><strong>Emergency Contact:</strong> "{{ localData.emergency_contact }}"</p>
        <p><strong>Emergency Phone:</strong> "{{ localData.emergency_phone }}"</p>
        <p><strong>Medical Notes:</strong> "{{ localData.medical_notes }}"</p>
        <p><strong>Step Valid:</strong> {{ isStepValid }}</p>
        <p><strong>Raw Form Data:</strong> {{ formDataRaw }}</p>
      </div>
    </FormKit>
  </div>
</template>

<script setup lang="ts">
import { ref, computed, watch, onMounted } from 'vue'
import { 
  CheckCircleIcon, 
  ExclamationCircleIcon,
  ExclamationTriangleIcon,
  ClipboardIcon,
  PhoneIcon,
  DocumentTextIcon,
  ShieldCheckIcon
} from '@heroicons/vue/24/outline'

// Interfaces
interface MedicalData {
  allergies: string
  current_medication: string
  emergency_contact: string
  emergency_phone: string
  medical_notes: string
}

interface Props {
  formData: MedicalData
}

interface Emits {
  (e: 'update:formData', data: MedicalData): void
  (e: 'validate', isValid: boolean): void
}

const props = defineProps<Props>()
const emit = defineEmits<Emits>()

// Estado local del formulario
const localData = ref<MedicalData>({
  allergies: '',
  current_medication: '',
  emergency_contact: '',
  emergency_phone: '',
  medical_notes: ''
})

const formDataRaw = ref<any>({})
const showDebug = ref(import.meta.env.DEV) // Solo mostrar debug en desarrollo

// Muestra el resumen cuando hay datos mÃ©dicos
const showMedicalSummary = computed(() => {
  return localData.value.allergies || 
         localData.value.current_medication || 
         localData.value.emergency_contact ||
         localData.value.emergency_phone ||
         localData.value.medical_notes
})

// Estado mÃ©dico general
const medicalStatusText = computed(() => {
  if (localData.value.allergies || localData.value.current_medication) {
    return 'InformaciÃ³n mÃ©dica importante registrada'
  }
  if (localData.value.emergency_contact && localData.value.emergency_phone) {
    return 'Contactos de emergencia registrados'
  }
  return 'Sin informaciÃ³n mÃ©dica especÃ­fica'
})

const medicalStatusClass = computed(() => {
  if (localData.value.allergies || localData.value.current_medication) {
    return 'status-important'
  }
  if (localData.value.emergency_contact && localData.value.emergency_phone) {
    return 'status-ok'
  }
  return 'status-neutral'
})

// Valida si el paso estÃ¡ completo (solo contacto de emergencia es obligatorio)
const isStepValid = computed(() => {
  const isValid = Boolean(
    localData.value.emergency_contact && 
    localData.value.emergency_contact.trim().length >= 2 && 
    localData.value.emergency_phone && 
    localData.value.emergency_phone.trim().length >= 8
  )
  
  console.log('ğŸ” ValidaciÃ³n Paso 4 - MÃ©dico:', {
    emergency_contact: localData.value.emergency_contact?.length,
    emergency_phone: localData.value.emergency_phone?.length,
    isValid
  })
  
  return isValid
})

// Formatea el nÃºmero de telÃ©fono para mejor visualizaciÃ³n
const formatPhoneNumber = (phone: string) => {
  if (!phone) return ''
  
  // Remover todos los caracteres no numÃ©ricos excepto el +
  const cleaned = phone.replace(/[^\d+]/g, '')
  
  // Formatear segÃºn el patrÃ³n chileno
  if (cleaned.startsWith('+56') && cleaned.length === 12) {
    return `+${cleaned.slice(1, 3)} ${cleaned.slice(3, 4)} ${cleaned.slice(4, 8)} ${cleaned.slice(8)}`
  } else if (cleaned.startsWith('56') && cleaned.length === 11) {
    return `+${cleaned.slice(0, 2)} ${cleaned.slice(2, 3)} ${cleaned.slice(3, 7)} ${cleaned.slice(7)}`
  } else if (cleaned.startsWith('9') && cleaned.length === 9) {
    return `+56 ${cleaned.slice(0, 1)} ${cleaned.slice(1, 5)} ${cleaned.slice(5)}`
  }
  
  return phone
}

// âœ… MANEJO DE INPUT DEL FORMULARIO MEJORADO
const handleFormInput = (rawData: any) => {
  console.log('ğŸ“ Input del formulario Paso 4 (raw):', rawData)
  
  // Procesar datos del formulario
  const processedData: MedicalData = {
    allergies: rawData.allergies || '',
    current_medication: rawData.current_medication || '',
    emergency_contact: rawData.emergency_contact || '',
    emergency_phone: rawData.emergency_phone || '',
    medical_notes: rawData.medical_notes || ''
  }
  
  console.log('ğŸ”„ Datos procesados Paso 4:', processedData)
  
  // Actualizar datos locales
  localData.value = processedData
  
  // Emitir cambios al padre
  emit('update:formData', processedData)
  
  // Emitir validaciÃ³n
  emit('validate', isStepValid.value)
}

// MÃ©todo para validaciÃ³n externa
const validate = () => {
  const isValid = isStepValid.value
  console.log('ğŸ” ValidaciÃ³n forzada Paso 4:', isValid)
  emit('validate', isValid)
  return isValid
}

// âœ… INICIALIZACIÃ“N MEJORADA
onMounted(() => {
  console.log('ğŸš€ Paso 4 - MÃ©dico montado con datos iniciales:', props.formData)
  
  // Cargar datos iniciales del formulario
  if (props.formData) {
    localData.value = {
      allergies: props.formData.allergies || '',
      current_medication: props.formData.current_medication || '',
      emergency_contact: props.formData.emergency_contact || '',
      emergency_phone: props.formData.emergency_phone || '',
      medical_notes: props.formData.medical_notes || ''
    }
    
    // Sincronizar datos crudos para FormKit
    formDataRaw.value = {
      allergies: props.formData.allergies || '',
      current_medication: props.formData.current_medication || '',
      emergency_contact: props.formData.emergency_contact || '',
      emergency_phone: props.formData.emergency_phone || '',
      medical_notes: props.formData.medical_notes || ''
    }
  }
  
  // Emitir validaciÃ³n inicial despuÃ©s de un pequeÃ±o delay
  setTimeout(() => {
    const isValid = isStepValid.value
    console.log('ğŸ“¢ ValidaciÃ³n inicial Paso 4:', isValid)
    emit('validate', isValid)
  }, 100)
})

// Watch para cambios en los props (en caso de ediciÃ³n)
watch(() => props.formData, (newData) => {
  if (newData) {
    const currentStr = JSON.stringify(localData.value)
    const newStr = JSON.stringify(newData)
    
    if (currentStr !== newStr) {
      console.log('ğŸ“¥ ActualizaciÃ³n desde padre Paso 4:', newData)
      
      // Actualizar datos locales
      localData.value = {
        allergies: newData.allergies || '',
        current_medication: newData.current_medication || '',
        emergency_contact: newData.emergency_contact || '',
        emergency_phone: newData.emergency_phone || '',
        medical_notes: newData.medical_notes || ''
      }
      
      // Sincronizar datos crudos para FormKit
      formDataRaw.value = {
        allergies: newData.allergies || '',
        current_medication: newData.current_medication || '',
        emergency_contact: newData.emergency_contact || '',
        emergency_phone: newData.emergency_phone || '',
        medical_notes: newData.medical_notes || ''
      }
    }
  }
}, { deep: true })

// Exponer el mÃ©todo validate al componente padre
defineExpose({
  validate
})
</script>

<style scoped>
.step-medical {
  @apply space-y-6;
}

.step-header {
  @apply flex items-start space-x-4 mb-8 pb-6 border-b border-gray-200;
}

.step-number {
  @apply flex-shrink-0 w-10 h-10 bg-blue-600 text-white rounded-full flex items-center justify-center text-lg font-bold;
}

.step-title h2 {
  @apply text-2xl font-bold text-gray-900;
}

.step-title p {
  @apply text-gray-600 mt-1;
}

.form-grid {
  @apply grid grid-cols-1 md:grid-cols-2 gap-6;
}

.col-span-full {
  @apply md:col-span-2;
}

.form-group {
  @apply space-y-2;
}

.medical-summary {
  @apply space-y-4 p-4 bg-gray-50 border border-gray-200 rounded-lg;
}

.summary-item {
  @apply flex items-start space-x-3;
}

.summary-content {
  @apply flex-1 min-w-0;
}

.summary-label {
  @apply block text-sm font-medium text-gray-700;
}

.summary-value {
  @apply block text-sm text-gray-900 mt-1;
}

.summary-status {
  @apply flex items-center space-x-2 p-3 rounded-lg border text-sm font-medium;
}

.status-important {
  @apply bg-red-50 border-red-200 text-red-800;
}

.status-ok {
  @apply bg-green-50 border-green-200 text-green-800;
}

.status-neutral {
  @apply bg-gray-50 border-gray-200 text-gray-600;
}

.status-text {
  @apply font-medium;
}

.validation-info {
  @apply mt-8 p-4 rounded-lg border flex items-center space-x-3 transition-colors duration-200;
}

.validation-info:not(.is-valid) {
  @apply bg-yellow-50 border-yellow-200 text-yellow-800;
}

.validation-info.is-valid {
  @apply bg-green-50 border-green-200 text-green-800;
}

.validation-icon {
  @apply flex-shrink-0;
}

.validation-text {
  @apply text-sm font-medium;
}

.debug-panel {
  @apply text-xs font-mono;
}

.debug-panel h4 {
  @apply text-sm font-bold text-gray-700;
}

.debug-panel p {
  @apply mb-1;
}
</style>

<style>
/* Estilos globales para FormKit - CONSISTENTES CON PASOS ANTERIORES */
#medical-form .formkit-outer {
  @apply mb-0;
}

#medical-form .formkit-label {
  @apply block text-sm font-medium text-gray-700 mb-2;
}

#medical-form .formkit-input {
  @apply block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm transition-colors duration-200 bg-white;
}

#medical-form .formkit-input:focus {
  @apply ring-2 ring-blue-500 ring-opacity-20;
}

#medical-form .formkit-message {
  @apply mt-1 text-sm text-red-600;
}

#medical-form .formkit-help {
  @apply mt-1 text-sm text-gray-500;
}

#medical-form .formkit-input[type="textarea"] {
  @apply min-h-[80px] resize-y;
}

#medical-form .formkit-input:disabled {
  @apply bg-gray-50 text-gray-500 cursor-not-allowed opacity-60;
}

#medical-form .formkit-input[data-invalid="true"] {
  @apply border-red-300 focus:border-red-500 focus:ring-red-500;
}

#medical-form .formkit-input[data-valid="true"] {
  @apply border-green-300 focus:border-green-500 focus:ring-green-500;
}

/* Responsive */
@media (max-width: 768px) {
  .form-grid {
    @apply grid-cols-1 gap-4;
  }
  
  .step-header {
    @apply flex-col space-x-0 space-y-4;
  }
  
  .step-number {
    @apply w-8 h-8 text-base;
  }
  
  .medical-summary {
    @apply p-3;
  }
  
  .summary-item {
    @apply items-start;
  }
  
  .summary-status {
    @apply p-2 text-xs;
  }
}
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\forms\multi-step\pasos\Paso5SpecialNeeds.vue
============================================================
<!-- src/components/forms/multi-step/pasos/Paso5SpecialNeeds.vue -->
<template>
  <div class="step-special-needs">
    <!-- Header del Paso -->
    <div class="step-header">
      <div class="step-number">5</div>
      <div class="step-title">
        <h2 class="text-2xl font-bold text-gray-900">Necesidades Especiales</h2>
        <p class="text-gray-600 mt-1">InformaciÃ³n sobre necesidades educativas especiales y nivel de autismo</p>
      </div>
    </div>

    <!-- Formulario -->
    <FormKit
      type="form"
      id="special-needs-form"
      :actions="false"
      v-model="formDataRaw"
      @input="handleFormInput"
    >
      <!-- Grid de Campos -->
      <div class="form-grid">
        <!-- Â¿Presenta NEE? -->
        <div class="form-group col-span-full">
          <FormKit
            type="radio"
            name="special_needs"
            label="Â¿Presenta Necesidades Educativas Especiales (NEE)?"
            :options="specialNeedsOptions"
            validation="required"
            :validation-messages="{
              required: 'Esta informaciÃ³n es requerida'
            }"
          />
          <div class="text-xs text-gray-500 mt-1">
            Indique si el niÃ±o/niÃ±a presenta necesidades educativas especiales
          </div>
        </div>

        <!-- Tipo de NEE (condicional) -->
        <div class="form-group col-span-full" v-if="localData.special_needs === true">
          <FormKit
            type="select"
            name="special_needs_type"
            label="Tipo de NEE *"
            placeholder="Selecciona el tipo de necesidad especial"
            :options="specialNeedsTypeOptions"
            validation="required"
            :validation-messages="{
              required: 'El tipo de NEE es obligatorio cuando se marcan necesidades especiales'
            }"
          />
          <div class="text-xs text-gray-500 mt-1">
            Seleccione el tipo de necesidad educativa especial que presenta
          </div>
        </div>

        <!-- Nivel de Autismo -->
        <div class="form-group col-span-full">
          <FormKit
            type="select"
            name="autism_level_value"
            label="Nivel de Autismo"
            placeholder="Selecciona el nivel de autismo"
            :options="autismLevelOptions"
          />
          <div class="text-xs text-gray-500 mt-1">
            Esta informaciÃ³n ayuda a proporcionar el apoyo adecuado
          </div>
        </div>

        <!-- InformaciÃ³n Adicional -->
        <div class="form-group col-span-full" v-if="showAdditionalInfo">
          <div class="additional-info">
            <InformationCircleIcon class="h-5 w-5 text-blue-500" />
            <div class="info-content">
              <h4 class="info-title">InformaciÃ³n sobre NEE</h4>
              <p class="info-text">
                Las Necesidades Educativas Especiales (NEE) se refieren a los apoyos y recursos 
                adicionales que requieren algunos estudiantes para participar plenamente en el 
                proceso educativo.
              </p>
            </div>
          </div>
        </div>

        <!-- Resumen de Necesidades Especiales -->
        <div class="form-group col-span-full" v-if="showSpecialNeedsSummary">
          <label class="formkit-label">Resumen de Necesidades Especiales</label>
          <div class="special-needs-summary">
            <!-- Estado NEE -->
            <div class="summary-item">
              <div class="summary-icon" :class="neeStatusClass">
                <AcademicCapIcon class="h-5 w-5" />
              </div>
              <div class="summary-content">
                <span class="summary-label">Necesidades Educativas Especiales:</span>
                <span class="summary-value">{{ neeStatusText }}</span>
              </div>
            </div>

            <!-- Tipo de NEE -->
            <div class="summary-item" v-if="localData.special_needs_type">
              <TagIcon class="h-5 w-5 text-purple-500" />
              <div class="summary-content">
                <span class="summary-label">Tipo de NEE:</span>
                <span class="summary-value">{{ specialNeedsTypeDisplay }}</span>
              </div>
            </div>

            <!-- Nivel de Autismo -->
            <div class="summary-item" v-if="localData.autism_level_value && localData.autism_level_value !== 'no_review'">
              <UserIcon class="h-5 w-5 text-blue-500" />
              <div class="summary-content">
                <span class="summary-label">Nivel de Autismo:</span>
                <span class="summary-value">{{ autismLevelDisplay }}</span>
                <p class="summary-description">{{ autismLevelDescription }}</p>
              </div>
            </div>

            <!-- Estado General -->
            <div class="summary-status" :class="overallStatusClass">
              <ShieldExclamationIcon class="h-5 w-5" />
              <span class="status-text">{{ overallStatusText }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- InformaciÃ³n de ValidaciÃ³n -->
      <div class="validation-info" :class="{ 'is-valid': isStepValid }">
        <div class="validation-icon">
          <CheckCircleIcon v-if="isStepValid" class="h-5 w-5" />
          <ExclamationCircleIcon v-else class="h-5 w-5" />
        </div>
        <div class="validation-text">
          <span v-if="isStepValid">âœ“ InformaciÃ³n de necesidades especiales completa</span>
          <span v-else>âš  Complete la informaciÃ³n requerida</span>
        </div>
      </div>

      <!-- Panel de Debug (solo desarrollo) -->
      <div v-if="showDebug" class="debug-panel mt-4 p-4 bg-gray-100 rounded-lg">
        <h4 class="font-bold mb-2">ğŸ› Debug Info Paso 5:</h4>
        <p><strong>Special Needs (boolean):</strong> {{ localData.special_needs }}</p>
        <p><strong>Special Needs Type:</strong> {{ localData.special_needs_type }}</p>
        <p><strong>Autism Level Value:</strong> {{ localData.autism_level_value }}</p>
        <p><strong>Step Valid:</strong> {{ isStepValid }}</p>
        <p><strong>Raw Form Data:</strong> {{ formDataRaw }}</p>
      </div>
    </FormKit>
  </div>
</template>

<script setup lang="ts">
import { ref, computed, watch, onMounted } from 'vue'
import { 
  CheckCircleIcon, 
  ExclamationCircleIcon,
  InformationCircleIcon,
  AcademicCapIcon,
  TagIcon,
  UserIcon,
  ShieldExclamationIcon
} from '@heroicons/vue/24/outline'

// Interfaces
interface SpecialNeedsData {
  special_needs: boolean | null
  special_needs_type: string
  autism_level_value: string
}

interface Props {
  formData: SpecialNeedsData
}

interface Emits {
  (e: 'update:formData', data: SpecialNeedsData): void
  (e: 'validate', isValid: boolean): void
}

const props = defineProps<Props>()
const emit = defineEmits<Emits>()

// Estado local del formulario
const localData = ref<SpecialNeedsData>({
  special_needs: null,
  special_needs_type: '',
  autism_level_value: 'no_review'
})

const formDataRaw = ref<any>({})
const showDebug = ref(import.meta.env.DEV) // Solo mostrar debug en desarrollo

// Opciones para los campos
const specialNeedsOptions = {
  'true': 'SÃ­, presenta NEE',
  'false': 'No, no presenta NEE'
}

const specialNeedsTypeOptions = {
  '': 'Selecciona el tipo',
  'permanent': 'Permanente',
  'temporary': 'Transitoria',
  'none': 'No especificado'
}

const autismLevelOptions = {
  'no_review': 'Sin revisiÃ³n',
  'level_1': 'Nivel 1 - Requiere apoyo',
  'level_2': 'Nivel 2 - Requiere apoyo sustancial',
  'level_3': 'Nivel 3 - Requiere apoyo muy sustancial',
  'not_applicable': 'No aplica',
  'none': 'No presenta'
}

// Display values y descripciones
const neeStatusText = computed(() => {
  if (localData.value.special_needs === true) return 'SÃ­ presenta NEE'
  if (localData.value.special_needs === false) return 'No presenta NEE'
  return 'No especificado'
})

const neeStatusClass = computed(() => {
  if (localData.value.special_needs === true) return 'status-yes'
  if (localData.value.special_needs === false) return 'status-no'
  return 'status-unknown'
})

const specialNeedsTypeDisplay = computed(() => {
  return specialNeedsTypeOptions[localData.value.special_needs_type as keyof typeof specialNeedsTypeOptions] || 'No especificado'
})

const autismLevelDisplay = computed(() => {
  return autismLevelOptions[localData.value.autism_level_value as keyof typeof autismLevelOptions] || 'No especificado'
})

const autismLevelDescription = computed(() => {
  const descriptions: Record<string, string> = {
    'level_1': 'Apoyo para dificultades en comunicaciÃ³n social',
    'level_2': 'Apoyo sustancial para interacciÃ³n social',
    'level_3': 'Apoyo muy sustancial para comunicaciÃ³n e interacciÃ³n',
    'not_applicable': 'No presenta caracterÃ­sticas del espectro autista',
    'none': 'No presenta caracterÃ­sticas del espectro autista'
  }
  return descriptions[localData.value.autism_level_value] || ''
})

// Muestra informaciÃ³n adicional cuando es relevante
const showAdditionalInfo = computed(() => {
  return localData.value.special_needs === true || 
         (localData.value.autism_level_value && localData.value.autism_level_value !== 'no_review')
})

// Muestra el resumen cuando hay datos
const showSpecialNeedsSummary = computed(() => {
  return localData.value.special_needs !== null || 
         localData.value.special_needs_type || 
         (localData.value.autism_level_value && localData.value.autism_level_value !== 'no_review')
})

// Estado general
const overallStatusText = computed(() => {
  if (localData.value.special_needs === true) {
    return 'Requiere apoyos educativos especiales'
  }
  if (localData.value.autism_level_value && localData.value.autism_level_value !== 'no_review' && localData.value.autism_level_value !== 'not_applicable' && localData.value.autism_level_value !== 'none') {
    return 'Requiere apoyo especÃ­fico'
  }
  return 'Sin necesidades especiales identificadas'
})

const overallStatusClass = computed(() => {
  if (localData.value.special_needs === true) {
    return 'status-important'
  }
  if (localData.value.autism_level_value && localData.value.autism_level_value !== 'no_review' && localData.value.autism_level_value !== 'not_applicable' && localData.value.autism_level_value !== 'none') {
    return 'status-medium'
  }
  return 'status-neutral'
})

// Valida si el paso estÃ¡ completo
const isStepValid = computed(() => {
  // Si marcÃ³ que tiene NEE, entonces el tipo es obligatorio
  if (localData.value.special_needs === true) {
    const isValid = localData.value.special_needs_type !== ''
    console.log('ğŸ” ValidaciÃ³n Paso 5 - NEE (true):', {
      special_needs: localData.value.special_needs,
      special_needs_type: localData.value.special_needs_type,
      isValid
    })
    return isValid
  }
  
  // Si no tiene NEE, el paso es vÃ¡lido
  const isValid = localData.value.special_needs !== null
  console.log('ğŸ” ValidaciÃ³n Paso 5 - NEE (false/null):', {
    special_needs: localData.value.special_needs,
    isValid
  })
  return isValid
})

// âœ… MANEJO DE INPUT DEL FORMULARIO MEJORADO
const handleFormInput = (rawData: any) => {
  console.log('ğŸ“ Input del formulario Paso 5 (raw):', rawData)
  
  // ğŸ”¥ CRÃTICO: Convertir string a boolean para special_needs
  const specialNeedsBoolean = rawData.special_needs === 'true' ? true : 
                             rawData.special_needs === 'false' ? false : null

  // Procesar datos del formulario
  const processedData: SpecialNeedsData = {
    special_needs: specialNeedsBoolean,
    special_needs_type: rawData.special_needs_type || '',
    autism_level_value: rawData.autism_level_value || 'no_review'
  }
  
  console.log('ğŸ”„ Datos procesados Paso 5:', processedData)
  
  // Si cambia de "SÃ­" a "No" en NEE, limpiar el tipo
  if (processedData.special_needs === false && localData.value.special_needs === true) {
    processedData.special_needs_type = ''
  }
  
  // Actualizar datos locales
  localData.value = processedData
  
  // Emitir cambios al padre
  emit('update:formData', processedData)
  
  // Emitir validaciÃ³n
  emit('validate', isStepValid.value)
}

// MÃ©todo para validaciÃ³n externa
const validate = () => {
  const isValid = isStepValid.value
  console.log('ğŸ” ValidaciÃ³n forzada Paso 5:', isValid)
  emit('validate', isValid)
  return isValid
}

// âœ… INICIALIZACIÃ“N MEJORADA
onMounted(() => {
  console.log('ğŸš€ Paso 5 - Necesidades Especiales montado con datos iniciales:', props.formData)
  
  // Cargar datos iniciales del formulario
  if (props.formData) {
    localData.value = {
      special_needs: props.formData.special_needs,
      special_needs_type: props.formData.special_needs_type || '',
      autism_level_value: props.formData.autism_level_value || 'no_review'
    }
    
    // Sincronizar datos crudos para FormKit (convertir boolean a string)
    formDataRaw.value = {
      special_needs: props.formData.special_needs === true ? 'true' : 
                     props.formData.special_needs === false ? 'false' : '',
      special_needs_type: props.formData.special_needs_type || '',
      autism_level_value: props.formData.autism_level_value || 'no_review'
    }
  }
  
  // Emitir validaciÃ³n inicial despuÃ©s de un pequeÃ±o delay
  setTimeout(() => {
    const isValid = isStepValid.value
    console.log('ğŸ“¢ ValidaciÃ³n inicial Paso 5:', isValid)
    emit('validate', isValid)
  }, 100)
})

// Watch para cambios en los props (en caso de ediciÃ³n)
watch(() => props.formData, (newData) => {
  if (newData) {
    const currentStr = JSON.stringify(localData.value)
    const newStr = JSON.stringify(newData)
    
    if (currentStr !== newStr) {
      console.log('ğŸ“¥ ActualizaciÃ³n desde padre Paso 5:', newData)
      
      // Actualizar datos locales
      localData.value = {
        special_needs: newData.special_needs,
        special_needs_type: newData.special_needs_type || '',
        autism_level_value: newData.autism_level_value || 'no_review'
      }
      
      // Sincronizar datos crudos para FormKit
      formDataRaw.value = {
        special_needs: newData.special_needs === true ? 'true' : 
                       newData.special_needs === false ? 'false' : '',
        special_needs_type: newData.special_needs_type || '',
        autism_level_value: newData.autism_level_value || 'no_review'
      }
    }
  }
}, { deep: true })

// Exponer el mÃ©todo validate al componente padre
defineExpose({
  validate
})
</script>

<style scoped>
.step-special-needs {
  @apply space-y-6;
}

.step-header {
  @apply flex items-start space-x-4 mb-8 pb-6 border-b border-gray-200;
}

.step-number {
  @apply flex-shrink-0 w-10 h-10 bg-blue-600 text-white rounded-full flex items-center justify-center text-lg font-bold;
}

.step-title h2 {
  @apply text-2xl font-bold text-gray-900;
}

.step-title p {
  @apply text-gray-600 mt-1;
}

.form-grid {
  @apply grid grid-cols-1 gap-6;
}

.col-span-full {
  @apply md:col-span-2;
}

.form-group {
  @apply space-y-2;
}

.additional-info {
  @apply flex items-start space-x-3 p-4 bg-blue-50 border border-blue-200 rounded-lg;
}

.info-content {
  @apply flex-1;
}

.info-title {
  @apply text-sm font-medium text-blue-900 mb-1;
}

.info-text {
  @apply text-sm text-blue-700;
}

.special-needs-summary {
  @apply space-y-4 p-4 bg-gray-50 border border-gray-200 rounded-lg;
}

.summary-item {
  @apply flex items-start space-x-3;
}

.summary-icon {
  @apply flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center;
}

.summary-icon.status-yes {
  @apply bg-red-100 text-red-600;
}

.summary-icon.status-no {
  @apply bg-green-100 text-green-600;
}

.summary-icon.status-unknown {
  @apply bg-gray-100 text-gray-600;
}

.summary-content {
  @apply flex-1 min-w-0;
}

.summary-label {
  @apply block text-sm font-medium text-gray-700;
}

.summary-value {
  @apply block text-sm text-gray-900 mt-1;
}

.summary-description {
  @apply block text-xs text-gray-600 mt-1 italic;
}

.summary-status {
  @apply flex items-center space-x-2 p-3 rounded-lg border text-sm font-medium;
}

.status-important {
  @apply bg-red-50 border-red-200 text-red-800;
}

.status-medium {
  @apply bg-yellow-50 border-yellow-200 text-yellow-800;
}

.status-neutral {
  @apply bg-green-50 border-green-200 text-green-800;
}

.status-text {
  @apply font-medium;
}

.validation-info {
  @apply mt-8 p-4 rounded-lg border flex items-center space-x-3 transition-colors duration-200;
}

.validation-info:not(.is-valid) {
  @apply bg-yellow-50 border-yellow-200 text-yellow-800;
}

.validation-info.is-valid {
  @apply bg-green-50 border-green-200 text-green-800;
}

.validation-icon {
  @apply flex-shrink-0;
}

.validation-text {
  @apply text-sm font-medium;
}

.debug-panel {
  @apply text-xs font-mono;
}

.debug-panel h4 {
  @apply text-sm font-bold text-gray-700;
}

.debug-panel p {
  @apply mb-1;
}
</style>

<style>
/* Estilos globales para FormKit - CONSISTENTES CON PASOS ANTERIORES */
#special-needs-form .formkit-outer {
  @apply mb-0;
}

#special-needs-form .formkit-label {
  @apply block text-sm font-medium text-gray-700 mb-2;
}

#special-needs-form .formkit-legend {
  @apply block text-sm font-medium text-gray-700 mb-3;
}

#special-needs-form .formkit-fieldset {
  @apply space-y-3;
}

#special-needs-form .formkit-radio-wrapper {
  @apply flex items-center space-x-3 p-3 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors duration-150;
}

#special-needs-form .formkit-radio-input {
  @apply h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300;
}

#special-needs-form .formkit-radio-label {
  @apply block text-sm font-medium text-gray-700 cursor-pointer;
}

#special-needs-form .formkit-input {
  @apply block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm transition-colors duration-200 bg-white;
}

#special-needs-form .formkit-input:focus {
  @apply ring-2 ring-blue-500 ring-opacity-20;
}

#special-needs-form .formkit-input[validation="required"] ~ .formkit-label::after {
  content: " *";
  @apply text-red-500;
}

#special-needs-form .formkit-legend[validation="required"]::after {
  content: " *";
  @apply text-red-500;
}

#special-needs-form .formkit-message {
  @apply mt-1 text-sm text-red-600;
}

#special-needs-form .formkit-help {
  @apply mt-1 text-sm text-gray-500;
}

#special-needs-form .formkit-input[type="select"] {
  @apply pr-10 bg-white;
}

#special-needs-form .formkit-input:disabled {
  @apply bg-gray-50 text-gray-500 cursor-not-allowed opacity-60;
}

#special-needs-form .formkit-input[data-invalid="true"] {
  @apply border-red-300 focus:border-red-500 focus:ring-red-500;
}

#special-needs-form .formkit-input[data-valid="true"] {
  @apply border-green-300 focus:border-green-500 focus:ring-green-500;
}

#special-needs-form .formkit-radio-wrapper[data-checked="true"] {
  @apply bg-blue-50 border-blue-200;
}

#special-needs-form .formkit-radio-input[data-invalid="true"] {
  @apply border-red-300 text-red-600 focus:ring-red-500;
}

/* Responsive */
@media (max-width: 768px) {
  .form-grid {
    @apply grid-cols-1 gap-4;
  }
  
  .step-header {
    @apply flex-col space-x-0 space-y-4;
  }
  
  .step-number {
    @apply w-8 h-8 text-base;
  }
  
  .special-needs-summary {
    @apply p-3;
  }
  
  .summary-item {
    @apply items-start;
  }
  
  .summary-status {
    @apply p-2 text-xs;
  }
  
  .additional-info {
    @apply p-3;
  }
  
  .formkit-radio-wrapper {
    @apply p-2;
  }
}
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\forms\multi-step\pasos\Paso6Therapy.vue
============================================================
<!-- src/components/forms/multi-step/pasos/Paso6Therapy.vue - VERSIÃ“N CORREGIDA COMPLETA -->
<template>
  <div class="step-therapy">
    <!-- Header del Paso -->
    <div class="step-header">
      <div class="step-number">6</div>
      <div class="step-title">
        <h2 class="text-2xl font-bold text-gray-900">Historial de Terapias</h2>
        <p class="text-gray-600 mt-1">InformaciÃ³n sobre terapias previas y derivaciones</p>
      </div>
    </div>

    <!-- Formulario -->
    <FormKit
      type="form"
      id="therapy-form"
      :actions="false"
      v-model="localData"
      @input="handleFormChange"
    >
      <!-- Grid de Campos -->
      <div class="form-grid">
        <!-- Â¿Ha recibido terapias antes? -->
        <div class="form-group col-span-full">
          <FormKit
            type="radio"
            name="has_previous_therapies"
            label="Â¿Ha recibido terapias antes? *"
            :options="therapyHistoryOptions"
            validation="required"
            :validation-messages="{
              required: 'Esta informaciÃ³n es requerida'
            }"
            @input="handleTherapyChange"
          />
        </div>

        <!-- Detalle de Terapias Previas (condicional) -->
        <div class="form-group col-span-full" v-if="localData.has_previous_therapies === 'true'">
          <FormKit
            type="textarea"
            name="therapies_detail"
            label="Detalle de Terapias Previas *"
            placeholder="Describa los tipos de terapias recibidas, duraciÃ³n, frecuencia, profesionales tratantes, resultados observados, etc."
            :rows="4"
            validation="required|length:10,1000"
            :validation-messages="{
              required: 'El detalle de terapias es obligatorio cuando ha recibido terapias previas',
              length: 'El detalle debe tener entre 10 y 1000 caracteres'
            }"
          />
          <p class="text-xs text-gray-500 mt-1">
            Incluya tipo de terapia, duraciÃ³n, frecuencia y profesionales involucrados (mÃ­nimo 10 caracteres)
          </p>
          <p v-if="localData.therapies_detail && localData.therapies_detail.length < 10" class="text-xs text-red-500 mt-1">
            âš ï¸ Faltan {{ 10 - localData.therapies_detail.length }} caracteres
          </p>
        </div>

        <!-- Â¿QuiÃ©n derivÃ³? -->
        <div class="form-group">
          <FormKit
            type="select"
            name="referred_by"
            label="Â¿QuiÃ©n derivÃ³?"
            placeholder="Selecciona quiÃ©n realizÃ³ la derivaciÃ³n"
            :options="referredByOptions"
          />
        </div>

        <!-- Detalle de DerivaciÃ³n -->
        <div class="form-group">
          <FormKit
            type="text"
            name="referred_by_detail"
            label="Detalle de DerivaciÃ³n"
            placeholder="Especifique nombre, cargo o detalles"
          />
          <p class="text-xs text-gray-500 mt-1">
            Ej: Dra. MarÃ­a GonzÃ¡lez, neurÃ³loga
          </p>
        </div>

        <!-- Â¿DÃ³nde se atendiÃ³ previamente? -->
        <div class="form-group col-span-full">
          <FormKit
            type="select"
            name="attended_where"
            label="Â¿DÃ³nde se atendiÃ³ previamente?"
            placeholder="Selecciona el establecimiento anterior"
            :options="establishmentOptions"
          />
          <p class="text-xs text-gray-500 mt-1">
            Establecimiento donde recibiÃ³ terapias anteriormente
          </p>
        </div>

        <!-- InformaciÃ³n de Apoyo -->
        <div class="form-group col-span-full" v-if="showSupportInfo">
          <div class="support-info">
            <HeartIcon class="h-5 w-5 text-pink-500" />
            <div class="info-content">
              <h4 class="info-title">Importancia del Historial</h4>
              <p class="info-text">
                Conocer el historial de terapias nos ayuda a continuar con los apoyos de manera 
                consistente y a evitar la repeticiÃ³n de estrategias que no han sido efectivas.
              </p>
            </div>
          </div>
        </div>

        <!-- Resumen del Historial de Terapias -->
        <div class="form-group col-span-full" v-if="showTherapySummary">
          <label class="formkit-label">Resumen del Historial</label>
          <div class="therapy-summary">
            <!-- Estado de Terapias Previas -->
            <div class="summary-item">
              <div class="summary-icon" :class="therapyStatusClass">
                <ClockIcon class="h-5 w-5" />
              </div>
              <div class="summary-content">
                <span class="summary-label">Terapias Previas:</span>
                <span class="summary-value">{{ therapyStatusText }}</span>
              </div>
            </div>

            <!-- Detalle de Terapias -->
            <div class="summary-item" v-if="localData.therapies_detail">
              <DocumentTextIcon class="h-5 w-5 text-blue-500" />
              <div class="summary-content">
                <span class="summary-label">Detalle de Terapias:</span>
                <span class="summary-value">{{ localData.therapies_detail }}</span>
              </div>
            </div>

            <!-- DerivaciÃ³n -->
            <div class="summary-item" v-if="localData.referred_by || localData.referred_by_detail">
              <UserGroupIcon class="h-5 w-5 text-green-500" />
              <div class="summary-content">
                <span class="summary-label">DerivaciÃ³n:</span>
                <span class="summary-value">
                  <span v-if="localData.referred_by">{{ referredByDisplay }}</span>
                  <span v-if="localData.referred_by_detail" class="block text-sm text-gray-600">
                    {{ localData.referred_by_detail }}
                  </span>
                </span>
              </div>
            </div>

            <!-- Establecimiento Anterior -->
            <div class="summary-item" v-if="localData.attended_where">
              <BuildingLibraryIcon class="h-5 w-5 text-purple-500" />
              <div class="summary-content">
                <span class="summary-label">Establecimiento Anterior:</span>
                <span class="summary-value">{{ establishmentDisplay }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- InformaciÃ³n de ValidaciÃ³n -->
      <div class="validation-info" :class="{ 'is-valid': isStepValid }">
        <div class="validation-icon">
          <CheckCircleIcon v-if="isStepValid" class="h-5 w-5" />
          <ExclamationCircleIcon v-else class="h-5 w-5" />
        </div>
        <div class="validation-text">
          <span v-if="isStepValid">âœ“ InformaciÃ³n de historial completa</span>
          <span v-else>âš  Complete la informaciÃ³n requerida</span>
        </div>
      </div>

      <!-- Debug Info -->
      <div class="debug-info" v-if="showDebug">
        <div class="flex justify-between items-center mb-2">
          <h4 class="font-bold">ğŸ› Debug Paso 6 - Terapias:</h4>
          <button @click="showDebug = false" type="button" class="text-xs px-2 py-1 bg-yellow-200 rounded hover:bg-yellow-300">
            Ocultar
          </button>
        </div>
        <p><strong>has_previous_therapies:</strong> "{{ localData.has_previous_therapies }}" (tipo: {{ typeof localData.has_previous_therapies }})</p>
        <p><strong>therapies_detail:</strong> "{{ localData.therapies_detail }}" (largo: {{ localData.therapies_detail?.length || 0 }})</p>
        <p><strong>referred_by:</strong> "{{ localData.referred_by }}"</p>
        <p><strong>referred_by_detail:</strong> "{{ localData.referred_by_detail }}"</p>
        <p><strong>attended_where:</strong> "{{ localData.attended_where }}"</p>
        <p class="pt-2 border-t border-yellow-300 mt-2"><strong>isStepValid:</strong> {{ isStepValid ? 'âœ… TRUE' : 'âŒ FALSE' }}</p>
      </div>
    </FormKit>
  </div>
</template>

<script setup lang="ts">
import { ref, computed, watch, onMounted, nextTick } from 'vue'
import { 
  CheckCircleIcon, 
  ExclamationCircleIcon,
  HeartIcon,
  ClockIcon,
  DocumentTextIcon,
  UserGroupIcon,
  BuildingLibraryIcon
} from '@heroicons/vue/24/outline'

// Props y Emits
interface Props {
  formData: {
    has_previous_therapies: string
    therapies_detail: string
    referred_by: string
    referred_by_detail: string
    attended_where: string
  }
}

interface Emits {
  (e: 'update:formData', data: Props['formData']): void
  (e: 'validate', isValid: boolean): void
}

const props = defineProps<Props>()
const emit = defineEmits<Emits>()

// Estado local
const localData = ref({
  has_previous_therapies: '',
  therapies_detail: '',
  referred_by: '',
  referred_by_detail: '',
  attended_where: ''
})

const showDebug = ref(true) // Cambiar a false en producciÃ³n

// Opciones para los campos
const therapyHistoryOptions = {
  'true': 'SÃ­, ha recibido terapias antes',
  'false': 'No, es la primera vez'
}

const referredByOptions = {
  '': 'Selecciona una opciÃ³n',
  'school': 'Establecimiento Educacional',
  'doctor': 'MÃ©dico',
  'specialist': 'Especialista', 
  'family': 'Familia',
  'other': 'Otro'
}

const establishmentOptions = {
  '': 'Selecciona un establecimiento',
  '3': 'Centro de Terapia Norte',
  '4': 'ClÃ­nica Los Alerces', 
  '5': 'Hospital Regional',
  '6': 'Centro de Desarrollo Infantil'
}

// Computed properties
const therapyStatusText = computed(() => {
  if (localData.value.has_previous_therapies === 'true') return 'SÃ­ ha recibido terapias'
  if (localData.value.has_previous_therapies === 'false') return 'Primera vez en terapia'
  return 'No especificado'
})

const therapyStatusClass = computed(() => {
  if (localData.value.has_previous_therapies === 'true') return 'status-yes'
  if (localData.value.has_previous_therapies === 'false') return 'status-no'
  return 'status-unknown'
})

const referredByDisplay = computed(() => {
  return referredByOptions[localData.value.referred_by as keyof typeof referredByOptions] || 'No especificado'
})

const establishmentDisplay = computed(() => {
  return establishmentOptions[localData.value.attended_where as keyof typeof establishmentOptions] || 'No especificado'
})

const showSupportInfo = computed(() => {
  return localData.value.has_previous_therapies === 'true' || 
         localData.value.referred_by !== '' ||
         localData.value.attended_where !== ''
})

const showTherapySummary = computed(() => {
  return localData.value.has_previous_therapies || 
         localData.value.therapies_detail || 
         localData.value.referred_by ||
         localData.value.referred_by_detail ||
         localData.value.attended_where
})

// âœ… VALIDACIÃ“N CORREGIDA
const isStepValid = computed(() => {
  // Si no ha respondido sobre terapias previas, no es vÃ¡lido
  if (!localData.value.has_previous_therapies || localData.value.has_previous_therapies === '') {
    console.log('âŒ Paso 6 invÃ¡lido: no ha respondido sobre terapias previas')
    return false
  }

  // Si tiene terapias previas, el detalle es obligatorio (mÃ­nimo 10 caracteres)
  if (localData.value.has_previous_therapies === 'true') {
    const isValid = localData.value.therapies_detail && localData.value.therapies_detail.trim().length >= 10
    console.log('ğŸ” Paso 6 con terapias previas:', {
      detail: localData.value.therapies_detail,
      length: localData.value.therapies_detail?.length || 0,
      isValid
    })
    return isValid
  }

  // Si no tiene terapias previas (false), el paso es vÃ¡lido
  console.log('âœ… Paso 6 vÃ¡lido: sin terapias previas')
  return true
})

// Maneja cambio especÃ­fico de terapias para limpiar el detalle
const handleTherapyChange = (value: string | undefined) => {
  console.log('ğŸ”„ CambiÃ³ respuesta de terapias a:', value)
  
  // Si cambia a "No", limpiar el detalle inmediatamente
  if (value === 'false') {
    nextTick(() => {
      localData.value.therapies_detail = ''
      console.log('ğŸ§¹ Limpiado detalle de terapias')
      emitChanges()
    })
  }
}

// Maneja cambios en el formulario
const handleFormChange = () => {
  console.log('ğŸ“ Cambio en formulario Paso 6:', localData.value)
  emitChanges()
}

// FunciÃ³n centralizada para emitir cambios
const emitChanges = () => {
  // Emitir datos actualizados
  emit('update:formData', { ...localData.value })
  
  // Emitir validaciÃ³n
  nextTick(() => {
    const valid = Boolean(isStepValid.value)
    console.log('ğŸ“¤ Emitiendo validaciÃ³n Paso 6:', valid)
    emit('validate', valid)
  })
}

// MÃ©todo para validaciÃ³n externa
const validate = () => {
  const isValid = Boolean(isStepValid.value)
  console.log('ğŸ” ValidaciÃ³n forzada Paso 6:', isValid, localData.value)
  emit('validate', isValid)
  return isValid
}

// Inicializar con datos del prop
onMounted(() => {
  console.log('ğŸš€ Paso 6 montado con props:', props.formData)
  
  if (props.formData) {
    // Asegurar que todos los valores sean strings
    localData.value = {
      has_previous_therapies: String(props.formData.has_previous_therapies || ''),
      therapies_detail: String(props.formData.therapies_detail || ''),
      referred_by: String(props.formData.referred_by || ''),
      referred_by_detail: String(props.formData.referred_by_detail || ''),
      attended_where: String(props.formData.attended_where || '')
    }
  }
  
  // Emitir validaciÃ³n inicial despuÃ©s de un breve delay
  setTimeout(() => {
    console.log('â° ValidaciÃ³n inicial Paso 6')
    emit('validate', Boolean(isStepValid.value))
  }, 100)
})

// Watch para cambios en los props (sincronizaciÃ³n)
watch(() => props.formData, (newData) => {
  if (newData && JSON.stringify(newData) !== JSON.stringify(localData.value)) {
    console.log('ğŸ“¥ Sincronizando props en Paso 6:', newData)
    localData.value = {
      has_previous_therapies: String(newData.has_previous_therapies || ''),
      therapies_detail: String(newData.therapies_detail || ''),
      referred_by: String(newData.referred_by || ''),
      referred_by_detail: String(newData.referred_by_detail || ''),
      attended_where: String(newData.attended_where || '')
    }
  }
}, { deep: true })

// Watch para cambios en localData (emitir al padre)
watch(localData, () => {
  emitChanges()
}, { deep: true })

defineExpose({
  validate
})
</script>

<style scoped>
.step-therapy {
  @apply space-y-6;
}

.step-header {
  @apply flex items-start space-x-4 mb-8 pb-6 border-b-2 border-gray-200;
}

.step-number {
  @apply flex-shrink-0 w-12 h-12 bg-blue-600 text-white rounded-full flex items-center justify-center text-xl font-bold;
}

.step-title h2 {
  @apply text-2xl font-bold text-gray-900;
}

.step-title p {
  @apply text-gray-600 mt-1;
}

.form-grid {
  @apply grid grid-cols-1 md:grid-cols-2 gap-6;
}

.form-group {
  @apply space-y-2;
}

.col-span-full {
  @apply md:col-span-2;
}

.support-info {
  @apply flex items-start space-x-3 p-4 bg-pink-50 border-2 border-pink-200 rounded-lg;
}

.info-content {
  @apply flex-1;
}

.info-title {
  @apply font-semibold text-pink-900 mb-1;
}

.info-text {
  @apply text-sm text-pink-800;
}

.therapy-summary {
  @apply space-y-4 p-4 bg-gray-50 border-2 border-gray-200 rounded-lg;
}

.summary-item {
  @apply flex items-start space-x-3;
}

.summary-icon {
  @apply flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center;
}

.summary-icon.status-yes {
  @apply bg-blue-100 text-blue-600;
}

.summary-icon.status-no {
  @apply bg-green-100 text-green-600;
}

.summary-icon.status-unknown {
  @apply bg-gray-100 text-gray-600;
}

.summary-content {
  @apply flex-1;
}

.summary-label {
  @apply text-sm font-medium text-gray-700;
}

.summary-value {
  @apply text-sm text-gray-900 ml-2;
}

.validation-info {
  @apply flex items-center space-x-3 p-4 rounded-lg border-2 transition-all duration-200;
}

.validation-info:not(.is-valid) {
  @apply bg-yellow-50 border-yellow-200;
}

.validation-info.is-valid {
  @apply bg-green-50 border-green-200;
}

.validation-icon {
  @apply flex-shrink-0;
}

.validation-info:not(.is-valid) .validation-icon {
  @apply text-yellow-600;
}

.validation-info.is-valid .validation-icon {
  @apply text-green-600;
}

.validation-text {
  @apply font-medium;
}

.validation-info:not(.is-valid) .validation-text {
  @apply text-yellow-800;
}

.validation-info.is-valid .validation-text {
  @apply text-green-800;
}

.debug-info {
  @apply mt-4 p-4 bg-yellow-50 border-2 border-yellow-200 rounded-lg text-sm font-mono;
}

.debug-info h4 {
  @apply font-bold mb-2 text-yellow-800;
}

.debug-info p {
  @apply mb-1 text-yellow-700;
}

/* Responsive */
@media (max-width: 768px) {
  .step-header {
    @apply flex-col space-x-0 space-y-3;
  }
  
  .step-number {
    @apply w-10 h-10 text-lg;
  }
}
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\forms\multi-step\pasos\Paso7Guardian.vue
============================================================
<!-- src\components\forms\multi-step\pasos\Paso7Guardian.vue -->
<template>
  <div class="step-guardian">
    <!-- Header del Paso -->
    <div class="step-header">
      <div class="step-number">7</div>
      <div class="step-title">
        <h2 class="text-2xl font-bold text-gray-900">Consentimiento del Apoderado</h2>
        <p class="text-gray-600 mt-1">AutorizaciÃ³n y consentimiento para el tratamiento del niÃ±o/niÃ±a</p>
      </div>
    </div>

    <!-- Formulario -->
    <FormKit
      type="form"
      id="guardian-form"
      :actions="false"
      v-model="localData"
      @change="handleFormChange"
      :config="{
        classes: {
          form: 'guardian-form-grid'
        }
      }"
    >
      <!-- Grid de Campos -->
      <div class="form-grid">
        <!-- Consentimiento del Apoderado -->
        <div class="form-group col-span-full">
          <FormKit
            type="radio"
            name="guardian_consent"
            label="Consentimiento del Apoderado *"
            :options="consentOptions"
            validation="required"
            :validation-messages="{
              required: 'El consentimiento es obligatorio'
            }"
            :classes="{
              outer: 'formkit-outer',
              legend: 'formkit-legend',
              fieldset: 'formkit-fieldset',
              wrapper: 'formkit-radio-wrapper',
              input: 'formkit-radio-input',
              label: 'formkit-radio-label',
              help: 'formkit-help',
              message: 'formkit-message'
            }"
          />
          <p class="text-xs text-gray-500 mt-2">
            Este consentimiento autoriza el tratamiento y uso de la informaciÃ³n del niÃ±o/niÃ±a 
            de acuerdo con las polÃ­ticas de privacidad y protecciÃ³n de datos.
          </p>
        </div>

        <!-- Fecha de Consentimiento (condicional) -->
        <div class="form-group" v-if="localData.guardian_consent === 'true'">
          <FormKit
            type="date"
            name="consent_date"
            label="Fecha de Consentimiento *"
            validation="required|date_before:today"
            :validation-messages="{
              required: 'La fecha de consentimiento es obligatoria',
              date_before: 'La fecha no puede ser futura'
            }"
            :classes="{
              outer: 'formkit-outer',
              label: 'formkit-label',
              input: 'formkit-input',
              help: 'formkit-help',
              message: 'formkit-message'
            }"
          />
          <p class="text-xs text-gray-500 mt-1">
            Fecha en que se otorgÃ³ el consentimiento
          </p>
        </div>

        <!-- InformaciÃ³n sobre el Consentimiento -->
        <div class="form-group col-span-full">
          <div class="consent-info">
            <ShieldCheckIcon class="h-5 w-5 text-green-500" />
            <div class="info-content">
              <h4 class="info-title">Importancia del Consentimiento</h4>
              <ul class="info-list">
                <li>â€¢ Autoriza la evaluaciÃ³n e intervenciÃ³n del niÃ±o/niÃ±a</li>
                <li>â€¢ Permite el intercambio de informaciÃ³n entre profesionales</li>
                <li>â€¢ Garantiza el cumplimiento de las normativas de protecciÃ³n de datos</li>
                <li>â€¢ Establece los tÃ©rminos de confidencialidad y uso de informaciÃ³n</li>
              </ul>
            </div>
          </div>
        </div>

        <!-- Documento de Consentimiento (simulado) -->
        <div class="form-group col-span-full" v-if="showConsentDocument">
          <label class="formkit-label">Documento de Consentimiento</label>
          <div class="consent-document">
            <div class="document-header">
              <DocumentTextIcon class="h-6 w-6 text-blue-500" />
              <h3 class="document-title">AutorizaciÃ³n para EvaluaciÃ³n e IntervenciÃ³n</h3>
            </div>
            <div class="document-content">
              <p class="document-text">
                Yo, <strong>apoderado/tutor legal</strong> del niÃ±o/niÃ±a, autorizo al establecimiento 
                educacional y al equipo de profesionales a:
              </p>
              <ul class="document-list">
                <li>Realizar evaluaciones diagnÃ³sticas necesarias</li>
                <li>Aplicar estrategias de intervenciÃ³n y apoyo</li>
                <li>Compartir informaciÃ³n relevante entre profesionales del equipo</li>
                <li>Mantener registro de los avances y progresos</li>
                <li>Utilizar la informaciÃ³n Ãºnicamente con fines educativos y terapÃ©uticos</li>
              </ul>
              <div class="document-footer">
                <p class="document-date" v-if="localData.consent_date">
                  <strong>Fecha de autorizaciÃ³n:</strong> {{ formatConsentDate }}
                </p>
                <p class="document-status" :class="consentStatusClass">
                  <strong>Estado:</strong> {{ consentStatusText }}
                </p>
              </div>
            </div>
          </div>
        </div>

        <!-- Resumen del Consentimiento -->
        <div class="form-group col-span-full" v-if="showConsentSummary">
          <label class="formkit-label">Resumen del Consentimiento</label>
          <div class="consent-summary">
            <!-- Estado del Consentimiento -->
            <div class="summary-item">
              <div class="summary-icon" :class="consentIconClass">
                <CheckCircleIcon v-if="localData.guardian_consent === 'true'" class="h-5 w-5" />
                <XCircleIcon v-else-if="localData.guardian_consent === 'false'" class="h-5 w-5" />
                <QuestionMarkCircleIcon v-else class="h-5 w-5" />
              </div>
              <div class="summary-content">
                <span class="summary-label">Consentimiento Otorgado:</span>
                <span class="summary-value">{{ consentStatusText }}</span>
                <p class="summary-description" v-if="localData.consent_date">
                  Fecha: {{ formatConsentDate }}
                </p>
              </div>
            </div>

            <!-- Implicancias -->
            <div class="summary-item">
              <InformationCircleIcon class="h-5 w-5 text-blue-500" />
              <div class="summary-content">
                <span class="summary-label">Implicancias:</span>
                <span class="summary-value">
                  {{ consentImplications }}
                </span>
              </div>
            </div>

            <!-- Estado General -->
            <div class="summary-status" :class="overallStatusClass">
              <ShieldExclamationIcon class="h-5 w-5" />
              <span class="status-text">{{ overallStatusText }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- InformaciÃ³n de ValidaciÃ³n -->
      <div class="validation-info" :class="{ 'is-valid': isStepValid }">
        <div class="validation-icon">
          <CheckCircleIcon v-if="isStepValid" class="h-5 w-5" />
          <ExclamationCircleIcon v-else class="h-5 w-5" />
        </div>
        <div class="validation-text">
          <span v-if="isStepValid">âœ“ Consentimiento registrado correctamente</span>
          <span v-else>âš  Complete la informaciÃ³n de consentimiento</span>
        </div>
      </div>
    </FormKit>
  </div>
</template>

<script setup lang="ts">
import { ref, computed, watch, onMounted } from 'vue'
import { 
  CheckCircleIcon, 
  ExclamationCircleIcon,
  ShieldCheckIcon,
  DocumentTextIcon,
  XCircleIcon,
  QuestionMarkCircleIcon,
  InformationCircleIcon,
  ShieldExclamationIcon
} from '@heroicons/vue/24/outline'

// Props y Emits
interface Props {
  formData: {
    guardian_consent: string
    consent_date: string
  }
}

interface Emits {
  (e: 'update:formData', data: Props['formData']): void
  (e: 'validate', isValid: boolean): void
}

const props = defineProps<Props>()
const emit = defineEmits<Emits>()

// Datos locales para el formulario
const localData = ref({
  guardian_consent: '',
  consent_date: ''
})

// Opciones para el consentimiento
const consentOptions = {
  'true': 'SÃ­, otorgo mi consentimiento',
  'false': 'No, no otorgo mi consentimiento'
}

// Display values y estados
const consentStatusText = computed(() => {
  if (localData.value.guardian_consent === 'true') return 'Consentimiento OTORGADO'
  if (localData.value.guardian_consent === 'false') return 'Consentimiento DENEGADO'
  return 'Pendiente de respuesta'
})

const consentIconClass = computed(() => {
  if (localData.value.guardian_consent === 'true') return 'status-approved'
  if (localData.value.guardian_consent === 'false') return 'status-denied'
  return 'status-pending'
})

const consentStatusClass = computed(() => {
  if (localData.value.guardian_consent === 'true') return 'status-approved'
  if (localData.value.guardian_consent === 'false') return 'status-denied'
  return 'status-pending'
})

const formatConsentDate = computed(() => {
  if (!localData.value.consent_date) return 'No especificada'
  
  const date = new Date(localData.value.consent_date)
  return date.toLocaleDateString('es-CL', {
    weekday: 'long',
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  })
})

const consentImplications = computed(() => {
  if (localData.value.guardian_consent === 'true') {
    return 'El niÃ±o/niÃ±a puede recibir evaluaciÃ³n e intervenciÃ³n completa'
  }
  if (localData.value.guardian_consent === 'false') {
    return 'No se puede proceder con la evaluaciÃ³n e intervenciÃ³n'
  }
  return 'Es necesario el consentimiento para continuar'
})

// Muestra el documento de consentimiento cuando se otorga
const showConsentDocument = computed(() => {
  return localData.value.guardian_consent === 'true'
})

// Muestra el resumen cuando hay datos
const showConsentSummary = computed(() => {
  return localData.value.guardian_consent !== ''
})

// Estado general
const overallStatusText = computed(() => {
  if (localData.value.guardian_consent === 'true') {
    return 'Autorizado para evaluaciÃ³n e intervenciÃ³n'
  }
  if (localData.value.guardian_consent === 'false') {
    return 'No autorizado - Requiere revisiÃ³n'
  }
  return 'Consentimiento pendiente'
})

const overallStatusClass = computed(() => {
  if (localData.value.guardian_consent === 'true') {
    return 'status-approved'
  }
  if (localData.value.guardian_consent === 'false') {
    return 'status-denied'
  }
  return 'status-pending'
})

// Valida si el paso estÃ¡ completo
const isStepValid = computed(() => {
  // Si otorga consentimiento, la fecha es obligatoria
  if (localData.value.guardian_consent === 'true') {
    return localData.value.consent_date !== ''
  }
  // Si no otorga consentimiento o no ha respondido, el paso no es vÃ¡lido hasta que responda
  return localData.value.guardian_consent !== ''
})

// Maneja cambios en el formulario
const handleFormChange = () => {
  // Si cambia a "No" en consentimiento, limpiar la fecha
  if (localData.value.guardian_consent === 'false') {
    localData.value.consent_date = ''
  }
  
  // Emitir datos actualizados al componente padre
  emit('update:formData', { ...localData.value })
  
  // Emitir estado de validaciÃ³n
  emit('validate', isStepValid.value)
}

// MÃ©todo para validaciÃ³n externa
const validate = () => {
  emit('validate', isStepValid.value)
  return isStepValid.value
}

// Inicializar con datos del prop
onMounted(() => {
  if (props.formData) {
    localData.value = { ...props.formData }
  }
  
  // Emitir validaciÃ³n inicial
  setTimeout(() => {
    emit('validate', isStepValid.value)
  }, 100)
})

// Watch para cambios en los props (en caso de ediciÃ³n)
watch(() => props.formData, (newData) => {
  if (newData) {
    localData.value = { ...newData }
  }
}, { deep: true, immediate: true })

// Exponer el mÃ©todo validate al componente padre
defineExpose({
  validate
})
</script>

<style scoped>
.step-guardian {
  @apply space-y-6;
}

.step-header {
  @apply flex items-start space-x-4 mb-8 pb-6 border-b border-gray-200;
}

.step-number {
  @apply flex-shrink-0 w-10 h-10 bg-blue-600 text-white rounded-full flex items-center justify-center text-lg font-bold;
}

.step-title h2 {
  @apply text-2xl font-bold text-gray-900;
}

.step-title p {
  @apply text-gray-600 mt-1;
}

.form-grid {
  @apply grid grid-cols-1 md:grid-cols-2 gap-6;
}

.col-span-full {
  @apply md:col-span-2;
}

.form-group {
  @apply space-y-2;
}

.consent-info {
  @apply flex items-start space-x-3 p-4 bg-green-50 border border-green-200 rounded-lg;
}

.info-content {
  @apply flex-1;
}

.info-title {
  @apply text-sm font-medium text-green-900 mb-2;
}

.info-list {
  @apply text-sm text-green-700 space-y-1;
}

.consent-document {
  @apply border border-gray-200 rounded-lg overflow-hidden;
}

.document-header {
  @apply bg-blue-50 px-4 py-3 border-b border-blue-200 flex items-center space-x-3;
}

.document-title {
  @apply text-lg font-semibold text-blue-900;
}

.document-content {
  @apply p-4 bg-white;
}

.document-text {
  @apply text-gray-700 mb-4;
}

.document-list {
  @apply space-y-2 mb-4 text-gray-700;
}

.document-list li {
  @apply ml-4;
}

.document-footer {
  @apply pt-4 border-t border-gray-200 space-y-2;
}

.document-date {
  @apply text-sm text-gray-600;
}

.document-status {
  @apply text-sm font-medium;
}

.document-status.status-approved {
  @apply text-green-600;
}

.document-status.status-denied {
  @apply text-red-600;
}

.document-status.status-pending {
  @apply text-yellow-600;
}

.consent-summary {
  @apply space-y-4 p-4 bg-gray-50 border border-gray-200 rounded-lg;
}

.summary-item {
  @apply flex items-start space-x-3;
}

.summary-icon {
  @apply flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center;
}

.summary-icon.status-approved {
  @apply bg-green-100 text-green-600;
}

.summary-icon.status-denied {
  @apply bg-red-100 text-red-600;
}

.summary-icon.status-pending {
  @apply bg-yellow-100 text-yellow-600;
}

.summary-content {
  @apply flex-1 min-w-0;
}

.summary-label {
  @apply block text-sm font-medium text-gray-700;
}

.summary-value {
  @apply block text-sm text-gray-900 mt-1;
}

.summary-description {
  @apply block text-xs text-gray-600 mt-1;
}

.summary-status {
  @apply flex items-center space-x-2 p-3 rounded-lg border text-sm font-medium;
}

.summary-status.status-approved {
  @apply bg-green-50 border-green-200 text-green-800;
}

.summary-status.status-denied {
  @apply bg-red-50 border-red-200 text-red-800;
}

.summary-status.status-pending {
  @apply bg-yellow-50 border-yellow-200 text-yellow-800;
}

.status-text {
  @apply font-medium;
}

.validation-info {
  @apply mt-8 p-4 rounded-lg border flex items-center space-x-3 transition-colors duration-200;
}

.validation-info:not(.is-valid) {
  @apply bg-yellow-50 border-yellow-200 text-yellow-800;
}

.validation-info.is-valid {
  @apply bg-green-50 border-green-200 text-green-800;
}

.validation-icon {
  @apply flex-shrink-0;
}

.validation-text {
  @apply text-sm font-medium;
}
</style>

<style>
/* Estilos globales para FormKit en este componente - CONSISTENTES CON PASOS ANTERIORES */
.guardian-form-grid {
  @apply space-y-6;
}

.formkit-outer {
  @apply mb-0;
}

.formkit-label {
  @apply block text-sm font-medium text-gray-700 mb-2;
}

.formkit-legend {
  @apply block text-sm font-medium text-gray-700 mb-3;
}

.formkit-fieldset {
  @apply space-y-3;
}

.formkit-radio-wrapper {
  @apply flex items-center space-x-3 p-3 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors duration-150;
}

.formkit-radio-input {
  @apply h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300;
}

.formkit-radio-label {
  @apply block text-sm font-medium text-gray-700 cursor-pointer;
}

.formkit-input {
  @apply block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm transition-colors duration-200;
}

.formkit-input:focus {
  @apply ring-2 ring-blue-500 ring-opacity-20;
}

.formkit-input[validation="required"] ~ .formkit-label::after {
  content: " *";
  @apply text-red-500;
}

.formkit-legend[validation="required"]::after {
  content: " *";
  @apply text-red-500;
}

.formkit-message {
  @apply mt-1 text-sm text-red-600;
}

.formkit-help {
  @apply mt-1 text-sm text-gray-500;
}

/* Estados de validaciÃ³n */
.formkit-input[data-invalid="true"] {
  @apply border-red-300 focus:border-red-500 focus:ring-red-500;
}

.formkit-input[data-valid="true"] {
  @apply border-green-300 focus:border-green-500 focus:ring-green-500;
}

/* Estados para radio buttons */
.formkit-radio-wrapper[data-checked="true"] {
  @apply bg-blue-50 border-blue-200;
}

.formkit-radio-input[data-invalid="true"] {
  @apply border-red-300 text-red-600 focus:ring-red-500;
}

/* Placeholder styling */
.formkit-input::placeholder {
  @apply text-gray-400;
}

/* Responsive adjustments */
@media (max-width: 768px) {
  .form-grid {
    @apply grid-cols-1 gap-4;
  }
  
  .step-header {
    @apply flex-col space-x-0 space-y-4;
  }
  
  .step-number {
    @apply w-8 h-8 text-base;
  }
  
  .consent-summary {
    @apply p-3;
  }
  
  .summary-item {
    @apply items-start;
  }
  
  .summary-status {
    @apply p-2 text-xs;
  }
  
  .consent-info {
    @apply p-3;
  }
  
  .formkit-radio-wrapper {
    @apply p-2;
  }
  
  .consent-document {
    @apply text-sm;
  }
  
  .document-header {
    @apply px-3 py-2;
  }
  
  .document-content {
    @apply p-3;
  }
}

/* Mejoras para radio buttons */
.formkit-radio-wrapper {
  @apply cursor-pointer;
}

.formkit-radio-input:checked {
  @apply bg-blue-600 border-blue-600;
}
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\forms\multi-step\pasos\Paso8Parents.vue
============================================================
<!-- src/components/forms/multi-step/pasos/Paso8Parents.vue -->
<template>
  <div class="paso-container">
    <h3 class="paso-title">Paso 8: AsignaciÃ³n de Padres/Tutores</h3>
    
    <!-- Grid de Campos -->
    <div class="form-grid">
      <!-- InformaciÃ³n sobre Responsables -->
      <div class="form-group col-span-full">
        <div class="info-box">
          <h4>ğŸ“‹ InformaciÃ³n Importante</h4>
          <ul>
            <li>Puede buscar y seleccionar padres existentes en el sistema</li>
            <li>O crear nuevos padres si no existen</li>
            <li>Debe asignar al menos un padre/tutor responsable</li>
            <li>Puede asignar mÃºltiples padres/tutores al estudiante</li>
          </ul>
        </div>
      </div>

      <!-- BÃºsqueda de Padres Existentes -->
      <div class="form-group col-span-full">
        <BusquedaPadre
          :selectedParents="selectedParents"
          @parent-selected="handleParentSelected"
          @search-complete="handleSearchComplete"
          @search-error="handleSearchError"
        />
      </div>

      <!-- Lista de Padres Existentes -->
      <div class="form-group col-span-full">
        <ListaPadresExistentes
          :selectedParents="selectedParents"
          @parent-selected="handleParentSelected"
          @parent-removed="handleParentRemoved"
        />
      </div>

      <!-- Crear Nuevo Padre -->
      <div class="form-group col-span-full">
        <CrearNuevoPadre
          @parent-created="handleParentCreated"
        />
      </div>

      <!-- Lista de Padres Seleccionados -->
      <div v-if="selectedParents.length > 0" class="form-group col-span-full">
        <div class="selected-parents-section">
          <h4>âœ… Padres/Tutores Seleccionados ({{ selectedParents.length }})</h4>
          
          <div class="selected-parents-list">
            <div 
              v-for="parent in selectedParents" 
              :key="parent.id"
              class="selected-parent-card"
            >
              <div class="parent-avatar">
                {{ getInitials(parent.first_name, parent.last_name) }}
              </div>
              
              <div class="parent-details">
                <h5>{{ parent.first_name }} {{ parent.last_name }}</h5>
                <p><strong>RUT:</strong> {{ parent.rut }}</p>
                <p><strong>Email:</strong> {{ parent.email }}</p>
                <p v-if="parent.phone"><strong>TelÃ©fono:</strong> {{ parent.phone }}</p>
                <p v-if="parent.username"><strong>Username:</strong> {{ parent.username }}</p>
              </div>
              
              <button
                type="button"
                class="btn btn-danger btn-sm"
                @click="removeParent(parent.id)"
              >
                âŒ Quitar
              </button>
            </div>
          </div>
          
          <!-- InformaciÃ³n de asociaciÃ³n -->
          <div class="association-info">
            <p class="info-text">
              <strong>IDs que se asociarÃ¡n al niÃ±o:</strong> 
              <code>{{ parentIds }}</code>
            </p>
          </div>
        </div>
      </div>

      <!-- Mensaje de validaciÃ³n -->
      <div v-if="selectedParents.length === 0" class="form-group col-span-full">
        <div class="warning-box">
          âš ï¸ Debe seleccionar o crear al menos un padre/tutor responsable para continuar
        </div>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, computed, watch, onMounted } from 'vue'
import { useAlertModalStore } from '@/store/alertModalStore'
import type { ParentUser } from '@/type/nne'
import BusquedaPadre from '../components/BusquedaPadre.vue'
import ListaPadresExistentes from '../components/ListaPadresExistentes.vue'
import CrearNuevoPadre from '../components/CrearNuevoPadre.vue'

interface Props {
  formData?: any
}

interface Emits {
  (e: 'update:formData', value: any): void
  (e: 'validate', isValid: boolean): void
}

const props = defineProps<Props>()
const emit = defineEmits<Emits>()
const alertModal = useAlertModalStore()

// Estado local
const selectedParents = ref<ParentUser[]>([])

// âœ… CRÃTICO: Computed que genera el array de IDs para el backend
const parentIds = computed(() => {
  return selectedParents.value.map((p) => p.id)
})

// âœ… CRÃTICO: ValidaciÃ³n - al menos un padre debe estar seleccionado
const isValid = computed(() => {
  const valid = selectedParents.value.length > 0
  console.log(`ğŸ” Paso 8 - ValidaciÃ³n: ${valid} (${selectedParents.value.length} padres seleccionados)`)
  return valid
})

// âœ… CRÃTICO: Watcher que actualiza formData y emite validaciÃ³n
watch(
  selectedParents,
  (newParents) => {
    console.log('ğŸ”„ Padres seleccionados cambiaron:', newParents.length)
    console.log('ğŸ“¤ IDs a enviar al backend:', parentIds.value)
    
    // Emitir datos actualizados al formulario padre
    emit('update:formData', { 
      usuarios: parentIds.value 
    })
    
    // Emitir estado de validaciÃ³n
    emit('validate', isValid.value)
  },
  { deep: true, immediate: true }
)

// âœ… CRÃTICO: Watcher de validaciÃ³n
watch(
  isValid,
  (newValue) => {
    console.log(`âœ… Paso 8 - Estado de validaciÃ³n cambiÃ³ a: ${newValue}`)
    emit('validate', newValue)
  },
  { immediate: true }
)

// MÃ©todos de utilidad
const getInitials = (firstName: string, lastName: string): string => {
  const first = firstName?.charAt(0) || ''
  const last = lastName?.charAt(0) || ''
  return (first + last).toUpperCase()
}

// Seleccionar padre existente
const handleParentSelected = (parent: ParentUser) => {
  if (!selectedParents.value.some((p) => p.id === parent.id)) {
    selectedParents.value.push(parent)
    
    console.log('âœ… Padre agregado:', parent)
    console.log('ğŸ“‹ Lista actual de IDs:', parentIds.value)
    
    alertModal.success(
      'Padre agregado',
      `${parent.first_name} ${parent.last_name} ha sido agregado correctamente`
    )
  } else {
    alertModal.info('Padre ya seleccionado', 'Este padre ya estÃ¡ en la lista de seleccionados')
  }
}

// Crear y agregar nuevo padre
const handleParentCreated = (parent: any) => {
  console.log('âœ… Padre creado recibido:', parent)

  // Verificar que tenga los campos requeridos
  if (!parent.id || !parent.first_name || !parent.last_name || !parent.email || !parent.rut) {
    console.error('âŒ Padre creado sin campos requeridos:', parent)
    alertModal.error(
      'Error al agregar padre',
      'El padre creado no tiene todos los campos requeridos'
    )
    return
  }

  // Normalizar el objeto padre
  const normalizedParent: ParentUser = {
    id: parent.id,
    first_name: parent.first_name,
    last_name: parent.last_name,
    email: parent.email,
    rut: parent.rut,
    username: parent.username || parent.email.split('@')[0],
    phone: parent.phone
  }

  if (!selectedParents.value.some((p) => p.id === normalizedParent.id)) {
    selectedParents.value.push(normalizedParent)
    
    console.log('âœ… Nuevo padre agregado a la lista:', normalizedParent)
    console.log('ğŸ“‹ Lista actualizada de IDs:', parentIds.value)
    
    alertModal.success(
      'Padre creado y agregado',
      `${normalizedParent.first_name} ${normalizedParent.last_name} ha sido creado y agregado correctamente`
    )
  }
}

// Remover padre
const handleParentRemoved = (parentId: number) => {
  removeParent(parentId)
}

const removeParent = (parentId: number) => {
  const index = selectedParents.value.findIndex((p) => p.id === parentId)
  if (index !== -1) {
    const removedParent = selectedParents.value[index]
    selectedParents.value.splice(index, 1)
    
    console.log('ğŸ—‘ï¸ Padre removido:', removedParent)
    console.log('ğŸ“‹ Lista actualizada de IDs:', parentIds.value)
    
    alertModal.info(
      'Padre removido',
      `${removedParent.first_name} ${removedParent.last_name} ha sido removido de la lista`
    )
  }
}

// Callbacks de bÃºsqueda
const handleSearchComplete = (results: ParentUser[]) => {
  console.log('ğŸ” BÃºsqueda completada:', results.length, 'resultados')
}

const handleSearchError = (error: string) => {
  console.error('âŒ Error en bÃºsqueda:', error)
}

// âœ… NUEVO: MÃ©todo validate para llamada externa
const validate = (): boolean => {
  const valid = isValid.value
  console.log(`ğŸ” Paso 8 - validate() llamado: ${valid}`)
  emit('validate', valid)
  return valid
}

// âœ… NUEVO: MÃ©todo para obtener los datos del paso
const getStepData = () => {
  return {
    usuarios: parentIds.value,
    selectedParents: selectedParents.value
  }
}

// InicializaciÃ³n
onMounted(() => {
  console.log('ğŸ¬ Paso 8 montado')
  
  // Si ya hay datos en formData.usuarios, cargar padres
  if (props.formData?.usuarios && Array.isArray(props.formData.usuarios)) {
    console.log('ğŸ“¥ Cargando padres existentes desde formData:', props.formData.usuarios)
    // AquÃ­ podrÃ­as cargar los padres desde el backend si es necesario
  }
  
  // Emitir validaciÃ³n inicial
  emit('validate', isValid.value)
})

// Exponer mÃ©todos y estado
defineExpose({
  selectedParents,
  parentIds,
  isValid,
  validate,
  getStepData
})
</script>

<style scoped>
.paso-container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 2rem;
}

.paso-title {
  font-size: 1.5rem;
  color: #1f2937;
  margin-bottom: 2rem;
  padding-bottom: 1rem;
  border-bottom: 2px solid #e5e7eb;
}

.form-grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: 2rem;
}

.form-group {
  display: flex;
  flex-direction: column;
}

.col-span-full {
  grid-column: 1 / -1;
}

.info-box {
  background: #eff6ff;
  border: 1px solid #3b82f6;
  border-radius: 8px;
  padding: 1.5rem;
}

.info-box h4 {
  margin: 0 0 1rem 0;
  color: #1e40af;
  font-size: 1.125rem;
}

.info-box ul {
  margin: 0;
  padding-left: 1.5rem;
  color: #1e40af;
}

.info-box li {
  margin-bottom: 0.5rem;
}

.selected-parents-section {
  background: #f0fdf4;
  border: 2px solid #10b981;
  border-radius: 8px;
  padding: 1.5rem;
}

.selected-parents-section h4 {
  margin: 0 0 1.5rem 0;
  color: #065f46;
  font-size: 1.125rem;
}

.selected-parents-list {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 1rem;
  margin-bottom: 1rem;
}

.selected-parent-card {
  display: flex;
  align-items: center;
  gap: 1rem;
  padding: 1rem;
  background: white;
  border: 1px solid #d1fae5;
  border-radius: 6px;
  transition: all 0.2s ease;
}

.selected-parent-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.parent-avatar {
  width: 50px;
  height: 50px;
  border-radius: 50%;
  background: #10b981;
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  font-size: 1rem;
  flex-shrink: 0;
}

.parent-details {
  flex: 1;
  min-width: 0;
}

.parent-details h5 {
  margin: 0 0 0.5rem 0;
  color: #1f2937;
  font-size: 1rem;
  font-weight: 600;
}

.parent-details p {
  margin: 0.25rem 0;
  color: #6b7280;
  font-size: 0.875rem;
}

.association-info {
  margin-top: 1rem;
  padding: 1rem;
  background: #dcfce7;
  border: 1px solid #86efac;
  border-radius: 6px;
}

.info-text {
  margin: 0;
  color: #166534;
  font-size: 0.875rem;
}

.info-text code {
  background: #bbf7d0;
  padding: 0.25rem 0.5rem;
  border-radius: 4px;
  font-family: monospace;
  color: #14532d;
}

.warning-box {
  background: #fef3c7;
  border: 1px solid #f59e0b;
  border-radius: 6px;
  padding: 1rem;
  color: #92400e;
  text-align: center;
  font-weight: 500;
}

.btn {
  padding: 0.5rem 1rem;
  border-radius: 6px;
  font-weight: 500;
  border: none;
  cursor: pointer;
  transition: all 0.2s;
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  font-size: 0.875rem;
}

.btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.btn-danger {
  background: #ef4444;
  color: white;
}

.btn-danger:hover:not(:disabled) {
  background: #dc2626;
}

.btn-sm {
  padding: 0.375rem 0.75rem;
  font-size: 0.75rem;
}

@media (max-width: 768px) {
  .paso-container {
    padding: 1rem;
  }
  
  .selected-parents-list {
    grid-template-columns: 1fr;
  }
  
  .selected-parent-card {
    flex-direction: column;
    text-align: center;
  }
}
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\forms\multi-step\pasos\Paso9Review.vue
============================================================
<!-- src\components\forms\multi-step\pasos\Paso9Review.vue CORREGIDO -->
<template>
  <div class="step-review">
    <!-- Header del Paso -->
    <div class="step-header">
      <div class="step-number">9</div>
      <div class="step-title">
        <h2 class="text-2xl font-bold text-gray-900">RevisiÃ³n Final</h2>
        <p class="text-gray-600 mt-1">Revise toda la informaciÃ³n antes de registrar al niÃ±o/niÃ±a</p>
      </div>
    </div>

    <!-- Resumen General -->
    <div class="review-summary">
      <div class="summary-header">
        <DocumentCheckIcon class="h-6 w-6 text-blue-500" />
        <h3 class="summary-title">Resumen General del Registro</h3>
      </div>
      
      <div class="summary-stats">
        <div class="stat-card" v-for="stat in summaryStats" :key="stat.label">
          <div class="stat-icon" :class="stat.color">
            <component :is="stat.icon" class="h-5 w-5" />
          </div>
          <div class="stat-content">
            <span class="stat-value">{{ stat.value }}</span>
            <span class="stat-label">{{ stat.label }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Secciones de RevisiÃ³n -->
    <div class="review-sections">
      <!-- Datos Personales -->
      <ReviewSection
        title="Datos Personales"
        :isValid="isPersonalDataValid"
        :isOpen="openSection === 'personal'"
        @toggle="toggleSection('personal')"
      >
        <div class="review-content">
          <div class="data-grid">
            <DataField label="Nombres" :value="formData.first_name" />
            <DataField label="Apellidos" :value="formData.last_name" />
            <DataField label="RUT" :value="formData.rut || 'No especificado'" />
            <DataField label="Fecha de Nacimiento" :value="formatDate(formData.birth_date)" />
            <DataField label="Edad" :value="calculateAge(formData.birth_date) + ' aÃ±os'" />
            <DataField label="GÃ©nero" :value="formatGender(formData.gender)" />
          </div>
        </div>
      </ReviewSection>

      <!-- UbicaciÃ³n -->
      <ReviewSection
        title="UbicaciÃ³n y Establecimiento"
        :isValid="isLocationDataValid"
        :isOpen="openSection === 'location'"
        @toggle="toggleSection('location')"
      >
        <div class="review-content">
          <div class="data-grid">
            <DataField label="Establecimiento" :value="getEstablishmentName(formData.establishment)" />
            <DataField label="RegiÃ³n" :value="getRegionName(formData.region)" />
            <DataField label="Comuna" :value="getCommuneName(formData.commune)" />
            <DataField label="DirecciÃ³n" :value="formatAddress(formData.street, formData.street_number)" />
          </div>
        </div>
      </ReviewSection>

      <!-- InformaciÃ³n Escolar -->
      <ReviewSection
        title="InformaciÃ³n Escolar"
        :isValid="isSchoolDataValid"
        :isOpen="openSection === 'school'"
        @toggle="toggleSection('school')"
      >
        <div class="review-content">
          <div class="data-grid">
            <DataField label="Curso/Nivel Actual" :value="formData.current_grade" />
            <DataField label="Jornada Escolar" :value="formatSchoolJourney(formData.school_journey)" />
            <DataField 
              label="Observaciones de AdaptaciÃ³n" 
              :value="formData.adaptation_notes || 'No especificadas'" 
              :isLong="true"
            />
          </div>
        </div>
      </ReviewSection>

      <!-- Perfil MÃ©dico -->
      <ReviewSection
        title="Perfil MÃ©dico"
        :isValid="isMedicalDataValid"
        :isOpen="openSection === 'medical'"
        @toggle="toggleSection('medical')"
      >
        <div class="review-content">
          <div class="data-grid">
            <DataField label="Alergias" :value="formData.allergies || 'Ninguna registrada'" :isLong="true" />
            <DataField label="MedicaciÃ³n Actual" :value="formData.current_medication || 'Ninguna registrada'" :isLong="true" />
            <DataField label="Contacto de Emergencia" :value="formData.emergency_contact" />
            <DataField label="TelÃ©fono de Emergencia" :value="formatPhone(formData.emergency_phone)" />
            <DataField label="Observaciones MÃ©dicas" :value="formData.medical_notes || 'No especificadas'" :isLong="true" />
          </div>
        </div>
      </ReviewSection>

      <!-- Necesidades Especiales -->
      <ReviewSection
        title="Necesidades Especiales"
        :isValid="isSpecialNeedsDataValid"
        :isOpen="openSection === 'special_needs'"
        @toggle="toggleSection('special_needs')"
      >
        <div class="review-content">
          <div class="data-grid">
            <DataField 
              label="Â¿Presenta NEE?" 
              :value="formatBoolean(formData.has_special_needs)" 
            />
            <DataField 
              v-if="formData.has_special_needs"
              label="Tipo de NEE" 
              :value="formatSpecialNeedsType(formData.special_needs_type)" 
            />
            <DataField 
              label="Nivel de Autismo" 
              :value="formatAutismLevel(formData.autism_level)" 
            />
          </div>
        </div>
      </ReviewSection>

      <!-- Historial de Terapias -->
      <ReviewSection
        title="Historial de Terapias"
        :isValid="isTherapyDataValid"
        :isOpen="openSection === 'therapy'"
        @toggle="toggleSection('therapy')"
      >
        <div class="review-content">
          <div class="data-grid">
            <DataField 
              label="Â¿Terapias Previas?" 
              :value="formatBoolean(formData.has_previous_therapies)" 
            />
            <DataField 
              v-if="formData.has_previous_therapies"
              label="Detalle de Terapias" 
              :value="formData.therapies_detail" 
              :isLong="true"
            />
            <DataField label="Â¿QuiÃ©n derivÃ³?" :value="formatReferredBy(formData.referred_by)" />
            <DataField 
              v-if="formData.referred_by_detail"
              label="Detalle de DerivaciÃ³n" 
              :value="formData.referred_by_detail" 
            />
            <DataField 
              label="Establecimiento Anterior" 
              :value="getEstablishmentName(formData.attended_where) || 'No especificado'" 
            />
          </div>
        </div>
      </ReviewSection>

      <!-- Consentimiento -->
      <ReviewSection
        title="Consentimiento del Apoderado"
        :isValid="isGuardianDataValid"
        :isOpen="openSection === 'guardian'"
        @toggle="toggleSection('guardian')"
      >
        <div class="review-content">
          <div class="data-grid">
            <DataField 
              label="Consentimiento Otorgado" 
              :value="formatBoolean(formData.guardian_consent)" 
            />
            <DataField 
              v-if="formData.guardian_consent"
              label="Fecha de Consentimiento" 
              :value="formatDate(formData.consent_date)" 
            />
          </div>
        </div>
      </ReviewSection>

      <!-- Padres/Tutores -->
      <ReviewSection
        title="Padres y Tutores"
        :isValid="isParentsDataValid"
        :isOpen="openSection === 'parents'"
        @toggle="toggleSection('parents')"
      >
        <div class="review-content">
          <div class="parents-list">
            <div 
              v-for="parent in selectedParents" 
              :key="parent.id"
              class="parent-review-card"
            >
              <UserCircleIcon class="h-8 w-8 text-gray-400" />
              <div class="parent-info">
                <span class="parent-name">{{ parent.fullName }}</span>
                <span class="parent-details">{{ parent.rut }} â€¢ {{ parent.email }}</span>
                <span v-if="parent.phone" class="parent-phone">{{ parent.phone }}</span>
              </div>
            </div>
            <div v-if="selectedParents.length === 0" class="no-parents">
              <ExclamationTriangleIcon class="h-5 w-5 text-yellow-500" />
              <span>No se han seleccionado padres/tutores</span>
            </div>
          </div>
        </div>
      </ReviewSection>
    </div>

    <!-- ValidaciÃ³n Final -->
    <div class="final-validation" :class="validationStatus.class">
      <div class="validation-header">
        <component :is="validationStatus.icon" class="h-6 w-6" />
        <h3 class="validation-title">{{ validationStatus.title }}</h3>
      </div>
      <p class="validation-message">{{ validationStatus.message }}</p>
      
      <div v-if="!isAllDataValid" class="validation-issues">
        <h4 class="issues-title">Problemas encontrados:</h4>
        <ul class="issues-list">
          <li v-if="!isPersonalDataValid">âŒ Datos personales incompletos (nombre, apellido, fecha nacimiento)</li>
          <li v-if="!isLocationDataValid">âŒ InformaciÃ³n de ubicaciÃ³n incompleta (establecimiento, direcciÃ³n)</li>
          <li v-if="!isSchoolDataValid">âŒ InformaciÃ³n escolar incompleta (curso/nivel actual)</li>
          <li v-if="!isMedicalDataValid">âŒ Perfil mÃ©dico incompleto (contacto y telÃ©fono de emergencia)</li>
          <li v-if="!isSpecialNeedsDataValid">âŒ Necesidades especiales incompletas (tipo de NEE requerido)</li>
          <li v-if="!isTherapyDataValid">âŒ Historial de terapias incompleto (detalle de terapias requerido)</li>
          <li v-if="!isGuardianDataValid">âŒ Consentimiento incompleto (fecha de consentimiento requerida)</li>
          <li v-if="!isParentsDataValid">âŒ Padres/tutores no asignados (mÃ­nimo 1 requerido)</li>
        </ul>
      </div>
    </div>

    <!-- InformaciÃ³n de ValidaciÃ³n -->
    <div class="validation-info" :class="{ 'is-valid': isStepValid }">
      <div class="validation-icon">
        <CheckCircleIcon v-if="isStepValid" class="h-5 w-5" />
        <ExclamationCircleIcon v-else class="h-5 w-5" />
      </div>
      <div class="validation-text">
        <span v-if="isStepValid">âœ“ Todo listo para registrar al niÃ±o/niÃ±a</span>
        <span v-else>âš  Corrija los problemas antes de continuar</span>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, computed, onMounted } from 'vue'
import { 
  CheckCircleIcon, 
  ExclamationCircleIcon,
  DocumentCheckIcon,
  UserCircleIcon,
  ExclamationTriangleIcon,
  ClipboardDocumentCheckIcon,
  XCircleIcon
} from '@heroicons/vue/24/outline'

// Components
import ReviewSection from '../components/ReviewSection.vue'
import DataField from '../components/DataField.vue'

// Props y Emits
interface Parent {
  id: number
  fullName: string
  rut: string
  email: string
  phone?: string
}

interface Props {
  formData: {
    first_name: string
    last_name: string
    rut: string
    birth_date: string
    gender: string
    establishment: any
    region: any
    commune: any
    street: string
    street_number: string
    current_grade: string
    school_journey: string
    adaptation_notes: string
    allergies: string
    current_medication: string
    emergency_contact: string
    emergency_phone: string
    medical_notes: string
    has_special_needs: boolean  // âœ… CORREGIDO: boolean en lugar de string
    special_needs_type: string
    autism_level: string
    has_previous_therapies: boolean  // âœ… CORREGIDO: boolean en lugar de string
    therapies_detail: string
    referred_by: string
    referred_by_detail: string
    attended_where: any
    guardian_consent: boolean  // âœ… CORREGIDO: boolean en lugar de string
    consent_date: string
    usuarios: number[]
  }
}

interface Emits {
  (e: 'update:formData', data: Props['formData']): void
  (e: 'validate', isValid: boolean): void
}

const props = defineProps<Props>()
const emit = defineEmits<Emits>()

// Estado local para secciones abiertas
const openSection = ref<string>('personal')

// Datos simulados de padres
const availableParents = ref<Parent[]>([
  {
    id: 10,
    fullName: 'Carlos RamÃ­rez Torres',
    rut: '12.345.678-9',
    email: 'carlos.ramirez@email.com',
    phone: '+56 9 3333 4444'
  },
  {
    id: 11,
    fullName: 'MarÃ­a GonzÃ¡lez LÃ³pez',
    rut: '23.456.789-0',
    email: 'maria.gonzalez@email.com',
    phone: '+56 9 5555 6666'
  }
])

// âœ… NUEVA FUNCIÃ“N: Formatear booleanos para display
const formatBoolean = (value: boolean | string): string => {
  if (typeof value === 'boolean') {
    return value ? 'SÃ­' : 'No'
  }
  // Backward compatibility con strings
  if (value === 'true') return 'SÃ­'
  if (value === 'false') return 'No'
  return 'No especificado'
}

// âœ… NUEVA FUNCIÃ“N: Convertir string a boolean para validaciÃ³n
const toBoolean = (value: boolean | string): boolean => {
  if (typeof value === 'boolean') return value
  return value === 'true'
}

// Funciones de formato (mantenidas)
const formatDate = (date: string) => {
  if (!date) return 'No especificada'
  return new Date(date).toLocaleDateString('es-CL')
}

const calculateAge = (birthDate: string) => {
  if (!birthDate) return 0
  const today = new Date()
  const birth = new Date(birthDate)
  let age = today.getFullYear() - birth.getFullYear()
  const monthDiff = today.getMonth() - birth.getMonth()
  if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
    age--
  }
  return age
}

const formatGender = (gender: string) => {
  const genders: Record<string, string> = {
    male: 'Masculino',
    female: 'Femenino',
    other: 'Otro',
    unspecified: 'No especifica'
  }
  return genders[gender] || 'No especificado'
}

const formatSchoolJourney = (journey: string) => {
  const journeys: Record<string, string> = {
    morning: 'Jornada MaÃ±ana',
    afternoon: 'Jornada Tarde',
    full_time: 'Jornada Completa',
    extended: 'Jornada Extendida'
  }
  return journeys[journey] || 'No especificada'
}

const formatSpecialNeedsType = (type: string) => {
  const types: Record<string, string> = {
    permanent: 'Permanente',
    temporary: 'Transitoria',
    none: 'No aplica'
  }
  return types[type] || 'No especificado'
}

const formatAutismLevel = (level: string) => {
  const levels: Record<string, string> = {
    no_review: 'Sin revisiÃ³n',
    level_1: 'Nivel 1 - Requiere apoyo',
    level_2: 'Nivel 2 - Requiere apoyo sustancial',
    level_3: 'Nivel 3 - Requiere apoyo muy sustancial',
    not_applicable: 'No aplica',
    none: 'No aplica'
  }
  return levels[level] || 'No especificado'
}

const formatReferredBy = (referred: string) => {
  const referredBy: Record<string, string> = {
    school: 'Establecimiento Educacional',
    doctor: 'MÃ©dico',
    specialist: 'Especialista',
    family: 'Familia',
    other: 'Otro',
    none: 'No aplica'
  }
  return referredBy[referred] || 'No especificado'
}

const formatPhone = (phone: string) => {
  if (!phone) return 'No especificado'
  return phone
}

const formatAddress = (street: string, number: string) => {
  if (!street && !number) return 'No especificada'
  return `${street || ''} ${number ? '#' + number : ''}`.trim()
}

// Funciones para obtener nombres (simuladas)
const getEstablishmentName = (id: any) => {
  const establishments: Record<string, string> = {
    '4': 'Colegio Los Alerces',
    '3': 'Centro de Terapia Norte'
  }
  return establishments[id] || 'No especificado'
}

const getRegionName = (id: any) => {
  const regions: Record<string, string> = {
    '7': 'RegiÃ³n Metropolitana'
  }
  return regions[id] || 'No especificado'
}

const getCommuneName = (id: any) => {
  const communes: Record<string, string> = {
    '8': 'Santiago'
  }
  return communes[id] || 'No especificado'
}

// âœ… VALIDACIONES CORREGIDAS - ALINEADAS CON BACKEND
const isPersonalDataValid = computed(() => {
  return props.formData.first_name?.trim() && 
         props.formData.last_name?.trim() && 
         props.formData.birth_date
})

const isLocationDataValid = computed(() => {
  return props.formData.establishment && 
         props.formData.region && 
         props.formData.commune && 
         props.formData.street?.trim() && 
         props.formData.street_number?.trim()
})

const isSchoolDataValid = computed(() => {
  return props.formData.current_grade?.trim()
})

const isMedicalDataValid = computed(() => {
  return props.formData.emergency_contact?.trim() && 
         props.formData.emergency_phone?.trim()
})

const isSpecialNeedsDataValid = computed(() => {
  const hasNeeds = toBoolean(props.formData.has_special_needs)
  if (hasNeeds) {
    return props.formData.special_needs_type && 
           props.formData.special_needs_type !== 'none'
  }
  return true // Si no tiene NEE, es vÃ¡lido
})

const isTherapyDataValid = computed(() => {
  const hasTherapies = toBoolean(props.formData.has_previous_therapies)
  if (hasTherapies) {
    return props.formData.therapies_detail?.trim()
  }
  return true // Si no tiene terapias previas, es vÃ¡lido
})

const isGuardianDataValid = computed(() => {
  const hasConsent = toBoolean(props.formData.guardian_consent)
  if (hasConsent) {
    return props.formData.consent_date
  }
  return true // Si no hay consentimiento, es vÃ¡lido (pero revisar requisitos legales)
})

const isParentsDataValid = computed(() => {
  return props.formData.usuarios && props.formData.usuarios.length > 0
})

// ValidaciÃ³n general - ALINEADA CON BACKEND
const isAllDataValid = computed(() => {
  return isPersonalDataValid.value &&
         isLocationDataValid.value &&
         isSchoolDataValid.value &&
         isMedicalDataValid.value &&
         isSpecialNeedsDataValid.value &&
         isTherapyDataValid.value &&
         isGuardianDataValid.value &&
         isParentsDataValid.value
})

// Padres seleccionados
const selectedParents = computed(() => {
  return availableParents.value.filter(parent => 
    props.formData.usuarios?.includes(parent.id)
  )
})

// EstadÃ­sticas del resumen
const summaryStats = computed(() => [
  {
    icon: UserCircleIcon,
    label: 'Datos Personales',
    value: isPersonalDataValid.value ? 'âœ“' : 'âœ—',
    color: isPersonalDataValid.value ? 'bg-green-100 text-green-600' : 'bg-red-100 text-red-600'
  },
  {
    icon: 'MapPinIcon',
    label: 'UbicaciÃ³n',
    value: isLocationDataValid.value ? 'âœ“' : 'âœ—',
    color: isLocationDataValid.value ? 'bg-green-100 text-green-600' : 'bg-red-100 text-red-600'
  },
  {
    icon: 'AcademicCapIcon',
    label: 'Escolar',
    value: isSchoolDataValid.value ? 'âœ“' : 'âœ—',
    color: isSchoolDataValid.value ? 'bg-green-100 text-green-600' : 'bg-red-100 text-red-600'
  },
  {
    icon: 'HeartIcon',
    label: 'MÃ©dico',
    value: isMedicalDataValid.value ? 'âœ“' : 'âœ—',
    color: isMedicalDataValid.value ? 'bg-green-100 text-green-600' : 'bg-red-100 text-red-600'
  },
  {
    icon: 'ClipboardDocumentCheckIcon',
    label: 'Consentimiento',
    value: isGuardianDataValid.value ? 'âœ“' : 'âœ—',
    color: isGuardianDataValid.value ? 'bg-green-100 text-green-600' : 'bg-red-100 text-red-600'
  }
])

// Estado de validaciÃ³n
const validationStatus = computed(() => {
  if (isAllDataValid.value) {
    return {
      icon: ClipboardDocumentCheckIcon,
      title: 'Â¡Todo listo!',
      message: 'Todos los datos han sido completados correctamente. Puede proceder con el registro.',
      class: 'status-valid'
    }
  } else {
    return {
      icon: XCircleIcon,
      title: 'RevisiÃ³n necesaria',
      message: 'Hay algunos problemas que deben ser corregidos antes de continuar.',
      class: 'status-invalid'
    }
  }
})

// Validez del paso
const isStepValid = computed(() => {
  return isAllDataValid.value
})

// MÃ©todos
const toggleSection = (section: string) => {
  openSection.value = openSection.value === section ? '' : section
}

// MÃ©todo para validaciÃ³n externa
const validate = () => {
  const isValid = isStepValid.value
  emit('validate', isValid)
  return isValid
}

// InicializaciÃ³n
onMounted(() => {
  openSection.value = 'personal'
  setTimeout(() => {
    emit('validate', isStepValid.value)
  }, 100)
})

// Exponer el mÃ©todo validate al componente padre
defineExpose({
  validate
})
</script>

<!-- Los estilos se mantienen igual -->
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\forms\sesiones\NuevaSession.vue
============================================================
<!-- src/components/forms/sesiones/NuevaSession.vue -->
<template>
  <BaseModal
    :show="props.show"
    @close="handleClose"
    title="Crear Nueva SesiÃ³n de Terapia"
    size="lg"
  >
    <div class="form-container">
      <p class="form-description">
        Completa los campos principales para programar la nueva sesiÃ³n. PodrÃ¡s
        aÃ±adir mÃ¡s detalles (observaciones, tÃ©cnicas, etc.) despuÃ©s de que la
        sesiÃ³n se realice.
      </p>

      <FormKit
        type="form"
        v-model="formData"
        @submit="handleSubmit"
        :actions="false"
        #default="{ value }"
      >
        <div class="form-grid">
          <!-- Fecha Programada -->
          <FormKit
            type="datetime-local"
            name="scheduled_date"
            label="Fecha y Hora Programada"
            validation="required"
            :min="getTodayString()"
          />

          <!-- DuraciÃ³n -->
          <FormKit
            type="number"
            name="duration_minutes"
            label="DuraciÃ³n (minutos)"
            validation="required|min:15|max:180"
            :value="'60'"
            help="DuraciÃ³n estimada en minutos. (Ej: 60)"
          />

          <!-- Tipo de SesiÃ³n -->
          <FormKit
            type="select"
            name="session_type"
            label="Tipo de SesiÃ³n"
            validation="required"
            :options="tiposSesion"
            placeholder="Selecciona un tipo"
          />

          <!-- Modalidad -->
          <FormKit
            type="select"
            name="modality"
            label="Modalidad"
            validation="required"
            :options="modalidades"
            placeholder="Selecciona una modalidad"
          />

          <!-- Objetivos (Campo principal) -->
          <div class="col-span-2">
            <FormKit
              type="textarea"
              name="objectives"
              label="Objetivos Planificados de la SesiÃ³n"
              placeholder="Describe los objetivos principales para esta sesiÃ³n..."
              validation="required"
              rows="4"
            />
          </div>
        </div>

        <!-- Botones del Formulario -->
        <div class="form-actions">
          <button type="button" class="btn btn-secondary" @click="handleClose">
            Cancelar
          </button>
          <FormKit
            type="submit"
            :label="isLoading ? 'Creando...' : 'Crear SesiÃ³n'"
            :disabled="isLoading"
          />
        </div>
      </FormKit>
    </div>
  </BaseModal>
</template>

<script setup lang="ts">
import { ref } from 'vue'
import type { FormKitNode } from '@formkit/core'
import BaseModal from '@/components/modal/BaseModal.vue'
import { useAlertModalStore } from '@/store/alertModalStore'
// âš ï¸ DEBERÃS CREAR ESTE SERVICIO EN EL SIGUIENTE PASO
import { createTherapySession } from '@/services/sessionService'

// --- Props y Emits ---
const props = defineProps<{
  show: boolean
  childId: number // ID del niÃ±o, necesario para la API
}>()

const emit = defineEmits<{
  (e: 'update:show', value: boolean): void
  (e: 'sesionCreada'): void // Para refrescar la lista en el padre
}>()

// --- Estado del Formulario ---
const isLoading = ref(false)
const getDefaultFormData = () => ({
  scheduled_date: getTodayString(),
  duration_minutes: 60,
  session_type: 'individual',
  modality: 'presencial',
  objectives: ''
})
const formData = ref(getDefaultFormData())

// --- Opciones para los <select> basadas en tu modelo ---
const tiposSesion = [
  { value: 'individual', label: 'Individual' },
  { value: 'grupal', label: 'Grupal' },
  { value: 'familiar', label: 'Con familia' },
  { value: 'evaluacion', label: 'EvaluaciÃ³n' },
  { value: 'seguimiento', label: 'Seguimiento' },
  { value: 'intervencion_crisis', label: 'IntervenciÃ³n en Crisis' }
]

const modalidades = [
  { value: 'presencial', label: 'Presencial' },
  { value: 'online', label: 'Videollamada' },
  { value: 'domiciliaria', label: 'A domicilio' },
  { value: 'escolar', label: 'En escuela' },
  { value: 'comunitaria', label: 'En comunidad' }
]

const alertModal = useAlertModalStore()

// --- MÃ©todos ---

/**
 * Obtiene la fecha y hora actual en formato YYYY-MM-DDTHH:mm para el input.
 */
function getTodayString() {
  const now = new Date();
  now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
  return now.toISOString().slice(0, 16);
}

/**
 * Cierra el modal y resetea el formulario.
 */
function handleClose(node?: FormKitNode | Event) {
  emit('update:show', false)
  // PequeÃ±o delay para que la animaciÃ³n de cierre termine
  setTimeout(() => {
    formData.value = getDefaultFormData()
    // Si es un nodo de FormKit, lo resetea
    if (node && 'reset' in node) {
      ;(node as FormKitNode).reset()
    }
  }, 300)
}

/**
 * Maneja el envÃ­o del formulario.
 */
async function handleSubmit(data: typeof formData.value, node: FormKitNode) {
  isLoading.value = true
  try {
    // Llama al servicio (que crearÃ¡s en el siguiente paso)
    await createTherapySession(props.childId, data)

    alertModal.success(
      'SesiÃ³n Creada',
      'La nueva sesiÃ³n ha sido programada exitosamente.'
    )
    emit('sesionCreada') // Avisa al padre que refresque la lista
    handleClose(node)
  } catch (error: any) {
    console.error('Error al crear la sesiÃ³n:', error)

    // Si el backend devuelve errores de validaciÃ³n para FormKit
    if (error.response && error.response.status === 400) {
      node.setErrors(error.response.data)
    } else {
      alertModal.error(
        'Error Inesperado',
        'No se pudo crear la sesiÃ³n. Por favor, revisa la conexiÃ³n o intÃ©ntalo de nuevo.'
      )
    }
  } finally {
    isLoading.value = false
  }
}
</script>

<style scoped>
.form-container {
  padding: 0.5rem 1rem;
}

.form-description {
  font-size: 0.9rem;
  color: #4b5563; /* text-gray-600 */
  margin-bottom: 1.5rem;
  background-color: #f9fafb; /* bg-gray-50 */
  padding: 1rem;
  border-radius: 8px;
  border: 1px solid #f3f4f6; /* border-gray-100 */
}

.form-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 1.5rem;
}

/* Hace que un campo ocupe ambas columnas */
.col-span-2 {
  grid-column: span 2 / span 2;
}

.form-actions {
  display: flex;
  justify-content: flex-end;
  gap: 0.75rem;
  margin-top: 2rem;
  padding-top: 1.5rem;
  border-top: 1px solid #e5e7eb; /* border-gray-200 */
}

/* Estilos para botones (puedes reusar los de SesionesTerapia.vue si son globales) */
.btn {
  padding: 0.6rem 1.25rem;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 500;
  transition: all 0.2s;
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  font-size: 0.875rem;
}

.btn-secondary {
  background: #f3f4f6; /* bg-gray-100 */
  color: #374151; /* text-gray-700 */
  border: 1px solid #d1d5db; /* border-gray-300 */
}

.btn-secondary:hover {
  background: #e5e7eb; /* bg-gray-200 */
}

/* Responsividad para el grid */
@media (max-width: 640px) {
  .form-grid {
    grid-template-columns: 1fr;
  }
  .col-span-2 {
    grid-column: span 1 / span 1;
  }
}
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\gestion\hitosLogros\MilestoneHistoryList.vue
============================================================
<template>
  <div class="milestone-history-list">
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6">
      <div>
        <h3 class="text-2xl font-bold text-gray-900 flex items-center">
          <ClockIcon class="w-7 h-7 text-primary-500 mr-2" />
          Historial de Hitos
        </h3>
        <p class="mt-1 text-sm text-gray-600 ml-9">
          Registro cronolÃ³gico de {{ milestones?.length || 0 }} {{ milestones?.length === 1 ? 'logro' : 'logros' }}
        </p>
      </div>
      <button
        @click="$emit('refresh')"
        :disabled="isLoading"
        class="inline-flex items-center px-4 py-2.5 text-sm font-semibold text-primary-700 bg-primary-50 hover:bg-primary-100 border border-primary-200 rounded-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-sm hover:shadow"
      >
        <ArrowPathIcon
          :class="['w-4 h-4 mr-2', { 'animate-spin': isLoading }]"
        />
        {{ isLoading ? 'Cargando...' : 'Refrescar' }}
      </button>
    </div>

    <div v-if="isLoading" class="flex items-center justify-center py-20 bg-white rounded-xl border border-gray-200 shadow-sm">
      <div class="text-center">
        <ArrowPathIcon class="animate-spin h-10 w-10 text-primary-500 mx-auto mb-4" />
        <p class="text-gray-600 font-medium">Cargando historial de hitos...</p>
        <p class="text-sm text-gray-500 mt-1">Por favor espera un momento</p>
      </div>
    </div>

    <div v-else-if="!milestones || milestones.length === 0" class="text-center py-20 bg-gradient-to-br from-gray-50 to-blue-50/30 rounded-xl border-2 border-dashed border-gray-300">
      <div class="inline-flex items-center justify-center w-20 h-20 rounded-full bg-gray-100 mb-5">
        <DocumentTextIcon class="w-10 h-10 text-gray-400" />
      </div>
      <h3 class="text-xl font-bold text-gray-900 mb-2">AÃºn no hay hitos registrados</h3>
      <p class="text-gray-600 mb-6 max-w-md mx-auto">
        Los hitos que registres aparecerÃ¡n aquÃ­. Comienza documentando los logros y avances del niÃ±o.
      </p>
      <div class="flex items-center justify-center gap-2 text-sm text-gray-500">
        <SparklesIcon class="w-5 h-5" />
        <span>Registra tu primer hito usando el formulario arriba</span>
      </div>
    </div>

    <div v-else class="space-y-4">
      <div
        v-for="(milestone, index) in milestones"
        :key="milestone.id || index" class="bg-white rounded-xl border border-gray-200 shadow-soft hover:shadow-medium transition-all duration-200 overflow-hidden group relative"
      >
        <div class="absolute top-4 right-4 bg-gray-100 text-gray-600 text-xs font-bold px-2.5 py-1 rounded-full">
          #{{ milestones.length - index }}
        </div>

        <div class="p-6">
          <div class="flex items-start gap-4 mb-5">
            <div class="flex-shrink-0">
              <div class="w-14 h-14 rounded-xl bg-gradient-to-br from-primary-500 to-primary-600 flex items-center justify-center shadow-md">
                <component :is="getCategoryHeroIcon(milestone.category)" class="w-8 h-8 text-white" />
              </div>
            </div>

            <div class="flex-1 min-w-0">
              <div class="flex flex-wrap items-center gap-2 mb-2">
                <span class="inline-flex items-center px-3 py-1.5 rounded-lg text-xs font-bold bg-primary-100 text-primary-800 border border-primary-200">
                  {{ getCategoryIcon(milestone.category) }} {{ milestone.category_display }}
                </span>
                <span
                  :class="[
                    'inline-flex items-center px-3 py-1.5 rounded-lg text-xs font-bold border',
                    getProficiencyColor(milestone.proficiency_level)
                  ]"
                >
                  {{ getProficiencyIcon(milestone.proficiency_level) }} {{ milestone.proficiency_level_display }}
                </span>
              </div>

              <div class="flex items-center gap-2 text-sm text-gray-600">
                <CalendarIcon class="w-4 h-4" />
                <span class="font-medium">{{ formatDateShort(milestone.date) }}</span>
                <span class="text-gray-400">â€¢</span>
                <UserCircleIcon class="w-4 h-4" />
                <span>Edad: {{ milestone.age_at_milestone || 'N/A' }}</span>
              </div>
            </div>

            <div class="flex items-center gap-1 flex-shrink-0">
              <button
                @click="$emit('edit', milestone)"
                class="p-2.5 text-primary-600 hover:bg-primary-50 rounded-lg transition-colors group/btn"
                title="Editar hito"
              >
                <PencilSquareIcon class="w-5 h-5 group-hover/btn:scale-110 transition-transform" />
              </button>
              <button
                @click="$emit('delete', milestone.id)"
                class="p-2.5 text-error-600 hover:bg-error-50 rounded-lg transition-colors group/btn"
                title="Eliminar hito"
              >
                <TrashIcon class="w-5 h-5 group-hover/btn:scale-110 transition-transform" />
              </button>
            </div>
          </div>

          <div class="mb-4 pl-[72px]">
            <div class="bg-gray-50 rounded-lg p-4 border border-gray-200">
              <div class="flex items-start gap-2 mb-2">
                <ChatBubbleLeftEllipsisIcon class="w-4 h-4 text-gray-500 mt-0.5 flex-shrink-0" />
                <h4 class="text-xs font-bold text-gray-500 uppercase tracking-wider">DescripciÃ³n del Logro</h4>
              </div>
              <p class="text-base text-gray-900 leading-relaxed">{{ milestone.description }}</p>
            </div>
          </div>

          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mb-4 pl-[72px]">
            <div class="bg-blue-50 rounded-lg p-3.5 border border-blue-100">
              <div class="flex items-center gap-2 mb-1.5">
                <MapPinIcon class="w-4 h-4 text-blue-600" />
                <p class="text-xs font-bold text-blue-900 uppercase tracking-wide">Contexto</p>
              </div>
              <p class="text-sm text-blue-800 font-medium">{{ milestone.context_display }}</p>
            </div>

            <div class="bg-purple-50 rounded-lg p-3.5 border border-purple-100">
              <div class="flex items-center gap-2 mb-1.5">
                <HandRaisedIcon class="w-4 h-4 text-purple-600" />
                <p class="text-xs font-bold text-purple-900 uppercase tracking-wide">Nivel de Apoyo</p>
              </div>
              <p class="text-sm text-purple-800 font-medium">{{ milestone.support_level_display }}</p>
            </div>

            <div v-if="milestone.functional_impact" class="bg-green-50 rounded-lg p-3.5 border border-green-100 sm:col-span-2 lg:col-span-1">
              <div class="flex items-center gap-2 mb-1.5">
                <SparklesIcon class="w-4 h-4 text-green-600" />
                <p class="text-xs font-bold text-green-900 uppercase tracking-wide">Impacto Funcional</p>
              </div>
              <p class="text-sm text-green-800 font-medium">{{ milestone.functional_impact }}</p>
            </div>
          </div>

          <div v-if="milestone.observations" class="pl-[72px] mb-4">
            <div class="bg-amber-50 rounded-lg p-4 border border-amber-200">
              <div class="flex items-start gap-2 mb-2">
                <LightBulbIcon class="w-4 h-4 text-amber-600 mt-0.5" />
                <h4 class="text-xs font-bold text-amber-900 uppercase tracking-wide">Observaciones Adicionales</h4>
              </div>
              <p class="text-sm text-amber-900 italic leading-relaxed">{{ milestone.observations }}</p>
            </div>
          </div>

          <div class="pt-4 border-t border-gray-200 pl-[72px]">
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-2 text-xs text-gray-500">
                <div class="flex items-center gap-1.5 bg-gray-100 px-3 py-1.5 rounded-lg">
                  <UserIcon class="w-4 h-4" />
                  <span class="font-semibold text-gray-700">{{ milestone.registered_by_name || 'Sistema' }}</span>
                </div>
                <span class="text-gray-400">â€¢</span>
                <div class="flex items-center gap-1.5">
                  <ClockIcon class="w-4 h-4" />
                  <span>{{ formatDate(milestone.created_at) }}</span>
                </div>
              </div>

              </div>
          </div>
        </div>
      </div>
    </div>

    <div v-if="milestones && milestones.length > 0" class="mt-6 bg-gradient-to-r from-primary-50 to-blue-50 rounded-xl p-5 border border-primary-200">
      <div class="flex items-center justify-between flex-wrap gap-4">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 rounded-lg bg-primary-100 flex items-center justify-center">
            <ChartBarIcon class="w-6 h-6 text-primary-600" />
          </div>
          <div>
            <p class="text-sm font-semibold text-gray-900">Total de hitos registrados</p>
            <p class="text-xs text-gray-600">Progreso documentado del desarrollo</p>
          </div>
        </div>
        <div class="text-right">
          <p class="text-3xl font-bold text-primary-600">{{ milestones.length }}</p>
          <p class="text-xs text-gray-600">{{ milestones.length === 1 ? 'Hito' : 'Hitos' }}</p>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import {
  ClockIcon, ArrowPathIcon, DocumentTextIcon, SparklesIcon,
  CheckCircleIcon, CalendarIcon, UserCircleIcon, PencilSquareIcon, TrashIcon,
  ChatBubbleLeftEllipsisIcon, MapPinIcon, HandRaisedIcon, LightBulbIcon,
  UserIcon, ChartBarIcon,
  // Specific category icons (optional but nice)
  ChatBubbleBottomCenterTextIcon, UserGroupIcon, AcademicCapIcon,
  CogIcon, HeartIcon, BeakerIcon, StarIcon // StarIcon as fallback
} from '@heroicons/vue/24/outline'
import type { Milestone } from '@/type/hitoServiceInterface'; // Import the interface

interface Props {
  milestones: Milestone[] | null; // Allow null for initial state
  isLoading?: boolean;
}

// Define props with defaults
const props = withDefaults(defineProps<Props>(), {
    milestones: () => [], // Default to empty array
    isLoading: false,
});


defineEmits<{
  (e: 'refresh'): void
  (e: 'edit', milestone: Milestone): void
  (e: 'delete', id: number | string): void
}>()

function getProficiencyColor(level: string): string {
  const colors: Record<string, string> = {
    emerging: 'bg-yellow-50 text-yellow-800 border-yellow-200',
    developing: 'bg-blue-50 text-blue-800 border-blue-200',
    proficient: 'bg-green-50 text-green-800 border-green-200',
    mastered: 'bg-purple-50 text-purple-800 border-purple-200'
  }
  return colors[level] || 'bg-gray-50 text-gray-800 border-gray-200'
}

function getProficiencyIcon(level: string): string {
  const icons: Record<string, string> = {
    emerging: 'ğŸŒ±',
    developing: 'ğŸŒ¿',
    proficient: 'ğŸŒ³',
    mastered: 'â­'
  }
  return icons[level] || 'ğŸ“'
}

// Simple text icons for categories
function getCategoryIcon(category: string): string {
  const icons: Record<string, string> = {
    communication: 'ğŸ“¢',
    social: 'ğŸ‘¥',
    academic: 'ğŸ“š',
    motor: 'ğŸƒ',
    cognitive: 'ğŸ§ ',
    emotional: 'ğŸ’',
    therapeutic: 'âš•ï¸'
  }
  return icons[category] || 'ğŸ“‹'
}

// Map category keys to Heroicons components for the main card icon
function getCategoryHeroIcon(category: string) {
    const iconMap: Record<string, any> = {
        communication: ChatBubbleBottomCenterTextIcon,
        social: UserGroupIcon,
        academic: AcademicCapIcon,
        motor: CogIcon, // Using Cog as a placeholder for Motor skills
        cognitive: BeakerIcon, // Using Beaker as a placeholder for Cognitive
        emotional: HeartIcon,
        therapeutic: CheckCircleIcon, // Or a specific therapy icon if available
    };
    return iconMap[category] || StarIcon; // Fallback icon
}


function formatDate(dateString: string | null | undefined): string {
  if (!dateString) return 'Fecha desconocida';
   try {
        return new Date(dateString).toLocaleString('es-CL', {
            year: 'numeric', month: 'short', day: 'numeric',
            hour: '2-digit', minute: '2-digit'
        });
    } catch (e) {
        return dateString;
    }
}

function formatDateShort(dateString: string | null | undefined): string {
  if (!dateString) return 'Fecha desconocida';
   try {
        return new Date(dateString).toLocaleDateString('es-CL', {
            year: 'numeric', month: 'long', day: 'numeric'
        });
    } catch (e) {
        return dateString;
    }
}
</script>

<style scoped>
/* Add any specific styles if needed */
.shadow-soft {
  box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.05), 0 2px 4px -2px rgb(0 0 0 / 0.05);
}
.shadow-medium {
   box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.07), 0 4px 6px -4px rgb(0 0 0 / 0.07);
}

/* Custom error color */
.text-error-600 { color: #DC2626; } /* Tailwind red-600 */
.hover\:bg-error-50:hover { background-color: #FEF2F2; } /* Tailwind red-50 */
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\gestion\rutinas\comparison\ComparisonChart.vue
============================================================

============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\gestion\rutinas\comparison\ComparisonMetricsGrid.vue
============================================================

============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\gestion\rutinas\comparison\ComparisonView.vue
============================================================

============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\gestion\rutinas\comparison\RecommendationCard.vue
============================================================

============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\gestion\rutinas\comparison\RoutineSelector.vue
============================================================

============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\gestion\rutinas\comparison\WinnerBadge.vue
============================================================

============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\gestion\rutinas\core\BasicInfoPanel.vue
============================================================
<template>
  <div class="bg-white rounded-2xl shadow-soft p-6">
    
    <h3 class="text-lg font-semibold text-gray-800 border-b border-gray-200 pb-3 mb-4 flex items-center">
      <InformationCircleIcon class="w-5 h-5 mr-2 text-primary-600" />
      InformaciÃ³n General
    </h3>

    <dl class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4 text-sm">

      <div class="md:col-span-2"> {/* Ocupa ambas columnas en md */}
        <dt class="text-gray-500 font-medium">Nombre de la Rutina</dt>
        <dd class="mt-1 text-gray-900 font-semibold text-base">{{ routineData.name }}</dd>
      </div>

      <div>
        <dt class="text-gray-500 font-medium">Tipo</dt>
        <dd class="mt-1 text-gray-900">{{ routineData.routine_type_display }}</dd>
      </div>

      <div>
        <dt class="text-gray-500 font-medium">Estado</dt>
        <dd class="mt-1">
          <RoutineStatusBadge :status="routineData.status" />
        </dd>
      </div>
      
      <div class="md:col-span-2">
        <dt class="text-gray-500 font-medium">DescripciÃ³n</dt>
        <dd class="mt-1 text-gray-900 whitespace-pre-wrap">{{ routineData.description || 'No especificada' }}</dd>
      </div>

      <div>
        <dt class="text-gray-500 font-medium">Fecha de Inicio</dt>
        <dd class="mt-1 text-gray-900">{{ formattedStartDate }}</dd>
      </div>

      <div>
        <dt class="text-gray-500 font-medium">Creado Por</dt>
        <dd class="mt-1 text-gray-900">{{ routineData.created_by_name }}</dd>
      </div>

      <div class="md:col-span-2">
        <dt class="text-gray-500 font-medium">Para</dt>
        <dd class="mt-1 text-gray-900 font-medium">{{ routineData.child_name }}</dd>
      </div>

    </dl>
  </div>
</template>

<script setup lang="ts">
import { ref, computed } from 'vue'
import type { PropType } from 'vue'
// Importamos la interfaz que define la estructura esperada
import type { DailyRoutineDetail } from '@/type/rutinas/rutinas' 

// Importamos date-fns para formatear fechas (de tus dependencias)
import { format, parseISO } from 'date-fns'
import { es } from 'date-fns/locale'

// Importamos el icono (de tus dependencias)
import { InformationCircleIcon } from '@heroicons/vue/24/outline'

// Importamos el componente Badge (de la misma carpeta 'core')
import RoutineStatusBadge from './RoutineStatusBadge.vue'

// === PROPS ===
// Este componente esperarÃ­a recibir el objeto de rutina completo
// const props = defineProps({
//   routine: {
//     type: Object as PropType<DailyRoutineDetail>,
//     required: true
//   }
// })

// === DATOS DE EJEMPLO (Simulando la Prop 'routine') ===
// Estos datos coinciden con la estructura de DailyRoutineDetailSerializer
const routineData = ref<DailyRoutineDetail>({
  id: 15,
  name: "Rutina Matutina Escolar",
  routine_type: "morning",
  routine_type_display: "MaÃ±ana",
  description: "PreparaciÃ³n completa para ir al colegio, desde levantarse hasta salir de casa.",
  status: "active",
  status_display: "Activa",
  is_active: true,
  date_started: "2025-09-01",
  date_ended: null,
  child: 4,
  child_name: "MatÃ­as GonzÃ¡lez",
  created_by: 1,
  created_by_name: "Dr. Ana Torres",
  total_steps: 8,
  days_active: 56, // Campo calculado por el serializer
  completion_rate_7days: 85.7, // Campo calculado por el serializer
  created_at: "2025-08-25T10:30:00Z",
  updated_at: "2025-10-20T15:00:00Z",
  // Relaciones anidadas (no usadas directamente en este panel, pero parte del tipo)
  schedules: [], 
  steps: [],
  strategies: null,
  motivation: null,
  independence_goal: null,
  coordination: null,
  challenges: null,
  evaluations: [],
})

// === COMPUTED ===

/**
 * Formatea la fecha de inicio a un formato legible (ej: "1 sep 2025")
 */
const formattedStartDate = computed(() => {
  if (!routineData.value.date_started) return 'No definida'
  try {
    // parseISO convierte el string YYYY-MM-DD en un objeto Date
    // format lo convierte al formato deseado
    return format(parseISO(routineData.value.date_started), 'd MMM yyyy', { locale: es })
  } catch (error) {
    console.warn('Error formatting start date:', routineData.value.date_started)
    return routineData.value.date_started // Fallback
  }
})

</script>

<style scoped>
/* Estilos especÃ­ficos si fueran necesarios, 
  pero Tailwind deberÃ­a cubrir la mayorÃ­a.
  'whitespace-pre-wrap' en la descripciÃ³n permite 
  respetar los saltos de lÃ­nea y espacios mÃºltiples.
*/
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\gestion\rutinas\core\RoutineActionMenu.vue
============================================================
<template>
  <Menu as="div" class="relative inline-block text-left">
    <div>
      <MenuButton 
        class="flex items-center rounded-full bg-white text-gray-400 hover:text-gray-600 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2"
        aria-label="Opciones de rutina"
      >
        <span class="sr-only">Abrir menÃº de opciones</span>
        <EllipsisVerticalIcon class="h-5 w-5" aria-hidden="true" />
      </MenuButton>
    </div>

    <transition
      enter-active-class="transition duration-100 ease-out"
      enter-from-class="transform scale-95 opacity-0"
      enter-to-class="transform scale-100 opacity-100"
      leave-active-class="transition duration-75 ease-in"
      leave-from-class="transform scale-100 opacity-100"
      leave-to-class="transform scale-95 opacity-0"
    >
      <MenuItems class="absolute right-0 z-10 mt-2 w-56 origin-top-right rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none">
        <div class="py-1">
          
          <MenuItem v-slot="{ active }">
            <button 
              @click="emitAction('edit')"
              :class="[
                active ? 'bg-gray-100 text-gray-900' : 'text-gray-700',
                'group flex w-full items-center px-4 py-2 text-sm'
              ]"
            >
              <PencilSquareIcon class="mr-3 h-5 w-5 text-gray-400 group-hover:text-gray-500" aria-hidden="true" />
              Editar Rutina
            </button>
          </MenuItem>

          <MenuItem v-slot="{ active }">
            <button 
              @click="emitAction('clone')"
              :class="[
                active ? 'bg-gray-100 text-gray-900' : 'text-gray-700',
                'group flex w-full items-center px-4 py-2 text-sm'
              ]"
            >
              <DocumentDuplicateIcon class="mr-3 h-5 w-5 text-gray-400 group-hover:text-gray-500" aria-hidden="true" />
              Clonar Rutina
            </button>
          </MenuItem>
          
          <MenuItem v-slot="{ active }">
            <button 
              v-if="routine.status === 'active' || routine.status === 'paused'"
              @click="emitAction('toggle-status')"
              :class="[
                active ? 'bg-gray-100 text-gray-900' : 'text-gray-700',
                'group flex w-full items-center px-4 py-2 text-sm'
              ]"
            >
              <component 
                :is="toggleStatusIcon" 
                class="mr-3 h-5 w-5 text-gray-400 group-hover:text-gray-500" 
                aria-hidden="true" 
              />
              {{ toggleStatusText }}
            </button>
          </MenuItem>

          <div class="my-1 border-t border-gray-100"></div>

          <MenuItem v-slot="{ active }">
            <button 
              @click="emitAction('archive')"
              :class="[
                active ? 'bg-error-50 text-error-700' : 'text-error-600',
                'group flex w-full items-center px-4 py-2 text-sm'
              ]"
            >
              <ArchiveBoxXMarkIcon class="mr-3 h-5 w-5 group-hover:text-error-500" :class="active ? 'text-error-500' : 'text-error-400'" aria-hidden="true" />
              Archivar Rutina
            </button>
          </MenuItem>
          
        </div>
      </MenuItems>
    </transition>
  </Menu>
</template>

<script setup lang="ts">
import { computed } from 'vue'
import type { PropType } from 'vue'
import type { DailyRoutineList } from '@/type/rutinas/rutinas' // Importa la interfaz

// Componentes de Headless UI y Heroicons
import { Menu, MenuButton, MenuItem, MenuItems } from '@headlessui/vue'
import {
  EllipsisVerticalIcon,
  PencilSquareIcon,
  DocumentDuplicateIcon,
  PauseCircleIcon, // Para Pausar
  PlayCircleIcon,  // Para Activar
  ArchiveBoxXMarkIcon,
} from '@heroicons/vue/20/solid' // Usamos 'solid' para iconos mÃ¡s llenos en el menÃº

// === PROPS ===
const props = defineProps({
  /**
   * El objeto de rutina para determinar las acciones disponibles.
   */
  routine: {
    type: Object as PropType<DailyRoutineList>,
    required: true
  }
})

// === EMITS ===
// Define los eventos que este componente puede emitir.
// El componente padre (ej. RoutineCard) escucharÃ¡ estos eventos.
const emit = defineEmits<{
  (e: 'edit'): void
  (e: 'clone'): void
  (e: 'toggle-status'): void
  (e: 'archive'): void
}>()

// === COMPUTED ===

/**
 * Determina el icono correcto para la acciÃ³n de Pausar/Activar.
 */
const toggleStatusIcon = computed(() => {
  return props.routine.status === 'active' ? PauseCircleIcon : PlayCircleIcon
})

/**
 * Determina el texto correcto para la acciÃ³n de Pausar/Activar.
 */
const toggleStatusText = computed(() => {
  return props.routine.status === 'active' ? 'Pausar Rutina' : 'Activar Rutina'
})

// === MÃ‰TODOS ===

/**
 * FunciÃ³n genÃ©rica para emitir el evento correspondiente a la acciÃ³n.
 */
function emitAction(actionName: 'edit' | 'clone' | 'toggle-status' | 'archive') {
  emit(actionName)
}

</script>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\gestion\rutinas\core\RoutineCard.vue
============================================================
<!-- src/components/gestion/rutinas/core/RoutineCard.vue -->
<template>
  <div class="bg-white rounded-2xl shadow-soft transition-all duration-300 hover:shadow-medium divide-y divide-gray-200 border border-gray-100">

    <!-- Header con nombre y acciones -->
    <div class="p-5 flex justify-between items-start">
      <div class="flex-1 min-w-0">
        <button 
          @click="onViewDetail" 
          class="text-left group w-full"
        >
          <h3 class="text-lg font-bold text-gray-900 group-hover:text-primary-600 transition-colors truncate">
            {{ routine.name }}
          </h3>
        </button>
        <p class="text-sm font-medium text-primary-600 mt-1">
          {{ getRoutineTypeDisplay }}
        </p>
        
        <!-- Estado y metadata en lÃ­nea -->
        <div class="flex items-center gap-3 mt-2">
          <RoutineStatusBadge :status="routine.status" />
          <span class="text-xs text-gray-500">
            {{ routine.total_steps || 0 }} pasos
          </span>
          <span class="text-xs text-gray-500">
            {{ formattedDate }}
          </span>
        </div>
      </div>
      
      <RoutineActionMenu 
        :routine="routine"
        @edit="handleAction('edit')"
        @clone="handleAction('clone')"
        @toggle-status="handleAction('toggle-status')"
        @archive="handleAction('archive')"
      />
    </div>

    <!-- Progreso y mÃ©tricas -->
    <div class="p-5">
      <div v-if="hasProgressData" class="space-y-3">
        <!-- Barra de progreso -->
        <div>
          <div class="flex justify-between items-center mb-1">
            <span class="text-sm font-medium text-gray-700">Progreso (7 dÃ­as)</span>
            <span class="text-sm font-bold" :class="progressColor">
              {{ routine.completion_rate_7days }}%
            </span>
          </div>
          <div class="w-full bg-gray-200 rounded-full h-2.5">
            <div 
              class="h-2.5 rounded-full transition-all duration-500" 
              :class="progressBarColor"
              :style="{ width: completionWidth }"
            ></div>
          </div>
        </div>

        <!-- MÃ©tricas adicionales -->
        <div class="grid grid-cols-2 gap-4 text-xs">
          <div class="text-center p-2 bg-gray-50 rounded-lg">
            <div class="font-semibold text-gray-900">{{ routine.total_steps || 0 }}</div>
            <div class="text-gray-500">Pasos totales</div>
          </div>
          <div class="text-center p-2 bg-gray-50 rounded-lg">
            <div class="font-semibold text-gray-900">{{ routineStatusText }}</div>
            <div class="text-gray-500">Estado</div>
          </div>
        </div>
      </div>
      
      <!-- Estado sin datos -->
      <div v-else class="text-center py-4">
        <div class="inline-flex items-center justify-center w-12 h-12 bg-gray-100 rounded-full mb-2">
          <CalendarDaysIcon class="w-6 h-6 text-gray-400" />
        </div>
        <p class="text-sm text-gray-500">
          Sin registros recientes
        </p>
        <button 
          @click="onViewDetail"
          class="mt-2 text-xs text-primary-600 hover:text-primary-700 font-medium"
        >
          Ver detalles â†’
        </button>
      </div>
    </div>

    <!-- Footer con acciones rÃ¡pidas -->
    <div class="p-4 bg-gray-50 rounded-b-2xl">
      <div class="flex justify-between items-center">
        <button
          @click="onViewDetail"
          class="inline-flex items-center text-sm text-primary-600 hover:text-primary-700 font-medium"
        >
          <EyeIcon class="w-4 h-4 mr-1" />
          Ver
        </button>
        
        <div class="flex items-center gap-2">
          <span class="text-xs text-gray-500" :title="`Creado: ${fullFormattedDate}`">
            {{ timeAgo }}
          </span>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { computed } from 'vue'
import type { PropType } from 'vue'
import { format, parseISO, formatDistanceToNow } from 'date-fns'
import { es } from 'date-fns/locale'

// Importar tipos desde el archivo reciÃ©n creado
import type { DailyRoutineList } from '@/type/rutinas/rutinas'

// Iconos
import { 
  CalendarDaysIcon, 
  EyeIcon 
} from '@heroicons/vue/24/outline'

// Componentes
import RoutineStatusBadge from './RoutineStatusBadge.vue'
import RoutineActionMenu from './RoutineActionMenu.vue'

// === PROPS ===
const props = defineProps({
  routine: {
    type: Object as PropType<DailyRoutineList>,
    required: true
  }
})

// === EMITS ===
const emit = defineEmits<{
  (e: 'view-detail', id: number): void
  (e: 'edit', id: number): void
  (e: 'clone', id: number): void
  (e: 'toggle-status', id: number): void
  (e: 'archive', id: number): void
}>()

// === COMPUTED PROPERTIES ===

/** Muestra el tipo de rutina formateado */
const getRoutineTypeDisplay = computed(() => {
  return props.routine.routine_type_display || props.routine.routine_type
})

/** Fecha formateada corta para el header */
const formattedDate = computed(() => {
  if (!props.routine.created_at) return 'N/A'
  try {
    return format(parseISO(props.routine.created_at), 'd MMM', { locale: es })
  } catch {
    return props.routine.created_at.split('T')[0]
  }
})

/** Fecha completa para tooltip */
const fullFormattedDate = computed(() => {
  if (!props.routine.created_at) return 'Fecha no disponible'
  try {
    return format(parseISO(props.routine.created_at), "d 'de' MMMM 'de' yyyy", { locale: es })
  } catch {
    return props.routine.created_at
  }
})

/** Tiempo relativo (hace X tiempo) */
const timeAgo = computed(() => {
  if (!props.routine.created_at) return 'Nunca'
  try {
    return formatDistanceToNow(parseISO(props.routine.created_at), { 
      addSuffix: true, 
      locale: es 
    })
  } catch {
    return 'Fecha invÃ¡lida'
  }
})

/** Ancho de la barra de progreso */
const completionWidth = computed(() => {
  return `${props.routine.completion_rate_7days ?? 0}%`
})

/** Color del texto del progreso basado en el porcentaje */
const progressColor = computed(() => {
  const rate = props.routine.completion_rate_7days
  if (rate === null || rate === undefined) return 'text-gray-500'
  if (rate >= 80) return 'text-green-600'
  if (rate >= 60) return 'text-primary-600'
  if (rate >= 40) return 'text-yellow-600'
  return 'text-red-600'
})

/** Color de la barra de progreso */
const progressBarColor = computed(() => {
  const rate = props.routine.completion_rate_7days
  if (rate === null || rate === undefined) return 'bg-gray-400'
  if (rate >= 80) return 'bg-green-500'
  if (rate >= 60) return 'bg-primary-500'
  if (rate >= 40) return 'bg-yellow-500'
  return 'bg-red-500'
})

/** Texto del estado de la rutina */
const routineStatusText = computed(() => {
  const status = props.routine.status
  const statusMap: Record<string, string> = {
    'active': 'Activa',
    'paused': 'Pausada', 
    'archived': 'Archivada',
    'draft': 'Borrador'
  }
  return statusMap[status] || props.routine.status_display || status
})

/** Verifica si hay datos de progreso para mostrar */
const hasProgressData = computed(() => {
  return props.routine.completion_rate_7days !== null && 
         props.routine.completion_rate_7days !== undefined
})

// === MÃ‰TODOS ===

function onViewDetail() {
  console.log('ğŸ“‹ Viewing routine detail:', props.routine.id)
  emit('view-detail', props.routine.id)
}

function handleAction(actionName: 'edit' | 'clone' | 'toggle-status' | 'archive') {
  console.log(`ğŸ”„ Routine action: ${actionName}`, props.routine.id)
  emit(actionName, props.routine.id)
}
</script>

<style scoped>
/* Estilos de transiciÃ³n para hover */
.shadow-soft {
  box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
}

.shadow-medium {
  box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
}

/* TransiciÃ³n suave para todos los estados interactivos */
.transition-all {
  transition-property: all;
  transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
  transition-duration: 300ms;
}

/* Mejora la legibilidad del truncado */
.truncate {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\gestion\rutinas\core\RoutineCopyDialog.vue
============================================================
<template>
  <BaseModal 
    :show="isOpen" 
    @update:show="closeDialog" 
    @close="closeDialog"
    title="Clonar Rutina" 
    size="md"
  >
    <p class="text-sm text-gray-500 mb-4">
      Crea una copia de <span class="font-medium text-primary-700">"{{ originalRoutineName }}"</span>.
    </p>

    <FormKit
      type="form"
      id="cloneRoutineForm" {# ID Ãºnico para el formulario #}
      v-model="formData"
      @submit="submitClone"
      :actions="false" {# Los botones estarÃ¡n en el footer del modal #}
      form-class="space-y-4"
    >
      <FormKit
        type="text"
        name="newName"
        label="Nuevo Nombre"
        placeholder="Ej: Rutina Matutina (Fin de semana)"
        validation="required|length:5,100"
        :validation-messages="{
          required: 'El nuevo nombre es obligatorio.',
          length: 'El nombre debe tener entre 5 y 100 caracteres.',
        }"
        help="Ingresa un nombre Ãºnico para la copia."
      />

      <div class="space-y-2 pt-2">
         <FormKit
          type="checkbox"
          name="copySteps"
          label="Copiar todos los pasos"
          help="Incluye los pasos definidos en la rutina original."
        />
         <FormKit
          type="checkbox"
          name="copyStrategies"
          label="Copiar estrategias"
          help="Incluye la configuraciÃ³n de flexibilidad, avisos, etc."
        />
      </div>

      <div v-if="error" class="p-3 bg-error-50 text-error-700 border border-error-200 rounded-lg text-sm">
         {{ error }}
      </div>

    </FormKit> {# Cierre del FormKit #}

    <template #footer>
      <div class="flex justify-end space-x-3">
        <button
          type="button"
          @click="closeDialog"
          class="inline-flex justify-center rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2"
        >
          Cancelar
        </button>
        <button
          type="submit" {# Este botÃ³n activarÃ¡ el @submit del FormKit de arriba #}
          form="cloneRoutineForm" {# Asocia este botÃ³n al formulario por su ID #}
          :disabled="isLoading"
          class="inline-flex items-center justify-center rounded-lg border border-transparent bg-primary-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 disabled:opacity-50"
        >
           <span v-if="!isLoading">Clonar Rutina</span>
           <span v-else class="flex items-center">
             <div class="w-4 h-4 mr-2 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
             Clonando...
           </span>
        </button>
      </div>
    </template>
    
  </BaseModal> 
</template>

<script setup lang="ts">
import { ref, watch, computed } from 'vue'
import type { PropType } from 'vue'
// Importamos el modal base
import BaseModal from '@/components/modal/BaseModal.vue' 
// Icono para el tÃ­tulo (opcional, si quieres aÃ±adirlo junto al texto)
// import { DocumentDuplicateIcon } from '@heroicons/vue/24/outline' 
import { useRoutinesStore } from '@/stores/routinesStore'
import type { DailyRoutineList } from '@/type/rutinas'

// === PROPS === (Sin cambios respecto a la versiÃ³n anterior)
const props = defineProps({
  open: { type: Boolean, default: false },
  routineId: { type: Number, required: true },
  originalRoutineName: { type: String, required: true },
  childId: { type: Number, required: true }
})

// === EMITS === (Sin cambios)
const emit = defineEmits<{
  (e: 'update:open', value: boolean): void
  (e: 'cloned', payload: DailyRoutineList): void
}>()

// === STORE & STATE === (Sin cambios)
const routinesStore = useRoutinesStore()
const isLoading = ref(false)
const error = ref<string | null>(null)
const formData = ref({
  newName: `${props.originalRoutineName} (Copia)`,
  copySteps: true,
  copyStrategies: true
})

// === COMPUTED ===
// Sincroniza v-model:open con BaseModal
const isOpen = computed({
  get: () => props.open,
  set: (value) => emit('update:open', value),
})

// === METHODS ===

/**
 * Cierra el modal a travÃ©s del v-model.
 * BaseModal emitirÃ¡ @close, pero lo manejamos actualizando el v-model.
 */
function closeDialog() {
  isOpen.value = false 
}

/**
 * Maneja la sumisiÃ³n del FormKit. (Sin cambios lÃ³gicos)
 */
async function submitClone() {
  isLoading.value = true
  error.value = null
  try {
    // La lÃ³gica de llamada al store sigue igual
    const clonedRoutine = await routinesStore.cloneRoutine(
      props.childId, 
      props.routineId, 
      formData.value.newName,
      formData.value.copySteps,
      formData.value.copyStrategies
    )
    emit('cloned', clonedRoutine) 
    closeDialog()
  } catch (err: any) {
    console.error("Error cloning routine:", err)
    error.value = err.message || "No se pudo clonar la rutina. IntÃ©ntalo de nuevo."
  } finally {
    isLoading.value = false
  }
}

/**
 * Resetea el formulario cuando se abre el modal. (Sin cambios)
 */
watch(() => props.open, (newVal) => {
  if (newVal) {
    formData.value.newName = `${props.originalRoutineName} (Copia)`
    formData.value.copySteps = true
    formData.value.copyStrategies = true
    error.value = null
  }
})
</script>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\gestion\rutinas\core\RoutineForm.vue
============================================================
<template>
  <FormKit
    type="form"
    v-model="formData"
    :form-class="formClass"
    :actions="false"
    @submit="handleSubmit"
    #default="{ value, state: { valid } }"
  >
    <div class="space-y-6">
      <FormKit
        type="text"
        name="name"
        label="Nombre de la Rutina"
        placeholder="Ej: Rutina de la maÃ±ana (ir al colegio)"
        validation="required|length:5,100"
        :validation-messages="{
          required: 'El nombre es obligatorio.',
          length: 'El nombre debe tener entre 5 y 100 caracteres.',
        }"
      />

      <div class="grid grid-cols-1 md:grid-cols-2 gap-x-4 gap-y-6">
        <FormKit
          type="select"
          name="routine_type"
          label="Tipo de Rutina"
          placeholder="Selecciona un tipo"
          validation="required"
          :options="routineTypeOptions"
          :validation-messages="{
            required: 'Debes seleccionar un tipo de rutina.',
          }"
        />
        
        <FormKit
          type="select"
          name="status"
          label="Estado"
          help="Activa, pausada, o borrador."
          :options="statusOptions"
          validation="required"
        />
      </div>

      <FormKit
        type="textarea"
        name="description"
        label="DescripciÃ³n (Opcional)"
        placeholder="Describe el objetivo principal de esta rutina..."
        :rows="4"
      />

      <div class="grid grid-cols-1 md:grid-cols-2 gap-x-4 gap-y-6">
         <FormKit
           type="date"
           name="date_started"
           label="Fecha de Inicio"
           help="CuÃ¡ndo comenzÃ³ o comenzarÃ¡ esta rutina."
           validation="date_before:2050-01-01" 
           :value="formData.date_started || undefined"
         />
         <FormKit
           type="date"
           name="date_ended"
           label="Fecha de TÃ©rmino (Opcional)"
           help="CuÃ¡ndo finalizÃ³ o finalizarÃ¡. Requerido si archivas."
           :validation="[['optional_date_after', formData.date_started]]" 
           :validation-messages="{
             optional_date_after: 'La fecha de tÃ©rmino no puede ser anterior a la de inicio.'
           }"
           :value="formData.date_ended || undefined" 
         />
      </div>
      
       <FormKit
        type="checkbox"
        name="is_active"
        label="Rutina Activa"
        help="Desmarca para ocultarla temporalmente sin archivarla."
      />

      <div v-if="apiError" class="p-3 bg-error-50 text-error-700 border border-error-200 rounded-lg text-sm">
        {{ apiError }}
      </div>

      <div :class="actionsClass">
        <button
          type="button"
          @click="handleCancel"
          class="inline-flex justify-center rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2"
        >
          {{ cancelText }}
        </button>
        <button
          type="submit"
          :disabled="!valid || isLoading"
          class="inline-flex items-center justify-center rounded-lg border border-transparent bg-primary-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 disabled:opacity-50"
        >
          <span v-if="!isLoading">{{ saveText }}</span>
          <span v-else class="flex items-center">
            <div class="w-4 h-4 mr-2 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
            Guardando...
          </span>
        </button>
      </div>
    </div>
  </FormKit>
</template>

<script setup lang="ts">
import { ref, watch, onMounted } from 'vue'
import type { PropType } from 'vue'
// Importa la interfaz detallada para los datos iniciales y la interfaz de escritura para el payload
import type { DailyRoutineDetail, RoutineWriteData } from '@/type/rutinas/rutinas' 
// Importa tipos de FormKit si necesitas interactuar con nodos

// Importa reglas de validaciÃ³n personalizadas si las tienes
// import '@/utils/validationRules' // Asume que aquÃ­ defines 'optional_date_after'

// === PROPS ===
const props = defineProps({
  /**
   * Datos iniciales para rellenar el formulario (modo ediciÃ³n).
   * Si es null o undefined, el formulario estarÃ¡ vacÃ­o (modo creaciÃ³n).
   */
  initialData: {
    type: Object as PropType<DailyRoutineDetail | null>,
    default: null
  },
  /**
   * Indica si el formulario estÃ¡ en proceso de envÃ­o (ej. esperando respuesta API).
   */
  isLoading: {
    type: Boolean,
    default: false
  },
  /**
   * Mensaje de error recibido de la API tras un intento de guardado.
   */
  apiError: {
    type: String as PropType<string | null>,
    default: null
  },
  /**
   * Clase CSS para el contenedor del formulario.
   */
  formClass: {
    type: String,
    default: ''
  },
  /**
   * Clase CSS para el contenedor de los botones de acciÃ³n.
   */
  actionsClass: {
    type: String,
    default: 'mt-8 flex justify-end space-x-3'
  },
  /**
   * Texto para el botÃ³n de guardar/crear.
   */
  saveText: {
    type: String,
    default: 'Guardar Cambios'
  },
  /**
   * Texto para el botÃ³n de cancelar.
   */
  cancelText: {
    type: String,
    default: 'Cancelar'
  }
})

// === EMITS ===
const emit = defineEmits<{
  /**
   * Se emite cuando el formulario se envÃ­a con Ã©xito y es vÃ¡lido.
   * El payload contiene los datos del formulario limpios, listos para enviar a la API.
   */
  (e: 'save', data: RoutineWriteData): void
  /**
   * Se emite cuando el usuario hace clic en el botÃ³n Cancelar.
   */
  (e: 'cancel'): void
}>()

// === FORM STATE ===
// Ref reactiva que FormKit usarÃ¡ para el v-model del formulario
const formData = ref<RoutineWriteData>({
  name: '',
  routine_type: '',
  description: '',
  status: 'draft', // Valor por defecto
  is_active: true, // Valor por defecto
  date_started: null, // FormKit maneja bien null para fechas
  date_ended: null,
})

// === OPTIONS FOR SELECTS === (DeberÃ­an venir de constantes o API si son dinÃ¡micas)
const routineTypeOptions = ref([
  { value: 'morning', label: 'MaÃ±ana' },
  { value: 'afternoon', label: 'Tarde' },
  { value: 'evening', label: 'Noche' },
  { value: 'hygiene', label: 'Higiene' },
  { value: 'feeding', label: 'AlimentaciÃ³n' },
  { value: 'play', label: 'Juego' },
  { value: 'therapy', label: 'Terapia' },
  { value: 'other', label: 'Otro' },
])

const statusOptions = ref([
  { value: 'draft', label: 'Borrador' },
  { value: 'active', label: 'Activa' },
  { value: 'paused', label: 'Pausada' },
  { value: 'archived', label: 'Archivada' },
])

// === LOGIC ===

/**
 * Rellena el formulario con los datos iniciales cuando estÃ¡ en modo ediciÃ³n.
 */
function populateForm(data: DailyRoutineDetail | null) {
  if (data) {
    formData.value = {
      name: data.name || '',
      routine_type: data.routine_type || '',
      description: data.description || '',
      status: data.status || 'draft',
      is_active: data.is_active !== undefined ? data.is_active : true, // Asegura un booleano
      // FormKit espera YYYY-MM-DD para input date
      date_started: data.date_started || null,
      date_ended: data.date_ended || null,
    }
  } else {
    // Resetea a valores por defecto si no hay datos iniciales (modo creaciÃ³n)
     formData.value = {
      name: '',
      routine_type: '',
      description: '',
      status: 'draft',
      is_active: true,
      date_started: null,
      date_ended: null,
    }
  }
}

/**
 * Se ejecuta cuando el formulario de FormKit es vÃ¡lido y se envÃ­a.
 * Emite el evento 'save' con los datos limpios.
 */
function handleSubmit() {
  // Asegurarse de que las fechas vacÃ­as se envÃ­en como null
  const dataToSend: RoutineWriteData = {
    ...formData.value,
    date_started: formData.value.date_started || null,
    date_ended: formData.value.date_ended || null,
  };
  emit('save', dataToSend)
}

/**
 * Se ejecuta al hacer clic en el botÃ³n Cancelar.
 * Emite el evento 'cancel'.
 */
function handleCancel() {
  emit('cancel')
}

// === LIFECYCLE & WATCHERS ===

// Rellena el formulario cuando el componente se monta (si hay initialData)
onMounted(() => {
  populateForm(props.initialData)
})

// Observa cambios en initialData (si el componente se reutiliza para editar otra rutina)
watch(() => props.initialData, (newData) => {
  populateForm(newData)
  // PodrÃ­as necesitar resetear la validaciÃ³n de FormKit aquÃ­ si cambias los datos programÃ¡ticamente
  // const node = FormKit.get('id-del-formulario') // NecesitarÃ­as asignar un ID al FormKit type="form"
  // node?.reset()
}, { deep: true }) // deep watch por si acaso

// ----- ValidaciÃ³n Personalizada para FormKit -----
// (AsegÃºrate de registrar esta regla globalmente o localmente)
// Esta regla verifica que si date_ended tiene valor, sea >= date_started
// function optional_date_after(node: FormKitNode, comparisonDate: string | null | undefined) {
//   const endDate = node.value as string | null | undefined;
//   if (!endDate || !comparisonDate) {
//     return true; // Es vÃ¡lido si alguna fecha no estÃ¡ definida
//   }
//   return new Date(endDate) >= new Date(comparisonDate);
// }

</script>

<style>
/* Estilos globales de FormKit (si usas @formkit/themes/tailwindcss, 
  la mayorÃ­a del estilo ya estÃ¡ aplicado).
  Puedes aÃ±adir overrides aquÃ­ si es necesario.
*/
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\gestion\rutinas\core\RoutineStatusBadge.vue
============================================================
<template>
  <span 
    :class="badgeClasses"
    class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium capitalize"
  >
    {{ statusText }}
  </span>
</template>

<script setup lang="ts">
import { computed } from 'vue'
import type { PropType } from 'vue'

// Defines the possible status values the badge can receive
type RoutineStatus = 'active' | 'paused' | 'archived' | 'draft' | string;

// === PROPS ===
const props = defineProps({
  /**
   * The status of the routine. Determines the color and text.
   * Expected values: 'active', 'paused', 'archived', 'draft'.
   */
  status: {
    type: String as PropType<RoutineStatus>,
    required: true,
    // Validator to ensure only expected statuses are passed (optional but good practice)
    validator: (value: string) => ['active', 'paused', 'archived', 'draft'].includes(value)
  }
})

// === COMPUTED ===

/**
 * Determines the Tailwind CSS classes for the badge based on the status prop.
 * Uses the color palette defined in your tailwind.config.js.
 */
const badgeClasses = computed(() => {
  switch (props.status) {
    case 'active':
      // Uses 'success' colors for active state
      return 'bg-success-100 text-success-800'; 
    case 'paused':
      // Uses 'warning' colors for paused state
      return 'bg-warning-100 text-warning-800'; 
    case 'archived':
      // Uses 'error' or neutral 'gray' colors for archived state
      return 'bg-gray-100 text-gray-600'; // Example using gray
      // return 'bg-error-100 text-error-800'; // Alternative using error
    case 'draft':
      // Uses neutral 'gray' colors for draft state
      return 'bg-gray-200 text-gray-700'; 
    default:
      // Fallback style for unexpected status values
      return 'bg-gray-100 text-gray-800';
  }
})

/**
 * Determines the display text for the badge based on the status prop.
 */
const statusText = computed(() => {
  // Directly returns the status prop, relying on the 'capitalize' Tailwind class
  // You could also map values here if needed:
  // const map = { active: 'Activa', paused: 'Pausada', ... }
  // return map[props.status] || props.status;
  return props.status;
})

</script>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\gestion\rutinas\core\RoutineTypeSelector.vue
============================================================
<template>
  <FormKit
    type="select"
    :label="label"
    :placeholder="placeholder"
    :value="modelValue"
    @input="emit('update:modelValue', $event)"
    :options="routineTypeOptions"
    :validation="validation"
    :validation-messages="validationMessages"
    :help="help"
    :disabled="disabled"
  />
</template>

<script setup lang="ts">
import { ref } from 'vue'

// === PROPS ===
// Defines the properties the component accepts for customization
const props = withDefaults(defineProps<{
  /**
   * The currently selected value (used with v-model).
   */
  modelValue: string | null
  /**
   * Text label displayed above the selector.
   */
  label?: string
  /**
   * Placeholder text shown when no option is selected.
   */
  placeholder?: string
  /**
   * FormKit validation rules (e.g., 'required').
   */
  validation?: string | Array<string | [string, ...any[]]>
  /**
   * Custom messages for validation errors.
   */
  validationMessages?: Record<string, string>
  /**
   * Helper text displayed below the selector.
   */
  help?: string
  /**
   * Disables the selector if true.
   */
  disabled?: boolean
}>(), {
  // Default values for optional props
  label: 'Tipo de Rutina',
  placeholder: 'Selecciona un tipo',
  validation: '',
  validationMessages: () => ({}), // Needs to be a factory function for objects/arrays
  help: '',
  disabled: false,
})

// === EMITS ===
// Defines the event emitted for v-model compatibility
const emit = defineEmits<{
  (e: 'update:modelValue', value: string | null): void
}>()

// === OPTIONS ===
// Defines the available routine types. 
// These correspond to the keys ('morning', 'evening', etc.) expected by the backend.
// The 'label' is what the user sees.
const routineTypeOptions = ref([
  { value: 'morning', label: 'MaÃ±ana (Ej: Despertar, ir al colegio)' },
  { value: 'afternoon', label: 'Tarde (Ej: DespuÃ©s del colegio, tareas)' },
  { value: 'evening', label: 'Noche (Ej: Cena, ir a dormir)' },
  { value: 'hygiene', label: 'Higiene (Ej: Ducha, lavarse los dientes)' },
  { value: 'feeding', label: 'AlimentaciÃ³n (Ej: Comer en la mesa)' },
  { value: 'play', label: 'Juego (Ej: Tiempo de juego estructurado)' },
  { value: 'therapy', label: 'Terapia (Ej: Ejercicios especÃ­ficos)' },
  { value: 'transition', label: 'TransiciÃ³n (Ej: Cambio entre actividades)' },
  { value: 'other', label: 'Otro' },
])

</script>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\gestion\rutinas\shared\ConfirmDialog.vue
============================================================

============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\gestion\rutinas\shared\DrawerLayout.vue
============================================================

============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\gestion\rutinas\shared\EmptyState.vue
============================================================
<template>
  <div class="text-center p-6">
    <div v-if="iconComponent" class="flex justify-center mb-4">
      <component 
        :is="iconComponent" 
        class="h-12 w-12 text-gray-400" 
        aria-hidden="true" 
      />
    </div>
    
    <h3 class="mt-2 text-lg font-semibold text-gray-800">
      {{ title }}
    </h3>
    
    <p v-if="message" class="mt-1 text-sm text-gray-500">
      {{ message }}
    </p>
    
    <div v-if="$slots.default" class="mt-6">
      <slot></slot>
    </div>
  </div>
</template>

<script setup lang="ts">
import { computed, defineAsyncComponent, type Component } from 'vue'
// Importa todos los iconos 'outline' de Heroicons
import * as HeroIconsOutline from '@heroicons/vue/24/outline' 

// === PROPS ===
const props = defineProps<{
  /**
   * Nombre del icono de Heroicons (outline) a mostrar (ej: 'DocumentMagnifyingGlassIcon').
   * Si se omite, no se muestra icono.
   */
  icon?: keyof typeof HeroIconsOutline 
  /**
   * TÃ­tulo principal del estado vacÃ­o. Es obligatorio.
   */
  title: string
  /**
   * Mensaje descriptivo opcional.
   */
  message?: string
}>()

// === COMPUTED ===

/**
 * Carga dinÃ¡micamente el componente del icono basado en el nombre de la prop.
 */
const iconComponent = computed<Component | null>(() => {
  if (props.icon && HeroIconsOutline[props.icon]) {
    // Carga asÃ­ncrona para no importar todos los iconos innecesariamente
    // aunque en este caso ya estÃ¡n importados arriba, pero es buena prÃ¡ctica
    return defineAsyncComponent(() => 
      Promise.resolve(HeroIconsOutline[props.icon])
    )
  }
  return null // No renderiza icono si no se especifica o no se encuentra
})

</script>

<style scoped>
/* Estilos especÃ­ficos si fueran necesarios, 
   pero Tailwind deberÃ­a ser suficiente. 
*/
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\gestion\rutinas\shared\ErrorState.vue
============================================================

============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\gestion\rutinas\shared\HelpTooltip.vue
============================================================

============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\gestion\rutinas\shared\LoadingState.vue
============================================================
<template>
  <div class="flex flex-col items-center justify-center text-center p-4">
    <svg 
      class="animate-spin h-10 w-10 text-primary-600" 
      xmlns="http://www.w3.org/2000/svg" 
      fill="none" 
      viewBox="0 0 24 24"
    >
      <circle 
        class="opacity-25" 
        cx="12" 
        cy="12" 
        r="10" 
        stroke="currentColor" 
        stroke-width="4"
      ></circle>
      <path 
        class="opacity-75" 
        fill="currentColor" 
        d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
      ></path>
    </svg>

    <p class="mt-3 text-sm font-medium text-gray-600">
      {{ message }}
    </p>
  </div>
</template>

<script setup lang="ts">
// === PROPS ===
// Define la propiedad 'message' que el componente aceptarÃ¡
withDefaults(defineProps<{
  /**
   * El texto que se muestra debajo del spinner.
   */
  message?: string 
}>(), {
  // Valor por defecto si no se proporciona el mensaje
  message: 'Cargando...', 
})
</script>

<style scoped>
/* No se necesitan estilos adicionales si usas Tailwind */
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\gestion\rutinas\shared\ToastNotification.vue
============================================================
<template>
  <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 animate-fade-in">
    <!-- Header Section -->
    <div class="text-center mb-8 space-y-3">
      <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-primary-100 mb-4 animate-bounce-soft">
        <svg class="w-8 h-8 text-primary-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" />
        </svg>
      </div>
      <h3 class="text-2xl sm:text-3xl font-bold text-gray-900 tracking-tight">
        Pasos de la Rutina
      </h3>
      <p class="text-base text-gray-600 max-w-2xl mx-auto">
        Define las acciones individuales. Puedes reordenarlas arrastrÃ¡ndolas.
      </p>
      <div class="flex items-center justify-center gap-2 text-sm text-gray-500">
        <span class="inline-block w-1.5 h-1.5 rounded-full bg-primary-500"></span>
        <span>Paso 3 de 5</span>
      </div>
    </div>

    <div class="space-y-6">
      <!-- ğŸ” DEBUG INFO (Quitar en producciÃ³n) -->
      <div v-if="showDebug" class="bg-yellow-50 border-2 border-yellow-300 rounded-lg p-4 space-y-2 text-xs font-mono">
        <div class="flex items-center justify-between mb-2">
          <h5 class="font-bold text-yellow-900 text-sm">ğŸ” DEBUG MODE</h5>
          <button 
            @click="showDebug = false"
            class="text-yellow-600 hover:text-yellow-800"
          >
            âœ• Cerrar
          </button>
        </div>
        
        <div class="space-y-1">
          <div><strong>Total steps:</strong> {{ steps.length }}</div>
          <div><strong>IDs Ãºnicos:</strong> {{ uniqueIdsCount }}</div>
          <div :class="hasIdConflicts ? 'text-red-600 font-bold' : 'text-green-600'">
            {{ hasIdConflicts ? 'âŒ IDS DUPLICADOS DETECTADOS' : 'âœ… Todos los IDs son Ãºnicos' }}
          </div>
          
          <details class="mt-2">
            <summary class="cursor-pointer text-yellow-800 font-bold">Ver IDs completos</summary>
            <pre class="mt-2 bg-white p-2 rounded overflow-auto max-h-40">{{ stepsDebugInfo }}</pre>
          </details>
        </div>
      </div>

      <!-- Lista de Pasos (Draggable) -->
      <div v-if="steps.length > 0" class="bg-white rounded-2xl shadow-soft border border-gray-100 overflow-hidden">
        <!-- Header de la lista -->
        <div class="px-6 py-4 bg-gradient-to-r from-primary-50 to-primary-100/50 border-b border-primary-200">
          <div class="flex items-center justify-between">
            <h4 class="text-sm font-semibold text-primary-900 flex items-center gap-2">
              <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z" />
                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z" clip-rule="evenodd" />
              </svg>
              Secuencia de Pasos
            </h4>
            <div class="flex items-center gap-2">
              <span class="px-3 py-1 text-xs font-semibold bg-primary-600 text-white rounded-full">
                {{ steps.length }}
              </span>
              <button 
                v-if="!showDebug"
                @click="showDebug = true"
                class="px-2 py-1 text-xs bg-yellow-100 text-yellow-700 rounded hover:bg-yellow-200"
                title="Mostrar debug"
              >
                ğŸ”
              </button>
            </div>
          </div>
          <p class="text-xs text-primary-700 mt-1.5">Arrastra para reordenar</p>
        </div>
        
        <!-- Componente draggable - SINTAXIS SIN SLOT -->
        <draggable
          v-model="steps"
          item-key="id"
          handle=".handle"
          ghost-class="ghost-step"
          drag-class="dragging-step"
          tag="div"
          class="divide-y divide-gray-100"
          @start="onDragStart"
          @end="onDragEnd"
        >
          <div 
            v-for="(step, index) in steps" 
            :key="step.id"
            class="step-item flex items-start p-5 hover:bg-gray-50 transition-all duration-200 group"
          >
            <!-- Handle -->
            <button 
              class="handle cursor-move text-gray-400 hover:text-primary-600 mr-3 flex-shrink-0 mt-1 transition-colors p-1 rounded hover:bg-primary-50" 
              title="Reordenar paso"
              type="button"
            >
              <Bars3Icon class="w-5 h-5" />
            </button>

            <!-- NÃºmero de orden -->
            <div class="mr-4 flex-shrink-0">
              <div class="w-8 h-8 rounded-full bg-primary-100 flex items-center justify-center group-hover:bg-primary-200 transition-colors">
                <span class="text-sm font-bold text-primary-700">{{ index + 1 }}</span>
              </div>
            </div>

            <!-- Contenido del paso -->
            <div class="flex-1 min-w-0 mr-4">
              <h5 class="font-semibold text-gray-900 mb-1 line-clamp-2">{{ step.action }}</h5>
              
              <p v-if="step.description" class="text-sm text-gray-600 mb-2 line-clamp-2">
                {{ step.description }}
              </p>
              
              <div class="flex flex-wrap gap-2 mt-2">
                <!-- DuraciÃ³n -->
                <span v-if="step.estimated_minutes" class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                  <ClockIcon class="w-3 h-3 mr-1" />
                  {{ step.estimated_minutes }} min
                </span>
                
                <!-- SupervisiÃ³n -->
                <span v-if="step.requires_supervision" class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-amber-100 text-amber-800">
                  <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" />
                  </svg>
                  SupervisiÃ³n
                </span>
                
                <!-- Saltable -->
                <span v-if="step.is_skippable" class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                  <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                  </svg>
                  Opcional
                </span>
                
                <!-- Apoyo Visual -->
                <span v-if="step.visual_support" class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800">
                  <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clip-rule="evenodd" />
                  </svg>
                  Visual
                </span>
              </div>
            </div>

            <!-- BotÃ³n eliminar -->
            <button
              @click="removeStep(index)"
              type="button"
              class="flex-shrink-0 p-2 rounded-lg text-gray-400 hover:text-error-600 hover:bg-error-50 transition-all duration-200 group/delete"
              title="Eliminar paso"
            >
              <TrashIcon class="w-5 h-5 group-hover/delete:scale-110 transition-transform" />
            </button>
          </div>
        </draggable>
      </div>

      <!-- Estado VacÃ­o -->
      <div v-else class="text-center py-12 px-6 bg-gradient-to-br from-yellow-50 to-amber-50 border-2 border-dashed border-yellow-300 rounded-2xl animate-pulse-slow">
        <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-yellow-100 mb-4">
          <svg class="w-8 h-8 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
          </svg>
        </div>
        <h5 class="text-base font-semibold text-yellow-900 mb-2">Sin pasos definidos</h5>
        <p class="text-sm text-yellow-700 max-w-md mx-auto">
          Necesitas aÃ±adir al menos un paso para continuar. Define las acciones que componen tu rutina.
        </p>
      </div>

      <!-- Formulario para AÃ±adir Paso -->
      <div class="bg-white rounded-2xl shadow-soft border border-gray-100 overflow-hidden">
        <div class="px-6 py-4 bg-gradient-to-r from-gray-50 to-gray-100/50 border-b border-gray-200">
          <h4 class="text-base font-semibold text-gray-900 flex items-center gap-2">
            <PlusCircleIcon class="w-5 h-5 text-primary-600" />
            AÃ±adir Nuevo Paso
          </h4>
        </div>

        <div class="p-6">
          <FormKit
            type="form"
            #default="{ value, state: { valid } }"
            v-model="newStepData"
            :actions="false"
            form-class="space-y-6"
            @submit="addStep"
            id="add-step-form"
          >
            <!-- AcciÃ³n (campo principal) -->
            <div class="form-group">
              <FormKit
                type="text"
                name="action"
                label="AcciÃ³n"
                placeholder="Ej: Lavarse los dientes"
                validation="required|length:3,500"
                outer-class="form-field-wrapper"
                input-class="form-input-enhanced"
                label-class="form-label-enhanced"
                :validation-messages="{
                  required: 'La acciÃ³n es obligatoria.',
                  length: 'Debe tener entre 3 y 500 caracteres.'
                }"
              >
                <template #prefix>
                  <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                  </svg>
                </template>
              </FormKit>
            </div>

            <!-- DescripciÃ³n y DuraciÃ³n -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
              <div class="form-group">
                <FormKit
                  type="textarea"
                  name="description"
                  label="DescripciÃ³n"
                  placeholder="Detalles adicionales sobre el paso..."
                  :rows="3"
                  validation="length:0,1000"
                  outer-class="form-field-wrapper"
                  input-class="form-textarea-enhanced"
                  label-class="form-label-enhanced"
                  help-class="form-help-text"
                  help="Opcional - MÃ¡ximo 1000 caracteres"
                  :validation-messages="{ length: 'MÃ¡ximo 1000 caracteres.' }"
                />
              </div>

              <div class="space-y-6">
                <div class="form-group">
                  <FormKit
                    type="number"
                    name="estimated_minutes"
                    label="DuraciÃ³n Estimada (minutos)"
                    placeholder="Ej: 5"
                    min="1"
                    step="1"
                    outer-class="form-field-wrapper"
                    input-class="form-input-enhanced"
                    label-class="form-label-enhanced"
                    help-class="form-help-text"
                    help="Opcional"
                    validation="number|min:1"
                    :validation-messages="{
                      number: 'Debe ser un nÃºmero.',
                      min: 'MÃ­nimo 1 minuto.'
                    }"
                  >
                    <template #prefix>
                      <ClockIcon class="w-5 h-5 text-gray-400" />
                    </template>
                  </FormKit>
                </div>

                <div class="form-group">
                  <FormKit
                    type="text"
                    name="visual_support"
                    label="Apoyo Visual"
                    placeholder="Nombre o descripciÃ³n del apoyo"
                    outer-class="form-field-wrapper"
                    input-class="form-input-enhanced"
                    label-class="form-label-enhanced"
                    help-class="form-help-text"
                    help="Opcional - PodrÃ¡s subir imÃ¡genes despuÃ©s"
                  >
                    <template #prefix>
                      <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                      </svg>
                    </template>
                  </FormKit>
                </div>
              </div>
            </div>

            <!-- Checkboxes -->
            <div class="bg-gray-50 rounded-xl p-4 space-y-3">
              <h5 class="text-sm font-semibold text-gray-700 mb-3">Opciones del Paso</h5>
              <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                <FormKit
                  type="checkbox"
                  name="requires_supervision"
                  label="Requiere supervisiÃ³n"
                  outer-class="checkbox-enhanced"
                />
                <FormKit
                  type="checkbox"
                  name="is_skippable"
                  label="Puede saltarse (opcional)"
                  outer-class="checkbox-enhanced"
                />
              </div>
            </div>

            <!-- BotÃ³n AÃ±adir -->
            <div class="flex justify-end pt-4 border-t border-gray-200">
              <button
                type="submit"
                :disabled="!valid"
                class="inline-flex items-center justify-center px-6 py-3 bg-primary-600 text-white font-semibold rounded-xl shadow-sm hover:bg-primary-700 hover:shadow-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 transform hover:scale-105 active:scale-95"
              >
                <PlusCircleIcon class="w-5 h-5 mr-2" />
                AÃ±adir Paso
              </button>
            </div>
          </FormKit>
        </div>
      </div>

      <!-- Info Card -->
      <div class="bg-primary-50 border border-primary-200 rounded-xl p-4 flex gap-3 animate-slide-in">
        <svg class="w-5 h-5 text-primary-600 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
        </svg>
        <div class="flex-1">
          <h4 class="text-sm font-semibold text-primary-900 mb-1">Consejo</h4>
          <p class="text-sm text-primary-800">
            Divide tareas complejas en pasos simples y especÃ­ficos. Esto facilitarÃ¡ el seguimiento y comprensiÃ³n de la rutina.
          </p>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, computed, onMounted, watch, nextTick } from 'vue'
import { VueDraggableNext as draggable } from 'vue-draggable-next'
import { useRoutineWizardStore } from '@/store/rutinas/routineWizardStore'
import { useNotificationStore } from '@/store/notificationStore' // âœ¨ IMPORTAR
import { storeToRefs } from 'pinia'
import type { WizardStep } from '@/store/rutinas/routineWizardStore'
import { Bars3Icon, ClockIcon, TrashIcon, PlusCircleIcon } from '@heroicons/vue/24/outline'

const emit = defineEmits<{
  (e: 'update:validity', isValid: boolean): void
}>()

const wizardStore = useRoutineWizardStore()
const { steps } = storeToRefs(wizardStore)

// âœ¨ OBTENER STORE DE NOTIFICACIONES
const notificationStore = useNotificationStore()

// Estado local
const showDebug = ref(false)
let stepIdCounter = 0 // Contador para IDs Ãºnicos

const newStepData = ref<WizardStep>({
  action: '',
  description: '',
  estimated_minutes: null,
  visual_support: '',
  requires_supervision: false,
  is_skippable: false,
})

// Computed properties para debugging
const uniqueIdsCount = computed(() => {
  const ids = steps.value.map(s => s.id)
  return new Set(ids).size
})

const hasIdConflicts = computed(() => {
  return steps.value.length !== uniqueIdsCount.value
})

const stepsDebugInfo = computed(() => {
  return steps.value.map((s, i) => ({
    index: i,
    id: s.id,
    action: s.action.substring(0, 30) + (s.action.length > 30 ? '...' : '')
  }))
})

// âœ¨ FUNCIÃ“N MEJORADA CON NOTIFICACIÃ“N TOAST
function addStep() {
  // Generar ID Ãºnico y robusto
  const uniqueId = Date.now() + (stepIdCounter++)
  
  // Verificar que no exista (por seguridad extra)
  const idExists = steps.value.some(s => s.id === uniqueId)
  
  if (idExists) {
    console.warn('âš ï¸ ID duplicado detectado, regenerando...')
    stepIdCounter += 100 // Saltar mÃ¡s adelante
    setTimeout(() => addStep(), 10)
    return
  }
  
  const stepToAdd = { 
    ...newStepData.value,
    id: uniqueId
  }
  
  console.log('â• Agregando paso:', { 
    id: uniqueId, 
    action: stepToAdd.action,
    counter: stepIdCounter 
  })
  
  steps.value.push(stepToAdd)
  
  // âœ¨ DISPARAR NOTIFICACIÃ“N DE Ã‰XITO
  notificationStore.success(
    `Paso "${stepToAdd.action}" aÃ±adido correctamente`,
    'âœ… Paso AÃ±adido',
    4000
  )
  
  // VerificaciÃ³n post-adiciÃ³n
  console.log('ğŸ“‹ Total steps:', steps.value.length)
  console.log('ğŸ”‘ IDs:', steps.value.map(s => s.id))
  console.log('âœ… IDs Ãºnicos:', uniqueIdsCount.value)
  
  if (hasIdConflicts.value) {
    console.error('âŒ CONFLICTO DE IDs DETECTADO!')
  }
  
  // Resetear el formulario
  newStepData.value = {
    action: '',
    description: '',
    estimated_minutes: null,
    visual_support: '',
    requires_supervision: false,
    is_skippable: false,
  }
}

// âœ¨ FUNCIÃ“N ELIMINAR CON NOTIFICACIÃ“N
function removeStep(index: number) {
  console.log('ğŸ—‘ï¸ Eliminando paso en Ã­ndice:', index)
  
  if (index >= 0 && index < steps.value.length) {
    const removedStep = steps.value[index]
    console.log('ğŸ—‘ï¸ Paso eliminado:', { id: removedStep.id, action: removedStep.action })
    
    steps.value.splice(index, 1)
    
    // âœ¨ DISPARAR NOTIFICACIÃ“N DE ELIMINACIÃ“N
    notificationStore.info(
      `Paso "${removedStep.action}" eliminado`,
      'ğŸ—‘ï¸ Paso Eliminado',
      3000
    )
  }
}

function onDragStart(event: any) {
  console.log('ğŸ¬ Arrastre iniciado:', event.oldIndex)
}

// âœ¨ FUNCIÃ“N DRAG END CON NOTIFICACIÃ“N
function onDragEnd(event: any) {
  console.log('ğŸ Arrastre finalizado:', { from: event.oldIndex, to: event.newIndex })
  console.log('ğŸ“‹ Nuevo orden:', steps.value.map((s, i) => `${i+1}. ${s.action}`))
  
  // âœ¨ DISPARAR NOTIFICACIÃ“N SI HUBO CAMBIO
  if (event.oldIndex !== event.newIndex) {
    notificationStore.success(
      'El orden de los pasos ha sido actualizado',
      'ğŸ”„ Pasos Reordenados',
      3000
    )
  }
}

function emitValidityStatus() {
  const isValid = steps.value.length > 0
  emit('update:validity', isValid)
  console.log('âœ‰ï¸ Emitiendo validez:', isValid)
}

// Watch para detectar cambios
watch(steps, () => {
  console.log('ğŸ‘ï¸ Steps watch: longitud =', steps.value.length)
  emitValidityStatus()
}, { deep: true })

onMounted(async () => {
  console.log('=== ğŸš€ COMPONENTE MONTADO ===')
  console.log('1ï¸âƒ£ Steps iniciales:', steps.value.length)
  console.log('2ï¸âƒ£ Contenido:', JSON.stringify(steps.value, null, 2))
  
  emitValidityStatus()
  
  await nextTick()
  
  // Verificar DOM
  const stepItems = document.querySelectorAll('.step-item')
  console.log('3ï¸âƒ£ Elementos .step-item en DOM:', stepItems.length)
  
  const draggableContainer = document.querySelector('.divide-y')
  console.log('4ï¸âƒ£ Contenedor draggable:', !!draggableContainer)
  console.log('5ï¸âƒ£ Hijos del contenedor:', draggableContainer?.children.length)
  
  console.log('=== FIN DEBUG INICIAL ===')
})
</script>

<style scoped>
/* Animaciones base */
@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes slideIn {
  from {
    opacity: 0;
    transform: translateX(-20px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

@keyframes bounceSoft {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-8px); }
}

@keyframes pulseSlow {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.8; }
}

.animate-fade-in {
  animation: fadeIn 0.6s ease-out;
}

.animate-slide-in {
  animation: slideIn 0.5s ease-out;
}

.animate-bounce-soft {
  animation: bounceSoft 3s ease-in-out infinite;
}

.animate-pulse-slow {
  animation: pulseSlow 3s ease-in-out infinite;
}

/* Draggable styles */
.ghost-step {
  @apply opacity-50 bg-primary-100 border-2 border-dashed border-primary-400 rounded-lg;
}

.dragging-step {
  @apply bg-white shadow-2xl border-2 border-primary-400 rounded-lg cursor-grabbing transform rotate-2 scale-105;
}

.handle {
  touch-action: none;
}

/* Line clamp utilities */
.line-clamp-2 {
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

/* FormKit styles */
:deep(.form-input-enhanced) {
  @apply w-full px-4 py-3 pl-11 rounded-lg border border-gray-300 
         focus:border-primary-500 focus:ring-2 focus:ring-primary-200 
         transition-all duration-300 text-gray-900 placeholder-gray-400
         hover:border-gray-400;
}

:deep(.form-textarea-enhanced) {
  @apply w-full px-4 py-3 rounded-lg border border-gray-300 
         focus:border-primary-500 focus:ring-2 focus:ring-primary-200 
         transition-all duration-300 text-gray-900 placeholder-gray-400
         hover:border-gray-400 resize-none;
}

:deep(.form-label-enhanced) {
  @apply block text-sm font-semibold text-gray-700 mb-2;
}

:deep(.form-help-text) {
  @apply text-xs text-gray-500 mt-1.5 italic;
}

:deep(.formkit-prefix) {
  @apply absolute left-3 top-[2.6rem] pointer-events-none;
}

/* Checkboxes mejorados */
:deep(.checkbox-enhanced .formkit-wrapper) {
  @apply flex items-center p-3 border-2 border-gray-200 rounded-lg
         hover:border-primary-400 hover:bg-primary-50 transition-all duration-200
         cursor-pointer;
}

:deep(.checkbox-enhanced input[type="checkbox"]) {
  @apply w-5 h-5 rounded border-gray-300 text-primary-600 
         focus:ring-2 focus:ring-primary-500 focus:ring-offset-0
         transition-all duration-200 cursor-pointer;
}

:deep(.checkbox-enhanced .formkit-label) {
  @apply text-sm font-medium text-gray-700 ml-3 cursor-pointer;
}

:deep(.checkbox-enhanced input[type="checkbox"]:checked ~ .formkit-label) {
  @apply text-primary-700 font-semibold;
}

/* AnimaciÃ³n de error */
:deep(.formkit-outer[data-invalid]) .form-input-enhanced,
:deep(.formkit-outer[data-invalid]) .form-textarea-enhanced {
  @apply border-error-400 focus:border-error-500 focus:ring-error-200;
  animation: shake 0.4s ease-in-out;
}

@keyframes shake {
  0%, 100% { transform: translateX(0); }
  25% { transform: translateX(-8px); }
  75% { transform: translateX(8px); }
}

:deep(.formkit-message) {
  @apply text-sm text-error-600 flex items-center gap-1.5 mt-1;
}

/* Responsive */
@media (max-width: 640px) {
  :deep(.form-input-enhanced),
  :deep(.form-textarea-enhanced) {
    @apply py-2.5 text-sm;
  }
}
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\gestion\rutinas\wizard\RoutineCreationWizard.vue
============================================================
<template>
  <Teleport to="body">
    <TransitionRoot appear :show="true" as="template">
      <Dialog as="div" @close="handleClose" class="relative z-50">
        <TransitionChild
          as="template"
          enter="duration-300 ease-out"
          enter-from="opacity-0"
          enter-to="opacity-100"
          leave="duration-200 ease-in"
          leave-from="opacity-100"
          leave-to="opacity-0"
        >
          <div class="fixed inset-0 bg-gray-900 bg-opacity-75" />
        </TransitionChild>

        <div class="fixed inset-0 overflow-y-auto">
          <div class="flex min-h-full items-center justify-center p-4 text-center">
            <TransitionChild
              as="template"
              enter="duration-300 ease-out"
              enter-from="opacity-0 scale-95"
              enter-to="opacity-100 scale-100"
              leave="duration-200 ease-in"
              leave-from="opacity-100 scale-100"
              leave-to="opacity-0 scale-95"
            >
              <DialogPanel
                class="w-full max-w-4xl transform overflow-hidden rounded-2xl bg-white p-6 text-left align-middle shadow-xl transition-all"
              >
                <div class="flex items-center justify-between pb-4 border-b border-gray-200">
                  <div>
                    <DialogTitle as="h3" class="text-2xl font-bold leading-6 text-gray-900">
                      âœ¨ Crear Nueva Rutina
                    </DialogTitle>
                    <p class="mt-1 text-sm text-gray-500">
                      Para: <span class="font-medium text-primary-600">{{ childName }}</span>
                    </p>
                  </div>
                  <button
                    @click="handleClose"
                    class="p-1 rounded-full text-gray-400 hover:text-gray-600 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-primary-500"
                    aria-label="Cerrar asistente"
                  >
                    <XMarkIcon class="h-6 w-6" />
                  </button>
                </div>

                <div class="my-6">
                  <WizardProgressBar
                    :steps="stepLabels"
                    :current-step="currentStep"
                  />
                </div>

                <!-- âŒ ESTE ERROR BANNER YA NO ES NECESARIO CON TOASTS -->
                <!-- Se mantiene solo como fallback para errores crÃ­ticos -->
                <div v-if="submissionError && showErrorBanner" class="p-4 mb-4 bg-error-50 text-error-700 border border-error-200 rounded-lg flex items-start gap-3">
                  <svg class="w-5 h-5 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
                  </svg>
                  <div class="flex-1">
                    <p class="font-medium">Error al crear la rutina</p>
                    <p class="text-sm mt-1">{{ submissionError }}</p>
                  </div>
                  <button @click="showErrorBanner = false" class="text-error-600 hover:text-error-800">
                    <XMarkIcon class="w-5 h-5" />
                  </button>
                </div>

                <div class="min-h-[400px] max-h-[60vh] overflow-y-auto p-1 pr-4 custom-scrollbar">
                  <KeepAlive>
                    <component
                      :is="currentStepComponent"
                      :child-id="props.childId"
                      @update:validity="onStepValidityChange"
                    />
                  </KeepAlive>
                </div>

                <div class="mt-6 pt-4 border-t border-gray-200 flex justify-between items-center">
                  <button
                    type="button"
                    v-if="currentStep > 1"
                    @click="prevStep"
                    class="inline-flex items-center px-4 py-2 bg-white text-sm font-medium text-gray-700 border border-gray-300 rounded-lg shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2"
                  >
                    <ChevronLeftIcon class="w-4 h-4 mr-1" />
                    Anterior
                  </button>

                  <div v-else></div>

                  <div>
                    <button
                      v-if="currentStep < steps.length"
                      type="button"
                      @click="nextStep"
                      :disabled="!isCurrentStepValid"
                      class="inline-flex items-center justify-center px-6 py-2 bg-primary-600 text-white font-semibold rounded-lg shadow-md hover:bg-primary-700 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed"
                    >
                      Siguiente
                      <ChevronRightIcon class="w-4 h-4 ml-1" />
                    </button>

                    <button
                      v-else
                      type="button"
                      @click="submitRoutine"
                      :disabled="!isCurrentStepValid || isLoading"
                      class="inline-flex items-center justify-center px-6 py-2 bg-success-600 text-white font-semibold rounded-lg shadow-md hover:bg-success-700 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-success-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed"
                    >
                      <span v-if="!isLoading" class="flex items-center">
                        <CheckCircleIcon class="w-5 h-5 mr-1" />
                        Finalizar CreaciÃ³n
                      </span>
                      <span v-else class="flex items-center">
                        <div class="w-5 h-5 mr-2 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
                        Guardando...
                      </span>
                    </button>
                  </div>
                </div>
              </DialogPanel>
            </TransitionChild>
          </div>
        </div>
      </Dialog>
    </TransitionRoot>
  </Teleport>
</template>

<script setup lang="ts">
import { ref, computed, defineAsyncComponent, onMounted, onUnmounted } from 'vue'
import {
  Dialog,
  DialogPanel,
  DialogTitle,
  TransitionRoot,
  TransitionChild
} from '@headlessui/vue'
import { XMarkIcon, ChevronLeftIcon, ChevronRightIcon, CheckCircleIcon } from '@heroicons/vue/24/outline'

// âœ¨ IMPORTAR STORE DE NOTIFICACIONES
import { useNotificationStore } from '@/store/notificationStore'

// Importar el store dedicado para el wizard
import { useRoutineWizardStore } from '@/store/rutinas/routineWizardStore'

// --- Importar componentes hijos de forma asÃ­ncrona (Lazy Loading) ---
const WizardProgressBar = defineAsyncComponent(() => import('./WizardProgressBar.vue'))
const WizardStep1Basic = defineAsyncComponent(() => import('./WizardStep1Basic.vue'))
const WizardStep2Schedules = defineAsyncComponent(() => import('./WizardStep2Schedules.vue'))
const WizardStep3Steps = defineAsyncComponent(() => import('./WizardStep3Steps.vue'))
const WizardStep4Strategies = defineAsyncComponent(() => import('./WizardStep4Strategies.vue'))
const WizardStep5Review = defineAsyncComponent(() => import('./WizardStep5Review.vue'))

// === PROPS Y EMITS ===
const props = defineProps<{
  childId: number
  childName: string
}>()

const emit = defineEmits<{
  (e: 'close'): void
  (e: 'created', payload: any): void
}>()

// === STORES ===
const wizardStore = useRoutineWizardStore()
const notificationStore = useNotificationStore() // âœ¨ STORE DE NOTIFICACIONES

// Inicializar el store con el ID del niÃ±o al montar
onMounted(() => {
  wizardStore.initialize(props.childId)
})

// Limpiar el store al cerrar/desmontar
onUnmounted(() => {
  wizardStore.reset()
})

// === ESTADO DEL ASISTENTE ===
const currentStep = ref(1)
const isCurrentStepValid = ref(false)
const isLoading = ref(false)
const submissionError = ref<string | null>(null)
const showErrorBanner = ref(true) // âœ¨ Control para mostrar/ocultar banner de error

// --- DefiniciÃ³n de los pasos del wizard ---
const steps = [
  { label: 'InformaciÃ³n BÃ¡sica', component: WizardStep1Basic, isValidGetter: () => wizardStore.isStep1Valid },
  { label: 'Horarios', component: WizardStep2Schedules, isValidGetter: () => wizardStore.isStep2Valid },
  { label: 'Pasos de la Rutina', component: WizardStep3Steps, isValidGetter: () => wizardStore.isStep3Valid },
  { label: 'Estrategias', component: WizardStep4Strategies, isValidGetter: () => wizardStore.isStep4Valid },
  { label: 'RevisiÃ³n', component: WizardStep5Review, isValidGetter: () => true },
]

// === COMPUTED PROPS ===
const stepLabels = computed(() => steps.map(s => s.label))
const currentStepComponent = computed(() => steps[currentStep.value - 1].component)

// === MÃ‰TODOS DE NAVEGACIÃ“N ===

function onStepValidityChange(isValid: boolean) {
  isCurrentStepValid.value = isValid
}

// âœ¨ FUNCIÃ“N MEJORADA CON TOAST
function nextStep() {
  if (isCurrentStepValid.value && currentStep.value < steps.length) {
    currentStep.value++
    
    isCurrentStepValid.value = steps[currentStep.value - 1].isValidGetter()
  }
}

function prevStep() {
  if (currentStep.value > 1) {
    currentStep.value--
    isCurrentStepValid.value = true
  }
}

function handleClose() {
  // âœ¨ OPCIONAL: Toast al cerrar sin guardar (si hay datos)
  const hasData = wizardStore.basicInfo.name || wizardStore.steps.length > 0
  
  if (hasData) {
    notificationStore.warning(
      'Los cambios no guardados se perderÃ¡n',
      'âš ï¸ Asistente Cerrado',
      3000
    )
  }
  
  emit('close')
}

// === MÃ‰TODO DE ENVÃO FINAL CON TOASTS ===
async function submitRoutine() {
  if (!steps[currentStep.value - 1].isValidGetter() || !isCurrentStepValid.value) return

  isLoading.value = true
  submissionError.value = null
  showErrorBanner.value = true

  try {
    // âœ¨ TOAST: Guardando...
    const savingToastId = notificationStore.info(
      'Guardando la rutina en el servidor...',
      'â³ Guardando',
      0 // DuraciÃ³n 0 = no se cierra automÃ¡ticamente
    )

    // Llama a la acciÃ³n principal del store
    const newRoutine = await wizardStore.submitAllData()

    // âœ¨ CERRAR TOAST DE "GUARDANDO"
    notificationStore.removeNotification(savingToastId)

    // âœ¨ TOAST DE Ã‰XITO
    notificationStore.success(
      `La rutina "${newRoutine.name}" ha sido creada correctamente`,
      'ğŸ‰ Â¡Rutina Creada!',
      5000
    )

    // Ã‰xito: Emitir eventos
    emit('created', newRoutine)
    
    // âœ¨ CERRAR MODAL DESPUÃ‰S DE UN BREVE DELAY (para que se vea el toast)
    setTimeout(() => {
      emit('close')
    }, 500)

  } catch (err: any) {
    console.error("Error al crear la rutina desde el Wizard:", err)
    
    submissionError.value = err.message || 'OcurriÃ³ un error inesperado. Por favor, revisa los datos o intÃ©ntalo mÃ¡s tarde.'
    
    // âœ¨ TOAST DE ERROR (mÃ¡s visible que el banner)
    notificationStore.error(
      err.message || 'Hubo un problema al guardar la rutina. Por favor, intÃ©ntalo nuevamente.',
      'âŒ Error al Crear Rutina',
      8000 // DuraciÃ³n mÃ¡s larga para errores
    )
    
  } finally {
    isLoading.value = false
  }
}

// Revalidar el paso actual al montar
onMounted(() => {
  setTimeout(() => {
    isCurrentStepValid.value = steps[currentStep.value - 1].isValidGetter()
  }, 50)
})

</script>

<style scoped>
/* Estilo para la barra de scroll personalizada */
.custom-scrollbar::-webkit-scrollbar {
  width: 6px;
}
.custom-scrollbar::-webkit-scrollbar-track {
  background: #f1f5f9; /* gray-100 */
  border-radius: 10px;
}
.custom-scrollbar::-webkit-scrollbar-thumb {
  background: #cbd5e1; /* gray-300 */
  border-radius: 10px;
}
.custom-scrollbar::-webkit-scrollbar-thumb:hover {
  background: #94a3b8; /* gray-400 */
}
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\gestion\rutinas\wizard\WizardProgressBar.vue
============================================================
<template>
  <nav aria-label="Progreso del asistente">
    <ol
      role="list"
      class="flex items-center space-x-2 sm:space-x-4"
    >
      <li v-for="(step, stepIdx) in steps" :key="step" class="relative flex-1">
        <!-- Paso Completado -->
        <div v-if="stepIdx < currentStep - 1" class="group flex w-full items-center">
          <span 
            class="flex h-0.5 flex-1 bg-primary-600 transition-all duration-500 ease-out transform origin-left scale-x-100 animate-progress-line" 
            aria-hidden="true"
          ></span>
          <span class="relative ml-2 sm:ml-4 flex h-8 w-8 flex-shrink-0 items-center justify-center rounded-full bg-primary-600 transition-all duration-500 ease-out transform hover:scale-110 hover:shadow-lg animate-check-appear">
            <CheckIcon class="h-5 w-5 text-white animate-check-pop" aria-hidden="true" />
            <span class="sr-only">{{ step }} - Completado</span>
            <!-- Efecto de pulso sutil -->
            <span class="absolute inset-0 rounded-full bg-primary-600 opacity-0 animate-pulse-ring"></span>
          </span>
          <span class="absolute top-full mt-2 hidden text-xs font-medium text-primary-700 sm:block transition-all duration-300 opacity-100">{{ step }}</span>
        </div>

        <!-- Paso Actual -->
        <div v-else-if="stepIdx === currentStep - 1" class="group flex w-full items-center" aria-current="step">
          <span 
            class="flex h-0.5 flex-1 transition-all duration-500 ease-out" 
            :class="stepIdx > 0 ? 'bg-primary-600 scale-x-100' : 'bg-transparent scale-x-0'" 
            aria-hidden="true"
          ></span>
          <span class="relative ml-2 sm:ml-4 flex h-8 w-8 flex-shrink-0 items-center justify-center rounded-full border-2 border-primary-600 bg-white transition-all duration-500 ease-out hover:scale-110 animate-current-pulse">
            <span class="h-2.5 w-2.5 rounded-full bg-primary-600 animate-pulse-dot" aria-hidden="true"></span>
            <span class="sr-only">{{ step }} - Actual</span>
            <!-- Anillo animado alrededor del paso actual -->
            <span class="absolute inset-0 rounded-full border-2 border-primary-400 animate-ping-slow opacity-75"></span>
            <span class="absolute inset-0 rounded-full border-2 border-primary-300 animate-ping-slower opacity-50"></span>
          </span>
          <span class="absolute top-full mt-2 hidden text-xs font-semibold text-primary-600 sm:block transition-all duration-300 animate-fade-in">{{ step }}</span>
        </div>

        <!-- Paso Pendiente -->
        <div v-else class="group flex w-full items-center">
          <span 
            class="flex h-0.5 flex-1 bg-gray-200 transition-all duration-500 ease-out transform scale-x-100" 
            aria-hidden="true"
          ></span>
          <span class="relative ml-2 sm:ml-4 flex h-8 w-8 flex-shrink-0 items-center justify-center rounded-full border-2 border-gray-300 bg-white transition-all duration-300 ease-out group-hover:border-primary-400 group-hover:scale-105 group-hover:shadow-md">
            <span class="text-xs font-medium text-gray-500 transition-colors duration-300 group-hover:text-primary-600">{{ stepIdx + 1 }}</span>
            <span class="sr-only">{{ step }} - PrÃ³ximo</span>
          </span>
          <span class="absolute top-full mt-2 hidden text-xs font-medium text-gray-500 sm:block transition-all duration-300 group-hover:text-gray-700">{{ step }}</span>
        </div>
      </li>
    </ol>
  </nav>
</template>

<script setup lang="ts">
import { CheckIcon } from '@heroicons/vue/24/solid'

defineProps<{
  steps: string[]
  currentStep: number
}>()
</script>

<style scoped>
/* AnimaciÃ³n para la lÃ­nea de progreso */
@keyframes progress-line {
  from {
    transform: scaleX(0);
  }
  to {
    transform: scaleX(1);
  }
}

.animate-progress-line {
  animation: progress-line 0.6s ease-out forwards;
}

/* AnimaciÃ³n para el check */
@keyframes check-appear {
  0% {
    transform: scale(0);
    opacity: 0;
  }
  50% {
    transform: scale(1.2);
  }
  100% {
    transform: scale(1);
    opacity: 1;
  }
}

.animate-check-appear {
  animation: check-appear 0.5s ease-out forwards;
}

@keyframes check-pop {
  0% {
    transform: scale(0) rotate(-45deg);
    opacity: 0;
  }
  50% {
    transform: scale(1.3) rotate(0deg);
  }
  100% {
    transform: scale(1) rotate(0deg);
    opacity: 1;
  }
}

.animate-check-pop {
  animation: check-pop 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards;
}

/* Anillo de pulso para pasos completados */
@keyframes pulse-ring {
  0% {
    transform: scale(1);
    opacity: 0.8;
  }
  100% {
    transform: scale(1.5);
    opacity: 0;
  }
}

.animate-pulse-ring {
  animation: pulse-ring 1.5s ease-out;
}

/* Pulso suave para el punto del paso actual */
@keyframes pulse-dot {
  0%, 100% {
    transform: scale(1);
    opacity: 1;
  }
  50% {
    transform: scale(1.3);
    opacity: 0.8;
  }
}

.animate-pulse-dot {
  animation: pulse-dot 2s ease-in-out infinite;
}

/* Efecto de ping lento para el paso actual */
@keyframes ping-slow {
  0% {
    transform: scale(1);
    opacity: 0.8;
  }
  75%, 100% {
    transform: scale(1.8);
    opacity: 0;
  }
}

.animate-ping-slow {
  animation: ping-slow 2s cubic-bezier(0, 0, 0.2, 1) infinite;
}

@keyframes ping-slower {
  0% {
    transform: scale(1);
    opacity: 0.6;
  }
  75%, 100% {
    transform: scale(2.2);
    opacity: 0;
  }
}

.animate-ping-slower {
  animation: ping-slower 2.5s cubic-bezier(0, 0, 0.2, 1) infinite;
}

/* Pulso para el contenedor del paso actual */
@keyframes current-pulse {
  0%, 100% {
    box-shadow: 0 0 0 0 rgba(var(--primary-rgb, 79, 70, 229), 0.4);
  }
  50% {
    box-shadow: 0 0 0 4px rgba(var(--primary-rgb, 79, 70, 229), 0);
  }
}

.animate-current-pulse {
  animation: current-pulse 2s ease-in-out infinite;
}

/* Fade in para labels */
@keyframes fade-in {
  from {
    opacity: 0;
    transform: translateY(-5px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.animate-fade-in {
  animation: fade-in 0.4s ease-out forwards;
}

/* Transiciones suaves globales */
* {
  transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
}

/* Efecto hover mejorado */
.group:hover span {
  transition: all 0.3s ease-out;
}
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\gestion\rutinas\wizard\WizardStep1Basic.vue
============================================================
<template>
  <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 animate-fade-in">
    <div class="text-center mb-8 space-y-3">
      <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-primary-100 mb-4 animate-bounce-soft">
        <svg class="w-8 h-8 text-primary-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
      </div>
      <h3 class="text-2xl sm:text-3xl font-bold text-gray-900 tracking-tight">
        InformaciÃ³n BÃ¡sica
      </h3>
      <p class="text-base text-gray-600 max-w-2xl mx-auto">
        Comencemos definiendo los detalles principales de tu rutina
      </p>
      <div class="flex items-center justify-center gap-2 text-sm text-gray-500">
        <span class="inline-block w-1.5 h-1.5 rounded-full bg-primary-500"></span>
        <span>Paso 1 de 5</span>
      </div>
    </div>

    <div class="bg-white rounded-2xl shadow-soft border border-gray-100 overflow-hidden">
      <div class="p-6 sm:p-8">
        <FormKit
          type="form"
          v-model="basicInfo"
          id="wizard-step-1-form"
          :actions="false"
          form-class="space-y-8"
          @input="checkValidity" >
          <div class="form-group">
            <FormKit
              type="text"
              name="name"
              label="Nombre de la Rutina"
              placeholder="Ej: Rutina de la maÃ±ana (ir al colegio)"
              validation="required|length:4,100"
              outer-class="form-field-wrapper"
              input-class="form-input-enhanced"
              label-class="form-label-enhanced"
              help-class="form-help-text"
              :validation-messages="{
                required: 'El nombre es obligatorio.',
                length: 'El nombre debe tener entre 4 y 100 caracteres.',
              }"
            >
              <template #prefix>
                <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
              </template>
            </FormKit>
          </div>

          <div class="form-group">
            <FormKit
              type="select"
              name="routine_type"
              label="Tipo de Rutina"
              placeholder="Selecciona un tipo"
              validation="required"
              outer-class="form-field-wrapper"
              input-class="form-select-enhanced"
              label-class="form-label-enhanced"
              :options="routineTypeOptions"
              :validation-messages="{
                required: 'Debes seleccionar un tipo de rutina.',
              }"
            >
              <template #prefix>
                <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01" />
                </svg>
              </template>
            </FormKit>
          </div>

          <div class="form-group">
            <FormKit
              type="textarea"
              name="description"
              label="DescripciÃ³n"
              placeholder="Describe el objetivo principal o los detalles clave de esta rutina..."
              :rows="4"
              validation="length:0,500"
              outer-class="form-field-wrapper"
              input-class="form-textarea-enhanced"
              label-class="form-label-enhanced"
              help-class="form-help-text"
              help="Opcional - MÃ¡ximo 500 caracteres"
              :validation-messages="{
                length: 'La descripciÃ³n no puede exceder los 500 caracteres.',
              }"
            />
            <div class="mt-2 text-right text-xs text-gray-500" v-if="basicInfo.description">
              {{ basicInfo.description?.length || 0 }} / 500 caracteres
            </div>
          </div>

          <div class="form-group">
            <FormKit
              type="select"
              name="status"
              label="Estado Inicial"
              help="Puedes comenzar como borrador y activarla cuando estÃ© lista"
              outer-class="form-field-wrapper"
              input-class="form-select-enhanced"
              label-class="form-label-enhanced"
              help-class="form-help-text"
              :options="statusOptions"
              validation="required"
            >
              <template #prefix>
                <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
              </template>
            </FormKit>
          </div>

          <div class="bg-primary-50 border border-primary-200 rounded-xl p-4 flex gap-3 animate-slide-in">
            <svg class="w-5 h-5 text-primary-600 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
            </svg>
            <div class="flex-1">
              <h4 class="text-sm font-semibold text-primary-900 mb-1">Consejo</h4>
              <p class="text-sm text-primary-800">
                Te recomendamos usar nombres descriptivos y especÃ­ficos para identificar fÃ¡cilmente cada rutina.
              </p>
            </div>
          </div>
        </FormKit>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, onMounted, computed } from 'vue'
import { useRoutineWizardStore } from '@/store/rutinas/routineWizardStore'
import { storeToRefs } from 'pinia'
// No necesitamos FormKitNode aquÃ­
// import type { FormKitNode } from '@formkit/core'

// === EMITS ===
const emit = defineEmits<{
  (e: 'update:validity', isValid: boolean): void
}>()

// === STORE ===
const wizardStore = useRoutineWizardStore()
const { basicInfo } = storeToRefs(wizardStore)

// === DATOS ===
const routineTypeOptions = ref([
  { value: 'morning', label: 'â˜€ï¸ MaÃ±ana', attrs: { 'data-icon': 'â˜€ï¸' } },
  { value: 'breakfast', label: 'ğŸ³ Desayuno' },
  { value: 'school_prep', label: 'ğŸ’ PreparaciÃ³n Escuela' },
  { value: 'after_school', label: 'ğŸ  DespuÃ©s de Escuela' },
  { value: 'homework', label: 'ğŸ“š Tareas' },
  { value: 'dinner', label: 'ğŸ½ï¸ Cena' },
  { value: 'bath', label: 'ğŸ› BaÃ±o' },
  { value: 'bedtime', label: 'ğŸŒ™ Dormir' },
  { value: 'therapy_session', label: 'ğŸ’† Terapia' },
  { value: 'weekend', label: 'ğŸ‰ Fin de Semana' },
  { value: 'transition', label: 'ğŸ”„ TransiciÃ³n' },
  { value: 'other', label: 'ğŸ“‹ Otro' },
])

const statusOptions = ref([
  { value: 'draft', label: 'ğŸ“ Borrador (Draft)', help: 'Guarda tu progreso sin activar' },
  { value: 'active', label: 'âœ… Activa', help: 'La rutina estarÃ¡ disponible inmediatamente' },
])

// === VALIDACIÃ“N (LÃ³gica Corregida) ===

/**
 * FunciÃ³n que se llama cada vez que hay un cambio en el formulario FormKit (@input).
 * Verifica la validez usando el getter del store y emite el resultado.
 */
function checkValidity() {
  const isValid = wizardStore.isStep1Valid // Usa el getter del store
  emit('update:validity', isValid)
}

// Emitir estado inicial al montar
onMounted(() => {
  // Esperar un tick por si acaso FormKit no ha actualizado el v-model inicial
  setTimeout(() => {
    checkValidity()
  }, 0)
})

</script>

<style scoped>
/* Tu CSS personalizado se mantiene igual */
@keyframes fadeIn { /* ... */ }
@keyframes slideIn { /* ... */ }
@keyframes bounceSoft { /* ... */ }
.animate-fade-in { /* ... */ }
.animate-slide-in { /* ... */ }
.animate-bounce-soft { /* ... */ }
.form-group { /* ... */ }
:deep(.form-input-enhanced) { /* ... */ }
:deep(.form-select-enhanced) { /* ... */ }
:deep(.form-textarea-enhanced) { /* ... */ }
:deep(.form-label-enhanced) { /* ... */ }
:deep(.form-help-text) { /* ... */ }
:deep(.form-field-wrapper) { /* ... */ }
:deep(.formkit-prefix) { /* ... */ }
:deep(.formkit-messages) { /* ... */ }
:deep(.formkit-message) { /* ... */ }
:deep(.formkit-message)::before { /* ... */ }
:deep(.formkit-outer[data-invalid]) .form-input-enhanced,
:deep(.formkit-outer[data-invalid]) .form-select-enhanced,
:deep(.formkit-outer[data-invalid]) .form-textarea-enhanced { /* ... */ }
@keyframes shake { /* ... */ }
:deep(.formkit-outer[data-complete]) .form-input-enhanced,
:deep(.formkit-outer[data-complete]) .form-select-enhanced { /* ... */ }
@media (max-width: 640px) { /* ... */ }
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\gestion\rutinas\wizard\WizardStep2Schedules.vue
============================================================
<template>
  <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 animate-fade-in">
    <!-- Header Section -->
    <div class="text-center mb-8 space-y-3">
      <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-primary-100 mb-4 animate-bounce-soft">
        <ClockIcon class="w-8 h-8 text-primary-600" />
      </div>
      <h3 class="text-2xl sm:text-3xl font-bold text-gray-900 tracking-tight">
        Horarios de la Rutina
      </h3>
      <p class="text-base text-gray-600 max-w-2xl mx-auto">
        Define cuÃ¡ndo se realizarÃ¡ esta rutina. Puedes aÃ±adir mÃºltiples horarios.
      </p>
      <div class="flex items-center justify-center gap-2 text-sm text-gray-500">
        <span class="inline-block w-1.5 h-1.5 rounded-full bg-primary-500"></span>
        <span>Paso 2 de 5</span>
      </div>
    </div>

    <div class="space-y-6">
      <!-- Lista de Horarios AÃ±adidos -->
      <div v-if="schedules.length > 0" class="bg-white rounded-2xl shadow-soft border border-gray-100 overflow-hidden">
        <div class="px-6 py-4 bg-gradient-to-r from-primary-50 to-primary-100/50 border-b border-primary-200">
          <div class="flex items-center justify-between">
            <h4 class="text-sm font-semibold text-primary-900 flex items-center gap-2">
              <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd" />
              </svg>
              Horarios Configurados
            </h4>
            <span class="px-3 py-1 text-xs font-semibold bg-primary-600 text-white rounded-full">
              {{ schedules.length }}
            </span>
          </div>
        </div>
        
        <TransitionGroup name="list" tag="ul" class="divide-y divide-gray-100">
          <li
            v-for="(schedule, index) in schedules"
            :key="index"
            class="p-5 hover:bg-gray-50 transition-colors duration-200 group"
          >
            <div class="flex items-start justify-between gap-4">
              <div class="flex-1 min-w-0">
                <div class="flex items-center gap-3 mb-2">
                  <div class="flex-shrink-0 w-12 h-12 rounded-xl bg-primary-100 flex items-center justify-center group-hover:bg-primary-200 transition-colors">
                    <ClockIcon class="w-6 h-6 text-primary-600" />
                  </div>
                  <div class="flex-1">
                    <div class="flex items-baseline gap-2">
                      <span class="text-xl font-bold text-gray-900">{{ formatTime(schedule.start_time) }}</span>
                      <span v-if="schedule.estimated_duration_minutes" class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary-100 text-primary-800">
                        <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                          <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd" />
                        </svg>
                        {{ schedule.estimated_duration_minutes }} min
                      </span>
                    </div>
                    <div class="flex items-center gap-2 mt-1">
                      <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                      </svg>
                      <span class="text-sm text-gray-600">{{ formatDays(schedule.days_of_week) }}</span>
                    </div>
                  </div>
                </div>
              </div>
              
              <button
                @click="removeSchedule(index)"
                type="button"
                class="flex-shrink-0 p-2 rounded-lg text-gray-400 hover:text-error-600 hover:bg-error-50 transition-all duration-200 group/delete"
                title="Eliminar horario"
              >
                <TrashIcon class="w-5 h-5 group-hover/delete:scale-110 transition-transform" />
              </button>
            </div>
          </li>
        </TransitionGroup>
      </div>

      <!-- Estado VacÃ­o -->
      <div v-else class="text-center py-12 px-6 bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-dashed border-blue-300 rounded-2xl animate-pulse-slow">
        <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-blue-100 mb-4">
          <ClockIcon class="w-8 h-8 text-blue-600" />
        </div>
        <h5 class="text-base font-semibold text-blue-900 mb-2">Sin horarios configurados</h5>
        <p class="text-sm text-blue-700 max-w-md mx-auto">
          AÃºn no has aÃ±adido ningÃºn horario. Puedes aÃ±adir uno a continuaciÃ³n o continuar sin horarios especÃ­ficos.
        </p>
      </div>

      <!-- Formulario para AÃ±adir Horario -->
      <div class="bg-white rounded-2xl shadow-soft border border-gray-100 overflow-hidden">
        <div class="px-6 py-4 bg-gradient-to-r from-gray-50 to-gray-100/50 border-b border-gray-200">
          <h4 class="text-base font-semibold text-gray-900 flex items-center gap-2">
            <PlusCircleIcon class="w-5 h-5 text-primary-600" />
            AÃ±adir Nuevo Horario
          </h4>
        </div>

        <div class="p-6">
          <FormKit
            type="form"
            #default="{ state: { valid } }"
            v-model="newScheduleData"
            :actions="false"
            form-class="space-y-6"
            @submit="addSchedule"
            id="add-schedule-form"
          >
            <!-- Hora y DuraciÃ³n -->
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
              <div class="form-group">
                <FormKit
                  type="time"
                  name="start_time"
                  label="Hora de Inicio"
                  validation="required"
                  outer-class="form-field-wrapper"
                  input-class="form-input-time"
                  label-class="form-label-enhanced"
                  :validation-messages="{ required: 'La hora es obligatoria.' }"
                >
                  <template #prefix>
                    <ClockIcon class="w-5 h-5 text-gray-400" />
                  </template>
                </FormKit>
              </div>

              <div class="form-group">
                <FormKit
                  type="number"
                  name="estimated_duration_minutes"
                  label="DuraciÃ³n Estimada (minutos)"
                  placeholder="Ej: 30"
                  min="1"
                  step="1"
                  outer-class="form-field-wrapper"
                  input-class="form-input-enhanced"
                  label-class="form-label-enhanced"
                  help-class="form-help-text"
                  help="Opcional - Tiempo aproximado de la rutina"
                  validation="number|min:1"
                  :validation-messages="{
                    number: 'Debe ser un nÃºmero vÃ¡lido.',
                    min: 'MÃ­nimo 1 minuto.'
                  }"
                >
                  <template #prefix>
                    <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                  </template>
                </FormKit>
              </div>
            </div>

            <!-- DÃ­as de la Semana CON MEJORAS -->
            <div class="form-group">
              <label class="block text-sm font-semibold text-gray-700 mb-3">
                DÃ­as de la Semana
              </label>

              <!-- âœ¨ BOTONES DE SELECCIÃ“N RÃPIDA -->
              <div class="flex flex-wrap gap-2 mb-4 pb-4 border-b border-gray-200">
                <button
                  type="button"
                  @click="selectAllDays"
                  class="px-3 py-1.5 text-xs font-medium rounded-lg border-2 border-gray-300 text-gray-700 hover:border-primary-500 hover:bg-primary-50 hover:text-primary-700 transition-all duration-200"
                >
                  ğŸ“… Todos los dÃ­as
                </button>
                <button
                  type="button"
                  @click="selectWeekdays"
                  class="px-3 py-1.5 text-xs font-medium rounded-lg border-2 border-gray-300 text-gray-700 hover:border-blue-500 hover:bg-blue-50 hover:text-blue-700 transition-all duration-200"
                >
                  ğŸ’¼ DÃ­as Laborables
                </button>
                <button
                  type="button"
                  @click="selectWeekend"
                  class="px-3 py-1.5 text-xs font-medium rounded-lg border-2 border-gray-300 text-gray-700 hover:border-purple-500 hover:bg-purple-50 hover:text-purple-700 transition-all duration-200"
                >
                  ğŸ‰ Fines de Semana
                </button>
                <button
                  type="button"
                  @click="clearDays"
                  class="px-3 py-1.5 text-xs font-medium rounded-lg border-2 border-gray-300 text-gray-700 hover:border-red-500 hover:bg-red-50 hover:text-red-700 transition-all duration-200"
                >
                  ğŸš« Ninguno
                </button>
              </div>

              <!-- âœ¨ LAYOUT HORIZONTAL ESTILO CALENDARIO -->
              <FormKit
                type="checkbox"
                name="days_of_week"
                :options="dayOptions"
                validation="required|min:1"
                :validation-messages="{
                  required: 'Debes seleccionar al menos un dÃ­a.',
                  min: 'Debes seleccionar al menos un dÃ­a.'
                }"
                outer-class="days-checkbox-wrapper"
                fieldset-class="grid grid-cols-7 gap-2"
                options-class="contents"
              />

              <!-- âœ¨ RESUMEN DINÃMICO EN TEXTO -->
              <div v-if="newScheduleData.days_of_week.length > 0" 
                   class="mt-4 p-3 bg-primary-50 border border-primary-200 rounded-lg">
                <div class="flex items-start gap-2">
                  <svg class="w-5 h-5 text-primary-600 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                  </svg>
                  <div class="flex-1">
                    <p class="text-sm font-medium text-primary-900">
                      SelecciÃ³n actual:
                    </p>
                    <p class="text-sm text-primary-700 mt-1">
                      {{ currentSelectionSummary }}
                    </p>
                  </div>
                </div>
              </div>
            </div>

            <!-- BotÃ³n AÃ±adir -->
            <div class="flex justify-end pt-4 border-t border-gray-200">
              <button
                type="submit"
                :disabled="!valid"
                class="inline-flex items-center justify-center px-6 py-3 bg-primary-600 text-white font-semibold rounded-xl shadow-sm hover:bg-primary-700 hover:shadow-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 transform hover:scale-105 active:scale-95"
              >
                <PlusCircleIcon class="w-5 h-5 mr-2" />
                AÃ±adir Horario
              </button>
            </div>
          </FormKit>
        </div>
      </div>

      <!-- InformaciÃ³n Adicional -->
      <div class="bg-primary-50 border border-primary-200 rounded-xl p-4 flex gap-3 animate-slide-in">
        <svg class="w-5 h-5 text-primary-600 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
        </svg>
        <div class="flex-1">
          <h4 class="text-sm font-semibold text-primary-900 mb-1">Consejo</h4>
          <p class="text-sm text-primary-800">
            Usa los botones de selecciÃ³n rÃ¡pida para configurar fÃ¡cilmente patrones comunes. Puedes configurar diferentes horarios para distintos dÃ­as.
          </p>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, computed, onMounted } from 'vue'
import { useRoutineWizardStore } from '@/store/rutinas/routineWizardStore'
import { storeToRefs } from 'pinia'
import type { WizardSchedule } from '@/store/rutinas/routineWizardStore'
import { ClockIcon, TrashIcon, PlusCircleIcon } from '@heroicons/vue/24/outline'

const emit = defineEmits<{
  (e: 'update:validity', isValid: boolean): void
}>()

const wizardStore = useRoutineWizardStore()
const { schedules } = storeToRefs(wizardStore)

const newScheduleData = ref<WizardSchedule>({
  start_time: '',
  estimated_duration_minutes: null,
  days_of_week: []
})

// âœ¨ Opciones mejoradas con emojis diferenciados
const dayOptions = ref([
  { value: 'monday', label: 'Lu' },
  { value: 'tuesday', label: 'Ma' },
  { value: 'wednesday', label: 'Mi' },
  { value: 'thursday', label: 'Ju' },
  { value: 'friday', label: 'Vi' },
  { value: 'saturday', label: 'SÃ¡' },
  { value: 'sunday', label: 'Do' },
])

// âœ¨ COMPUTED: Resumen dinÃ¡mico de la selecciÃ³n
const currentSelectionSummary = computed(() => {
  return formatDays(newScheduleData.value.days_of_week)
})

// âœ¨ FUNCIONES DE SELECCIÃ“N RÃPIDA
function selectAllDays() {
  newScheduleData.value.days_of_week = [
    'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'
  ]
}

function selectWeekdays() {
  newScheduleData.value.days_of_week = [
    'monday', 'tuesday', 'wednesday', 'thursday', 'friday'
  ]
}

function selectWeekend() {
  newScheduleData.value.days_of_week = ['saturday', 'sunday']
}

function clearDays() {
  newScheduleData.value.days_of_week = []
}

function addSchedule() {
  const scheduleToAdd = { ...newScheduleData.value }
  schedules.value.push(scheduleToAdd)
  
  newScheduleData.value = {
    start_time: '',
    estimated_duration_minutes: null,
    days_of_week: []
  }
  
  emitValidityStatus()
}

function removeSchedule(index: number) {
  if (index >= 0 && index < schedules.value.length) {
    schedules.value.splice(index, 1)
    emitValidityStatus()
  }
}

function emitValidityStatus() {
  emit('update:validity', true)
}

function formatTime(timeString: string): string {
  if (!timeString) return 'Hora no definida'
  try {
    const [hours, minutes] = timeString.split(':')
    return `${hours}:${minutes}`
  } catch {
    return timeString
  }
}

function formatDays(days: string[]): string {
  if (!days || days.length === 0) return 'NingÃºn dÃ­a seleccionado'
  
  const dayMap: Record<string, string> = {
    monday: 'Lunes', tuesday: 'Martes', wednesday: 'MiÃ©rcoles', thursday: 'Jueves', 
    friday: 'Viernes', saturday: 'SÃ¡bado', sunday: 'Domingo'
  }
  
  const orderedDays = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday']
  const sortedSelectedDays = orderedDays.filter(d => days.includes(d))

  // Casos especiales
  if (sortedSelectedDays.length === 7) return 'Todos los dÃ­as'
  if (sortedSelectedDays.length === 5 && 
      ['monday', 'tuesday', 'wednesday', 'thursday', 'friday'].every(d => days.includes(d))) {
    return 'Lunes a Viernes (DÃ­as laborables)'
  }
  if (sortedSelectedDays.length === 2 && days.includes('saturday') && days.includes('sunday')) {
    return 'SÃ¡bado y Domingo (Fin de semana)'
  }
  
  // Detectar rangos consecutivos
  if (sortedSelectedDays.length > 2) {
    const indices = sortedSelectedDays.map(d => orderedDays.indexOf(d))
    const isConsecutive = indices.every((val, i, arr) => i === 0 || val === arr[i - 1] + 1)
    
    if (isConsecutive) {
      const first = dayMap[sortedSelectedDays[0]]
      const last = dayMap[sortedSelectedDays[sortedSelectedDays.length - 1]]
      return `${first} a ${last}`
    }
  }
  
  // Lista normal
  return sortedSelectedDays.map(day => dayMap[day] || day).join(', ')
}

onMounted(() => {
  emitValidityStatus()
})
</script>

<style scoped>
/* Animaciones */
@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes slideIn {
  from {
    opacity: 0;
    transform: translateX(-20px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

@keyframes bounceSoft {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-8px); }
}

@keyframes pulseSlow {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.8; }
}

.animate-fade-in {
  animation: fadeIn 0.6s ease-out;
}

.animate-slide-in {
  animation: slideIn 0.5s ease-out;
}

.animate-bounce-soft {
  animation: bounceSoft 3s ease-in-out infinite;
}

.animate-pulse-slow {
  animation: pulseSlow 3s ease-in-out infinite;
}

/* Transiciones de lista */
.list-move,
.list-enter-active,
.list-leave-active {
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.list-enter-from {
  opacity: 0;
  transform: translateX(-30px) scale(0.95);
}

.list-leave-to {
  opacity: 0;
  transform: translateX(30px) scale(0.95);
}

.list-leave-active {
  position: absolute;
  width: 100%;
}

/* Estilos FormKit mejorados */
:deep(.form-input-enhanced),
:deep(.form-input-time) {
  @apply w-full px-4 py-3 pl-11 rounded-lg border border-gray-300 
         focus:border-primary-500 focus:ring-2 focus:ring-primary-200 
         transition-all duration-300 text-gray-900 placeholder-gray-400
         hover:border-gray-400;
}

:deep(.form-label-enhanced) {
  @apply block text-sm font-semibold text-gray-700 mb-2;
}

:deep(.form-help-text) {
  @apply text-xs text-gray-500 mt-1.5 italic;
}

:deep(.formkit-prefix) {
  @apply absolute left-3 top-[2.6rem] pointer-events-none;
}

/* âœ¨ CHECKBOXES ESTILO BOTÃ“N MEJORADOS - Layout horizontal */
:deep(.days-checkbox-wrapper .formkit-option) {
  position: relative;
}

:deep(.days-checkbox-wrapper .formkit-wrapper) {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 0.75rem 0.5rem;
  border: 2px solid #d1d5db; /* gray-300 */
  border-radius: 0.75rem;
  transition: all 0.2s;
  cursor: pointer;
  min-height: 3.5rem;
  background-color: #ffffff;
}

:deep(.days-checkbox-wrapper .formkit-wrapper:hover) {
  border-color: #60a5fa; /* primary-400 */
  background-color: #eff6ff; /* primary-50 */
  transform: translateY(-2px);
  box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
}

:deep(.days-checkbox-wrapper input[type="checkbox"]) {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border-width: 0;
}

/* âœ¨ ESTADO CHECKED MUY EVIDENTE */
:deep(.days-checkbox-wrapper input[type="checkbox"]:checked + .formkit-decorator + .formkit-label) {
  color: #ffffff; /* Texto blanco */
  font-weight: 700;
}

:deep(.days-checkbox-wrapper input[type="checkbox"]:checked ~ .formkit-wrapper),
:deep(.days-checkbox-wrapper .formkit-option[data-checked] .formkit-wrapper) {
  border-color: #2563eb; /* primary-600 */
  background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); /* primary-600 gradient */
  box-shadow: 0 4px 6px -1px rgb(37 99 235 / 0.3);
  transform: translateY(-2px) scale(1.05);
}

:deep(.days-checkbox-wrapper .formkit-decorator) {
  display: none;
}

:deep(.days-checkbox-wrapper .formkit-label) {
  font-size: 0.875rem;
  font-weight: 600;
  color: #374151; /* gray-700 */
  text-align: center;
  width: 100%;
  transition: all 0.2s;
  user-select: none;
}

:deep(.days-checkbox-wrapper input[type="checkbox"]:checked ~ .formkit-wrapper .formkit-label) {
  color: #ffffff !important;
}

/* âœ¨ AGRUPACIÃ“N VISUAL: Separador entre viernes y sÃ¡bado */
:deep(.days-checkbox-wrapper .formkit-fieldset .formkit-option:nth-child(6)) {
  margin-left: 0.5rem;
  position: relative;
}

:deep(.days-checkbox-wrapper .formkit-fieldset .formkit-option:nth-child(6)::before) {
  content: '';
  position: absolute;
  left: -0.375rem;
  top: 10%;
  bottom: 10%;
  width: 2px;
  background: linear-gradient(to bottom, transparent, #d1d5db 20%, #d1d5db 80%, transparent);
}

/* AnimaciÃ³n de error */
:deep(.formkit-outer[data-invalid]) .form-input-enhanced,
:deep(.formkit-outer[data-invalid]) .form-input-time {
  @apply border-error-400 focus:border-error-500 focus:ring-error-200;
  animation: shake 0.4s ease-in-out;
}

@keyframes shake {
  0%, 100% { transform: translateX(0); }
  25% { transform: translateX(-8px); }
  75% { transform: translateX(8px); }
}

:deep(.formkit-message) {
  @apply text-sm text-error-600 flex items-center gap-1.5 mt-1;
}

/* Responsive: Ajustar grid en mÃ³viles */
@media (max-width: 640px) {
  :deep(.form-input-enhanced),
  :deep(.form-input-time) {
    @apply py-2.5 text-sm;
  }
  
  :deep(.days-checkbox-wrapper .formkit-fieldset) {
    grid-template-columns: repeat(4, 1fr) !important;
  }
  
  /* Mover separador en mÃ³vil */
  :deep(.days-checkbox-wrapper .formkit-fieldset .formkit-option:nth-child(6)::before) {
    display: none;
  }
  
  :deep(.days-checkbox-wrapper .formkit-fieldset .formkit-option:nth-child(5)) {
    position: relative;
  }
  
  :deep(.days-checkbox-wrapper .formkit-fieldset .formkit-option:nth-child(5)::after) {
    content: '';
    position: absolute;
    left: 0;
    right: 0;
    bottom: -0.25rem;
    height: 2px;
    background: linear-gradient(to right, transparent, #d1d5db 20%, #d1d5db 80%, transparent);
  }
}
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\gestion\rutinas\wizard\WizardStep3Steps.vue
============================================================
<template>
  <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 animate-fade-in">
    <!-- Header Section -->
    <div class="text-center mb-8 space-y-3">
      <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-primary-100 mb-4 animate-bounce-soft">
        <svg class="w-8 h-8 text-primary-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" />
        </svg>
      </div>
      <h3 class="text-2xl sm:text-3xl font-bold text-gray-900 tracking-tight">
        Pasos de la Rutina
      </h3>
      <p class="text-base text-gray-600 max-w-2xl mx-auto">
        Define las acciones individuales. Puedes reordenarlas arrastrÃ¡ndolas.
      </p>
      <div class="flex items-center justify-center gap-2 text-sm text-gray-500">
        <span class="inline-block w-1.5 h-1.5 rounded-full bg-primary-500"></span>
        <span>Paso 3 de 5</span>
      </div>
    </div>

    <div class="space-y-6">
      <!-- ğŸ” DEBUG INFO (Quitar en producciÃ³n) -->
      <div v-if="showDebug" class="bg-yellow-50 border-2 border-yellow-300 rounded-lg p-4 space-y-2 text-xs font-mono">
        <div class="flex items-center justify-between mb-2">
          <h5 class="font-bold text-yellow-900 text-sm">ğŸ” DEBUG MODE</h5>
          <button 
            @click="showDebug = false"
            class="text-yellow-600 hover:text-yellow-800"
          >
            âœ• Cerrar
          </button>
        </div>
        
        <div class="space-y-1">
          <div><strong>Total steps:</strong> {{ steps.length }}</div>
          <div><strong>IDs Ãºnicos:</strong> {{ uniqueIdsCount }}</div>
          <div :class="hasIdConflicts ? 'text-red-600 font-bold' : 'text-green-600'">
            {{ hasIdConflicts ? 'âŒ IDS DUPLICADOS DETECTADOS' : 'âœ… Todos los IDs son Ãºnicos' }}
          </div>
          
          <details class="mt-2">
            <summary class="cursor-pointer text-yellow-800 font-bold">Ver IDs completos</summary>
            <pre class="mt-2 bg-white p-2 rounded overflow-auto max-h-40">{{ stepsDebugInfo }}</pre>
          </details>
        </div>
      </div>

      <!-- Lista de Pasos (Draggable) -->
      <div v-if="steps.length > 0" class="bg-white rounded-2xl shadow-soft border border-gray-100 overflow-hidden">
        <!-- Header de la lista -->
        <div class="px-6 py-4 bg-gradient-to-r from-primary-50 to-primary-100/50 border-b border-primary-200">
          <div class="flex items-center justify-between">
            <h4 class="text-sm font-semibold text-primary-900 flex items-center gap-2">
              <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z" />
                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z" clip-rule="evenodd" />
              </svg>
              Secuencia de Pasos
            </h4>
            <div class="flex items-center gap-2">
              <span class="px-3 py-1 text-xs font-semibold bg-primary-600 text-white rounded-full">
                {{ steps.length }}
              </span>
              <button 
                v-if="!showDebug"
                @click="showDebug = true"
                class="px-2 py-1 text-xs bg-yellow-100 text-yellow-700 rounded hover:bg-yellow-200"
                title="Mostrar debug"
              >
                ğŸ”
              </button>
            </div>
          </div>
          <p class="text-xs text-primary-700 mt-1.5">Arrastra para reordenar</p>
        </div>
        
        <!-- Componente draggable - SINTAXIS SIN SLOT -->
        <draggable
          v-model="steps"
          item-key="id"
          handle=".handle"
          ghost-class="ghost-step"
          drag-class="dragging-step"
          tag="div"
          class="divide-y divide-gray-100"
          @start="onDragStart"
          @end="onDragEnd"
        >
          <div 
            v-for="(step, index) in steps" 
            :key="step.id"
            class="step-item flex items-start p-5 hover:bg-gray-50 transition-all duration-200 group"
          >
            <!-- Handle -->
            <button 
              class="handle cursor-move text-gray-400 hover:text-primary-600 mr-3 flex-shrink-0 mt-1 transition-colors p-1 rounded hover:bg-primary-50" 
              title="Reordenar paso"
              type="button"
            >
              <Bars3Icon class="w-5 h-5" />
            </button>

            <!-- NÃºmero de orden -->
            <div class="mr-4 flex-shrink-0">
              <div class="w-8 h-8 rounded-full bg-primary-100 flex items-center justify-center group-hover:bg-primary-200 transition-colors">
                <span class="text-sm font-bold text-primary-700">{{ index + 1 }}</span>
              </div>
            </div>

            <!-- Contenido del paso -->
            <div class="flex-1 min-w-0 mr-4">
              <h5 class="font-semibold text-gray-900 mb-1 line-clamp-2">{{ step.action }}</h5>
              
              <p v-if="step.description" class="text-sm text-gray-600 mb-2 line-clamp-2">
                {{ step.description }}
              </p>
              
              <div class="flex flex-wrap gap-2 mt-2">
                <!-- DuraciÃ³n -->
                <span v-if="step.estimated_minutes" class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                  <ClockIcon class="w-3 h-3 mr-1" />
                  {{ step.estimated_minutes }} min
                </span>
                
                <!-- SupervisiÃ³n -->
                <span v-if="step.requires_supervision" class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-amber-100 text-amber-800">
                  <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" />
                  </svg>
                  SupervisiÃ³n
                </span>
                
                <!-- Saltable -->
                <span v-if="step.is_skippable" class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                  <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                  </svg>
                  Opcional
                </span>
                
                <!-- Apoyo Visual -->
                <span v-if="step.visual_support" class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800">
                  <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clip-rule="evenodd" />
                  </svg>
                  Visual
                </span>
              </div>
            </div>

            <!-- BotÃ³n eliminar -->
            <button
              @click="removeStep(index)"
              type="button"
              class="flex-shrink-0 p-2 rounded-lg text-gray-400 hover:text-error-600 hover:bg-error-50 transition-all duration-200 group/delete"
              title="Eliminar paso"
            >
              <TrashIcon class="w-5 h-5 group-hover/delete:scale-110 transition-transform" />
            </button>
          </div>
        </draggable>
      </div>

      <!-- Estado VacÃ­o -->
      <div v-else class="text-center py-12 px-6 bg-gradient-to-br from-yellow-50 to-amber-50 border-2 border-dashed border-yellow-300 rounded-2xl animate-pulse-slow">
        <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-yellow-100 mb-4">
          <svg class="w-8 h-8 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
          </svg>
        </div>
        <h5 class="text-base font-semibold text-yellow-900 mb-2">Sin pasos definidos</h5>
        <p class="text-sm text-yellow-700 max-w-md mx-auto">
          Necesitas aÃ±adir al menos un paso para continuar. Define las acciones que componen tu rutina.
        </p>
      </div>

      <!-- Formulario para AÃ±adir Paso -->
      <div class="bg-white rounded-2xl shadow-soft border border-gray-100 overflow-hidden">
        <div class="px-6 py-4 bg-gradient-to-r from-gray-50 to-gray-100/50 border-b border-gray-200">
          <h4 class="text-base font-semibold text-gray-900 flex items-center gap-2">
            <PlusCircleIcon class="w-5 h-5 text-primary-600" />
            AÃ±adir Nuevo Paso
          </h4>
        </div>

        <div class="p-6">
          <FormKit
            type="form"
            #default="{ value, state: { valid } }"
            v-model="newStepData"
            :actions="false"
            form-class="space-y-6"
            @submit="addStep"
            id="add-step-form"
          >
            <!-- AcciÃ³n (campo principal) -->
            <div class="form-group">
              <FormKit
                type="text"
                name="action"
                label="AcciÃ³n"
                placeholder="Ej: Lavarse los dientes"
                validation="required|length:3,500"
                outer-class="form-field-wrapper"
                input-class="form-input-enhanced"
                label-class="form-label-enhanced"
                :validation-messages="{
                  required: 'La acciÃ³n es obligatoria.',
                  length: 'Debe tener entre 3 y 500 caracteres.'
                }"
              >
                <template #prefix>
                  <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                  </svg>
                </template>
              </FormKit>
            </div>

            <!-- DescripciÃ³n y DuraciÃ³n -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
              <div class="form-group">
                <FormKit
                  type="textarea"
                  name="description"
                  label="DescripciÃ³n"
                  placeholder="Detalles adicionales sobre el paso..."
                  :rows="3"
                  validation="length:0,1000"
                  outer-class="form-field-wrapper"
                  input-class="form-textarea-enhanced"
                  label-class="form-label-enhanced"
                  help-class="form-help-text"
                  help="Opcional - MÃ¡ximo 1000 caracteres"
                  :validation-messages="{ length: 'MÃ¡ximo 1000 caracteres.' }"
                />
              </div>

              <div class="space-y-6">
                <div class="form-group">
                  <FormKit
                    type="number"
                    name="estimated_minutes"
                    label="DuraciÃ³n Estimada (minutos)"
                    placeholder="Ej: 5"
                    min="1"
                    step="1"
                    outer-class="form-field-wrapper"
                    input-class="form-input-enhanced"
                    label-class="form-label-enhanced"
                    help-class="form-help-text"
                    help="Opcional"
                    validation="number|min:1"
                    :validation-messages="{
                      number: 'Debe ser un nÃºmero.',
                      min: 'MÃ­nimo 1 minuto.'
                    }"
                  >
                    <template #prefix>
                      <ClockIcon class="w-5 h-5 text-gray-400" />
                    </template>
                  </FormKit>
                </div>

                <div class="form-group">
                  <FormKit
                    type="text"
                    name="visual_support"
                    label="Apoyo Visual"
                    placeholder="Nombre o descripciÃ³n del apoyo"
                    outer-class="form-field-wrapper"
                    input-class="form-input-enhanced"
                    label-class="form-label-enhanced"
                    help-class="form-help-text"
                    help="Opcional - PodrÃ¡s subir imÃ¡genes despuÃ©s"
                  >
                    <template #prefix>
                      <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                      </svg>
                    </template>
                  </FormKit>
                </div>
              </div>
            </div>

            <!-- Checkboxes -->
            <div class="bg-gray-50 rounded-xl p-4 space-y-3">
              <h5 class="text-sm font-semibold text-gray-700 mb-3">Opciones del Paso</h5>
              <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                <FormKit
                  type="checkbox"
                  name="requires_supervision"
                  label="Requiere supervisiÃ³n"
                  outer-class="checkbox-enhanced"
                />
                <FormKit
                  type="checkbox"
                  name="is_skippable"
                  label="Puede saltarse (opcional)"
                  outer-class="checkbox-enhanced"
                />
              </div>
            </div>

            <!-- BotÃ³n AÃ±adir -->
            <div class="flex justify-end pt-4 border-t border-gray-200">
              <button
                type="submit"
                :disabled="!valid"
                class="inline-flex items-center justify-center px-6 py-3 bg-primary-600 text-white font-semibold rounded-xl shadow-sm hover:bg-primary-700 hover:shadow-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 transform hover:scale-105 active:scale-95"
              >
                <PlusCircleIcon class="w-5 h-5 mr-2" />
                AÃ±adir Paso
              </button>
            </div>
          </FormKit>
        </div>
      </div>

      <!-- Info Card -->
      <div class="bg-primary-50 border border-primary-200 rounded-xl p-4 flex gap-3 animate-slide-in">
        <svg class="w-5 h-5 text-primary-600 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
        </svg>
        <div class="flex-1">
          <h4 class="text-sm font-semibold text-primary-900 mb-1">Consejo</h4>
          <p class="text-sm text-primary-800">
            Divide tareas complejas en pasos simples y especÃ­ficos. Esto facilitarÃ¡ el seguimiento y comprensiÃ³n de la rutina.
          </p>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, computed, onMounted, watch, nextTick } from 'vue'
import { VueDraggableNext as draggable } from 'vue-draggable-next'
import { useRoutineWizardStore } from '@/store/rutinas/routineWizardStore'
import { storeToRefs } from 'pinia'
import type { WizardStep } from '@/store/rutinas/routineWizardStore'
import { Bars3Icon, ClockIcon, TrashIcon, PlusCircleIcon } from '@heroicons/vue/24/outline'

const emit = defineEmits<{
  (e: 'update:validity', isValid: boolean): void
}>()

const wizardStore = useRoutineWizardStore()
const { steps } = storeToRefs(wizardStore)

// Estado local
const showDebug = ref(false)
let stepIdCounter = 0 // Contador para IDs Ãºnicos

const newStepData = ref<WizardStep>({
  action: '',
  description: '',
  estimated_minutes: null,
  visual_support: '',
  requires_supervision: false,
  is_skippable: false,
})

// Computed properties para debugging
const uniqueIdsCount = computed(() => {
  const ids = steps.value.map(s => s.id)
  return new Set(ids).size
})

const hasIdConflicts = computed(() => {
  return steps.value.length !== uniqueIdsCount.value
})

const stepsDebugInfo = computed(() => {
  return steps.value.map((s, i) => ({
    index: i,
    id: s.id,
    action: s.action.substring(0, 30) + (s.action.length > 30 ? '...' : '')
  }))
})

// FunciÃ³n mejorada para agregar paso con ID Ãºnico garantizado
function addStep() {
  // Generar ID Ãºnico y robusto
  const uniqueId = Date.now() + (stepIdCounter++)
  
  // Verificar que no exista (por seguridad extra)
  const idExists = steps.value.some(s => s.id === uniqueId)
  
  if (idExists) {
    console.warn('âš ï¸ ID duplicado detectado, regenerando...')
    stepIdCounter += 100 // Saltar mÃ¡s adelante
    setTimeout(() => addStep(), 10)
    return
  }
  
  const stepToAdd = { 
    ...newStepData.value,
    id: uniqueId
  }
  
  console.log('â• Agregando paso:', { 
    id: uniqueId, 
    action: stepToAdd.action,
    counter: stepIdCounter 
  })
  
  steps.value.push(stepToAdd)
  
  // VerificaciÃ³n post-adiciÃ³n
  console.log('ğŸ“‹ Total steps:', steps.value.length)
  console.log('ğŸ”‘ IDs:', steps.value.map(s => s.id))
  console.log('âœ… IDs Ãºnicos:', uniqueIdsCount.value)
  
  if (hasIdConflicts.value) {
    console.error('âŒ CONFLICTO DE IDs DETECTADO!')
  }
  
  // Resetear el formulario
  newStepData.value = {
    action: '',
    description: '',
    estimated_minutes: null,
    visual_support: '',
    requires_supervision: false,
    is_skippable: false,
  }
}

function removeStep(index: number) {
  console.log('ğŸ—‘ï¸ Eliminando paso en Ã­ndice:', index)
  if (index >= 0 && index < steps.value.length) {
    const removedStep = steps.value[index]
    console.log('ğŸ—‘ï¸ Paso eliminado:', { id: removedStep.id, action: removedStep.action })
    steps.value.splice(index, 1)
  }
}

function onDragStart(event: any) {
  console.log('ğŸ¬ Arrastre iniciado:', event.oldIndex)
}

function onDragEnd(event: any) {
  console.log('ğŸ Arrastre finalizado:', { from: event.oldIndex, to: event.newIndex })
  console.log('ğŸ“‹ Nuevo orden:', steps.value.map((s, i) => `${i+1}. ${s.action}`))
}

function emitValidityStatus() {
  const isValid = steps.value.length > 0
  emit('update:validity', isValid)
  console.log('âœ‰ï¸ Emitiendo validez:', isValid)
}

// Watch para detectar cambios
watch(steps, () => {
  console.log('ğŸ‘ï¸ Steps watch: longitud =', steps.value.length)
  emitValidityStatus()
}, { deep: true })

onMounted(async () => {
  console.log('=== ğŸš€ COMPONENTE MONTADO ===')
  console.log('1ï¸âƒ£ Steps iniciales:', steps.value.length)
  console.log('2ï¸âƒ£ Contenido:', JSON.stringify(steps.value, null, 2))
  
  emitValidityStatus()
  
  await nextTick()
  
  // Verificar DOM
  const stepItems = document.querySelectorAll('.step-item')
  console.log('3ï¸âƒ£ Elementos .step-item en DOM:', stepItems.length)
  
  const draggableContainer = document.querySelector('.divide-y')
  console.log('4ï¸âƒ£ Contenedor draggable:', !!draggableContainer)
  console.log('5ï¸âƒ£ Hijos del contenedor:', draggableContainer?.children.length)
  
  console.log('=== FIN DEBUG INICIAL ===')
})
</script>

<style scoped>
/* Animaciones base */
@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes slideIn {
  from {
    opacity: 0;
    transform: translateX(-20px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

@keyframes bounceSoft {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-8px); }
}

@keyframes pulseSlow {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.8; }
}

.animate-fade-in {
  animation: fadeIn 0.6s ease-out;
}

.animate-slide-in {
  animation: slideIn 0.5s ease-out;
}

.animate-bounce-soft {
  animation: bounceSoft 3s ease-in-out infinite;
}

.animate-pulse-slow {
  animation: pulseSlow 3s ease-in-out infinite;
}

/* Draggable styles */
.ghost-step {
  @apply opacity-50 bg-primary-100 border-2 border-dashed border-primary-400 rounded-lg;
}

.dragging-step {
  @apply bg-white shadow-2xl border-2 border-primary-400 rounded-lg cursor-grabbing transform rotate-2 scale-105;
}

.handle {
  touch-action: none;
}

/* Line clamp utilities */
.line-clamp-2 {
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

/* FormKit styles */
:deep(.form-input-enhanced) {
  @apply w-full px-4 py-3 pl-11 rounded-lg border border-gray-300 
         focus:border-primary-500 focus:ring-2 focus:ring-primary-200 
         transition-all duration-300 text-gray-900 placeholder-gray-400
         hover:border-gray-400;
}

:deep(.form-textarea-enhanced) {
  @apply w-full px-4 py-3 rounded-lg border border-gray-300 
         focus:border-primary-500 focus:ring-2 focus:ring-primary-200 
         transition-all duration-300 text-gray-900 placeholder-gray-400
         hover:border-gray-400 resize-none;
}

:deep(.form-label-enhanced) {
  @apply block text-sm font-semibold text-gray-700 mb-2;
}

:deep(.form-help-text) {
  @apply text-xs text-gray-500 mt-1.5 italic;
}

:deep(.formkit-prefix) {
  @apply absolute left-3 top-[2.6rem] pointer-events-none;
}

/* Checkboxes mejorados */
:deep(.checkbox-enhanced .formkit-wrapper) {
  @apply flex items-center p-3 border-2 border-gray-200 rounded-lg
         hover:border-primary-400 hover:bg-primary-50 transition-all duration-200
         cursor-pointer;
}

:deep(.checkbox-enhanced input[type="checkbox"]) {
  @apply w-5 h-5 rounded border-gray-300 text-primary-600 
         focus:ring-2 focus:ring-primary-500 focus:ring-offset-0
         transition-all duration-200 cursor-pointer;
}

:deep(.checkbox-enhanced .formkit-label) {
  @apply text-sm font-medium text-gray-700 ml-3 cursor-pointer;
}

:deep(.checkbox-enhanced input[type="checkbox"]:checked ~ .formkit-label) {
  @apply text-primary-700 font-semibold;
}

/* AnimaciÃ³n de error */
:deep(.formkit-outer[data-invalid]) .form-input-enhanced,
:deep(.formkit-outer[data-invalid]) .form-textarea-enhanced {
  @apply border-error-400 focus:border-error-500 focus:ring-error-200;
  animation: shake 0.4s ease-in-out;
}

@keyframes shake {
  0%, 100% { transform: translateX(0); }
  25% { transform: translateX(-8px); }
  75% { transform: translateX(8px); }
}

:deep(.formkit-message) {
  @apply text-sm text-error-600 flex items-center gap-1.5 mt-1;
}

/* Responsive */
@media (max-width: 640px) {
  :deep(.form-input-enhanced),
  :deep(.form-textarea-enhanced) {
    @apply py-2.5 text-sm;
  }
}
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\gestion\rutinas\wizard\WizardStep4Strategies.vue
============================================================
<template>
  <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 animate-fade-in">
    <!-- Header Section -->
    <div class="text-center mb-8 space-y-3">
      <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-primary-100 mb-4 animate-bounce-soft">
        <svg class="w-8 h-8 text-primary-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
        </svg>
      </div>
      <h3 class="text-2xl sm:text-3xl font-bold text-gray-900 tracking-tight">
        Estrategias de Apoyo
      </h3>
      <p class="text-base text-gray-600 max-w-2xl mx-auto">
        Define estrategias especÃ­ficas para facilitar el cumplimiento de la rutina
      </p>
      <div class="flex items-center justify-center gap-2 text-sm text-gray-500">
        <span class="inline-block w-1.5 h-1.5 rounded-full bg-primary-500"></span>
        <span>Paso 4 de 5</span>
      </div>
    </div>

    <div class="space-y-6">
      <!-- ğŸ” DEBUG INFO -->
      <div v-if="showDebug" class="bg-yellow-50 border-2 border-yellow-300 rounded-lg p-4 space-y-2 text-xs font-mono">
        <div class="flex items-center justify-between mb-2">
          <h5 class="font-bold text-yellow-900 text-sm">ğŸ” DEBUG MODE - ESTRATEGIAS</h5>
          <button 
            @click="showDebug = false"
            class="text-yellow-600 hover:text-yellow-800"
          >
            âœ• Cerrar
          </button>
        </div>
        
        <div class="space-y-1">
          <div><strong>Total estrategias:</strong> {{ strategies.length }}</div>
          <div><strong>Total pasos disponibles:</strong> {{ availableSteps.length }}</div>
          <div><strong>IDs Ãºnicos:</strong> {{ uniqueIdsCount }}</div>
          <div :class="hasIdConflicts ? 'text-red-600 font-bold' : 'text-green-600'">
            {{ hasIdConflicts ? 'âŒ IDS DUPLICADOS DETECTADOS' : 'âœ… Todos los IDs son Ãºnicos' }}
          </div>
          
          <details class="mt-2">
            <summary class="cursor-pointer text-yellow-800 font-bold">Ver estrategias completas</summary>
            <pre class="mt-2 bg-white p-2 rounded overflow-auto max-h-40">{{ strategiesDebugInfo }}</pre>
          </details>
        </div>
      </div>

      <!-- Lista de Estrategias CON DRAGGABLE -->
      <div v-if="strategies.length > 0" class="bg-white rounded-2xl shadow-soft border border-gray-100 overflow-hidden">
        <div class="px-6 py-4 bg-gradient-to-r from-primary-50 to-primary-100/50 border-b border-primary-200">
          <div class="flex items-center justify-between">
            <h4 class="text-sm font-semibold text-primary-900 flex items-center gap-2">
              <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                <path d="M11 3a1 1 0 10-2 0v1a1 1 0 102 0V3zM15.657 5.757a1 1 0 00-1.414-1.414l-.707.707a1 1 0 001.414 1.414l.707-.707zM18 10a1 1 0 01-1 1h-1a1 1 0 110-2h1a1 1 0 011 1zM5.05 6.464A1 1 0 106.464 5.05l-.707-.707a1 1 0 00-1.414 1.414l.707.707zM5 10a1 1 0 01-1 1H3a1 1 0 110-2h1a1 1 0 011 1zM8 16v-1h4v1a2 2 0 11-4 0zM12 14c.015-.34.208-.646.477-.859a4 4 0 10-4.954 0c.27.213.462.519.476.859h4.002z" />
              </svg>
              Estrategias Configuradas
            </h4>
            <div class="flex items-center gap-2">
              <span class="px-3 py-1 text-xs font-semibold bg-primary-600 text-white rounded-full">
                {{ strategies.length }}
              </span>
              <button 
                v-if="!showDebug"
                @click="showDebug = true"
                class="px-2 py-1 text-xs bg-yellow-100 text-yellow-700 rounded hover:bg-yellow-200"
                title="Mostrar debug"
              >
                ğŸ”
              </button>
            </div>
          </div>
          <p class="text-xs text-primary-700 mt-1.5">Arrastra para reordenar â¬†ï¸â¬‡ï¸</p>
        </div>
        
        <!-- DRAGGABLE en lugar de TransitionGroup -->
        <draggable
          v-model="strategies"
          :item-key="getStrategyKey"
          handle=".drag-handle"
          ghost-class="ghost-strategy"
          drag-class="dragging-strategy"
          tag="ul"
          class="divide-y divide-gray-100"
          @start="onDragStart"
          @end="onDragEnd"
        >
          <div
            v-for="(strategy, index) in strategies"
            :key="strategy.id || index"
            class="p-5 hover:bg-gray-50 transition-colors duration-200 group flex items-start gap-3"
          >
            <!-- HANDLE DE ARRASTRE -->
            <button 
              class="drag-handle cursor-move text-gray-400 hover:text-purple-600 flex-shrink-0 mt-1 transition-colors p-1 rounded hover:bg-purple-50" 
              title="Reordenar estrategia"
              type="button"
            >
              <Bars3Icon class="w-5 h-5" />
            </button>

            <div class="flex-1 min-w-0 flex items-start justify-between gap-4">
              <div class="flex-1 min-w-0">
                <div class="flex items-start gap-3 mb-2">
                  <div class="flex-shrink-0 w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center group-hover:bg-purple-200 transition-colors">
                    <component :is="getStrategyIcon(strategy.strategy_type)" class="w-5 h-5 text-purple-600" />
                  </div>
                  <div class="flex-1">
                    <div class="flex items-start justify-between gap-2">
                      <h5 class="font-semibold text-gray-900">{{ getStrategyTypeLabel(strategy.strategy_type) }}</h5>
                      <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800">
                        {{ strategy.strategy_type }}
                      </span>
                    </div>
                    <p v-if="strategy.description" class="text-sm text-gray-600 mt-1 line-clamp-2">
                      {{ strategy.description }}
                    </p>
                    <div v-if="strategy.related_step_order !== null" class="flex items-center gap-2 mt-2">
                      <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" />
                      </svg>
                      <span class="text-xs text-gray-500">Vinculada al paso {{ strategy.related_step_order }}</span>
                    </div>
                  </div>
                </div>
              </div>
              
              <button
                @click="removeStrategy(index)"
                type="button"
                class="flex-shrink-0 p-2 rounded-lg text-gray-400 hover:text-error-600 hover:bg-error-50 transition-all duration-200 group/delete"
                title="Eliminar estrategia"
              >
                <TrashIcon class="w-5 h-5 group-hover/delete:scale-110 transition-transform" />
              </button>
            </div>
          </div>
        </draggable>
      </div>

      <!-- Estado VacÃ­o -->
      <div v-else class="text-center py-12 px-6 bg-gradient-to-br from-purple-50 to-indigo-50 border-2 border-dashed border-purple-300 rounded-2xl animate-pulse-slow">
        <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-purple-100 mb-4">
          <svg class="w-8 h-8 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
          </svg>
        </div>
        <h5 class="text-base font-semibold text-purple-900 mb-2">Sin estrategias configuradas</h5>
        <p class="text-sm text-purple-700 max-w-md mx-auto">
          Las estrategias son opcionales, pero pueden ayudar a mejorar el cumplimiento de la rutina.
        </p>
      </div>

      <!-- Formulario para AÃ±adir Estrategia -->
      <div class="bg-white rounded-2xl shadow-soft border border-gray-100 overflow-hidden">
        <div class="px-6 py-4 bg-gradient-to-r from-gray-50 to-gray-100/50 border-b border-gray-200">
          <h4 class="text-base font-semibold text-gray-900 flex items-center gap-2">
            <PlusCircleIcon class="w-5 h-5 text-primary-600" />
            AÃ±adir Nueva Estrategia
          </h4>
        </div>

        <div class="p-6">
          <FormKit
            type="form"
            #default="{ value, state: { valid } }"
            v-model="newStrategyData"
            :actions="false"
            form-class="space-y-6"
            @submit="addStrategy"
            id="add-strategy-form"
          >
            <!-- Tipo de Estrategia -->
            <div class="form-group">
              <FormKit
                type="select"
                name="strategy_type"
                label="Tipo de Estrategia"
                placeholder="Selecciona un tipo"
                validation="required"
                outer-class="form-field-wrapper"
                input-class="form-select-enhanced"
                label-class="form-label-enhanced"
                :options="strategyTypeOptions"
                :validation-messages="{
                  required: 'Debes seleccionar un tipo de estrategia.',
                }"
              >
                <template #prefix>
                  <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01" />
                  </svg>
                </template>
              </FormKit>
            </div>

            <!-- DescripciÃ³n -->
            <div class="form-group">
              <FormKit
                type="textarea"
                name="description"
                label="DescripciÃ³n"
                placeholder="Describe cÃ³mo aplicar esta estrategia..."
                :rows="4"
                validation="length:0,1000"
                outer-class="form-field-wrapper"
                input-class="form-textarea-enhanced"
                label-class="form-label-enhanced"
                help-class="form-help-text"
                help="Opcional - MÃ¡ximo 1000 caracteres"
                :validation-messages="{
                  length: 'La descripciÃ³n no puede exceder los 1000 caracteres.',
                }"
              />
              <div class="mt-2 text-right text-xs text-gray-500" v-if="newStrategyData.description">
                {{ newStrategyData.description?.length || 0 }} / 1000 caracteres
              </div>
            </div>

            <!-- Paso Relacionado -->
            <div class="form-group" v-if="availableSteps.length > 0">
              <FormKit
                type="select"
                name="related_step_order"
                label="Vincular a un Paso EspecÃ­fico"
                placeholder="Ninguno (aplica a toda la rutina)"
                outer-class="form-field-wrapper"
                input-class="form-select-enhanced"
                label-class="form-label-enhanced"
                help-class="form-help-text"
                help="Opcional - Asocia esta estrategia con un paso en particular"
                :options="stepOptions"
              >
                <template #prefix>
                  <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" />
                  </svg>
                </template>
              </FormKit>
            </div>

            <!-- Alerta si no hay pasos -->
            <div v-else class="bg-amber-50 border border-amber-200 rounded-xl p-4 flex gap-3">
              <svg class="w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
              </svg>
              <div class="flex-1">
                <h5 class="text-sm font-semibold text-amber-900 mb-1">No hay pasos definidos</h5>
                <p class="text-sm text-amber-800">
                  Define algunos pasos en el Step 3 para poder vincular estrategias especÃ­ficas.
                </p>
              </div>
            </div>

            <!-- BotÃ³n AÃ±adir -->
            <div class="flex justify-end pt-4 border-t border-gray-200">
              <button
                type="submit"
                :disabled="!valid"
                class="inline-flex items-center justify-center px-6 py-3 bg-primary-600 text-white font-semibold rounded-xl shadow-sm hover:bg-primary-700 hover:shadow-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 transform hover:scale-105 active:scale-95"
              >
                <PlusCircleIcon class="w-5 h-5 mr-2" />
                AÃ±adir Estrategia
              </button>
            </div>
          </FormKit>
        </div>
      </div>

      <!-- Info Card -->
      <div class="bg-primary-50 border border-primary-200 rounded-xl p-4 flex gap-3 animate-slide-in">
        <svg class="w-5 h-5 text-primary-600 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
        </svg>
        <div class="flex-1">
          <h4 class="text-sm font-semibold text-primary-900 mb-1">Consejo</h4>
          <p class="text-sm text-primary-800">
            Puedes reordenar las estrategias arrastrÃ¡ndolas. El orden puede ayudar a priorizar su aplicaciÃ³n.
          </p>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, computed, onMounted } from 'vue'
import { VueDraggableNext as draggable } from 'vue-draggable-next'
import { useRoutineWizardStore } from '@/store/rutinas/routineWizardStore'
import { storeToRefs } from 'pinia'
import type { WizardStrategy } from '@/store/rutinas/routineWizardStore'
import { 
  TrashIcon, 
  PlusCircleIcon,
  SparklesIcon,
  PhotoIcon,
  BellAlertIcon,
  SpeakerWaveIcon,
  HandRaisedIcon,
  ClockIcon,
  Bars3Icon
} from '@heroicons/vue/24/outline'

const emit = defineEmits<{
  (e: 'update:validity', isValid: boolean): void
}>()

const wizardStore = useRoutineWizardStore()
const { strategies, steps } = storeToRefs(wizardStore)

// Estado local
const showDebug = ref(false)
let strategyIdCounter = 0

const newStrategyData = ref<WizardStrategy>({
  strategy_type: '',
  description: '',
  related_step_order: null,
})

// Opciones de tipos de estrategia
const strategyTypeOptions = computed(() => [
  { value: '', label: 'Selecciona un tipo...', attrs: { disabled: true } },
  { value: 'positive_reinforcement', label: 'â­ Refuerzo Positivo' },
  { value: 'visual_reminder', label: 'ğŸ–¼ï¸ Recordatorio Visual' },
  { value: 'timer_alarm', label: 'â° Temporizador/Alarma' },
  { value: 'sensory_adaptation', label: 'ğŸ¨ AdaptaciÃ³n Sensorial' },
  { value: 'verbal_prompt', label: 'ğŸ’¬ IndicaciÃ³n Verbal' },
  { value: 'physical_assistance', label: 'ğŸ¤ Asistencia FÃ­sica' },
  { value: 'choice_offering', label: 'ğŸ”€ Ofrecer Opciones' },
  { value: 'break_time', label: 'â¸ï¸ Tiempo de Descanso' },
  { value: 'social_story', label: 'ğŸ“– Historia Social' },
  { value: 'token_economy', label: 'ğŸ¯ Sistema de Fichas' },
  { value: 'other', label: 'â• Otra' },
])

// Computed para debug
const uniqueIdsCount = computed(() => {
  const ids = strategies.value.map(s => s.id).filter(id => id !== undefined)
  return new Set(ids).size
})

const hasIdConflicts = computed(() => {
  const ids = strategies.value.map(s => s.id).filter(id => id !== undefined)
  return ids.length !== uniqueIdsCount.value && ids.length > 0
})

const strategiesDebugInfo = computed(() => {
  return strategies.value.map((s, i) => ({
    index: i,
    id: s.id,
    type: s.strategy_type,
    hasDescription: !!s.description,
    linkedToStep: s.related_step_order
  }))
})

const availableSteps = computed(() => steps.value || [])

const stepOptions = computed(() => {
  const options: { value: number | null, label: string }[] = [{ value: null, label: 'Ninguno (toda la rutina)' }]
  availableSteps.value.forEach((step, index) => {
    options.push({
      value: index + 1,
      label: `Paso ${index + 1}: ${step.action.substring(0, 40)}${step.action.length > 40 ? '...' : ''}`
    })
  })
  return options
})

function getStrategyKey(strategy: WizardStrategy): number | string {
  return strategy.id || Math.random()
}

function addStrategy() {
  const uniqueId = Date.now() + (strategyIdCounter++)
  
  console.log('â• Agregando estrategia:', { 
    id: uniqueId, 
    type: newStrategyData.value.strategy_type 
  })
  
  const strategyToAdd = { 
    ...newStrategyData.value,
    id: uniqueId
  }
  strategies.value.push(strategyToAdd)
  
  console.log('ğŸ“‹ Total estrategias:', strategies.value.length)
  console.log('ğŸ”‘ IDs:', strategies.value.map(s => s.id))
  
  // Resetear formulario
  newStrategyData.value = {
    strategy_type: '',
    description: '',
    related_step_order: null,
  }
  
  emitValidityStatus()
}

function removeStrategy(index: number) {
  console.log('ğŸ—‘ï¸ Eliminando estrategia en Ã­ndice:', index)
  
  if (index >= 0 && index < strategies.value.length) {
    const removed = strategies.value[index]
    console.log('ğŸ—‘ï¸ Estrategia eliminada:', removed.strategy_type)
    strategies.value.splice(index, 1)
    emitValidityStatus()
  }
}

function onDragStart(event: any) {
  console.log('ğŸ¬ Arrastre de estrategia iniciado:', event.oldIndex)
}

function onDragEnd(event: any) {
  console.log('ğŸ Arrastre de estrategia finalizado:', { from: event.oldIndex, to: event.newIndex })
  console.log('ğŸ“‹ Nuevo orden:', strategies.value.map((s, i) => `${i+1}. ${s.strategy_type}`))
}

function emitValidityStatus() {
  emit('update:validity', true)
  console.log('âœ‰ï¸ Emitiendo validez: true (estrategias opcionales)')
}

function getStrategyTypeLabel(type: string): string {
  const option = strategyTypeOptions.value.find(opt => opt.value === type)
  return option ? option.label.replace(/^[^\s]+\s/, '') : type
}

function getStrategyIcon(type: string) {
  const icons: Record<string, any> = {
    positive_reinforcement: SparklesIcon,
    visual_reminder: PhotoIcon,
    timer_alarm: BellAlertIcon,
    sensory_adaptation: SparklesIcon,
    verbal_prompt: SpeakerWaveIcon,
    physical_assistance: HandRaisedIcon,
    choice_offering: SparklesIcon,
    break_time: ClockIcon,
    social_story: PhotoIcon,
    token_economy: SparklesIcon,
    other: SparklesIcon,
  }
  return icons[type] || SparklesIcon
}

onMounted(() => {
  console.log('=== ğŸš€ STEP 4 STRATEGIES MONTADO (CON DRAGGABLE) ===')
  console.log('1ï¸âƒ£ Estrategias iniciales:', strategies.value.length)
  console.log('2ï¸âƒ£ Pasos disponibles:', availableSteps.value.length)
  console.log('=== FIN DEBUG INICIAL ===')
  
  emitValidityStatus()
})
</script>

<style scoped>
/* ... [Mismos estilos que antes] ... */

/* Draggable styles ADICIONALES */
.ghost-strategy {
  @apply opacity-50 bg-purple-100 border-2 border-dashed border-purple-400 rounded-lg;
}

.dragging-strategy {
  @apply bg-white shadow-2xl border-2 border-purple-400 rounded-lg cursor-grabbing transform rotate-1 scale-105;
}

.drag-handle {
  touch-action: none;
}

/* ... [Resto de estilos igual que la versiÃ³n anterior] ... */
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\gestion\rutinas\wizard\WizardStep5Review.vue
============================================================
<template>
  <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 animate-fade-in">
    <!-- Header Section -->
    <div class="text-center mb-8 space-y-3">
      <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-success-100 mb-4 animate-bounce-soft">
        <svg class="w-8 h-8 text-success-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
      </div>
      <h3 class="text-2xl sm:text-3xl font-bold text-gray-900 tracking-tight">
        RevisiÃ³n Final
      </h3>
      <p class="text-base text-gray-600 max-w-2xl mx-auto">
        Verifica que toda la informaciÃ³n estÃ© correcta antes de guardar
      </p>
      <div class="flex items-center justify-center gap-2 text-sm text-gray-500">
        <span class="inline-block w-1.5 h-1.5 rounded-full bg-success-500"></span>
        <span>Paso 5 de 5 - Â¡Ãšltimo paso!</span>
      </div>
    </div>

    <div class="space-y-6">
      <!-- InformaciÃ³n BÃ¡sica -->
      <section class="bg-white rounded-2xl shadow-soft border border-gray-100 overflow-hidden">
        <div class="px-6 py-4 bg-gradient-to-r from-blue-50 to-blue-100/50 border-b border-blue-200">
          <h4 class="text-base font-semibold text-blue-900 flex items-center gap-2">
            <InformationCircleIcon class="w-5 h-5" />
            InformaciÃ³n BÃ¡sica
          </h4>
        </div>
        <div class="p-6">
          <dl class="grid grid-cols-1 sm:grid-cols-2 gap-6">
            <div class="review-item">
              <dt class="review-label">Nombre</dt>
              <dd class="review-value">{{ basicInfo.name }}</dd>
            </div>
            <div class="review-item">
              <dt class="review-label">Tipo</dt>
              <dd class="review-value">{{ getRoutineTypeLabel(basicInfo.routine_type) }}</dd>
            </div>
            <div class="review-item sm:col-span-2">
              <dt class="review-label">DescripciÃ³n</dt>
              <dd class="review-value whitespace-pre-wrap">{{ basicInfo.description || 'Sin descripciÃ³n' }}</dd>
            </div>
            <div class="review-item">
              <dt class="review-label">Estado Inicial</dt>
              <dd class="review-value">
                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium"
                      :class="basicInfo.status === 'active' ? 'bg-success-100 text-success-800' : 'bg-gray-100 text-gray-800'">
                  {{ basicInfo.status === 'active' ? 'âœ… Activa' : 'ğŸ“ Borrador' }}
                </span>
              </dd>
            </div>
          </dl>
        </div>
      </section>

      <!-- Horarios -->
      <section class="bg-white rounded-2xl shadow-soft border border-gray-100 overflow-hidden">
        <div class="px-6 py-4 bg-gradient-to-r from-primary-50 to-primary-100/50 border-b border-primary-200">
          <div class="flex items-center justify-between">
            <h4 class="text-base font-semibold text-primary-900 flex items-center gap-2">
              <ClockIcon class="w-5 h-5" />
              Horarios
            </h4>
            <span class="px-3 py-1 text-xs font-semibold bg-primary-600 text-white rounded-full">
              {{ schedules.length }}
            </span>
          </div>
        </div>
        <div class="p-6">
          <ul v-if="schedules.length > 0" class="space-y-3">
            <li v-for="(schedule, index) in schedules" :key="index" 
                class="flex items-start gap-3 p-4 bg-gray-50 rounded-xl border border-gray-200 hover:border-primary-300 transition-colors">
              <div class="flex-shrink-0 w-10 h-10 rounded-lg bg-primary-100 flex items-center justify-center">
                <ClockIcon class="w-5 h-5 text-primary-600" />
              </div>
              <div class="flex-1">
                <div class="flex items-baseline gap-2">
                  <span class="text-lg font-bold text-gray-900">{{ formatTime(schedule.start_time) }}</span>
                  <span v-if="schedule.estimated_duration_minutes" 
                        class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                    {{ schedule.estimated_duration_minutes }} min
                  </span>
                </div>
                <div class="flex items-center gap-2 mt-1">
                  <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                  </svg>
                  <span class="text-sm text-gray-600">{{ formatDays(schedule.days_of_week) }}</span>
                </div>
              </div>
            </li>
          </ul>
          <div v-else class="text-center py-8 text-gray-500">
            <ClockIcon class="w-12 h-12 mx-auto mb-2 text-gray-300" />
            <p class="text-sm">No se definieron horarios especÃ­ficos</p>
          </div>
        </div>
      </section>

      <!-- Pasos -->
      <section class="bg-white rounded-2xl shadow-soft border border-gray-100 overflow-hidden">
        <div class="px-6 py-4 bg-gradient-to-r from-purple-50 to-purple-100/50 border-b border-purple-200">
          <div class="flex items-center justify-between">
            <h4 class="text-base font-semibold text-purple-900 flex items-center gap-2">
              <ClipboardDocumentListIcon class="w-5 h-5" />
              Pasos de la Rutina
            </h4>
            <span class="px-3 py-1 text-xs font-semibold bg-purple-600 text-white rounded-full">
              {{ steps.length }}
            </span>
          </div>
        </div>
        <div class="p-6">
          <ol v-if="steps.length > 0" class="space-y-3">
            <li v-for="(step, index) in steps" :key="index" 
                class="flex items-start gap-3 p-4 bg-gray-50 rounded-xl border border-gray-200">
              <div class="flex-shrink-0 w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center">
                <span class="text-sm font-bold text-purple-700">{{ index + 1 }}</span>
              </div>
              <div class="flex-1 min-w-0">
                <h5 class="font-semibold text-gray-900 mb-1">{{ step.action }}</h5>
                <p v-if="step.description" class="text-sm text-gray-600 mb-2">{{ step.description }}</p>
                <div class="flex flex-wrap gap-2">
                  <span v-if="step.estimated_minutes" 
                        class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                    <ClockIcon class="w-3 h-3 mr-1" />
                    {{ step.estimated_minutes }} min
                  </span>
                  <span v-if="step.requires_supervision" 
                        class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-amber-100 text-amber-800">
                    <UserGroupIcon class="w-3 h-3 mr-1" />
                    SupervisiÃ³n
                  </span>
                  <span v-if="step.is_skippable" 
                        class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                    <ForwardIcon class="w-3 h-3 mr-1" />
                    Opcional
                  </span>
                  <span v-if="step.visual_support" 
                        class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800">
                    <PhotoIcon class="w-3 h-3 mr-1" />
                    Visual
                  </span>
                </div>
              </div>
            </li>
          </ol>
          <div v-else class="text-center py-8">
            <svg class="w-12 h-12 mx-auto mb-2 text-error-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
            </svg>
            <p class="text-sm text-error-600 font-semibold">Â¡No se han definido pasos para la rutina!</p>
            <p class="text-xs text-gray-500 mt-1">Necesitas al menos un paso para continuar</p>
          </div>
        </div>
      </section>

      <!-- Estrategias -->
      <section class="bg-white rounded-2xl shadow-soft border border-gray-100 overflow-hidden">
        <div class="px-6 py-4 bg-gradient-to-r from-green-50 to-green-100/50 border-b border-green-200">
          <div class="flex items-center justify-between">
            <h4 class="text-base font-semibold text-green-900 flex items-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
              </svg>
              Estrategias de Apoyo
            </h4>
            <span class="px-3 py-1 text-xs font-semibold bg-green-600 text-white rounded-full">
              {{ strategies.length }}
            </span>
          </div>
        </div>
        <div class="p-6">
          <ul v-if="strategies.length > 0" class="space-y-3">
            <li v-for="(strategy, index) in strategies" :key="index" 
                class="flex items-start gap-3 p-4 bg-gray-50 rounded-xl border border-gray-200">
              <div class="flex-shrink-0 w-10 h-10 rounded-lg bg-green-100 flex items-center justify-center">
                <svg class="w-5 h-5 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M11 3a1 1 0 10-2 0v1a1 1 0 102 0V3zM15.657 5.757a1 1 0 00-1.414-1.414l-.707.707a1 1 0 001.414 1.414l.707-.707zM18 10a1 1 0 01-1 1h-1a1 1 0 110-2h1a1 1 0 011 1zM5.05 6.464A1 1 0 106.464 5.05l-.707-.707a1 1 0 00-1.414 1.414l.707.707zM5 10a1 1 0 01-1 1H3a1 1 0 110-2h1a1 1 0 011 1zM8 16v-1h4v1a2 2 0 11-4 0zM12 14c.015-.34.208-.646.477-.859a4 4 0 10-4.954 0c.27.213.462.519.476.859h4.002z" />
                </svg>
              </div>
              <div class="flex-1 min-w-0">
                <div class="flex items-start justify-between gap-2 mb-1">
                  <h5 class="font-semibold text-gray-900">{{ getStrategyTypeLabel(strategy.strategy_type) }}</h5>
                  <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                    {{ strategy.strategy_type }}
                  </span>
                </div>
                <p v-if="strategy.description" class="text-sm text-gray-600 mb-2">{{ strategy.description }}</p>
                <div v-if="strategy.related_step_order !== null" class="flex items-center gap-2">
                  <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" />
                  </svg>
                  <span class="text-xs text-gray-500">Vinculada al paso {{ strategy.related_step_order }}</span>
                </div>
              </div>
            </li>
          </ul>
          <div v-else class="text-center py-8 text-gray-500">
            <svg class="w-12 h-12 mx-auto mb-2 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
            </svg>
            <p class="text-sm">No se definieron estrategias de apoyo</p>
          </div>
        </div>
      </section>

      <!-- Mensaje de ConfirmaciÃ³n -->
      <div class="bg-gradient-to-r from-success-50 to-green-50 border-2 border-success-300 rounded-2xl p-6 flex gap-4 animate-slide-in">
        <div class="flex-shrink-0">
          <svg class="w-8 h-8 text-success-600" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
          </svg>
        </div>
        <div class="flex-1">
          <h4 class="text-base font-semibold text-success-900 mb-2">Â¿Todo estÃ¡ correcto?</h4>
          <p class="text-sm text-success-800 mb-3">
            Revisa cuidadosamente toda la informaciÃ³n. Una vez guardada, podrÃ¡s editarla desde el panel de rutinas.
          </p>
          <p class="text-xs text-success-700 italic">
            ğŸ’¡ Consejo: AsegÃºrate de que los pasos estÃ©n en el orden correcto y que las estrategias sean apropiadas.
          </p>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { onMounted } from 'vue'
import { useRoutineWizardStore } from '@/store/rutinas/routineWizardStore'
import { storeToRefs } from 'pinia'
import {
  InformationCircleIcon,
  ClockIcon,
  ClipboardDocumentListIcon,
  UserGroupIcon,
  ForwardIcon,
  PhotoIcon
} from '@heroicons/vue/24/outline'

const emit = defineEmits<{
  (e: 'update:validity', isValid: boolean): void
}>()

const wizardStore = useRoutineWizardStore()
const { basicInfo, schedules, steps, strategies } = storeToRefs(wizardStore)

function formatTime(timeString: string | null | undefined): string {
  if (!timeString) return '-'
  try {
    const [hours, minutes] = timeString.split(':')
    return `${hours}:${minutes}`
  } catch { return timeString }
}

function formatDays(days: string[] | null | undefined): string {
  if (!days || days.length === 0) return 'Sin dÃ­as asignados'
  const dayMap: Record<string, string> = {
    monday: 'Lun', tuesday: 'Mar', wednesday: 'MiÃ©', thursday: 'Jue',
    friday: 'Vie', saturday: 'SÃ¡b', sunday: 'Dom'
  }
  const orderedDays = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday']
  const sortedSelectedDays = orderedDays.filter(d => days.includes(d))

  if (sortedSelectedDays.length === 7) return 'Todos los dÃ­as'
  if (sortedSelectedDays.length === 5 && !days.includes('saturday') && !days.includes('sunday')) return 'Lunes a Viernes'
  if (sortedSelectedDays.length === 2 && days.includes('saturday') && days.includes('sunday')) return 'Fines de semana'

  return sortedSelectedDays.map(day => dayMap[day] || day).join(', ')
}

function getRoutineTypeLabel(typeValue: string | null): string {
  const options = [
    { value: 'morning', label: 'â˜€ï¸ MaÃ±ana' },
    { value: 'breakfast', label: 'ğŸ³ Desayuno' },
    { value: 'school_prep', label: 'ğŸ’ PreparaciÃ³n Escuela' },
    { value: 'after_school', label: 'ğŸ  DespuÃ©s de Escuela' },
    { value: 'homework', label: 'ğŸ“š Tareas' },
    { value: 'dinner', label: 'ğŸ½ï¸ Cena' },
    { value: 'bath', label: 'ğŸ› BaÃ±o' },
    { value: 'bedtime', label: 'ğŸŒ™ Dormir' },
    { value: 'therapy_session', label: 'ğŸ’† Terapia' },
    { value: 'weekend', label: 'ğŸ‰ Fin de Semana' },
    { value: 'transition', label: 'ğŸ”„ TransiciÃ³n' },
    { value: 'other', label: 'ğŸ“‹ Otro' },
  ]
  return options.find(opt => opt.value === typeValue)?.label || typeValue || '-'
}

function getStrategyTypeLabel(type: string): string {
  const options = [
    { value: 'positive_reinforcement', label: 'Refuerzo Positivo' },
    { value: 'visual_reminder', label: 'Recordatorio Visual' },
    { value: 'timer_alarm', label: 'Temporizador/Alarma' },
    { value: 'sensory_adaptation', label: 'AdaptaciÃ³n Sensorial' },
    { value: 'verbal_prompt', label: 'IndicaciÃ³n Verbal' },
    { value: 'physical_assistance', label: 'Asistencia FÃ­sica' },
    { value: 'choice_offering', label: 'Ofrecimiento de Opciones' },
    { value: 'break_time', label: 'Tiempo de Descanso' },
    { value: 'social_story', label: 'Historia Social' },
    { value: 'token_economy', label: 'EconomÃ­a de Fichas' },
    { value: 'other', label: 'Otra' },
  ]
  return options.find(opt => opt.value === type)?.label || type
}

onMounted(() => {
  const isOverallValid = wizardStore.isStep3Valid
  emit('update:validity', isOverallValid)
})
</script>

<style scoped>
/* Animaciones */
@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes slideIn {
  from {
    opacity: 0;
    transform: translateX(-20px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

@keyframes bounceSoft {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-8px); }
}

.animate-fade-in {
  animation: fadeIn 0.6s ease-out;
}

.animate-slide-in {
  animation: slideIn 0.5s ease-out;
}

.animate-bounce-soft {
  animation: bounceSoft 3s ease-in-out infinite;
}

/* Review items */
.review-item {
  @apply space-y-1;
}

.review-label {
  @apply text-xs font-semibold text-gray-500 uppercase tracking-wide;
}

.review-value {
  @apply text-base text-gray-900 font-medium;
}

/* Responsive */
@media (max-width: 640px) {
  .review-value {
    @apply text-sm;
  }
}
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\HelloWorld.vue
============================================================
<script setup lang="ts">
import { ref } from 'vue'

defineProps<{ msg: string }>()

const count = ref(0)
</script>

<template>
  <h1>{{ msg }}</h1>

  <div class="card">
    <button type="button" @click="count++">count is {{ count }}</button>
    <p>
      Edit
      <code>components/HelloWorld.vue</code> to test HMR
    </p>
  </div>

  <p>
    Check out
    <a href="https://vuejs.org/guide/quick-start.html#local" target="_blank"
      >create-vue</a
    >, the official Vue + Vite starter
  </p>
  <p>
    Learn more about IDE Support for Vue in the
    <a
      href="https://vuejs.org/guide/scaling-up/tooling.html#ide-support"
      target="_blank"
      >Vue Docs Scaling up Guide</a
    >.
  </p>
  <p class="read-the-docs">Click on the Vite and Vue logos to learn more</p>
</template>

<style scoped>
.read-the-docs {
  color: #888;
}
</style>

============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\layout\Breadcrumbs.vue
============================================================
<template>
  <nav class="text-sm font-medium" aria-label="Breadcrumb">
    <ol class="flex items-center space-x-2 text-gray-500">
      
      <li v-for="(crumb, index) in crumbs" :key="index">
        <div class="flex items-center">
          
          <svg
            v-if="index > 0"
            class="h-5 w-5 flex-shrink-0 text-gray-300 mr-2"
            xmlns="http://www.w3.org/2000/svg"
            fill="currentColor"
            viewBox="0 0 20 20"
            aria-hidden="true"
          >
            <path d="M5.555 17.776l8-16 .894.448-8 16-.894-.448z" />
          </svg>
          
          <router-link
            v-if="index < crumbs.length - 1"
            :to="crumb.to"
            class="hover:text-gray-700 hover:underline"
          >
            {{ crumb.label }}
          </router-link>

          <span
            v-else
            class="font-semibold text-gray-700"
            aria-current="page"
          >
            {{ crumb.label }}
          </span>
        </div>
      </li>
    </ol>
  </nav>
</template>

<script setup lang="ts">
import { computed } from 'vue'
import { useRoute, type RouteLocationNormalized } from 'vue-router'
// Opcional: Importa tu store si necesitas nombres dinÃ¡micos
// import { useChildStore } from '@/store/childStore'

const route = useRoute()
// const childStore = useChildStore() // Descomenta si usas el store

interface Crumb {
  label: string;
  to: { name: string; params?: Record<string, any> };
}

// La lÃ³gica principal estÃ¡ en esta propiedad computada
const crumbs = computed(() => {
  
  // 1. Obtenemos todas las rutas "padre" e "hija" activas
  const matchedRoutes = route.matched

  const processedCrumbs: Crumb[] = matchedRoutes
    // 2. Filtramos solo las que tengan la propiedad 'meta.breadcrumb'
    .filter(r => r.meta && r.meta.breadcrumb)
    // 3. Mapeamos cada ruta a un objeto Crumb
    .map(r => {
      // 4. Resolvemos el texto de la miga
      const label = typeof r.meta.breadcrumb === 'function'
        ? (r.meta.breadcrumb as (route: RouteLocationNormalized) => string)(route) // Resuelve breadcrumb dinÃ¡mico (ej. Perfil NiÃ±o #123)
        : r.meta.breadcrumb as string

      return {
        label: label,
        to: { 
          name: r.name as string, 
          params: route.params // Pasamos los params de la ruta actual
        }
      }
    })

  // 5. (Opcional) LÃ³gica para nombres dinÃ¡micos desde un store
  //    Esto reemplaza etiquetas genÃ©ricas como "Perfil NiÃ±o #123"
  //    por nombres reales como "Perfil de Juan PÃ©rez"
  
  // return processedCrumbs.map(crumb => {
  //   if (crumb.to.name === 'perfil-nino-layout' && childStore.currentChildName) {
  //     return {
  //       ...crumb,
  //       label: `Perfil de ${childStore.currentChildName}`
  //     }
  //   }
  //   return crumb
  // })
  
  // Devuelve las migas procesadas (sin el paso 5 opcional por ahora)
  return processedCrumbs
})
</script>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\modal\BaseModal.vue
============================================================
<!-- src/components/modal/BaseModal.vue -->
<!-- MODAL BASE REUTILIZABLE CON TRANSICIONES Y HEROICONS -->
<template>
  <!-- Teleport permite renderizar el modal directamente en <body> -->
  <Teleport to="body">
    <!-- TransiciÃ³n para el overlay (fondo oscuro) -->
    <Transition name="modal-overlay" appear>
      <div v-if="show" class="modal-overlay" @click.self="handleClose">
        <!-- TransiciÃ³n para el contenedor del modal -->
        <Transition name="modal" appear>
          <div class="modal-container" :class="`modal-${size}`">
            <!-- HEADER DEL MODAL -->
            <div class="modal-header">
              <!-- TÃ­tulo dinÃ¡mico pasado por props -->
              <h2 class="modal-title">{{ title }}</h2>
              <!-- BotÃ³n de cierre con icono de Heroicons -->
              <button class="modal-close" @click="handleClose">
                <XMarkIcon class="modal-close-icon" />
              </button>
            </div>
            <!-- CONTENIDO PRINCIPAL DEL MODAL -->
            <div class="modal-content">
              <!-- Slot principal: aquÃ­ se inyecta el contenido del modal -->
              <slot></slot>
            </div>
            <!-- FOOTER OPCIONAL -->
            <div v-if="$slots.footer" class="modal-footer">
              <slot name="footer"></slot>
            </div>
          </div>
        </Transition>
      </div>
    </Transition>
  </Teleport>
</template>

<script setup lang="ts">
import { XMarkIcon } from '@heroicons/vue/24/outline'

// INTERFAZ DE PROPIEDADES QUE RECIBE EL MODAL
interface Props {
  show: boolean              // Controla si el modal estÃ¡ visible
  title: string              // TÃ­tulo que se muestra en el header
  size?: 'sm' | 'md' | 'lg' | 'xl'  // TamaÃ±o del modal (opcional)
}

// DEFINIMOS LAS PROPS CON VALORES POR DEFECTO
const props = withDefaults(defineProps<Props>(), {
  size: 'md'                // Si no se especifica, el modal serÃ¡ tamaÃ±o medio
})

// DEFINIMOS LOS EVENTOS QUE EMITE EL MODAL
const emit = defineEmits<{
  (e: 'update:show', value: boolean): void  // Para v-model:show
  (e: 'close'): void                        // Evento personalizado para cerrar
}>()

// FUNCIÃ“N QUE CIERRA EL MODAL
const handleClose = () => {
  emit('update:show', false)  // Oculta el modal (v-model)
  emit('close')               // Permite al padre ejecutar lÃ³gica adicional
}
</script>

<style scoped>
/* TRANSICIONES DEL MODAL */
/* TransiciÃ³n del overlay (fondo oscuro) */
.modal-overlay-enter-active,
.modal-overlay-leave-active {
  transition: opacity 0.3s ease;
}

.modal-overlay-enter-from,
.modal-overlay-leave-to {
  opacity: 0;
}

/* TransiciÃ³n del contenedor del modal */
.modal-enter-active,
.modal-leave-active {
  transition: all 0.3s ease;
}

.modal-enter-from,
.modal-leave-to {
  opacity: 0;
  transform: scale(0.95) translateY(-20px);
}

/* FONDO OSCURO DETRÃS DEL MODAL */
.modal-overlay {
  position: fixed;
  top: 0; 
  left: 0;
  width: 100%; 
  height: 100%;
  background: rgba(0, 0, 0, 0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  backdrop-filter: blur(2px); /* Efecto de desenfoque sutil */
}

/* CONTENEDOR DEL MODAL */
.modal-container {
  background: white;
  border-radius: 12px; /* Bordes mÃ¡s redondeados */
  max-height: 90vh;
  display: flex;
  flex-direction: column;
  box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); /* Sombra mÃ¡s elegante */
}

/* TAMAÃ‘OS DEL MODAL SEGÃšN prop `size` */
.modal-sm { 
  width: 400px; 
  max-width: 90vw;
}
.modal-md { 
  width: 600px; 
  max-width: 90vw;
}
.modal-lg { 
  width: 800px; 
  max-width: 90vw;
}
.modal-xl { 
  width: 1000px; 
  max-width: 95vw;
}

/* ENCABEZADO DEL MODAL */
.modal-header {
  padding: 1.25rem 1.5rem;
  border-bottom: 1px solid #e5e7eb;
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: #f9fafb; /* Fondo ligeramente gris */
  border-radius: 12px 12px 0 0; /* Bordes redondeados solo arriba */
}

.modal-title {
  margin: 0;
  font-size: 1.25rem;
  font-weight: 600;
  color: #111827;
}

/* BOTÃ“N DE CIERRE MEJORADO */
.modal-close {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 2.5rem;
  height: 2.5rem;
  border: none;
  border-radius: 50%;
  background: transparent;
  cursor: pointer;
  transition: all 0.2s ease;
  color: #6b7280;
}

.modal-close:hover {
  background: #f3f4f6;
  color: #dc2626; /* Color rojo en hover */
  transform: scale(1.1); /* Crece ligeramente */
}

.modal-close:active {
  transform: scale(0.95);
}

/* ICONO DE CIERRE */
.modal-close-icon {
  width: 1.5rem;
  height: 1.5rem;
  transition: transform 0.2s ease;
}

.modal-close:hover .modal-close-icon {
  transform: rotate(90deg); /* RotaciÃ³n en hover para efecto dinÃ¡mico */
}

/* CONTENIDO PRINCIPAL DEL MODAL */
.modal-content {
  padding: 1.5rem;
  overflow-y: auto;
  flex: 1;
}

/* PIE DEL MODAL (OPCIONAL) */
.modal-footer {
  padding: 1rem 1.5rem;
  border-top: 1px solid #e5e7eb;
  background: #f9fafb;
  border-radius: 0 0 12px 12px;
}

/* RESPONSIVE DESIGN */
@media (max-width: 640px) {
  .modal-container {
    margin: 1rem;
    max-height: calc(100vh - 2rem);
  }
  
  .modal-sm,
  .modal-md,
  .modal-lg,
  .modal-xl {
    width: 100%;
    max-width: none;
  }
}
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\modal\SessionWarningModal.vue
============================================================
<template>
  <div
    v-if="visible"
    class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50"
  >
    <div class="bg-white rounded-lg shadow-lg p-6 w-96">
      <h2 class="text-lg font-semibold text-gray-800 mb-4">SesiÃ³n inactiva</h2>
      <p class="text-gray-600 mb-6">
        Tu sesiÃ³n se cerrarÃ¡ en menos de 1 minuto por inactividad.
      </p>
      <div class="flex justify-end space-x-3">
        <button
          @click="onKeepAlive"
          class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"
        >
          Mantener sesiÃ³n activa
        </button>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
defineProps<{
  visible: boolean
  onKeepAlive: () => void
}>()
</script>

============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\ninos\FiltraNinos.vue
============================================================

============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\ninos\PaginadorNino.vue
============================================================

============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\ninos\SubComponentes\BusquedaFiltros.vue
============================================================
<!-- src/components/ninos/SubComponentes/BusquedaFiltros.vue -->
<template>
  <div class="filters-section">
    <div class="search-wrapper">
      <div class="search-input-group">
        <svg class="search-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
        </svg>
        <input
          :value="searchQuery"
          type="text"
          placeholder="Buscar por nombre, apellido o estado..."
          class="search-input"
          @input="$emit('update:searchQuery', ($event.target as HTMLInputElement).value)"
        />
        <button 
          v-if="searchQuery" 
          @click="$emit('update:searchQuery', '')"
          class="clear-button"
          aria-label="Limpiar bÃºsqueda"
        >
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
    </div>

    <div class="filters-actions">
      <select :value="filterStatus" @change="$emit('update:filterStatus', ($event.target as HTMLSelectElement).value)" class="filter-select">
        <option value="">Todos los estados</option>
        <option value="active">Activo</option>
        <option value="suspended">Suspendido</option>
      </select>

      <select :value="filterGrade" @change="$emit('update:filterGrade', ($event.target as HTMLSelectElement).value)" class="filter-select">
        <option value="">Todos los grados</option>
        <option value="1Â° BÃ¡sico">1Â° BÃ¡sico</option>
        <option value="2Â° BÃ¡sico">2Â° BÃ¡sico</option>
        <option value="3Â° BÃ¡sico">3Â° BÃ¡sico</option>
        <option value="4Â° BÃ¡sico">4Â° BÃ¡sico</option>
        <option value="5Â° BÃ¡sico">5Â° BÃ¡sico</option>
        <option value="6Â° BÃ¡sico">6Â° BÃ¡sico</option>
        <option value="7Â° BÃ¡sico">7Â° BÃ¡sico</option>
        <option value="8Â° BÃ¡sico">8Â° BÃ¡sico</option>
      </select>

      <button 
        v-if="hasActiveFilters" 
        @click="$emit('clear-filters')"
        class="clear-filters-btn"
      >
        Limpiar filtros
      </button>
    </div>
  </div>
</template>

<script setup lang="ts">
defineProps<{
  searchQuery: string
  filterStatus: string
  filterGrade: string
  hasActiveFilters?: boolean
}>()

defineEmits<{
  'update:searchQuery': [value: string]
  'update:filterStatus': [value: string]
  'update:filterGrade': [value: string]
  'clear-filters': []
}>()
</script>

<style scoped>
.filters-section {
  padding: 1.5rem;
  border-bottom: 1px solid #e5e7eb;
  display: flex;
  flex-wrap: wrap;
  gap: 1rem;
}

.search-wrapper {
  flex: 1;
  min-width: 250px;
}

.search-input-group {
  position: relative;
  display: flex;
  align-items: center;
}

.search-icon {
  position: absolute;
  left: 12px;
  width: 20px;
  height: 20px;
  color: #9ca3af;
  pointer-events: none;
}

.search-input {
  width: 100%;
  padding: 0.625rem 2.5rem 0.625rem 2.75rem;
  border: 1px solid #e5e7eb;
  border-radius: 8px;
  font-size: 0.875rem;
  transition: all 0.2s;
}

.search-input:focus {
  outline: none;
  border-color: #3b82f6;
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

.clear-button {
  position: absolute;
  right: 8px;
  padding: 4px;
  color: #9ca3af;
  background: none;
  border: none;
  cursor: pointer;
  border-radius: 4px;
  transition: all 0.2s;
}

.clear-button:hover {
  color: #ef4444;
  background: #fee;
}

.filters-actions {
  display: flex;
  gap: 0.75rem;
  flex-wrap: wrap;
}

.filter-select {
  padding: 0.625rem 2.5rem 0.625rem 0.75rem;
  border: 1px solid #e5e7eb;
  border-radius: 8px;
  font-size: 0.875rem;
  background: white;
  cursor: pointer;
  transition: all 0.2s;
  appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%239ca3af'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 0.5rem center;
  background-size: 1.25rem;
}

.filter-select:focus {
  outline: none;
  border-color: #3b82f6;
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

.clear-filters-btn {
  padding: 0.625rem 1rem;
  background: #fee;
  color: #dc2626;
  border: 1px solid #fca5a5;
  border-radius: 8px;
  font-size: 0.875rem;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s;
}

.clear-filters-btn:hover {
  background: #fecaca;
}
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\ninos\SubComponentes\metricasCard\MetricCard.vue
============================================================
<!-- src/components/ninos/SubComponentes/metricasCard/MetricCard.vue -->
<template>
  <div 
    class="metric-card" 
    :class="{
      'metric-card--loading': loading,
      'metric-card--positive': tendencia === 'positiva',
      'metric-card--negative': tendencia === 'negativa',
      'metric-card--neutral': tendencia === 'neutral'
    }"
  >
    <!-- Header con tÃ­tulo e Ã­cono -->
    <div class="metric-card__header">
      <h3 class="metric-card__title">{{ titulo }}</h3>
      <div v-if="icono" class="metric-card__icon">
        {{ icono }}
      </div>
    </div>

    <!-- Contenido principal -->
    <div class="metric-card__content">
      <div v-if="loading" class="metric-card__loading">
        <div class="loading-skeleton"></div>
      </div>
      
      <template v-else>
        <div class="metric-card__value">{{ valorFormateado }}</div>
        <div v-if="subtitulo" class="metric-card__subtitle">{{ subtitulo }}</div>
        
        <!-- Indicador de tendencia -->
        <div v-if="tendencia" class="metric-card__trend">
          <span class="trend-icon">{{ tendenciaIcono }}</span>
          <span class="trend-text">{{ tendenciaTexto }}</span>
        </div>
      </template>
    </div>
  </div>
</template>

<script setup lang="ts">
import { computed } from 'vue';
import { MetricCardProps } from '@/type/metricas';

// Props con TypeScript
const props = withDefaults(defineProps<MetricCardProps>(), {
  tendencia: 'neutral',
  loading: false
});

// Computed para formatear valores
const valorFormateado = computed(() => {
  if (typeof props.valor === 'number') {
    return props.valor.toLocaleString('es-CL');
  }
  return props.valor;
});

// Ãcono y texto de tendencia
const tendenciaIcono = computed(() => {
  switch (props.tendencia) {
    case 'positiva': return 'â†—';
    case 'negativa': return 'â†˜';
    default: return 'â†’';
  }
});

const tendenciaTexto = computed(() => {
  switch (props.tendencia) {
    case 'positiva': return 'Positiva';
    case 'negativa': return 'Negativa';
    default: return 'Estable';
  }
});
</script>

<style scoped>
.metric-card {
  background: white;
  border-radius: 12px;
  padding: 1.5rem;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  border: 1px solid #e2e8f0;
  transition: all 0.3s ease;
  height: fit-content;
}

.metric-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.metric-card--loading {
  opacity: 0.7;
}

.metric-card--positive {
  border-left: 4px solid #10b981;
}

.metric-card--negative {
  border-left: 4px solid #ef4444;
}

.metric-card--neutral {
  border-left: 4px solid #6b7280;
}

.metric-card__header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 1rem;
}

.metric-card__title {
  font-size: 0.875rem;
  font-weight: 600;
  color: #6b7280;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  margin: 0;
}

.metric-card__icon {
  font-size: 1.25rem;
  opacity: 0.7;
}

.metric-card__content {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.metric-card__value {
  font-size: 2rem;
  font-weight: 700;
  color: #1f2937;
  line-height: 1;
}

.metric-card__subtitle {
  font-size: 0.875rem;
  color: #6b7280;
}

.metric-card__trend {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-size: 0.75rem;
  margin-top: 0.5rem;
}

.trend-icon {
  font-weight: bold;
}

.metric-card--positive .trend-icon {
  color: #10b981;
}

.metric-card--negative .trend-icon {
  color: #ef4444;
}

.metric-card--neutral .trend-icon {
  color: #6b7280;
}

.trend-text {
  color: #6b7280;
  text-transform: uppercase;
  font-weight: 600;
  letter-spacing: 0.05em;
}

/* Loading skeleton */
.loading-skeleton {
  background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
  background-size: 200% 100%;
  animation: loading 1.5s infinite;
  height: 2rem;
  border-radius: 4px;
}

@keyframes loading {
  0% {
    background-position: 200% 0;
  }
  100% {
    background-position: -200% 0;
  }
}

/* Responsive */
@media (max-width: 768px) {
  .metric-card {
    padding: 1rem;
  }
  
  .metric-card__value {
    font-size: 1.5rem;
  }
}
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\ninos\SubComponentes\metricasCard\MetricCardGrid.vue
============================================================
<!-- src/components/ninos/SubComponentes/metricasCard/MetricCardGrid.vue -->
<template>
  <section class="metricas-dashboard">
    <!-- Header con tÃ­tulo y controles -->
    <div class="metricas-header">
      <h2 class="metricas-title">Resumen Ejecutivo</h2>
      <div class="metricas-controls">
        <button 
          @click="$emit('refresh')" 
          class="refresh-btn"
          :disabled="loading"
        >
          <span class="refresh-icon">ğŸ”„</span>
          Actualizar
        </button>
        <div v-if="metricas?.metadata" class="last-update">
          Actualizado: {{ formatLastUpdate(metricas.metadata.ultima_actualizacion) }}
        </div>
      </div>
    </div>

    <!-- Estado de error -->
    <div v-if="error && !loading" class="metricas-error">
      <div class="error-icon">âŒ</div>
      <div class="error-message">{{ error }}</div>
      <button @click="$emit('refresh')" class="retry-btn">
        Reintentar
      </button>
    </div>

    <!-- Grid de mÃ©tricas -->
    <div v-else class="metricas-grid">
      <!-- Resumen General -->
      <MetricSummaryCard
        :total-ninos="metricas?.resumen_general.total_ninos ?? 0"
        :loading="loading"
      />
      
      <MetricClinicalCard
        :con-necesidades-especiales="metricas?.resumen_general.con_necesidades_especiales ?? 0"
        :porcentaje-con-nee="metricas?.resumen_general.porcentaje_con_nee ?? 0"
        :loading="loading"
      />
      
      <MetricCard
        titulo="En Programa PIE"
        :valor="metricas?.resumen_general.en_programa_pie ?? 0"
        subtitulo="Con programa activo"
        icono="ğŸ“Š"
        :loading="loading"
      />
      
      <MetricCard
        titulo="Nuevos Este Mes"
        :valor="metricas?.resumen_general.nuevos_este_mes ?? 0"
        subtitulo="Altas recientes"
        icono="ğŸ†•"
        tendencia="positiva"
        :loading="loading"
      />

      <!-- GestiÃ³n Operativa -->
      <MetricOperationalCard
        :sin-consentimiento="metricas?.gestion_operativa.sin_consentimiento ?? 0"
        :loading="loading"
      />
      
      <MetricCard
        titulo="En EvaluaciÃ³n PIE"
        :valor="metricas?.gestion_operativa.en_evaluacion_pie ?? 0"
        subtitulo="Procesos en curso"
        icono="ğŸ“‹"
        :loading="loading"
      />
      
      <MetricCard
        titulo="Sin Establecimiento"
        :valor="metricas?.gestion_operativa.sin_establecimiento ?? 0"
        subtitulo="Requieren asignaciÃ³n"
        icono="ğŸ«"
        tendencia="negativa"
        :loading="loading"
      />
    </div>

    <!-- Loading state -->
    <div v-if="loading" class="metricas-loading">
      <div class="loading-spinner"></div>
      <p>Cargando mÃ©tricas...</p>
    </div>
  </section>
</template>

<script setup lang="ts">

import MetricCard from './MetricCard.vue';
import MetricSummaryCard from './MetricSummaryCard.vue';
import MetricClinicalCard from './MetricClinicalCard.vue';
import MetricOperationalCard from './MetricOperationalCard.vue';
import { MetricCardGridProps } from '@/type/metricas';
defineProps<MetricCardGridProps>();
defineEmits<{
  refresh: [];
}>();

// Formatear fecha de Ãºltima actualizaciÃ³n
const formatLastUpdate = (timestamp: string) => {
  return new Date(timestamp).toLocaleTimeString('es-CL');
};
</script>

<style scoped>
.metricas-dashboard {
  margin-bottom: 2rem;
}

.metricas-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1.5rem;
  flex-wrap: wrap;
  gap: 1rem;
}

.metricas-title {
  font-size: 1.5rem;
  font-weight: 700;
  color: #1f2937;
  margin: 0;
}

.metricas-controls {
  display: flex;
  align-items: center;
  gap: 1rem;
}

.refresh-btn {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  background: #3b82f6;
  color: white;
  border: none;
  padding: 0.5rem 1rem;
  border-radius: 6px;
  cursor: pointer;
  font-size: 0.875rem;
  transition: background-color 0.2s;
}

.refresh-btn:hover:not(:disabled) {
  background: #2563eb;
}

.refresh-btn:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

.refresh-icon {
  font-size: 0.875rem;
}

.last-update {
  font-size: 0.75rem;
  color: #6b7280;
}

.metricas-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 1.5rem;
  margin-bottom: 1rem;
}

.metricas-error {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 3rem 2rem;
  background: #fef2f2;
  border: 1px solid #fecaca;
  border-radius: 8px;
  text-align: center;
  gap: 1rem;
}

.error-icon {
  font-size: 2rem;
}

.error-message {
  color: #dc2626;
  font-weight: 500;
}

.retry-btn {
  background: #dc2626;
  color: white;
  border: none;
  padding: 0.5rem 1rem;
  border-radius: 6px;
  cursor: pointer;
}

.retry-btn:hover {
  background: #b91c1c;
}

.metricas-loading {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 3rem 2rem;
  gap: 1rem;
}

.loading-spinner {
  width: 2rem;
  height: 2rem;
  border: 2px solid #e5e7eb;
  border-top: 2px solid #3b82f6;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* Responsive */
@media (max-width: 768px) {
  .metricas-header {
    flex-direction: column;
    align-items: stretch;
  }
  
  .metricas-controls {
    justify-content: space-between;
  }
  
  .metricas-grid {
    grid-template-columns: 1fr;
    gap: 1rem;
  }
}
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\ninos\SubComponentes\metricasCard\MetricClinicalCard.vue
============================================================
<!-- src/components/ninos/SubComponentes/metricasCard/MetricClinicalCard.vue -->
<template>
  <MetricCard
    titulo="Con NEE"
    :valor="conNecesidadesEspeciales"
    :subtitulo="`${porcentajeConNee}% del total`"
    icono="ğŸ¥"
    :tendencia="tendencia"
    :loading="loading"
  />
</template>

<script setup lang="ts">
import { computed } from 'vue';
import MetricCard from './MetricCard.vue';

interface Props {
  conNecesidadesEspeciales: number;
  porcentajeConNee: number;
  loading?: boolean;
  tendencia?: 'positiva' | 'negativa' | 'neutral';
}

const props = withDefaults(defineProps<Props>(), {
  loading: false,
  tendencia: 'neutral'
});
</script>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\ninos\SubComponentes\metricasCard\MetricDemographicCard.vue
============================================================
<!-- src/components/ninos/SubComponentes/metricasCard/MetricDemographicCard.vue -->
<template>
  <MetricCard
    titulo="DistribuciÃ³n"
    :valor="totalPorGenero"
    subtitulo="Total por gÃ©nero"
    icono="ğŸ‘ª"
    :loading="loading"
  />
</template>

<script setup lang="ts">
import MetricCard from './MetricCard.vue';

interface Props {
  totalPorGenero: number;
  loading?: boolean;
}

defineProps<Props>();
</script>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\ninos\SubComponentes\metricasCard\MetricOperationalCard.vue
============================================================
<!-- src/components/ninos/SubComponentes/metricasCard/MetricOperationalCard.vue -->
<template>
  <MetricCard
    titulo="Sin Consentimiento"
    :valor="sinConsentimiento"
    subtitulo="Requieren atenciÃ³n"
    icono="âš ï¸"
    tendencia="negativa"
    :loading="loading"
  />
</template>

<script setup lang="ts">
import MetricCard from './MetricCard.vue';

interface Props {
  sinConsentimiento: number;
  loading?: boolean;
}

defineProps<Props>();
</script>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\ninos\SubComponentes\metricasCard\MetricSummaryCard.vue
============================================================
<!-- src/components/ninos/SubComponentes/metricasCard/MetricSummaryCard.vue -->
<template>
  <MetricCard
    titulo="Total NNA"
    :valor="totalNinos"
    subtitulo="NiÃ±os y adolescentes en el sistema"
    icono="ğŸ‘¥"
    :tendencia="tendencia"
    :loading="loading"
  />
</template>

<script setup lang="ts">
import MetricCard from './MetricCard.vue';

interface Props {
  totalNinos: number;
  loading?: boolean;
  tendencia?: 'positiva' | 'negativa' | 'neutral';
}

withDefaults(defineProps<Props>(), {
  loading: false,
  tendencia: 'neutral'
});
</script>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\ninos\SubComponentes\TablaDesktopRow.vue
============================================================
<!-- src/components/ninos/SubComponentes/TablaDesktopRow.vue -->
<template>
  <tr class="data-row">
    <td class="name-cell">
      <div class="name-wrapper">
        <!-- Avatar con imagen o fallback a iniciales -->
        <div class="avatar" :key="avatarKey">
          <img
            v-if="photoUrl"
            :src="photoUrl"
            :alt="`Foto de ${nna.first_name} ${nna.last_name}`"
            class="avatar-image"
            @error="handleImageError"
            @load="handleImageLoad"
          />
          <span v-else class="avatar-initials">
            {{ getInitials(nna.first_name, nna.last_name) }}
          </span>
        </div>
        <div class="name-details">
          <!-- ğŸ†• NOMBRE CLICKABLE PARA NAVEGAR AL PERFIL -->
          <span 
            class="name clickable-name" 
            @click="verPerfilNino"
            :title="`Ver perfil de ${nna.first_name} ${nna.last_name}`"
          >
            {{ nna.first_name }} {{ nna.last_name }}
          </span>
          <span class="rut" v-if="nna.rut">{{ nna.rut }}</span>
        </div>
      </div>
    </td>
    <td>
      <div class="commune-info">
        <span>{{ nna.commune_name || 'Sin comuna' }}</span>
        <span class="autism-level" v-if="nna.autism_level">{{ nna.autism_level }}</span>
      </div>
    </td>
    <td>
      <span class="age-badge">{{ calculateAge(nna.birth_date) }} aÃ±os</span>
    </td>
    <td>
      <label
        :class="[
          'toggle-switch',
          nna.status === 'active' ? 'toggle-active' : 'toggle-inactive'
        ]"
      >
        <input 
          type="checkbox" 
          :checked="nna.status === 'active'"
          @change="handleToggleStatus"
          class="toggle-input"
        />
        <span class="toggle-slider"></span>
      </label>
      <span class="status-text" :class="nna.status">
        {{ nna.pie_status_display || (nna.status === 'active' ? 'Activo' : 'Suspendido') }}
      </span>
    </td>
    <td>
      <span class="session-date">{{ formatLastSession(nna.last_session) }}</span>
    </td>
    <td class="actions-cell">
      <div class="actions-buttons">
        <!-- ğŸ†• BOTÃ“N VIEW ACTUALIZADO PARA NAVEGAR AL PERFIL -->
        <button 
          @click="verPerfilNino" 
          class="action-btn view-btn"
          :title="`Ver perfil completo de ${nna.first_name}`"
        >
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
          </svg>
        </button>
        <button 
          @click="handleEdit" 
          class="action-btn edit-btn"
          title="Editar"
        >
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
          </svg>
        </button>
      </div>
    </td>
  </tr>
</template>

<script setup lang="ts">
/**
 * TablaDesktopRow.vue - ACTUALIZADO CON SOPORTE PARA IMAGEN
 * 
 * Componente que representa UNA FILA de la tabla desktop.
 * âœ¨ NUEVA: Ahora muestra foto del NNA si estÃ¡ disponible
 * 
 * IMPORTANTE: Este componente ya es un <tr>, no lo envuelvas en otro <tr>
 * Se usa dentro de un v-for en TablaFiltro.vue
 * 
 * ğŸ†• NUEVA FUNCIONALIDAD: 
 * - Click en nombre o botÃ³n view navega al perfil del niÃ±o
 * - Avatar muestra foto si estÃ¡ disponible (con fallback a iniciales)
 */

import { useRouter } from 'vue-router'
import { computed, ref, watch } from 'vue'

// Inicializar router
const router = useRouter()

// ============================================================================
// INTERFACE
// ============================================================================

interface NnaData {
  id: number | string
  first_name: string
  last_name: string
  birth_date: string
  current_grade: string
  status: 'active' | 'suspended'
  last_session: string
  rut?: string
  full_name?: string
  commune_name?: string
  region_name?: string
  address?: string
  autism_level?: string
  school_journey?: string
  created_at?: string
  pie_status_display?: string
  attended_where_name?: string
  usuarios_count?: number
  autism_level_value?: string
  photo_url?: string  // âœ¨ NUEVO: URL de la foto
  has_photo?: boolean // âœ¨ NUEVO: Indicador de foto
}

// ============================================================================
// PROPS & EMITS
// ============================================================================

const props = defineProps<{
  nna: NnaData
}>()

const emit = defineEmits<{
  view: [nna: NnaData]
  edit: [nna: NnaData]
  toggle: [nna: NnaData, newStatus: 'active' | 'suspended']
}>()

// ============================================================================
// STATE
// ============================================================================

const avatarKey = ref(0)
const imageLoaded = ref(false)

// ============================================================================
// COMPUTED
// ============================================================================

/**
 * Construir URL de la foto con timestamp para evitar cachÃ©
 * - Si no hay photo_url, devuelve null
 * - Si es URL relativa, la convierte a absoluta
 * - Agrega timestamp para forzar actualizaciÃ³n
 */
const photoUrl = computed(() => {
  if (!props.nna?.photo_url) {
    return null
  }

  try {
    let fullUrl = props.nna.photo_url

    // Convertir URL relativa a absoluta
    if (!fullUrl.startsWith('http')) {
      const baseURL = import.meta.env.VITE_API_BASE_URL || 'http://127.0.0.1:8000'
      fullUrl = `${baseURL.replace('/api', '')}${fullUrl}`
    }

    // Agregar timestamp para evitar cachÃ©
    const timestamp = Date.now()
    const finalUrl = `${fullUrl}?t=${timestamp}`

    console.log('[TablaDesktopRow] ğŸ“· URL de foto construida:', {
      nnaId: props.nna.id,
      original: props.nna.photo_url,
      final: finalUrl
    })

    return finalUrl
  } catch (error) {
    console.error('[TablaDesktopRow] âŒ Error construyendo URL:', error)
    return null
  }
})

// ============================================================================
// METHODS
// ============================================================================

/**
 * Navegar al perfil del niÃ±o
 */
const verPerfilNino = () => {
  console.log(`[TablaDesktopRow] ğŸ”„ Navegando al perfil del niÃ±o ID: ${props.nna.id}`)
  
  // Usar la ruta 'perfil-nino'
  router.push({ 
    name: 'perfil-nino',
    params: { id: props.nna.id.toString() }
  })
  
  // TambiÃ©n emitimos el evento view por compatibilidad
  emit('view', props.nna)
}

/**
 * Manejar error al cargar la imagen
 */
const handleImageError = (event: Event) => {
  console.error('[TablaDesktopRow] âŒ Error cargando imagen para NNA:', props.nna?.id, event)
  imageLoaded.value = false
}

/**
 * Manejar carga exitosa de imagen
 */
const handleImageLoad = () => {
  console.log('[TablaDesktopRow] âœ… Imagen cargada exitosamente para NNA:', props.nna?.id)
  imageLoaded.value = true
}

/**
 * Obtener iniciales del nombre
 */
const getInitials = (firstName: string, lastName: string) => {
  return `${firstName.charAt(0)}${lastName.charAt(0)}`.toUpperCase()
}

/**
 * Calcular edad a partir de fecha de nacimiento
 */
const calculateAge = (birthDate: string): number => {
  if (!birthDate) return 0
  
  const today = new Date()
  const birth = new Date(birthDate)
  let age = today.getFullYear() - birth.getFullYear()
  const monthDiff = today.getMonth() - birth.getMonth()
  
  if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
    age--
  }
  
  return age
}

/**
 * Formatear fecha de Ãºltima sesiÃ³n
 */
const formatLastSession = (date: string): string => {
  if (!date) return 'Nunca'
  
  const sessionDate = new Date(date)
  const today = new Date()
  const yesterday = new Date(today)
  yesterday.setDate(yesterday.getDate() - 1)
  
  if (sessionDate.toDateString() === today.toDateString()) {
    return 'Hoy'
  } else if (sessionDate.toDateString() === yesterday.toDateString()) {
    return 'Ayer'
  } else {
    return sessionDate.toLocaleDateString('es-CL', { 
      day: '2-digit', 
      month: '2-digit', 
      year: 'numeric' 
    })
  }
}

/**
 * Manejadores de eventos
 */
const handleToggleStatus = () => {
  const newStatus = props.nna.status === 'active' ? 'suspended' : 'active'
  emit('toggle', props.nna, newStatus)
}

const handleEdit = () => {
  emit('edit', props.nna)
}

// ============================================================================
// WATCHERS
// ============================================================================

// Detectar cambios en la foto
watch(
  () => props.nna?.photo_url,
  (newUrl, oldUrl) => {
    if (newUrl !== oldUrl) {
      console.log('[TablaDesktopRow] ğŸ”„ Foto cambiÃ³:', { old: oldUrl, new: newUrl })
      avatarKey.value++
      imageLoaded.value = false
    }
  }
)

// Detectar cambios en el NNA
watch(
  () => props.nna?.id,
  (newId, oldId) => {
    if (newId !== oldId) {
      console.log('[TablaDesktopRow] ğŸ”„ NNA cambiÃ³:', { old: oldId, new: newId })
      avatarKey.value++
      imageLoaded.value = false
    }
  }
)
</script>

<style scoped>
/* ========================================================================== */
/* LAYOUT PRINCIPAL                                                          */
/* ========================================================================== */

.data-row {
  transition: background 0.2s;
}

.data-row:hover {
  background: #f9fafb;
}

.name-cell {
  font-weight: 500;
}

.name-wrapper {
  display: flex;
  align-items: center;
  gap: 0.75rem;
}

/* ========================================================================== */
/* AVATAR CON IMAGEN                                                         */
/* ========================================================================== */

.avatar {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.75rem;
  font-weight: 600;
  flex-shrink: 0;
  overflow: hidden;
  border: 2px solid #e2e8f0;
  transition: all 0.2s ease;
}

.avatar:hover {
  border-color: #cbd5e1;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.avatar-image {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
}

.avatar-initials {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 100%;
  height: 100%;
}

/* ========================================================================== */
/* DETALLES DEL NOMBRE                                                       */
/* ========================================================================== */

.name-details {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
}

.name {
  font-weight: 500;
  color: #1f2937;
}

.clickable-name {
  cursor: pointer;
  transition: all 0.2s ease;
  padding: 0.125rem 0.25rem;
  border-radius: 4px;
  display: inline-block;
}

.clickable-name:hover {
  color: #3b82f6;
  background-color: #f0f9ff;
  text-decoration: underline;
  transform: translateY(-1px);
}

.clickable-name:active {
  transform: translateY(0);
}

.rut {
  font-size: 0.75rem;
  color: #6b7280;
}

/* ========================================================================== */
/* INFORMACIÃ“N ADICIONAL                                                     */
/* ========================================================================== */

.commune-info {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
}

.autism-level {
  font-size: 0.75rem;
  color: #7c3aed;
  background: #f3f4f6;
  padding: 0.125rem 0.5rem;
  border-radius: 4px;
  display: inline-block;
  max-width: fit-content;
}

.age-badge {
  display: inline-block;
  padding: 0.25rem 0.625rem;
  background: #e0e7ff;
  color: #3730a3;
  border-radius: 6px;
  font-size: 0.75rem;
  font-weight: 500;
}

/* ========================================================================== */
/* TOGGLE SWITCH                                                             */
/* ========================================================================== */

.toggle-switch {
  position: relative;
  display: inline-block;
  width: 56px;
  height: 28px;
  margin-right: 0.75rem;
  vertical-align: middle;
}

.toggle-input {
  opacity: 0;
  width: 0;
  height: 0;
  position: absolute;
}

.toggle-slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: #d1d5db;
  transition: .4s;
  border-radius: 34px;
}

.toggle-slider:before {
  position: absolute;
  content: "";
  height: 20px;
  width: 20px;
  left: 4px;
  bottom: 4px;
  background-color: white;
  transition: .4s;
  border-radius: 50%;
}

.toggle-input:checked + .toggle-slider {
  background-color: #10b981;
}

.toggle-input:checked + .toggle-slider:before {
  transform: translateX(28px);
}

.toggle-active .toggle-slider {
  background-color: #10b981;
}

.toggle-inactive .toggle-slider {
  background-color: #d1d5db;
}

.status-text {
  font-size: 0.75rem;
  font-weight: 500;
}

.status-text.active {
  color: #10b981;
}

.status-text.suspended {
  color: #6b7280;
}

/* ========================================================================== */
/* SESIÃ“N                                                                    */
/* ========================================================================== */

.session-date {
  font-size: 0.875rem;
  color: #6b7280;
}

/* ========================================================================== */
/* ACCIONES                                                                  */
/* ========================================================================== */

.actions-cell {
  text-align: center;
}

.actions-buttons {
  display: flex;
  gap: 0.5rem;
  justify-content: center;
}

.action-btn {
  padding: 0.5rem;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  justify-content: center;
}

.action-btn:hover {
  transform: translateY(-1px);
}

.view-btn {
  background: #dbeafe;
  color: #1e40af;
}

.view-btn:hover {
  background: #bfdbfe;
  box-shadow: 0 2px 4px rgba(59, 130, 246, 0.3);
}

.edit-btn {
  background: #fef3c7;
  color: #d97706;
}

.edit-btn:hover {
  background: #fde68a;
  box-shadow: 0 2px 4px rgba(217, 119, 6, 0.3);
}

/* ========================================================================== */
/* ACCESIBILIDAD                                                             */
/* ========================================================================== */

.clickable-name:focus-visible,
.action-btn:focus-visible {
  outline: 2px solid #3b82f6;
  outline-offset: 2px;
}

/* ========================================================================== */
/* RESPONSIVE                                                                */
/* ========================================================================== */

@media (max-width: 768px) {
  .clickable-name {
    padding: 0.25rem 0.5rem;
  }
  
  .name-wrapper {
    gap: 0.5rem;
  }
  
  .avatar {
    width: 32px;
    height: 32px;
    font-size: 0.7rem;
  }
}
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\ninos\SubComponentes\TablaMobileCard.vue
============================================================
<template>
  <div class="nna-card">
    <div class="card-header">
      <div class="card-avatar-section">
        <div class="avatar-large">{{ getInitials(nna.first_name, nna.last_name) }}</div>
        <div class="card-info">
          <h3
            class="card-name clickable-name"
            @click="verPerfilNino"
            :title="`Ver perfil de ${nna.first_name} ${nna.last_name}`"
          >
            {{ nna.first_name }} {{ nna.last_name }}
          </h3>
          <p class="card-age">{{ calculateAge(nna.birth_date) }} aÃ±os</p>
        </div>
      </div>
      <div class="card-status">
        <label
          :class="[
            'toggle-switch',
            nna.status === 'active' ? 'toggle-active' : 'toggle-inactive'
          ]"
        >
          <input
            type="checkbox"
            :checked="nna.status === 'active'"
            @change="handleToggleStatus"
            class="toggle-input"
          />
          <span class="toggle-slider"></span>
        </label>
        <span class="status-text" :class="nna.status">
          {{ nna.status === 'active' ? 'Activo' : 'Suspendido' }}
        </span>
      </div>
    </div>

    <div class="card-body">
      <div class="card-detail">
        <span class="detail-label">Ãšltima SesiÃ³n:</span>
        <span class="detail-value">{{ formatLastSession(nna.last_session) }}</span>
      </div>
      <div class="card-detail">
        <span class="detail-label">Grado:</span>
        <span class="detail-value">
          <span class="grade-badge">{{ nna.current_grade }}</span>
        </span>
      </div>
       <div class="card-detail" v-if="nna.rut">
        <span class="detail-label">RUT:</span>
        <span class="detail-value">{{ nna.rut }}</span>
      </div>
       <div class="card-detail" v-if="nna.commune_name">
        <span class="detail-label">Comuna:</span>
        <span class="detail-value">{{ nna.commune_name }}</span>
      </div>
    </div>

    <div class="card-actions">
      <button @click="verPerfilNino" class="card-action-btn view">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
        </svg>
        Ver Perfil
      </button>
      <button @click="handleEdit" class="card-action-btn edit">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
        </svg>
        Editar
      </button>
    </div>
  </div>
</template>

<script setup lang="ts">
import { defineProps, defineEmits } from 'vue';
import { useRouter } from 'vue-router'; // âœ… Import useRouter

// âœ… Initialize router
const router = useRouter();

// Interface defines the data expected for each child card
interface NnaData {
  id: number | string;
  first_name: string;
  last_name: string;
  birth_date: string;
  current_grade: string;
  status: 'active' | 'suspended';
  last_session: string;
  rut?: string; // Optional field
  commune_name?: string; // Optional field
}

// Define component props
const props = defineProps<{
  nna: NnaData; // Expects an 'nna' object matching the NnaData interface
}>();

// Define events the component can emit
const emit = defineEmits<{
  (e: 'view', nna: NnaData): void;       // Emitted when view profile is triggered
  (e: 'edit', nna: NnaData): void;       // Emitted when edit button is clicked
  (e: 'toggle', nna: NnaData, newStatus: 'active' | 'suspended'): void; // Emitted when status toggle changes
}>();

// --- Helper Functions ---

// Get initials from first and last name
const getInitials = (firstName: string = '', lastName: string = ''): string => {
  const firstInitial = firstName ? firstName.charAt(0) : '';
  const lastInitial = lastName ? lastName.charAt(0) : '';
  return `${firstInitial}${lastInitial}`.toUpperCase();
};

// Calculate age based on birth date
const calculateAge = (birthDate: string): number | string => {
  if (!birthDate) return '?'; // Return placeholder if no date
  try {
    const today = new Date();
    const birth = new Date(birthDate);
    let age = today.getFullYear() - birth.getFullYear();
    const monthDiff = today.getMonth() - birth.getMonth();

    if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
      age--;
    }
    return age >= 0 ? age : '?'; // Ensure age is not negative
  } catch (e) {
    console.error("Error calculating age:", e);
    return '?'; // Return placeholder on error
  }
};

// Format the date of the last session
const formatLastSession = (date: string | null | undefined): string => {
  if (!date) return 'Nunca';

  try {
    const sessionDate = new Date(date);
    // Check if the date is valid
    if (isNaN(sessionDate.getTime())) return 'Fecha invÃ¡lida';

    const today = new Date();
    const yesterday = new Date(today);
    yesterday.setDate(yesterday.getDate() - 1);

    // Clear time part for accurate date comparison
    sessionDate.setHours(0, 0, 0, 0);
    today.setHours(0, 0, 0, 0);
    yesterday.setHours(0, 0, 0, 0);


    if (sessionDate.getTime() === today.getTime()) {
      return 'Hoy';
    } else if (sessionDate.getTime() === yesterday.getTime()) {
      return 'Ayer';
    } else {
      // Format as DD/MM/YYYY for es-CL locale
      return sessionDate.toLocaleDateString('es-CL', {
        day: '2-digit',
        month: '2-digit',
        year: 'numeric'
      });
    }
  } catch (e) {
     console.error("Error formatting last session date:", e);
     return 'Fecha invÃ¡lida';
  }
};

// --- Event Handlers ---

// Handles the toggle switch change event
const handleToggleStatus = () => {
  const newStatus = props.nna.status === 'active' ? 'suspended' : 'active';
  console.log(`ğŸ“± Toggling status for ${props.nna.id} to ${newStatus}`);
  emit('toggle', props.nna, newStatus); // Emit event to parent
};

// âœ… UPDATED: Navigates to the child's profile page
const verPerfilNino = () => {
  console.log(`ğŸ“± Navigating to profile for child ID: ${props.nna.id} from mobile card`);
  // Use Vue Router to navigate to the child's profile summary page
  router.push({
    name: 'perfil-nino-resumen', // Ensure this route name matches your router config
    params: { id: props.nna.id.toString() } // Pass child ID as parameter
  });
  // Optionally emit 'view' event if the parent component needs to know
  emit('view', props.nna);
};

// Handles the edit button click event
const handleEdit = () => {
  console.log(`ğŸ“± Edit requested for child ID: ${props.nna.id}`);
  emit('edit', props.nna); // Emit event to parent
};
</script>

<style scoped>
/* Scoped styles for the mobile card component */
.nna-card {
  background: white;
  border: 1px solid #e5e7eb; /* gray-200 */
  border-radius: 8px;
  padding: 1.25rem; /* p-5 */
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05); /* shadow-sm */
  transition: box-shadow 0.2s ease-in-out;
}
.nna-card:hover {
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); /* shadow-md */
}

.card-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start; /* Align items to the top */
  margin-bottom: 1rem; /* mb-4 */
}

.card-avatar-section {
  display: flex;
  align-items: center;
  gap: 0.75rem; /* gap-3 */
}

.avatar-large {
  width: 48px; /* w-12 */
  height: 48px; /* h-12 */
  border-radius: 9999px; /* rounded-full */
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); /* Example gradient */
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.875rem; /* text-sm */
  font-weight: 600; /* font-semibold */
  flex-shrink: 0;
}

.card-info {
  display: flex;
  flex-direction: column;
}

.card-name {
  font-weight: 600; /* font-semibold */
  color: #1f2937; /* gray-800 */
  margin: 0;
  line-height: 1.25; /* Add line-height for better spacing */
}

/* Style for clickable name */
.clickable-name {
  cursor: pointer;
  transition: all 0.2s ease;
  padding: 0.125rem 0.25rem;
  margin: -0.125rem -0.25rem; /* Negative margin to maintain layout */
  border-radius: 4px;
  display: inline-block; /* Make it behave like inline text */
}
.clickable-name:hover {
  color: #3b82f6; /* blue-600 */
  background-color: #eff6ff; /* blue-50 */
  text-decoration: underline;
}


.card-age {
  font-size: 0.875rem; /* text-sm */
  color: #6b7280; /* gray-500 */
  margin: 0;
  margin-top: 0.125rem; /* Add small top margin */
}

.card-status {
  display: flex;
  flex-direction: column;
  align-items: flex-end; /* Align toggle and text to the right */
  gap: 0.25rem; /* gap-1 */
  flex-shrink: 0; /* Prevent status section from shrinking */
  padding-left: 0.5rem; /* Add some space from info */
}

.card-body {
  display: flex;
  flex-direction: column;
  gap: 0.75rem; /* gap-3 */
  margin-bottom: 1rem; /* mb-4 */
  border-top: 1px solid #f3f4f6; /* gray-100 */
  padding-top: 1rem; /* pt-4 */
}

.card-detail {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.detail-label {
  font-size: 0.875rem; /* text-sm */
  color: #6b7280; /* gray-500 */
}

.detail-value {
  font-size: 0.875rem; /* text-sm */
  color: #1f2937; /* gray-800 */
  font-weight: 500; /* font-medium */
  text-align: right;
}

.grade-badge {
  display: inline-block;
  padding: 0.25rem 0.625rem; /* px-2.5 py-1 */
  background: #e0e7ff; /* indigo-100 */
  color: #4338ca;    /* indigo-800 */
  border-radius: 6px; /* rounded-md */
  font-size: 0.75rem; /* text-xs */
  font-weight: 500; /* font-medium */
}

.card-actions {
  display: flex;
  gap: 0.5rem; /* gap-2 */
  justify-content: space-between; /* Space buttons evenly */
  border-top: 1px solid #f3f4f6; /* gray-100 */
  padding-top: 1rem; /* pt-4 */
}

.card-action-btn {
  flex: 1; /* Make buttons take equal width */
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem; /* gap-2 */
  padding: 0.5rem 0.75rem; /* py-2 px-3 */
  border: 1px solid transparent;
  border-radius: 6px; /* rounded-md */
  font-size: 0.75rem; /* text-xs */
  font-weight: 500; /* font-medium */
  cursor: pointer;
  transition: all 0.2s ease-in-out;
}

.card-action-btn:hover {
  transform: translateY(-1px);
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
}
.card-action-btn:active {
    transform: translateY(0);
}

.card-action-btn.view {
  background: #dbeafe; /* blue-100 */
  color: #1e40af;    /* blue-800 */
  border-color: #bfdbfe; /* blue-200 */
}
.card-action-btn.view:hover {
    background-color: #bfdbfe; /* blue-200 */
}


.card-action-btn.edit {
  background: #fef3c7; /* amber-100 */
  color: #b45309;    /* amber-700 */
   border-color: #fde68a; /* amber-200 */
}
.card-action-btn.edit:hover {
     background-color: #fde68a; /* amber-200 */
}


/* --- Toggle Switch Styles --- */
.toggle-switch {
  position: relative;
  display: inline-block;
  width: 44px; /* Slightly smaller */
  height: 24px;
  vertical-align: middle;
}

.toggle-input {
  opacity: 0;
  width: 0;
  height: 0;
  position: absolute;
}

.toggle-slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: #d1d5db; /* gray-300 */
  transition: .4s;
  border-radius: 34px; /* rounded-full */
}

.toggle-slider:before {
  position: absolute;
  content: "";
  height: 18px; /* Slightly smaller */
  width: 18px;
  left: 3px;
  bottom: 3px;
  background-color: white;
  transition: .4s;
  border-radius: 50%; /* rounded-full */
  box-shadow: 0 1px 2px rgba(0,0,0,0.1);
}

.toggle-input:checked + .toggle-slider {
  background-color: #10b981; /* green-500 */
}

.toggle-input:checked + .toggle-slider:before {
  transform: translateX(20px); /* Adjust translation distance */
}

/* Focus styles for accessibility */
.toggle-input:focus-visible + .toggle-slider {
  box-shadow: 0 0 0 2px #ffffff, 0 0 0 4px #3b82f6; /* blue-500 ring */
}

.toggle-active .toggle-slider { background-color: #10b981; } /* green-500 */
.toggle-inactive .toggle-slider { background-color: #d1d5db; } /* gray-300 */

.status-text {
  font-size: 0.75rem; /* text-xs */
  font-weight: 500; /* font-medium */
}

.status-text.active { color: #059669; } /* green-600 */
.status-text.suspended { color: #6b7280; } /* gray-500 */
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\ninos\TablaFiltro.vue
============================================================
<template>
  <div class="tabla-filtro-container">
    <!-- SecciÃ³n de BÃºsqueda -->
<BusquedaFiltros
  v-model:search-query="searchQuery"
  v-model:filter-status="filterStatus"    
  v-model:filter-grade="filterGrade"
  @clear-filters="clearAllFilters"        
/>

    <!-- InformaciÃ³n de resultados -->
    <div class="results-info">
      <p class="results-text">
        Mostrando <span class="font-semibold">{{ filteredData.length }}</span>
        de <span class="font-semibold">{{ props.data.length }}</span> registros
        <span v-if="searchQuery" class="filtered-badge">Filtrado</span>
      </p>
    </div>

    <!-- Debug: Mostrar datos crudos -->
    <div v-if="showDebug" class="debug-section">
      <details>
        <summary class="debug-toggle">ğŸ“Š Datos Debug ({{ props.data.length }} registros)</summary>
        <pre class="debug-data">{{ JSON.stringify(props.data, null, 2) }}</pre>
      </details>
    </div>

    <!-- Tabla Desktop -->
    <div class="table-wrapper desktop-table" v-show="!isMobile">
      <table class="nna-table">
        <thead>
          <tr>
            <th @click="sortBy('first_name')" class="sortable">
              <div class="th-content">
                Nombre
                <span class="sort-icon">{{ getSortIcon('first_name') }}</span>
              </div>
            </th>
            <th>InformaciÃ³n</th>
            <th @click="sortBy('age')" class="sortable">
              <div class="th-content">
                Edad
                <span class="sort-icon">{{ getSortIcon('age') }}</span>
              </div>
            </th>
            <th>Estado</th>
            <th @click="sortBy('last_session')" class="sortable">
              <div class="th-content">
                Ãšltima SesiÃ³n
                <span class="sort-icon">{{ getSortIcon('last_session') }}</span>
              </div>
            </th>
            <th class="actions-column">Acciones</th>
          </tr>
        </thead>
        <tbody>
          <!-- 
            ESTADO DE CARGA
            Muestra un spinner mientras los datos estÃ¡n cargando
          -->
          <tr v-if="loading" class="loading-row">
            <td colspan="6">
              <div class="loading-container">
                <div class="spinner"></div>
                <span>Cargando datos...</span>
              </div>
            </td>
          </tr>

          <!-- 
            ESTADO VACÃO
            Muestra mensaje cuando no hay datos para mostrar
          -->
          <tr v-else-if="filteredData.length === 0" class="empty-row">
            <td colspan="6">
              <div class="empty-state">
                <p class="empty-title">No se encontraron registros</p>
                <p class="empty-subtitle">
                  {{ searchQuery ? 'Intenta ajustar la bÃºsqueda' : 'Agrega tu primer NNA para comenzar' }}
                </p>
              </div>
            </td>
          </tr>

          <!-- 
            âœ… CORRECCIÃ“N DEL PROBLEMA DE DUPLICACIÃ“N
            
            PROBLEMA ORIGINAL:
            Antes, el cÃ³digo tenÃ­a:
            <TablaDesktopRow v-else v-for="..." />
            
            Esto causaba que Vue manejara incorrectamente la combinaciÃ³n de v-else + v-for
            en el mismo elemento, resultando en renderizado mÃºltiple de los datos.
            
            SOLUCIÃ“N:
            Usar <template> como contenedor para v-else, y luego aplicar v-for
            al componente TablaDesktopRow. El <template> no genera elementos HTML,
            solo actÃºa como contenedor lÃ³gico para las directivas de Vue.
            
            RESULTADO:
            - Cada NNA se renderiza EXACTAMENTE UNA VEZ
            - La estructura del DOM queda limpia (solo los <tr> de TablaDesktopRow)
            - Vue maneja correctamente la lÃ³gica condicional y el loop
          -->
          <template v-else>
            <TablaDesktopRow
              v-for="nna in filteredData"
              :key="nna.id"
              :nna="nna"
              @view="handleView"
              @edit="handleEdit"
              @toggle="handleToggleStatus"
            />
          </template>
        </tbody>
      </table>
    </div>

    <!-- Cards Mobile -->
    <div class="mobile-cards" v-show="isMobile">
      <div v-if="loading" class="loading-container mobile-loading">
        <div class="spinner"></div>
        <span>Cargando datos...</span>
      </div>

      <div v-else-if="filteredData.length === 0" class="empty-state mobile-empty">
        <p class="empty-title">No se encontraron registros</p>
        <p class="empty-subtitle">
          {{ searchQuery ? 'Intenta ajustar la bÃºsqueda' : 'Agrega tu primer NNA' }}
        </p>
      </div>

      <!-- 
        NOTA: En la versiÃ³n mobile tambiÃ©n aplicamos <template>
        para mantener consistencia y buenas prÃ¡cticas
      -->
      <template v-else>
        <TablaMobileCard
          v-for="nna in filteredData"
          :key="nna.id"
          :nna="nna"
          @view="handleView"
          @edit="handleEdit"
          @toggle="handleToggleStatus"
        />
      </template>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, computed, onMounted, onUnmounted } from 'vue'
import TablaDesktopRow from './SubComponentes/TablaDesktopRow.vue'
import TablaMobileCard from './SubComponentes/TablaMobileCard.vue' 
import BusquedaFiltros from './SubComponentes/BusquedaFiltros.vue'

// ============================================
// INTERFACES
// ============================================
interface NnaData {
  id: number | string
  first_name: string
  last_name: string
  birth_date: string
  current_grade: string
  status: 'active' | 'suspended'
  last_session: string
  rut?: string
  full_name?: string
  commune_name?: string
  region_name?: string
  address?: string
  autism_level?: string
  school_journey?: string
  created_at?: string
  pie_status_display?: string
  attended_where_name?: string
  usuarios_count?: number
  autism_level_value?: string
}

// ============================================
// PROPS & EMITS
// ============================================
/**
 * Props recibidas desde el componente padre (IngresoNneDashboard)
 * - data: Array de NNA que viene del backend
 * - loading: Estado de carga para mostrar spinner
 */
const props = defineProps<{
  data: NnaData[]
  loading?: boolean
}>()

/**
 * Eventos que se emiten hacia el componente padre
 * - view: Cuando se hace clic en ver detalles
 * - edit: Cuando se hace clic en editar
 * - toggle: Cuando se cambia el estado activo/suspendido
 */
const emit = defineEmits<{
  view: [nna: NnaData]
  edit: [nna: NnaData]
  toggle: [nna: NnaData, newStatus: 'active' | 'suspended']
}>()

// ============================================
// ESTADO LOCAL
// ============================================
const searchQuery = ref('')
const filterStatus = ref('')  // ğŸ‘ˆ AGREGAR ESTA LÃNEA
const filterGrade = ref('')   // ğŸ‘ˆ AGREGAR ESTA LÃNEA
const sortColumn = ref<keyof NnaData | 'age' | ''>('')
const sortDirection = ref<'asc' | 'desc'>('asc')
const showDebug = ref(false)

// ============================================
// RESPONSIVE: DETECTAR MOBILE
// ============================================
const isMobile = ref(window.innerWidth < 768)
const handleResize = () => {
  isMobile.value = window.innerWidth < 768
}
onMounted(() => window.addEventListener('resize', handleResize))
onUnmounted(() => window.removeEventListener('resize', handleResize))

// ============================================
// COMPUTED: FILTRADO Y ORDENAMIENTO
// ============================================
/**
 * Computed que procesa los datos para:
 * 1. Aplicar bÃºsqueda por texto
 * 2. Ordenar por columna seleccionada
 * 
 * Este computed es REACTIVO, por lo que cada vez que:
 * - props.data cambia (nuevos datos del backend)
 * - searchQuery cambia (el usuario busca)
 * - sortColumn/sortDirection cambian (el usuario ordena)
 * 
 * Se recalcula automÃ¡ticamente y actualiza la tabla
 */
const filteredData = computed(() => {
  let result = [...props.data]

  // FILTRO DE BÃšSQUEDA
  if (searchQuery.value) {
    const query = searchQuery.value.toLowerCase()
    result = result.filter(nna =>
      nna.first_name?.toLowerCase().includes(query) ||
      nna.last_name?.toLowerCase().includes(query) ||
      nna.rut?.toLowerCase().includes(query) ||
      nna.commune_name?.toLowerCase().includes(query) ||
      nna.current_grade?.toLowerCase().includes(query) ||
      nna.autism_level?.toLowerCase().includes(query)
    )
  }

  // ORDENAMIENTO
  if (sortColumn.value) {
    result.sort((a, b) => {
      let aVal: any = a[sortColumn.value as keyof NnaData]
      let bVal: any = b[sortColumn.value as keyof NnaData]

      // Caso especial: ordenar por edad calculada
      if (sortColumn.value === 'age') {
        aVal = calculateAge(a.birth_date)
        bVal = calculateAge(b.birth_date)
      }

      if (aVal < bVal) return sortDirection.value === 'asc' ? -1 : 1
      if (aVal > bVal) return sortDirection.value === 'asc' ? 1 : -1
      return 0
    })
  }

  return result
})

// ============================================
// MÃ‰TODOS
// ============================================

/**
 * Maneja el ordenamiento al hacer clic en headers de columna
 * Si ya estÃ¡ ordenando por esa columna, invierte la direcciÃ³n
 * Si es una nueva columna, inicia con orden ascendente
 */
const sortBy = (column: keyof NnaData | 'age') => {
  if (sortColumn.value === column) {
    sortDirection.value = sortDirection.value === 'asc' ? 'desc' : 'asc'
  } else {
    sortColumn.value = column
    sortDirection.value = 'asc'
  }
}

/**
 * Retorna el icono apropiado para el estado de ordenamiento
 */
const getSortIcon = (column: string) => {
  if (sortColumn.value !== column) return 'â‡…'
  return sortDirection.value === 'asc' ? 'â†‘' : 'â†“'
}

/**
 * Calcula la edad a partir de la fecha de nacimiento
 */
const calculateAge = (birthDate: string): number => {
  if (!birthDate) return 0
  const today = new Date()
  const birth = new Date(birthDate)
  let age = today.getFullYear() - birth.getFullYear()
  const monthDiff = today.getMonth() - birth.getMonth()
  if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
    age--
  }
  return age
}


// ğŸ‘‡ AGREGAR ESTA FUNCIÃ“N AQUÃ
/**
 * Limpia todos los filtros aplicados
 */
const clearAllFilters = () => {
  searchQuery.value = ''
  filterStatus.value = ''
  filterGrade.value = ''
}


/**
 * Manejadores de eventos que propagan las acciones al padre
 */
const handleToggleStatus = (nna: NnaData, newStatus: 'active' | 'suspended') => {
  emit('toggle', nna, newStatus)
}
const handleView = (nna: NnaData) => emit('view', nna)
const handleEdit = (nna: NnaData) => emit('edit', nna)
</script>

<style scoped>
.tabla-filtro-container {
  background: white;
  border-radius: 12px;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  overflow: hidden;
}

/* SecciÃ³n Debug */
.debug-section {
  padding: 1rem 1.5rem;
  background: #fef3c7;
  border-bottom: 1px solid #f59e0b;
}

.debug-toggle {
  cursor: pointer;
  font-weight: 600;
  color: #92400e;
  user-select: none;
}

.debug-data {
  margin-top: 0.5rem;
  padding: 1rem;
  background: #fffbeb;
  border: 1px solid #fbbf24;
  border-radius: 6px;
  font-size: 0.75rem;
  max-height: 300px;
  overflow: auto;
  white-space: pre-wrap;
  word-wrap: break-word;
}

/* InformaciÃ³n de resultados */
.results-info {
  padding: 1rem 1.5rem;
  background: #f9fafb;
  border-bottom: 1px solid #e5e7eb;
}

.results-text {
  font-size: 0.875rem;
  color: #6b7280;
}

.filtered-badge {
  display: inline-block;
  margin-left: 0.5rem;
  padding: 0.125rem 0.5rem;
  background: #dbeafe;
  color: #1e40af;
  border-radius: 9999px;
  font-size: 0.75rem;
  font-weight: 500;
}

/* Tabla Desktop */
.table-wrapper {
  overflow-x: auto;
}

.desktop-table {
  display: block;
}

@media (max-width: 768px) {
  .desktop-table {
    display: none;
  }
}

.nna-table {
  width: 100%;
  border-collapse: collapse;
}

.nna-table thead {
  background: #f9fafb;
}

.nna-table th {
  padding: 1rem 1.5rem;
  text-align: left;
  font-size: 0.75rem;
  font-weight: 600;
  color: #374151;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  border-bottom: 1px solid #e5e7eb;
}

.nna-table th.sortable {
  cursor: pointer;
  user-select: none;
  transition: background 0.2s;
}

.nna-table th.sortable:hover {
  background: #f3f4f6;
}

.th-content {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.sort-icon {
  font-size: 0.875rem;
  color: #9ca3af;
}

.nna-table td {
  padding: 1rem 1.5rem;
  font-size: 0.875rem;
  color: #1f2937;
  border-bottom: 1px solid #f3f4f6;
}

/* Estados de carga y vacÃ­o */
.loading-row td {
  text-align: center;
  padding: 3rem;
}

.loading-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 1rem;
  color: #6b7280;
}

.spinner {
  width: 2rem;
  height: 2rem;
  border: 2px solid #e5e7eb;
  border-top: 2px solid #3b82f6;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.empty-row td {
  text-align: center;
  padding: 3rem;
}

.empty-state {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 1rem;
  color: #6b7280;
}

.empty-icon {
  width: 4rem;
  height: 4rem;
  color: #d1d5db;
}

.empty-title {
  font-size: 1.125rem;
  font-weight: 600;
  color: #374151;
}

.empty-subtitle {
  font-size: 0.875rem;
}

/* Cards Mobile */
.mobile-cards {
  display: none;
  padding: 1rem;
  gap: 1rem;
  flex-direction: column;
}

@media (max-width: 768px) {
  .mobile-cards {
    display: flex;
  }
}

.mobile-loading,
.mobile-empty {
  padding: 2rem;
  text-align: center;
}

/* PaginaciÃ³n */
.pagination {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1.5rem;
  border-top: 1px solid #e5e7eb;
  background: #f9fafb;
}

.pagination-btn {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem 1rem;
  border: 1px solid #e5e7eb;
  border-radius: 6px;
  background: white;
  color: #374151;
  font-size: 0.875rem;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s;
}

.pagination-btn:hover:not(:disabled) {
  background: #f3f4f6;
  border-color: #d1d5db;
}

.pagination-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.pagination-numbers {
  display: flex;
  gap: 0.25rem;
}

.pagination-number {
  min-width: 2.5rem;
  height: 2.5rem;
  display: flex;
  align-items: center;
  justify-content: center;
  border: 1px solid #e5e7eb;
  border-radius: 6px;
  background: white;
  color: #374151;
  font-size: 0.875rem;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s;
}

.pagination-number:hover {
  background: #f3f4f6;
  border-color: #d1d5db;
}

.pagination-number.active {
  background: #3b82f6;
  border-color: #3b82f6;
  color: white;
}
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\ninos\toggleActivarSuspender.vue
============================================================
<template>
  <label
    :for="inputId"
    class="relative block h-8 w-14 rounded-full bg-gray-300 transition-colors [-webkit-tap-highlight-color:_transparent] cursor-pointer"
    :class="{ 'bg-green-500': modelValue, 'bg-red-400': !modelValue }"
  >
    <input 
      :id="inputId"
      type="checkbox" 
      class="peer sr-only"
      :checked="modelValue"
      @change="handleToggle"
      :disabled="disabled"
    />

    <span
      class="absolute inset-y-0 start-0 m-1 size-6 rounded-full bg-white transition-[inset-inline-start] peer-checked:start-6 shadow-md"
    ></span>
  </label>
</template>

<script setup lang="ts">
import { computed } from 'vue'

interface Props {
  modelValue: boolean
  disabled?: boolean
  ninoId?: string | number
}

interface Emits {
  (e: 'update:modelValue', value: boolean): void
  (e: 'toggle', value: boolean, ninoId?: string | number): void
}

const props = withDefaults(defineProps<Props>(), {
  disabled: false,
  modelValue: true
})

const emit = defineEmits<Emits>()

const inputId = computed(() => `toggle-${props.ninoId || Math.random().toString(36).substr(2, 9)}`)

const handleToggle = (event: Event) => {
  if (props.disabled) return
  
  const target = event.target as HTMLInputElement
  const newValue = target.checked
  
  emit('update:modelValue', newValue)
  emit('toggle', newValue, props.ninoId)
}
</script>

<style scoped>
label:has(input:disabled) {
  opacity: 0.5;
  cursor: not-allowed;
}
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\profile\header\EncabezadoConFoto.vue
============================================================
<template>
  <div class="header-content">
    <div class="nna-info">
      <div class="avatar-section">
        
        <div class="avatar-placeholder relative group" :key="avatarKey">
          
          <img
            v-if="childPhotoUrl"
            :src="childPhotoUrl"
            :alt="`Foto de ${nnaData?.first_name} ${nnaData?.last_name}`"
            class="avatar-image"
            @error="handleImageError"
            @load="handleImageLoad"
          />
          <UserIcon v-else class="icon-xl" />

          <div
            class="absolute inset-0 rounded-full bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity duration-200 flex items-center justify-center cursor-pointer"
            @click="openPhotoModal"
          >
            <PhotoUploadButton
              variant="icon"
              size="md"
              :loading="false"
              class="pointer-events-none" 
            />
          </div>
          </div>
        <div class="nna-details">
          <h1 class="nna-name">{{ nnaData?.first_name }} {{ nnaData?.last_name }}</h1>
          <div class="nna-meta">
            <span v-if="nnaData?.rut" class="meta-item">
              <IdentificationIcon class="icon-sm" />
              {{ nnaData.rut }}
            </span>
            <span v-if="nnaData?.age" class="meta-item">
              <CalendarIcon class="icon-sm" />
              {{ nnaData.age }} aÃ±os
            </span>
            <span v-if="nnaData?.grade" class="meta-item">
              <AcademicCapIcon class="icon-sm" />
              {{ nnaData.grade }}
            </span>
            <span v-if="nnaData?.autism_level" class="meta-item">
              <SparklesIcon class="icon-sm" />
              {{ nnaData.autism_level }}
            </span>
          </div>
        </div>
      </div>
    </div>
    
    <div class="header-actions">
      <button class="btn btn-secondary" @click="$emit('verDashboard')">
        <ChartBarIcon class="icon-sm" />
        Dashboard
      </button>
      <button class="btn btn-primary" @click="$emit('exportarDatos')">
        <DocumentArrowDownIcon class="icon-sm" />
        Exportar Datos
      </button>
    </div>
  </div>

  <PhotoUploadModal
    v-if="nnaData"
    v-model:visible="showPhotoModal"
    :child-id="nnaData.id || 0"
    :child-name="`${nnaData.first_name || ''} ${nnaData.last_name || ''}`"
    :current-photo-url="childPhotoUrl"
    @success="handlePhotoSuccess"
  />
</template>

<script setup lang="ts">
import { computed, ref, watch } from 'vue'
import {
  // ArrowLeftIcon (Se queda en el padre)
  UserIcon,
  IdentificationIcon,
  CalendarIcon,
  AcademicCapIcon,
  SparklesIcon,
  ChartBarIcon,
  DocumentArrowDownIcon
} from '@heroicons/vue/24/outline'

// Imports para el modal de foto
import PhotoUploadButton from '@/components/common/PhotoUploadButton.vue'
import PhotoUploadModal from '@/components/dashboard/padres/PhotoUploadModal.vue'

// Props (Los mismos que tenÃ­a el padre)
const props = defineProps<{
  nnaData?: {
    first_name?: string
    last_name?: string
    rut?: string
    age?: number
    grade?: string
    autism_level?: string
    photo_url?: string
    id?: number
  }
}>()

// Emits (Los mismos que tenÃ­a el padre)
const emit = defineEmits<{
  verDashboard: []
  exportarDatos: []
  photoUploaded: [photoUrl: string] // Evento para notificar al padre
}>()

// Estado (Toda la lÃ³gica se mueve aquÃ­)
const avatarKey = ref(0)
const imageLoaded = ref(false)
const showPhotoModal = ref(false)

const openPhotoModal = () => {
  if (!props.nnaData?.id) {
    console.error('[EncabezadoConFoto] No se puede abrir el modal, falta ID del NNA.')
    return
  }
  showPhotoModal.value = true
}

const handlePhotoSuccess = (photoUrl: string) => {
  avatarKey.value++
  emit('photoUploaded', photoUrl)
  showPhotoModal.value = false
}

/**
 * Construir URL de la imagen con timestamp para evitar cachÃ©
 */
const childPhotoUrl = computed(() => {
  if (!props.nnaData?.photo_url) {
    console.log('[EncabezadoConFoto] ğŸ“· Sin foto disponible para:', props.nnaData?.id)
    return null
  }

  let fullUrl = props.nnaData.photo_url
  
  // Convertir URL relativa a absoluta
  if (!fullUrl.startsWith('http')) {
    const baseURL = import.meta.env.VITE_API_BASE_URL || 'http://127.0.0.1:8000'
    fullUrl = `${baseURL.replace('/api', '')}${fullUrl}`
  }
  
  // Agregar timestamp para evitar cachÃ©
  const timestamp = Date.now()
  const finalUrl = `${fullUrl}?t=${timestamp}`
  
  console.log('[EncabezadoConFoto] ğŸ“· URL de foto construida:', {
    nnaId: props.nnaData?.id,
    original: props.nnaData.photo_url,
    final: finalUrl,
    hasPhoto: !!fullUrl
  })
  
  return finalUrl
})

/**
 * Manejar error al cargar la imagen
 */
const handleImageError = (event: Event) => {
  console.error('[EncabezadoConFoto] âŒ Error cargando imagen para NNA:', props.nnaData?.id, event)
  imageLoaded.value = false
}

/**
 * Manejar carga exitosa de imagen
 */
const handleImageLoad = () => {
  console.log('[EncabezadoConFoto] âœ… Imagen cargada exitosamente para NNA:', props.nnaData?.id)
  imageLoaded.value = true
}

/**
 * Watchers para detectar cambios en los datos del NNA
 */
watch(
  () => props.nnaData?.id,
  (newId, oldId) => {
    if (newId !== oldId) {
      console.log('[EncabezadoConFoto] ğŸ”„ NNA cambiÃ³:', { old: oldId, new: newId })
      avatarKey.value++
      imageLoaded.value = false
    }
  }
)

watch(
  () => props.nnaData?.photo_url,
  (newUrl, oldUrl) => {
    if (newUrl !== oldUrl) {
      console.log('[EncabezadoConFoto] ğŸ”„ Foto cambiÃ³:', { old: oldUrl, new: newUrl })
      avatarKey.value++
      imageLoaded.value = false
    }
  }
)
</script>

<style scoped>
/* Todos los estilos se mueven aquÃ­, EXCEPTO .perfil-header, .breadcrumb y .breadcrumb-link */
.header-content {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 1.5rem;
}

.avatar-section {
  display: flex;
  align-items: center;
  gap: 1.25rem; /* âœ… Aumentado de 0.875rem a 1.25rem (20px) */
}

.avatar-placeholder {
  width: 80px;   /* âœ… Aumentado de 56px a 80px */
  height: 80px;  /* âœ… Aumentado de 56px a 80px */
  border-radius: 50%;
  background: #f1f5f9;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #475569;
  border: 2px solid #e2e8f0;
  flex-shrink: 0;
  overflow: hidden;
  transition: all 0.2s ease;
  position: relative;
}

.avatar-placeholder:hover {
  border-color: #cbd5e1;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.avatar-image {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
}

.nna-name {
  font-size: 1.5rem; /* âœ… Aumentado de 1.25rem a 1.5rem (text-2xl) */
  font-weight: 700;
  color: #1e293b;
  margin: 0 0 0.375rem 0;
  line-height: 1.3;
}

.nna-details {
  display: flex;
  flex-direction: column;
  justify-content: center;
}

.nna-meta {
  display: flex;
  align-items: center;
  gap: 1rem;
  flex-wrap: wrap;
  margin: 0;
}

.meta-item {
  display: inline-flex;
  align-items: center;
  gap: 0.375rem;
  color: #64748b;
  font-size: 0.875rem; /* âœ… Aumentado de 0.75rem a 0.875rem (text-sm) */
  font-weight: 500;
  background: #f8fafc;
  padding: 0.25rem 0.5rem;
  border-radius: 6px;
  border: 1px solid #f1f5f9;
  transition: all 0.2s ease;
}

.meta-item:hover {
  background: #e2e8f0;
  border-color: #cbd5e1;
}

.header-actions {
  display: flex;
  gap: 0.75rem;
}

.btn {
  padding: 0.5rem 0.875rem;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 500;
  transition: all 0.2s;
  text-decoration: none;
  display: inline-flex;
  align-items: center;
  gap: 0.375rem;
  font-size: 0.875rem; /* âœ… Aumentado de 0.75rem a 0.875rem (text-sm) */
  white-space: nowrap;
}

.btn-primary {
  background: #3b82f6;
  color: white;
  border: 1px solid #2563eb;
}

.btn-primary:hover {
  background: #2563eb;
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(37, 99, 235, 0.4);
}

.btn-secondary {
  background: white;
  color: #475569;
  border: 1px solid #d1d5db;
}

.btn-secondary:hover {
  background: #f8fafc;
  border-color: #9ca3af;
}

/* Estilos de iconos */
.icon-xs {
  width: 0.875rem;
  height: 0.875rem;
}

.icon-sm {
  width: 1rem; /* âœ… Aumentado de 0.875rem */
  height: 1rem; /* (16px) */
}

.icon-md {
  width: 1.25rem;
  height: 1.25rem;
}

.icon-lg {
  width: 1.5rem;
  height: 1.5rem;
}

/* âœ… NUEVO: Icono extra grande para el avatar fallback */
.icon-xl {
  width: 2.5rem; /* (40px) */
  height: 2.5rem;
}

/* Estilos responsive */
@media (max-width: 768px) {
  .header-content {
    flex-direction: column;
    align-items: stretch;
    gap: 1rem;
  }
  
  .header-actions {
    width: 100%;
    justify-content: stretch;
  }
  
  .header-actions .btn {
    flex: 1;
    justify-content: center;
    padding: 0.625rem 0.75rem;
  }
  
  .nna-meta {
    gap: 0.5rem;
  }
  
  .avatar-section {
    gap: 0.75rem;
  }
  
  .avatar-placeholder {
    /* Mantenemos el tamaÃ±o responsive original, que es mÃ¡s pequeÃ±o */
    width: 48px;
    height: 48px;
  }
  
  .nna-name {
    /* Mantenemos el tamaÃ±o responsive original */
    font-size: 1.125rem;
  }
  
  /* âœ… AÃ‘ADIDO: Ajustar el icono fallback en responsive */
  .icon-xl {
    width: 1.5rem;
    height: 1.5rem;
  }
}

@media (max-width: 480px) {
  .nna-meta {
    flex-direction: column;
    align-items: flex-start;
    gap: 0.375rem;
  }
  
  .meta-item {
    width: 100%;
    justify-content: flex-start;
  }
}
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\profile\header\PerfilHeader.vue
============================================================
<template>
  <div class="perfil-header">
    <div class="breadcrumb">
      <router-link to="/ingreso-nna" class="breadcrumb-link">
        <ArrowLeftIcon class="icon-xs" />
        Volver a GestiÃ³n de NNA
      </router-link>
    </div>

    <EncabezadoConFoto
      :nnaData="props.nnaData"
      @verDashboard="$emit('verDashboard')"
      @exportarDatos="$emit('exportarDatos')"
      @photoUploaded="handlePhotoUpload"
    />
    </div>
</template>

<script setup lang="ts">
import {
  ArrowLeftIcon,
} from '@heroicons/vue/24/outline'

// âœ… --- AÃ‘ADIDO: Importar el nuevo componente --- âœ…
import EncabezadoConFoto from './EncabezadoConFoto.vue'

// Props (Se mantienen para recibir los datos)
const props = defineProps<{
  nnaData?: {
    first_name?: string
    last_name?: string
    rut?: string
    age?: number
    grade?: string
    autism_level?: string
    photo_url?: string
    id?: number
  }
}>()

// Emits (Se mantienen para "burbujear" los eventos)
const emit = defineEmits<{
  verDashboard: []
  exportarDatos: []
  photoUploaded: [photoUrl: string]
}>()

// âœ… --- AÃ‘ADIDO: Handler para el evento del hijo --- âœ…
const handlePhotoUpload = (photoUrl: string) => {
  // Notifica al componente padre (la vista) que la foto cambiÃ³
  emit('photoUploaded', photoUrl)
}

// â›”ï¸ --- LÃ“GICA ELIMINADA --- â›”ï¸
// Toda la lÃ³gica de avatarKey, imageLoaded, showPhotoModal,
// openPhotoModal, handlePhotoSuccess, childPhotoUrl,
// handleImageError, handleImageLoad, y los watchers
// han sido movidos a EncabezadoConFoto.vue
</script>

<style scoped>
/* Solo se quedan los estilos del "cascarÃ³n" */
.perfil-header {
  background: white;
  border-bottom: 1px solid #e2e8f0;
  padding: 1rem 1.5rem;
}

.breadcrumb {
  margin-bottom: 0.75rem;
}

.breadcrumb-link {
  color: #3b82f6;
  text-decoration: none;
  font-size: 0.75rem;
  display: inline-flex;
  align-items: center;
  gap: 0.375rem;
  font-weight: 500;
}

.breadcrumb-link:hover {
  text-decoration: underline;
}

/* Estilos de iconos (solo los usados aquÃ­) */
.icon-xs {
  width: 0.875rem;
  height: 0.875rem;
}

/* Estilos responsive (solo los de las clases que se quedaron) */
@media (max-width: 768px) {
  .perfil-header {
    padding: 0.875rem 1rem;
  }
}
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\profile\profile\modals\DiagnosticoModal.vue
============================================================
<template>
  <!-- Usamos el componente BaseModal como contenedor -->
  <BaseModal
    :show="show"
    title="Agregar Nuevo DiagnÃ³stico"
    size="md"
    @update:show="handleClose"
  >
    <!-- Contenido del Modal: El Formulario -->
    <form @submit.prevent="handleSubmit" id="diagnosis-form">
      <div class="space-y-4">

        <!-- Campo: DescripciÃ³n del DiagnÃ³stico -->
        <div>
          <label for="description" class="block text-sm font-medium text-gray-700 mb-1">
            DescripciÃ³n <span class="text-red-500">*</span>
          </label>
          <textarea
            id="description"
            v-model="formData.description"
            rows="3"
            required
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
            placeholder="Describe el diagnÃ³stico..."
          ></textarea>
        </div>

        <!-- Campo: Tipo de DiagnÃ³stico -->
        <div>
          <label for="diagnosis_type" class="block text-sm font-medium text-gray-700 mb-1">
            Tipo <span class="text-red-500">*</span>
          </label>
          <select
            id="diagnosis_type"
            v-model="formData.diagnosis_type"
            required
            class="w-full px-3 py-2 border border-gray-300 rounded-md bg-white focus:outline-none focus:ring-2 focus:ring-blue-500"
          >
            <option value="" disabled>Selecciona un tipo</option>
            <option value="primary">Primario</option>
            <option value="secondary">Secundario</option>
            <option value="comorbidity">Comorbilidad</option>
            <!-- Puedes aÃ±adir mÃ¡s opciones si las tienes en tu modelo -->
          </select>
        </div>

        <!-- Campo: Fecha del DiagnÃ³stico -->
        <div>
          <label for="diagnosis_date" class="block text-sm font-medium text-gray-700 mb-1">
            Fecha del DiagnÃ³stico <span class="text-red-500">*</span>
          </label>
          <input
            type="date"
            id="diagnosis_date"
            v-model="formData.diagnosis_date"
            required
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
          />
        </div>

        <!-- Campo: CÃ³digo CIE-10 (Opcional) -->
        <div>
          <label for="cie10_code" class="block text-sm font-medium text-gray-700 mb-1">
            CÃ³digo CIE-10 (Opcional)
          </label>
          <input
            type="text"
            id="cie10_code"
            v-model="formData.cie10_code"
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
            placeholder="Ej: F84.0"
          />
        </div>

        <!-- Campo: Severidad (Opcional) -->
        <div>
          <label for="severity" class="block text-sm font-medium text-gray-700 mb-1">
            Severidad (Opcional)
          </label>
          <input
            type="text"
            id="severity"
            v-model="formData.severity"
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
            placeholder="Ej: Leve, Moderado, Severo"
          />
        </div>

        <!-- Campo: Observaciones (Opcional) - CORREGIDO -->
        <div>
          <label for="observations" class="block text-sm font-medium text-gray-700 mb-1">
            Observaciones (Opcional)
          </label>
          <textarea
            id="observations"
            v-model="formData.observations"
            rows="2"
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
            placeholder="AÃ±ade cualquier observaciÃ³n relevante..."
          ></textarea>
        </div>

        <!-- Mensaje de Error (si ocurre) -->
        <div v-if="errorMessage" class="p-3 bg-red-100 text-red-700 rounded-md text-sm">
          {{ errorMessage }}
        </div>

      </div>
    </form> <!-- Fin del <form> -->

    <!-- Footer del Modal: Botones de AcciÃ³n (Hijo directo de BaseModal) -->
    <template #footer>
      <div class="flex justify-end space-x-3">
        <button
          type="button"
          @click="handleClose"
          class="px-4 py-2 bg-white border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
        >
          Cancelar
        </button>
        <button
          type="button"
          @click="handleSubmit"
          :disabled="isSubmitting"
          class="px-4 py-2 bg-blue-600 border border-transparent rounded-md text-sm font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50"
        >
          {{ isSubmitting ? 'Guardando...' : 'Guardar DiagnÃ³stico' }}
        </button>
      </div>
    </template>
  </BaseModal>
</template>

<script setup lang="ts">
import { ref } from 'vue';
import BaseModal from '@/components/modal/BaseModal.vue'; // Importa el modal base
import {
  createDiagnosisForChild,
  type CreateDiagnosisPayload // AsegÃºrate que esta interfaz incluya cie10_code y observations
} from '@/services/sessionService'; // O diagnosisService si lo separaste

// --- Props ---
// Recibe 'show' para controlar la visibilidad (v-model)
// Recibe 'childId' para saber a quÃ© niÃ±o asociar el diagnÃ³stico
const props = defineProps<{
  show: boolean;
  childId: number;
}>();

// --- Emits ---
// Emite 'update:show' para cerrar el modal (v-model)
// Emite 'diagnosis-created' cuando el diagnÃ³stico se guarda exitosamente
const emit = defineEmits<{
  (e: 'update:show', value: boolean): void;
  (e: 'diagnosis-created'): void;
}>();

// --- Estado del Componente ---
// Estado para controlar si se estÃ¡ enviando el formulario
const isSubmitting = ref(false);
// Estado para almacenar mensajes de error
const errorMessage = ref<string | null>(null);
// Estado reactivo para almacenar los datos del formulario
// AsegÃºrate que tu interfaz CreateDiagnosisPayload incluya los campos opcionales
const formData = ref<CreateDiagnosisPayload>({
  description: '',
  diagnosis_type: '',
  diagnosis_date: '',
  cie10_code: '', // Campo aÃ±adido
  severity: '',
  observations: '', // Campo aÃ±adido/corregido
  is_active: true // Por defecto, marcar como activo
});

// --- MÃ©todos ---

/**
 * Maneja el cierre del modal.
 * Emite el evento para actualizar 'show' en el componente padre.
 */
const handleClose = () => {
  if (!isSubmitting.value) { // No permitir cerrar si estÃ¡ enviando
    emit('update:show', false);
    resetForm(); // Limpia el formulario al cerrar
  }
};

/**
 * Maneja el envÃ­o del formulario.
 * Llama a la funciÃ³n del servicio para crear el diagnÃ³stico.
 */
const handleSubmit = async () => {
  // ValidaciÃ³n bÃ¡sica de campos requeridos
  if (!formData.value.description || !formData.value.diagnosis_type || !formData.value.diagnosis_date) {
      errorMessage.value = "Por favor, completa los campos DescripciÃ³n, Tipo y Fecha.";
      return;
  }

  isSubmitting.value = true;
  errorMessage.value = null; // Limpia errores previos

  try {
    console.log('Enviando datos de diagnÃ³stico:', formData.value);
    // Llama a la funciÃ³n del servicio con el ID del niÃ±o y los datos del formulario
    await createDiagnosisForChild(props.childId, formData.value);

    console.log('DiagnÃ³stico creado exitosamente!');
    emit('diagnosis-created'); // Notifica al padre que se creÃ³
    handleClose(); // Cierra el modal automÃ¡ticamente al Ã©xito

  } catch (error: any) {
    console.error('Error al crear diagnÃ³stico:', error);
    // Muestra un mensaje de error genÃ©rico o uno especÃ­fico si la API lo devuelve
    errorMessage.value = error.response?.data?.detail || error.message || 'OcurriÃ³ un error al guardar el diagnÃ³stico.';
  } finally {
    isSubmitting.value = false; // Reactiva los botones
  }
};

/**
 * Resetea el formulario a sus valores iniciales.
 */
const resetForm = () => {
   formData.value = {
    description: '',
    diagnosis_type: '',
    diagnosis_date: '',
    cie10_code: '', // Resetear campo aÃ±adido
    severity: '',
    observations: '', // Resetear campo aÃ±adido/corregido
    is_active: true
  };
  errorMessage.value = null;
};

</script>

<style scoped>
/* Estilos adicionales si son necesarios */
.space-y-4 > :not([hidden]) ~ :not([hidden]) {
  --tw-space-y-reverse: 0;
  margin-top: calc(1rem * calc(1 - var(--tw-space-y-reverse))); /* 16px */
  margin-bottom: calc(1rem * var(--tw-space-y-reverse));
}
.text-red-500 {
  color: #ef4444; /* Rojo para indicar campos requeridos */
}
.disabled\:opacity-50:disabled {
  opacity: 0.5;
}
</style>


============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\profile\profile\modals\InteresModal.vue
============================================================
<template>
  <BaseModal
    :show="show"
    title="Agregar Nuevo InterÃ©s Principal"
    size="md"
    @update:show="handleClose"
  >
    <FormKit
      type="form"
      id="interest-form"
      v-model="formData"
      :actions="false"
      @submit="handleSubmit"
    >
      <div class="space-y-4">

        <FormKit
          type="textarea"
          name="description"
          label="DescripciÃ³n del InterÃ©s"
          placeholder="Describe el interÃ©s principal del niÃ±o..."
          validation="required"
          rows="3"
        />

        <FormKit
          type="select"
          name="category"
          label="CategorÃ­a"
          placeholder="Selecciona una categorÃ­a"
          validation="required"
          :options="categoryOptions"
        />

        <FormKit
          type="select"
          name="intensity"
          label="Intensidad"
          placeholder="Selecciona la intensidad"
          validation="required"
          :options="intensityOptions"
        />

        <FormKit
          type="textarea"
          name="therapeutic_utility"
          label="Utilidad TerapÃ©utica (Opcional)"
          placeholder="Describe cÃ³mo se puede usar este interÃ©s en terapia..."
          rows="2"
        />

        <div v-if="errorMessage" class="p-3 bg-red-100 text-red-700 rounded-md text-sm">
          {{ errorMessage }}
        </div>

      </div>
    </FormKit>

    <template #footer>
      <div class="flex justify-end space-x-3">
        <button
          type="button"
          @click="handleClose"
          class="px-4 py-2 bg-white border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
        >
          Cancelar
        </button>
        <FormKit
          type="submit"
          form="interest-form"
          :label="isSubmitting ? 'Guardando...' : 'Guardar InterÃ©s'"
          :disabled="isSubmitting"
          outer-class="!mb-0"
          input-class="px-4 py-2 bg-blue-600 border border-transparent rounded-md text-sm font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50"
        />
      </div>
    </template>
  </BaseModal>
</template>

<script setup lang="ts">
import { ref } from 'vue';
import { FormKit } from '@formkit/vue';
import BaseModal from '@/components/modal/BaseModal.vue';
import {
  createInterestForChild,
  type CreateInterestPayload
} from '@/services/sessionService';

const props = defineProps<{
  show: boolean;
  childId: number;
}>();

const emit = defineEmits<{
  (e: 'update:show', value: boolean): void;
  (e: 'interest-created'): void;
}>();

const isSubmitting = ref(false);
const errorMessage = ref<string | null>(null);
const formData = ref<CreateInterestPayload>({
  description: '',
  category: '',
  intensity: '',
  therapeutic_utility: ''
});

const categoryOptions = [
  { value: 'food', label: 'Comida' },
  { value: 'games', label: 'Juegos' },
  { value: 'music', label: 'MÃºsica' },
  { value: 'movies', label: 'PelÃ­culas' },
  { value: 'books', label: 'Libros' },
  { value: 'activities', label: 'Actividades' },
  { value: 'objects', label: 'Objetos' },
  { value: 'other', label: 'Otro' },
];

const intensityOptions = [
  { value: 'mild', label: 'Leve' },
  { value: 'moderate', label: 'Moderado' },
  { value: 'strong', label: 'Fuerte' },
  { value: 'obsessive', label: 'Obsesivo' },
];

const handleClose = () => {
  if (!isSubmitting.value) {
    emit('update:show', false);
    resetForm();
  }
};

const handleSubmit = async (submittedData: CreateInterestPayload) => {
  isSubmitting.value = true;
  errorMessage.value = null;

  try {
    console.log('Enviando datos de interÃ©s:', submittedData);
    await createInterestForChild(props.childId, submittedData);

    console.log('InterÃ©s creado exitosamente!');
    emit('interest-created');
    handleClose();

  } catch (error: any) {
    console.error('Error al crear interÃ©s:', error);
    errorMessage.value = error.response?.data?.detail || error.message || 'OcurriÃ³ un error al guardar el interÃ©s.';
  } finally {
    isSubmitting.value = false;
  }
};

const resetForm = () => {
  formData.value = {
    description: '',
    category: '',
    intensity: '',
    therapeutic_utility: ''
  };
  errorMessage.value = null;
};

</script>

<style scoped>
.space-y-4 > :not([hidden]) ~ :not([hidden]) {
  --tw-space-y-reverse: 0;
  margin-top: calc(1rem * calc(1 - var(--tw-space-y-reverse)));
  margin-bottom: calc(1rem * var(--tw-space-y-reverse));
}

.text-red-500 {
  color: #ef4444;
}

:deep(.formkit-outer) {
  margin-bottom: 1rem;
}

:deep(.formkit-label) {
  display: block;
  margin-bottom: 0.25rem;
  font-size: 0.875rem;
  font-weight: 500;
  color: #374151;
}

:deep(.formkit-input[type="text"]),
:deep(.formkit-input[type="date"]),
:deep(.formkit-select .formkit-input),
:deep(.formkit-textarea .formkit-input) {
  width: 100%;
  padding: 0.5rem 0.75rem;
  border: 1px solid #d1d5db;
  border-radius: 0.375rem;
  background-color: white;
  box-shadow: inset 0 1px 2px 0 rgba(0, 0, 0, 0.05);
}

:deep(.formkit-input:focus) {
  outline: none;
  border-color: #2563eb;
  box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.5);
}

:deep(.formkit-form > .formkit-actions) {
  display: none;
}

.formkit-outer.\!mb-0 {
  margin-bottom: 0 !important;
}
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\profile\tabcontent\card\informaciongeneral\ContactoEmergencia.vue
============================================================
<!-- src/components/profile/tabcontent/card/ContactoEmergencia.vue -->
<template>
  <div class="info-card">
    <div class="card-header">
      <PhoneIcon class="icon-md" />
      <h3>Contactos de Emergencia</h3>
    </div>
    <div class="card-body">
      <div class="contactos-list">
        <div v-if="contactos.length === 0" class="empty-state">
          <ExclamationTriangleIcon class="icon-lg" />
          <p>No hay contactos registrados</p>
        </div>
        <div v-else class="contacto-item" v-for="contacto in contactos" :key="contacto.id">
          <div class="contacto-info">
            <strong>{{ contacto.name }}</strong>
            <span class="relationship">{{ contacto.relationship }}</span>
          </div>
          <div class="contacto-phone">{{ contacto.phone }}</div>
        </div>
      </div>
      <button class="btn btn-outline full-width" @click="$emit('gestionarContactos')">
        <PlusIcon class="icon-sm" />
        Gestionar Contactos
      </button>
    </div>
  </div>
</template>

<script setup lang="ts">
import { 
  PhoneIcon, 
  PlusIcon, 
  ExclamationTriangleIcon 
} from '@heroicons/vue/24/outline'

defineProps<{
  contactos: any[]
}>()

defineEmits<{
  gestionarContactos: []
}>()
</script>

<style scoped>
.info-card {
  border: 1px solid #e2e8f0;
  border-radius: 12px;
  overflow: hidden;
}

.card-header {
  background: #f8fafc;
  padding: 1.25rem 1.5rem;
  border-bottom: 1px solid #e2e8f0;
  display: flex;
  align-items: center;
  gap: 0.75rem;
}

.card-header h3 {
  margin: 0;
  font-size: 1.125rem;
  color: #1f2937;
}

.card-body {
  padding: 1.5rem;
}

.contactos-list {
  margin-bottom: 1rem;
}

.contacto-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0.75rem 0;
  border-bottom: 1px solid #f1f5f9;
}

.contacto-item:last-child {
  border-bottom: none;
}

.contacto-info {
  display: flex;
  flex-direction: column;
}

.contacto-info strong {
  color: #1f2937;
}

.relationship {
  font-size: 0.875rem;
  color: #6b7280;
}

.contacto-phone {
  color: #3b82f6;
  font-weight: 500;
}

.empty-state {
  text-align: center;
  padding: 2rem;
  color: #6b7280;
}

.btn {
  padding: 0.75rem 1.5rem;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 500;
  transition: all 0.2s;
  text-decoration: none;
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  font-size: 0.875rem;
}

.btn-outline {
  background: transparent;
  border: 1px solid #d1d5db;
  color: #374151;
}

.btn-outline:hover {
  background: #f9fafb;
}

.full-width {
  width: 100%;
  justify-content: center;
}

.icon-md {
  width: 1.5rem;
  height: 1.5rem;
}

.icon-sm {
  width: 1.25rem;
  height: 1.25rem;
}

.icon-lg {
  width: 2rem;
  height: 2rem;
}
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\profile\tabcontent\card\informaciongeneral\HistorialMedico.vue
============================================================
<!-- src/components/profile/tabcontent/card/HistorialMedico.vue -->
<template>
  <div class="info-card">
    <div class="card-header">
      <HeartIcon class="icon-md" />
      <h3>Historial MÃ©dico</h3>
    </div>
    <div class="card-body">
      <div class="historial-stats">
        <div class="stat-item">
          <span class="stat-number">{{ historialCount }}</span>
          <span class="stat-label">Registros</span>
        </div>
        <div class="stat-item">
          <span class="stat-number">{{ medicamentosCount }}</span>
          <span class="stat-label">Medicamentos</span>
        </div>
      </div>
      <button class="btn btn-outline full-width" @click="$emit('verHistorialCompleto')">
        <EyeIcon class="icon-sm" />
        Ver Historial Completo
      </button>
    </div>
  </div>
</template>

<script setup lang="ts">
import { 
  HeartIcon, 
  EyeIcon 
} from '@heroicons/vue/24/outline'

defineProps<{
  historialCount: number
  medicamentosCount: number
}>()

defineEmits<{
  verHistorialCompleto: []
}>()
</script>

<style scoped>
.info-card {
  border: 1px solid #e2e8f0;
  border-radius: 12px;
  overflow: hidden;
}

.card-header {
  background: #f8fafc;
  padding: 1.25rem 1.5rem;
  border-bottom: 1px solid #e2e8f0;
  display: flex;
  align-items: center;
  gap: 0.75rem;
}

.card-header h3 {
  margin: 0;
  font-size: 1.125rem;
  color: #1f2937;
}

.card-body {
  padding: 1.5rem;
}

.historial-stats {
  display: flex;
  gap: 2rem;
  margin-bottom: 1.5rem;
}

.stat-item {
  text-align: center;
}

.stat-number {
  display: block;
  font-size: 1.5rem;
  font-weight: 700;
  color: #3b82f6;
}

.stat-label {
  font-size: 0.875rem;
  color: #6b7280;
}

.btn {
  padding: 0.75rem 1.5rem;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 500;
  transition: all 0.2s;
  text-decoration: none;
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  font-size: 0.875rem;
}

.btn-outline {
  background: transparent;
  border: 1px solid #d1d5db;
  color: #374151;
}

.btn-outline:hover {
  background: #f9fafb;
}

.full-width {
  width: 100%;
  justify-content: center;
}

.icon-md {
  width: 1.5rem;
  height: 1.5rem;
}

.icon-sm {
  width: 1.25rem;
  height: 1.25rem;
}
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\profile\tabcontent\card\informaciongeneral\HistorialTerapias.vue
============================================================
<!-- src/components/profile/tabcontent/card/informaciongeneral/HistorialTerapias.vue -->
<template>
  <div class="info-card">
    <div class="card-header">
      <ClockIcon class="icon-md" />
      <h3>Historial de Terapias</h3>
    </div>
    <div class="card-body">
      <div class="info-list">
        <div class="info-item">
          <CheckCircleIcon class="icon-sm" />
          <div>
            <label>Â¿Terapias Previas?</label>
            <span>{{ therapyData?.has_previous_therapies || 'No especificado' }}</span>
          </div>
        </div>
        
        <div v-if="therapyData?.therapies_detail" class="info-item">
          <DocumentTextIcon class="icon-sm" />
          <div>
            <label>Detalles de Terapias</label>
            <span class="therapy-details">{{ therapyData.therapies_detail }}</span>
          </div>
        </div>
        
        <div v-if="therapyData?.referred_by" class="info-item">
          <UserIcon class="icon-sm" />
          <div>
            <label>Referido por</label>
            <span>{{ therapyData.referred_by }}</span>
          </div>
        </div>
        
        <div v-if="therapyData?.referred_by_detail" class="info-item">
          <IdentificationIcon class="icon-sm" />
          <div>
            <label>Detalle de Referencia</label>
            <span>{{ therapyData.referred_by_detail }}</span>
          </div>
        </div>
        
        <div v-if="therapyData?.attended_where" class="info-item">
          <BuildingLibraryIcon class="icon-sm" />
          <div>
            <label>Atendido en</label>
            <span>{{ therapyData.attended_where }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { 
  ClockIcon,
  CheckCircleIcon,
  DocumentTextIcon,
  UserIcon,
  IdentificationIcon,
  BuildingLibraryIcon
} from '@heroicons/vue/24/outline'

defineProps<{
  therapyData?: any
}>()
</script>

<style scoped>
.therapy-details {
  line-height: 1.4;
  font-style: italic;
}

/* Mantener estilos base de la tarjeta */
.info-card {
  border: 1px solid #e2e8f0;
  border-radius: 12px;
  overflow: hidden;
}

.card-header {
  background: #f8fafc;
  padding: 1.25rem 1.5rem;
  border-bottom: 1px solid #e2e8f0;
  display: flex;
  align-items: center;
  gap: 0.75rem;
}

.card-header h3 {
  margin: 0;
  font-size: 1.125rem;
  color: #1f2937;
}

.card-body {
  padding: 1.5rem;
}

.info-list {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.info-item {
  display: flex;
  align-items: flex-start;
  gap: 0.75rem;
}

.info-item label {
  font-size: 0.875rem;
  color: #6b7280;
  display: block;
  margin-bottom: 0.25rem;
}

.info-item span {
  font-weight: 500;
  color: #1f2937;
}

.icon-md {
  width: 1.5rem;
  height: 1.5rem;
}

.icon-sm {
  width: 1.25rem;
  height: 1.25rem;
}
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\profile\tabcontent\card\informaciongeneral\InformacionBasica.vue
============================================================
<!-- src/components/profile/tabcontent/card/informaciongeneral/InformacionBasica.vue -->
<template>
  <div class="info-card">
    <div class="card-header">
      <BuildingLibraryIcon class="icon-md" />
      <h3>InformaciÃ³n de UbicaciÃ³n</h3>
    </div>
    <div class="card-body">
      <div v-if="loading" class="loading-state">
        Cargando informaciÃ³n...
      </div>
      <div v-else class="info-list">
        <div class="info-item">
          <BuildingLibraryIcon class="icon-sm" />
          <div>
            <label>Establecimiento</label>
            <span>{{ locationData?.establishment || 'No asignado' }}</span>
          </div>
        </div>
        <div class="info-item">
          <MapPinIcon class="icon-sm" />
          <div>
            <label>DirecciÃ³n</label>
            <span>{{ locationData?.full_address || 'No especificada' }}</span>
          </div>
        </div>
        <div class="info-item">
          <MapPinIcon class="icon-sm" />
          <div>
            <label>Calle y NÃºmero</label>
            <span>{{ formatStreetAddress() }}</span>
          </div>
        </div>
        <div class="info-item">
          <MapIcon class="icon-sm" />
          <div>
            <label>Comuna</label>
            <span>{{ locationData?.commune || 'No especificada' }}</span>
          </div>
        </div>
        <div class="info-item">
          <GlobeAmericasIcon class="icon-sm" />
          <div>
            <label>RegiÃ³n</label>
            <span>{{ locationData?.region || 'No especificada' }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { 
  BuildingLibraryIcon, 
  MapPinIcon, 
  MapIcon,
  GlobeAmericasIcon
} from '@heroicons/vue/24/outline'
import { computed } from 'vue'

const props = defineProps<{
  locationData?: any
  loading: boolean
}>()

const formatStreetAddress = () => {
  if (props.locationData?.street && props.locationData?.street_number) {
    return `${props.locationData.street} #${props.locationData.street_number}`
  }
  return 'No especificada'
}
</script>

<style scoped>
/* Estilos mantienen igual que antes */
.info-card {
  border: 1px solid #e2e8f0;
  border-radius: 12px;
  overflow: hidden;
}

.card-header {
  background: #f8fafc;
  padding: 1.25rem 1.5rem;
  border-bottom: 1px solid #e2e8f0;
  display: flex;
  align-items: center;
  gap: 0.75rem;
}

.card-header h3 {
  margin: 0;
  font-size: 1.125rem;
  color: #1f2937;
}

.card-body {
  padding: 1.5rem;
}

.info-list {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.info-item {
  display: flex;
  align-items: flex-start;
  gap: 0.75rem;
}

.info-item label {
  font-size: 0.875rem;
  color: #6b7280;
  display: block;
  margin-bottom: 0.25rem;
}

.info-item span {
  font-weight: 500;
  color: #1f2937;
}

.loading-state {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 2rem;
  color: #6b7280;
}

.icon-md {
  width: 1.5rem;
  height: 1.5rem;
}

.icon-sm {
  width: 1.25rem;
  height: 1.25rem;
}
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\profile\tabcontent\card\informaciongeneral\InformacionEscolar.vue
============================================================
<!-- src/components/profile/tabcontent/card/informaciongeneral/InformacionEscolar.vue -->
<template>
  <div class="info-card">
    <div class="card-header">
      <AcademicCapIcon class="icon-md" />
      <h3>InformaciÃ³n Escolar</h3>
    </div>
    <div class="card-body">
      <div class="info-list">
        <div class="info-item">
          <BookOpenIcon class="icon-sm" />
          <div>
            <label>Grado Actual</label>
            <span>{{ schoolData?.current_grade || 'No especificado' }}</span>
          </div>
        </div>
        <div class="info-item">
          <ClockIcon class="icon-sm" />
          <div>
            <label>Jornada Escolar</label>
            <span>{{ schoolData?.school_journey || 'No especificada' }}</span>
          </div>
        </div>
        <div v-if="schoolData?.adaptation_notes" class="info-item">
          <PencilSquareIcon class="icon-sm" />
          <div>
            <label>Notas de AdaptaciÃ³n</label>
            <span class="adaptation-notes">{{ schoolData.adaptation_notes }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { 
  AcademicCapIcon,
  BookOpenIcon,
  ClockIcon,
  PencilSquareIcon
} from '@heroicons/vue/24/outline'

defineProps<{
  schoolData?: any
}>()
</script>

<style scoped>
.adaptation-notes {
  line-height: 1.4;
  font-style: italic;
}

/* Mantener estilos base de la tarjeta */
.info-card {
  border: 1px solid #e2e8f0;
  border-radius: 12px;
  overflow: hidden;
}

.card-header {
  background: #f8fafc;
  padding: 1.25rem 1.5rem;
  border-bottom: 1px solid #e2e8f0;
  display: flex;
  align-items: center;
  gap: 0.75rem;
}

.card-header h3 {
  margin: 0;
  font-size: 1.125rem;
  color: #1f2937;
}

.card-body {
  padding: 1.5rem;
}

.info-list {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.info-item {
  display: flex;
  align-items: flex-start;
  gap: 0.75rem;
}

.info-item label {
  font-size: 0.875rem;
  color: #6b7280;
  display: block;
  margin-bottom: 0.25rem;
}

.info-item span {
  font-weight: 500;
  color: #1f2937;
}

.icon-md {
  width: 1.5rem;
  height: 1.5rem;
}

.icon-sm {
  width: 1.25rem;
  height: 1.25rem;
}
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\profile\tabcontent\card\informaciongeneral\InformacionMedica.vue
============================================================
<!-- src/components/profile/tabcontent/card/informaciongeneral/InformacionMedica.vue -->
<template>
  <div class="info-card">
    <div class="card-header">
      <HeartIcon class="icon-md" />
      <h3>InformaciÃ³n MÃ©dica</h3>
    </div>
    <div class="card-body">
      <div class="info-list">
        <div class="info-item">
          <ExclamationTriangleIcon class="icon-sm" />
          <div>
            <label>Alergias</label>
            <span :class="allergiesClass">{{ medicalData?.allergies }}</span>
          </div>
        </div>
        <div class="info-item">
          <ClipboardDocumentCheckIcon class="icon-sm" />
          <div>
            <label>MedicaciÃ³n Actual</label>
            <span :class="medicationClass">{{ medicalData?.current_medication }}</span>
          </div>
        </div>
        <div class="info-item">
          <PhoneIcon class="icon-sm" />
          <div>
            <label>Contacto Emergencia</label>
            <span>{{ medicalData?.emergency_contact || 'No especificado' }}</span>
          </div>
        </div>
        <div class="info-item">
          <DevicePhoneMobileIcon class="icon-sm" />
          <div>
            <label>TelÃ©fono Emergencia</label>
            <span class="phone-number">{{ medicalData?.emergency_phone || 'No especificado' }}</span>
          </div>
        </div>
        <div v-if="medicalData?.medical_notes" class="info-item">
          <DocumentTextIcon class="icon-sm" />
          <div>
            <label>Notas MÃ©dicas</label>
            <span class="medical-notes">{{ medicalData.medical_notes }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { 
  HeartIcon,
  ExclamationTriangleIcon,
  ClipboardDocumentCheckIcon,
  PhoneIcon,
  DevicePhoneMobileIcon,
  DocumentTextIcon
} from '@heroicons/vue/24/outline'
import { computed } from 'vue'

const props = defineProps<{
  medicalData?: any
}>()

const allergiesClass = computed(() => 
  props.medicalData?.has_allergies ? 'text-red-600' : 'text-green-600'
)

const medicationClass = computed(() => 
  props.medicalData?.has_medication ? 'text-yellow-600' : 'text-green-600'
)
</script>

<style scoped>
.text-red-600 {
  color: #dc2626;
}

.text-yellow-600 {
  color: #d97706;
}

.text-green-600 {
  color: #059669;
}

.phone-number {
  font-family: monospace;
  font-weight: 600;
}

.medical-notes {
  line-height: 1.4;
  font-style: italic;
  color: #4b5563;
}

/* Mantener estilos base de la tarjeta */
.info-card {
  border: 1px solid #e2e8f0;
  border-radius: 12px;
  overflow: hidden;
}

.card-header {
  background: #f8fafc;
  padding: 1.25rem 1.5rem;
  border-bottom: 1px solid #e2e8f0;
  display: flex;
  align-items: center;
  gap: 0.75rem;
}

.card-header h3 {
  margin: 0;
  font-size: 1.125rem;
  color: #1f2937;
}

.card-body {
  padding: 1.5rem;
}

.info-list {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.info-item {
  display: flex;
  align-items: flex-start;
  gap: 0.75rem;
}

.info-item label {
  font-size: 0.875rem;
  color: #6b7280;
  display: block;
  margin-bottom: 0.25rem;
}

.info-item span {
  font-weight: 500;
  color: #1f2937;
}

.icon-md {
  width: 1.5rem;
  height: 1.5rem;
}

.icon-sm {
  width: 1.25rem;
  height: 1.25rem;
}
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\profile\tabcontent\card\informaciongeneral\InformacionPersonal.vue
============================================================
<!-- src/components/profile/tabcontent/card/informaciongeneral/InformacionPersonal.vue -->
<template>
  <div class="info-card">
    <div class="card-header">
      <UserCircleIcon class="icon-md" />
      <h3>InformaciÃ³n Personal</h3>
    </div>
    <div class="card-body">
      <div class="info-list">
        <div class="info-item">
          <UserIcon class="icon-sm" />
          <div>
            <label>Nombre Completo</label>
            <span>{{ personalData?.full_name || 'No especificado' }}</span>
          </div>
        </div>
        <div class="info-item">
          <IdentificationIcon class="icon-sm" />
          <div>
            <label>RUT</label>
            <span>{{ personalData?.rut || 'No especificado' }}</span>
          </div>
        </div>
        <div class="info-item">
          <CalendarIcon class="icon-sm" />
          <div>
            <label>Fecha de Nacimiento</label>
            <span>{{ personalData?.birth_date || 'No especificada' }}</span>
          </div>
        </div>
        <div class="info-item">
          <CalendarDaysIcon class="icon-sm" />
          <div>
            <label>Edad</label>
            <span>{{ personalData?.age || '0' }} aÃ±os</span>
          </div>
        </div>
        <div class="info-item">
          <UserGroupIcon class="icon-sm" />
          <div>
            <label>GÃ©nero</label>
            <span>{{ personalData?.gender || 'No especificado' }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { 
  UserCircleIcon,
  UserIcon,
  IdentificationIcon,
  CalendarIcon,
  CalendarDaysIcon,
  UserGroupIcon
} from '@heroicons/vue/24/outline'

defineProps<{
  personalData?: any
}>()
</script>

<style scoped>
.info-card {
  border: 1px solid #e2e8f0;
  border-radius: 12px;
  overflow: hidden;
}

.card-header {
  background: #f8fafc;
  padding: 1.25rem 1.5rem;
  border-bottom: 1px solid #e2e8f0;
  display: flex;
  align-items: center;
  gap: 0.75rem;
}

.card-header h3 {
  margin: 0;
  font-size: 1.125rem;
  color: #1f2937;
}

.card-body {
  padding: 1.5rem;
}

.info-list {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.info-item {
  display: flex;
  align-items: flex-start;
  gap: 0.75rem;
}

.info-item label {
  font-size: 0.875rem;
  color: #6b7280;
  display: block;
  margin-bottom: 0.25rem;
}

.info-item span {
  font-weight: 500;
  color: #1f2937;
}

.icon-md {
  width: 1.5rem;
  height: 1.5rem;
}

.icon-sm {
  width: 1.25rem;
  height: 1.25rem;
}
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\profile\tabcontent\card\informaciongeneral\InformacionTutor.vue
============================================================
<!-- src/components/profile/tabcontent/card/informaciongeneral/InformacionTutor.vue -->
<template>
  <div class="info-card">
    <div class="card-header">
      <UserGroupIcon class="icon-md" />
      <h3>InformaciÃ³n del Tutor</h3>
    </div>
    <div class="card-body">
      <div class="info-list">
        <div class="info-item">
          <CheckCircleIcon class="icon-sm" />
          <div>
            <label>Consentimiento del Apoderado</label>
            <span :class="consentClass">{{ guardianData?.guardian_consent }}</span>
          </div>
        </div>
        <div v-if="guardianData?.consent_date" class="info-item">
          <CalendarIcon class="icon-sm" />
          <div>
            <label>Fecha de Consentimiento</label>
            <span>{{ guardianData.consent_date }}</span>
          </div>
        </div>
        
        <!-- Lista de Tutores/Usuarios -->
        <div v-if="guardianData?.usuarios_info?.length > 0" class="tutores-section">
          <h4 class="tutores-title">Tutores Registrados</h4>
          <div class="tutores-list">
            <div v-for="usuario in guardianData.usuarios_info" :key="usuario.id" class="tutor-item">
              <div class="tutor-info">
                <strong>{{ usuario.full_name }}</strong>
                <span class="tutor-email">{{ usuario.email }}</span>
                <span v-if="usuario.rut" class="tutor-rut">RUT: {{ usuario.rut }}</span>
              </div>
            </div>
          </div>
        </div>
        <div v-else class="empty-tutores">
          <ExclamationTriangleIcon class="icon-sm" />
          <span>No hay tutores registrados</span>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { 
  UserGroupIcon,
  CheckCircleIcon,
  CalendarIcon,
  ExclamationTriangleIcon
} from '@heroicons/vue/24/outline'
import { computed } from 'vue'

const props = defineProps<{
  guardianData?: any
}>()

const consentClass = computed(() => 
  props.guardianData?.guardian_consent === 'SÃ­' ? 'text-green-600' : 'text-red-600'
)
</script>

<style scoped>
.text-green-600 {
  color: #059669;
}

.text-red-600 {
  color: #dc2626;
}

.tutores-section {
  margin-top: 1rem;
  padding-top: 1rem;
  border-top: 1px solid #f1f5f9;
}

.tutores-title {
  font-size: 0.875rem;
  font-weight: 600;
  color: #374151;
  margin-bottom: 0.75rem;
}

.tutores-list {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
}

.tutor-item {
  padding: 0.75rem;
  background: #f8fafc;
  border-radius: 8px;
  border: 1px solid #e2e8f0;
}

.tutor-info {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
}

.tutor-info strong {
  color: #1f2937;
  font-size: 0.875rem;
}

.tutor-email {
  color: #3b82f6;
  font-size: 0.75rem;
}

.tutor-rut {
  color: #6b7280;
  font-size: 0.75rem;
}

.empty-tutores {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  color: #6b7280;
  font-size: 0.875rem;
  margin-top: 1rem;
}

/* Mantener estilos base de la tarjeta */
.info-card {
  border: 1px solid #e2e8f0;
  border-radius: 12px;
  overflow: hidden;
}

.card-header {
  background: #f8fafc;
  padding: 1.25rem 1.5rem;
  border-bottom: 1px solid #e2e8f0;
  display: flex;
  align-items: center;
  gap: 0.75rem;
}

.card-header h3 {
  margin: 0;
  font-size: 1.125rem;
  color: #1f2937;
}

.card-body {
  padding: 1.5rem;
}

.info-list {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.info-item {
  display: flex;
  align-items: flex-start;
  gap: 0.75rem;
}

.info-item label {
  font-size: 0.875rem;
  color: #6b7280;
  display: block;
  margin-bottom: 0.25rem;
}

.info-item span {
  font-weight: 500;
  color: #1f2937;
}

.icon-md {
  width: 1.5rem;
  height: 1.5rem;
}

.icon-sm {
  width: 1.25rem;
  height: 1.25rem;
}
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\profile\tabcontent\card\informaciongeneral\InteresesPrincipales.vue
============================================================
<template>
  <div class="info-card bg-white border border-gray-200 rounded-lg overflow-hidden shadow-sm">
    <!-- Encabezado de la tarjeta -->
    <div class="card-header bg-gray-50 p-4 border-b border-gray-200 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <SparklesIcon class="icon-md text-blue-600" />
        <h3 class="text-lg font-semibold text-gray-800">Intereses Principales</h3>
      </div>
      <!-- BotÃ³n para abrir el modal de gestiÃ³n -->
      <button
        @click="$emit('gestionarIntereses')"
        class="btn btn-sm btn-outline-primary flex items-center gap-1"
      >
        <PencilSquareIcon class="icon-xs" />
        Gestionar
      </button>
    </div>

    <!-- Cuerpo de la tarjeta -->
    <div class="card-body p-5">
      <!-- Estado de carga -->
      <div v-if="loading" class="text-center text-gray-500 py-4">
        <svg class="animate-spin h-5 w-5 text-blue-500 mx-auto mb-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
        Cargando intereses...
      </div>

      <!-- Estado de error -->
      <div v-else-if="error" class="text-center text-red-600 bg-red-50 p-3 rounded-md">
        <ExclamationTriangleIcon class="icon-md mx-auto mb-1" />
        Error al cargar intereses: {{ error }}
      </div>

      <!-- Estado vacÃ­o -->
      <div v-else-if="interests.length === 0" class="empty-state text-center text-gray-500 py-4">
        <InformationCircleIcon class="icon-lg mx-auto mb-2" />
        <p>No hay intereses principales registrados.</p>
        <button
          @click="$emit('gestionarIntereses')"
          class="text-blue-600 hover:text-blue-800 text-sm mt-1 underline"
        >
          Agregar el primer interÃ©s
        </button>
      </div>

      <!-- Lista de intereses -->
      <ul v-else class="space-y-3">
        <li v-for="interest in interests" :key="interest.id" class="interest-item border-b border-gray-100 pb-3 last:border-b-0">
          <div class="flex items-center justify-between mb-1">
            <span class="font-medium text-gray-800">{{ interest.description }}</span>
            <span :class="['intensity-badge', `intensity-${interest.intensity}`]">
              {{ getIntensityLabel(interest.intensity) }}
            </span>
          </div>
          <div class="text-sm text-gray-500 flex items-center gap-1">
             <TagIcon class="icon-xs" /> {{ getCategoryLabel(interest.category) }}
          </div>
          <p v-if="interest.therapeutic_utility" class="text-xs text-gray-600 mt-1 pl-1 border-l-2 border-blue-200">
             {{ interest.therapeutic_utility }}
          </p>
        </li>
      </ul>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, onMounted, watch } from 'vue';
import {
  SparklesIcon, // Icono para Intereses
  PencilSquareIcon, // Icono para Gestionar/Editar
  InformationCircleIcon, // Icono para estado vacÃ­o
  ExclamationTriangleIcon, // Icono para error
  TagIcon // Icono para categorÃ­a
} from '@heroicons/vue/24/outline';
// Importamos la funciÃ³n del servicio y el tipo
import { getInterestsForChild, type Interest } from '@/services/sessionService'; // O interestService si lo creaste

// --- Props ---
// Recibe el ID del niÃ±o para saber quÃ© intereses cargar
const props = defineProps<{
  childId: number | string; // Puede ser string desde la ruta, lo convertimos a number
}>();

// --- Emits ---
// Emite 'gestionarIntereses' cuando se hace clic en el botÃ³n Gestionar
const emit = defineEmits<{
  (e: 'gestionarIntereses'): void;
}>();

// --- Estado del Componente ---
const loading = ref(false); // Indica si se estÃ¡n cargando los datos
const error = ref<string | null>(null); // Almacena mensajes de error
const interests = ref<Interest[]>([]); // Array para almacenar los intereses cargados

// --- MÃ©todos ---

/**
 * Carga la lista de intereses desde la API.
 */
const loadInterests = async () => {
  // Asegurarse de que tenemos un ID numÃ©rico vÃ¡lido
  const id = Number(props.childId);
  if (isNaN(id) || id <= 0) {
    error.value = "ID de niÃ±o no vÃ¡lido.";
    return;
  }

  loading.value = true;
  error.value = null; // Limpiar errores previos
  try {
    console.log(`â³ Cargando intereses para el niÃ±o ID: ${id}...`);
    interests.value = await getInterestsForChild(id);
    console.log(`âœ… ${interests.value.length} intereses cargados.`);
  } catch (err: any) {
    console.error('âŒ Error cargando intereses:', err);
    error.value = err.response?.data?.detail || err.message || 'OcurriÃ³ un error desconocido.';
    interests.value = []; // Limpiar lista en caso de error
  } finally {
    loading.value = false;
  }
};

/**
 * Obtiene una etiqueta legible para la intensidad.
 * @param intensity El valor de la intensidad ('mild', 'moderate', etc.)
 */
const getIntensityLabel = (intensity: string) => {
  const labels: { [key: string]: string } = {
    mild: 'Leve',
    moderate: 'Moderado',
    strong: 'Fuerte',
    obsessive: 'Obsesivo',
  };
  return labels[intensity] || intensity; // Devuelve la etiqueta o el valor original si no se encuentra
};

/**
 * Obtiene una etiqueta legible para la categorÃ­a.
 * @param category El valor de la categorÃ­a ('food', 'games', etc.)
 */
const getCategoryLabel = (category: string) => {
    const labels: { [key: string]: string } = {
        food: 'Comida',
        games: 'Juegos',
        music: 'MÃºsica',
        movies: 'PelÃ­culas',
        books: 'Libros',
        activities: 'Actividades',
        objects: 'Objetos',
        other: 'Otro',
    };
    return labels[category] || category;
}

// --- Lifecycle Hooks ---

// Carga los intereses cuando el componente se monta por primera vez
onMounted(() => {
  loadInterests();
});

// Vuelve a cargar los intereses si el childId cambia (Ãºtil si el perfil se reutiliza)
watch(() => props.childId, () => {
  loadInterests();
});

</script>

<style scoped>
/* Reutilizamos estilos similares a otras tarjetas si es posible */
.info-card {
  /* Estilos base de la tarjeta */
}

.card-header {
  /* Estilos del encabezado */
}

.card-body {
 /* Estilos del cuerpo */
}

.btn {
  padding: 0.5rem 1rem;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 500;
  display: inline-flex;
  align-items: center;
  transition: background-color 0.2s;
  text-decoration: none;
}
.btn-sm {
  padding: 0.25rem 0.75rem;
  font-size: 0.75rem;
}
.btn-outline-primary {
  border: 1px solid #3b82f6;
  color: #3b82f6;
  background-color: transparent;
}
.btn-outline-primary:hover {
  background-color: #eff6ff; /* Azul muy claro */
}

.empty-state {
 /* Estilos para cuando no hay datos */
}

.interest-item {
 /* Estilos para cada elemento de la lista */
}

.intensity-badge {
  display: inline-block;
  padding: 0.15rem 0.6rem;
  border-radius: 9999px; /* PÃ­ldora */
  font-size: 0.7rem; /* MÃ¡s pequeÃ±o */
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

/* Colores segÃºn intensidad (ajusta segÃºn tu paleta) */
.intensity-mild { background-color: #dbeafe; color: #1e40af; } /* Azul claro */
.intensity-moderate { background-color: #fef3c7; color: #92400e; } /* Amarillo claro */
.intensity-strong { background-color: #fee2e2; color: #991b1b; } /* Rojo claro */
.intensity-obsessive { background-color: #e0e7ff; color: #4338ca; } /* Indigo claro */

.icon-md {
  width: 1.5rem; height: 1.5rem;
}
.icon-lg {
  width: 2rem; height: 2rem;
}
.icon-xs {
 width: 0.875rem; height: 0.875rem; /* 14px */
}
</style>

============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\profile\tabcontent\card\informaciongeneral\NecesidadesEspeciales.vue
============================================================
<!-- src/components/profile/tabcontent/card/informaciongeneral/NecesidadesEspeciales.vue -->
<template>
  <div class="info-card">
    <div class="card-header">
      <ExclamationTriangleIcon class="icon-md" />
      <h3>Necesidades Especiales</h3>
    </div>
    <div class="card-body">
      <div class="info-list">
        <div class="info-item">
          <CheckCircleIcon class="icon-sm" />
          <div>
            <label>Â¿Tiene NEE?</label>
            <span :class="needsClass">
              {{ specialNeedsData?.has_special_needs ? 'SÃ­' : 'No' }}
            </span>
          </div>
        </div>
        <div v-if="specialNeedsData?.has_special_needs" class="info-item">
          <TagIcon class="icon-sm" />
          <div>
            <label>Tipo de NEE</label>
            <span>{{ specialNeedsData?.special_needs_type || 'No especificado' }}</span>
          </div>
        </div>
        <div class="info-item">
          <SparklesIcon class="icon-sm" />
          <div>
            <label>Nivel de Autismo</label>
            <span :class="autismLevelClass">
              {{ specialNeedsData?.autism_level || 'No especificado' }}
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { 
  ExclamationTriangleIcon,
  CheckCircleIcon,
  TagIcon,
  SparklesIcon
} from '@heroicons/vue/24/outline'
import { computed } from 'vue'

const props = defineProps<{
  specialNeedsData?: any
}>()

const needsClass = computed(() => 
  props.specialNeedsData?.has_special_needs ? 'text-green-600' : 'text-gray-500'
)

const autismLevelClass = computed(() => {
  const level = props.specialNeedsData?.autism_level;
  if (!level) return 'text-gray-500';
  
  if (level.includes('Nivel 1')) return 'text-blue-600';
  if (level.includes('Nivel 2')) return 'text-yellow-600';
  if (level.includes('Nivel 3')) return 'text-red-600';
  
  return 'text-gray-600';
})
</script>

<style scoped>
.text-green-600 {
  color: #059669;
}

.text-blue-600 {
  color: #2563eb;
}

.text-yellow-600 {
  color: #d97706;
}

.text-red-600 {
  color: #dc2626;
}

.text-gray-500 {
  color: #6b7280;
}

.text-gray-600 {
  color: #4b5563;
}

/* Mantener estilos base de la tarjeta */
.info-card {
  border: 1px solid #e2e8f0;
  border-radius: 12px;
  overflow: hidden;
}

.card-header {
  background: #f8fafc;
  padding: 1.25rem 1.5rem;
  border-bottom: 1px solid #e2e8f0;
  display: flex;
  align-items: center;
  gap: 0.75rem;
}

.card-header h3 {
  margin: 0;
  font-size: 1.125rem;
  color: #1f2937;
}

.card-body {
  padding: 1.5rem;
}

.info-list {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.info-item {
  display: flex;
  align-items: flex-start;
  gap: 0.75rem;
}

.info-item label {
  font-size: 0.875rem;
  color: #6b7280;
  display: block;
  margin-bottom: 0.25rem;
}

.info-item span {
  font-weight: 500;
}

.icon-md {
  width: 1.5rem;
  height: 1.5rem;
}

.icon-sm {
  width: 1.25rem;
  height: 1.25rem;
}
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\profile\tabcontent\card\informaciongeneral\RegistroDiagnostico.vue
============================================================
<!-- src/components/profile/tabcontent/card/informaciongeneral/RegistroDiagnostico.vue -->
<template>
  <div class="info-card">
    <!-- Cabecera de la tarjeta -->
    <div class="card-header">
      <ClipboardDocumentListIcon class="icon-md" />
      <h3>DiagnÃ³sticos</h3>
      <!-- 
        BOTÃ“N AGREGAR: 
        - Se muestra al lado derecho gracias a 'ml-auto'.
        - Al hacer clic, emite el evento 'add-diagnosis'.
        - El componente padre (PerfilSeguimientoPersonal via TabContent) escucharÃ¡ este evento
          para abrir el modal del formulario de nuevo diagnÃ³stico.
      -->
      <button
        @click="$emit('add-diagnosis')"
        class="ml-auto btn btn-sm btn-outline-primary"
      >
        <PlusIcon class="icon-xs mr-1" />
        Agregar
      </button>
    </div>
    <!-- Cuerpo de la tarjeta -->
    <div class="card-body">
      <div class="diagnosticos-list">
        <!-- Estado VacÃ­o: Se muestra si no hay diagnÃ³sticos -->
        <div v-if="diagnosticos.length === 0" class="empty-state">
          <ExclamationTriangleIcon class="icon-lg" />
          <p>No hay diagnÃ³sticos registrados</p>
        </div>
        <!-- Lista de DiagnÃ³sticos: Se itera sobre la prop 'diagnosticos' -->
        <div v-else class="diagnostico-item" v-for="diagnostico in diagnosticos" :key="diagnostico.id">
          <!-- Tipo de DiagnÃ³stico (ej. Primario, Secundario) -->
          <div class="diagnostico-type" :class="diagnostico.diagnosis_type || 'default'">
            {{ diagnostico.diagnosis_type || 'No especificado' }}
          </div>
          <!-- DescripciÃ³n del DiagnÃ³stico -->
          <div class="diagnostico-desc">{{ diagnostico.description }}</div>
          <!-- Fecha del DiagnÃ³stico (formateada) -->
          <div v-if="diagnostico.diagnosis_date" class="diagnostico-date text-xs text-gray-500 mt-1">
             {{ formatDate(diagnostico.diagnosis_date) }}
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
// ImportaciÃ³n de Ã­conos desde Heroicons
import {
  ClipboardDocumentListIcon,
  ExclamationTriangleIcon,
  PlusIcon // Ãcono para el botÃ³n "Agregar"
} from '@heroicons/vue/24/outline'

// ImportaciÃ³n de la interfaz Diagnosis desde el servicio (Â¡AsegÃºrate de que la ruta sea correcta!)
// Esto mejora la seguridad de tipos comparado con usar 'any[]'
import type { Diagnosis } from '@/services/sessionService'; // O diagnosisService si lo creaste

// DEFINICIÃ“N DE PROPS:
// - 'diagnosticos': Un array de objetos Diagnosis que este componente recibe del padre.
//   El padre (PerfilSeguimientoPersonal) es responsable de cargar estos datos usando getDiagnosesForChild.
defineProps<{
  // Es mejor usar el tipo especÃ­fico en lugar de any[]
  diagnosticos: Diagnosis[]
}>()

// DEFINICIÃ“N DE EMITS:
// - 'add-diagnosis': Evento que se emitirÃ¡ cuando el usuario haga clic en el botÃ³n "Agregar".
//   No lleva datos adicionales. El padre lo escucharÃ¡ para saber que debe abrir el modal.
defineEmits<{
  'add-diagnosis': []
}>()

// FUNCIÃ“N HELPER: Formatear Fecha
// - Toma una fecha en formato string (ej. "YYYY-MM-DD")
// - La convierte a un formato mÃ¡s legible para el usuario (ej. "Oct 22, 2025")
// - Incluye manejo bÃ¡sico de errores por si la fecha es invÃ¡lida.
const formatDate = (dateString: string) => {
  if (!dateString) return ''; // Si no hay fecha, no mostrar nada
  try {
    // Usa la configuraciÃ³n regional 'es-CL' para el formato chileno
    return new Date(dateString).toLocaleDateString('es-CL', { year: 'numeric', month: 'short', day: 'numeric' });
  } catch (e) {
    console.error("Error formateando fecha:", e);
    return dateString; // Si hay error, devuelve la fecha original
  }
}

</script>

<style scoped>
/* Estilos generales de la tarjeta (sin cambios) */
.info-card {
  border: 1px solid #e2e8f0;
  border-radius: 12px;
  overflow: hidden;
  background-color: white; /* Asegura fondo blanco */
}

.card-header {
  background: #f8fafc;
  padding: 1.25rem 1.5rem;
  border-bottom: 1px solid #e2e8f0;
  display: flex;
  align-items: center;
  gap: 0.75rem;
}

.card-header h3 {
  margin: 0;
  font-size: 1.125rem; /* 18px */
  color: #1f2937;
}

.card-body {
  padding: 1.5rem;
}

/* Estilos para la lista de diagnÃ³sticos (sin cambios) */
.diagnostico-item {
  padding: 0.75rem 0;
  border-bottom: 1px solid #f1f5f9;
}

.diagnostico-item:last-child {
  border-bottom: none;
}

/* Estilos para la etiqueta del tipo de diagnÃ³stico */
.diagnostico-type {
  display: inline-block;
  padding: 0.25rem 0.75rem;
  border-radius: 9999px; /* PÃ­ldora redondeada */
  font-size: 0.75rem; /* 12px */
  font-weight: 500;
  text-transform: capitalize;
  margin-bottom: 0.5rem;
}

/* Colores segÃºn el tipo (ajusta segÃºn los valores de tu modelo) */
.diagnostico-type.primary {
  background: #fef3c7; /* Amarillo claro */
  color: #92400e; /* Amarillo oscuro */
}

.diagnostico-type.secondary {
  background: #dbeafe; /* Azul claro */
  color: #1e40af; /* Azul oscuro */
}

.diagnostico-type.comorbidity {
  background: #fee2e2; /* Rojo claro */
  color: #991b1b; /* Rojo oscuro */
}

.diagnostico-type.default {
  background: #e5e7eb; /* Gris claro */
  color: #4b5563; /* Gris oscuro */
}


.diagnostico-desc {
  color: #374151; /* Gris medio-oscuro */
  font-size: 0.875rem; /* 14px */
}

/* Estilos para el estado vacÃ­o (sin cambios) */
.empty-state {
  text-align: center;
  padding: 2rem;
  color: #6b7280; /* Gris medio */
}
.empty-state .icon-lg {
  margin: 0 auto 0.5rem; /* Centra el Ã­cono */
}

/* TamaÃ±os de Ã­conos */
.icon-xs {
  width: 0.75rem; /* 12px */
  height: 0.75rem;
}
.icon-md {
  width: 1.5rem; /* 24px */
  height: 1.5rem;
}
.icon-lg {
  width: 2rem; /* 32px */
  height: 2rem;
}

/* Estilos bÃ¡sicos para botones (NUEVO) */
.btn {
  padding: 0.5rem 1rem;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 500;
  display: inline-flex;
  align-items: center;
  transition: background-color 0.2s;
  white-space: nowrap; /* Evita que el texto del botÃ³n se parta */
}
.btn-sm {
  padding: 0.25rem 0.75rem;
  font-size: 0.75rem; /* 12px */
}
.btn-outline-primary {
  border: 1px solid #3b82f6; /* Azul */
  color: #3b82f6;
  background-color: transparent;
}
.btn-outline-primary:hover {
  background-color: #eff6ff; /* Azul muy claro al pasar el mouse */
}

/* Utilidades (NUEVO) */
.ml-auto {
  margin-left: auto; /* Empuja el botÃ³n a la derecha en el header */
}
.mr-1 {
  margin-right: 0.25rem; /* Espacio entre Ã­cono y texto */
}
.text-xs {
  font-size: 0.75rem; /* 12px */
  line-height: 1rem; /* 16px */
}
.text-gray-500 {
  color: rgb(107 114 128); /* Gris medio */
}
.mt-1 {
  margin-top: 0.25rem; /* 4px */
}

</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\profile\tabcontent\card\informaciongeneral\RegistroPIE.vue
============================================================
<!-- src/components/profile/tabcontent/card/informaciongeneral/RegistroPIE.vue -->
<template>
  <div class="info-card">
    <div class="card-header">
      <ClipboardDocumentCheckIcon class="icon-md" />
      <h3>Registro PIE</h3>
    </div>
    <div class="card-body">
      <div class="info-list">
        <div class="info-item">
          <DocumentTextIcon class="icon-sm" />
          <div>
            <label>DiagnÃ³stico</label>
            <span class="diagnosis-text">{{ pieData?.diagnosis || 'No especificado' }}</span>
          </div>
        </div>
        <div class="info-item">
          <CalendarIcon class="icon-sm" />
          <div>
            <label>Fecha de Ingreso</label>
            <span>{{ pieData?.entry_date || 'No especificada' }}</span>
          </div>
        </div>
        <div class="info-item">
          <StatusOnlineIcon class="icon-sm" />
          <div>
            <label>Estado</label>
            <span :class="statusClass">{{ pieData?.status || 'No especificado' }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { 
  ClipboardDocumentCheckIcon,
  DocumentTextIcon,
  CalendarIcon,
} from '@heroicons/vue/24/outline'
import { computed } from 'vue'

const props = defineProps<{
  pieData?: any
}>()

const statusClass = computed(() => {
  const status = props.pieData?.status;
  if (status === 'Activo') return 'text-green-600';
  if (status === 'Inactivo') return 'text-red-600';
  return 'text-gray-600';
})
</script>

<style scoped>
.text-green-600 {
  color: #059669;
}

.text-red-600 {
  color: #dc2626;
}

.text-gray-600 {
  color: #4b5563;
}

.diagnosis-text {
  line-height: 1.4;
}

/* Mantener estilos base de la tarjeta */
.info-card {
  border: 1px solid #e2e8f0;
  border-radius: 12px;
  overflow: hidden;
}

.card-header {
  background: #f8fafc;
  padding: 1.25rem 1.5rem;
  border-bottom: 1px solid #e2e8f0;
  display: flex;
  align-items: center;
  gap: 0.75rem;
}

.card-header h3 {
  margin: 0;
  font-size: 1.125rem;
  color: #1f2937;
}

.card-body {
  padding: 1.5rem;
}

.info-list {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.info-item {
  display: flex;
  align-items: flex-start;
  gap: 0.75rem;
}

.info-item label {
  font-size: 0.875rem;
  color: #6b7280;
  display: block;
  margin-bottom: 0.25rem;
}

.info-item span {
  font-weight: 500;
  color: #1f2937;
}

.icon-md {
  width: 1.5rem;
  height: 1.5rem;
}

.icon-sm {
  width: 1.25rem;
  height: 1.25rem;
}
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\profile\tabcontent\card\progresometricas\ProgresoMetricas.vue
============================================================
<!-- src/components/profile/tabcontent/card/ProgresoMetricas.vue -->
<template>
  <div class="tab-pane">
    <div class="metricas-header">
      <div class="section-title">
        <ChartBarIcon class="icon-lg" />
        <h3>Progreso y MÃ©tricas</h3>
      </div>
      <div class="time-filters">
        <button class="btn btn-sm" :class="{ active: periodo === '30d' }" @click="$emit('update:periodo', '30d')">
          30 dÃ­as
        </button>
        <button class="btn btn-sm" :class="{ active: periodo === '90d' }" @click="$emit('update:periodo', '90d')">
          90 dÃ­as
        </button>
        <button class="btn btn-sm" :class="{ active: periodo === '1a' }" @click="$emit('update:periodo', '1a')">
          1 aÃ±o
        </button>
      </div>
    </div>

    <!-- MÃ‰TRICAS PRINCIPALES -->
    <div class="metricas-principales">
      <div class="metrica-principal">
        <div class="metrica-header">
          <div class="metrica-icon desarrollo">
            <TrophyIcon class="icon-lg" />
          </div>
          <div class="metrica-info">
            <span class="metrica-valor">{{ metricas.hitos_desarrollo }}</span>
            <span class="metrica-label">Hitos de Desarrollo</span>
          </div>
        </div>
        <button class="btn btn-outline full-width" @click="$emit('cargarHitosDesarrollo')">
          <ArrowRightIcon class="icon-sm" />
          Ver Detalles
        </button>
      </div>

      <div class="metrica-principal">
        <div class="metrica-header">
          <div class="metrica-icon comunicacion">
            <ChatBubbleLeftRightIcon class="icon-lg" />
          </div>
          <div class="metrica-info">
            <span class="metrica-valor">{{ metricas.progresos_comunicacion }}</span>
            <span class="metrica-label">Progresos ComunicaciÃ³n</span>
          </div>
        </div>
        <button class="btn btn-outline full-width" @click="$emit('cargarProgresosComunicacion')">
          <ArrowRightIcon class="icon-sm" />
          Ver Detalles
        </button>
      </div>

      <div class="metrica-principal">
        <div class="metrica-header">
          <div class="metrica-icon social">
            <UserGroupIcon class="icon-lg" />
          </div>
          <div class="metrica-info">
            <span class="metrica-valor">{{ metricas.habilidades_sociales }}</span>
            <span class="metrica-label">Habilidades Sociales</span>
          </div>
        </div>
        <button class="btn btn-outline full-width" @click="$emit('cargarHabilidadesSociales')">
          <ArrowRightIcon class="icon-sm" />
          Ver Detalles
        </button>
      </div>
    </div>

    <!-- GRÃFICOS Y TENDENCIAS -->
    <div class="graficos-section">
      <div class="grafico-card">
        <h4>Tendencia de Progreso</h4>
        <div class="grafico-placeholder">
          <ChartBarSquareIcon class="icon-xxl" />
          <p>GrÃ¡fico de tendencia se cargarÃ¡ aquÃ­</p>
        </div>
      </div>
      
      <div class="grafico-card">
        <h4>DistribuciÃ³n por Ãreas</h4>
        <div class="grafico-placeholder">
          <CircleStackIcon class="icon-xxl" />
          <p>GrÃ¡fico de distribuciÃ³n se cargarÃ¡ aquÃ­</p>
        </div>
      </div>
    </div>

    <!-- REGISTROS RECIENTES -->
    <div class="registros-recientes">
      <h4>Registros Recientes</h4>
      <div class="registros-list">
        <div class="registro-item" v-for="registro in registrosRecientes" :key="registro.id">
          <div class="registro-icon" :class="registro.tipo">
            <component :is="registro.icono" class="icon-sm" />
          </div>
          <div class="registro-content">
            <div class="registro-desc">{{ registro.descripcion }}</div>
            <div class="registro-meta">
              <span class="registro-fecha">{{ registro.fecha }}</span>
              <span class="registro-categoria">{{ registro.categoria }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import {
  ChartBarIcon,
  TrophyIcon,
  ChatBubbleLeftRightIcon,
  UserGroupIcon,
  ArrowRightIcon,
  ChartBarSquareIcon,
  CircleStackIcon
} from '@heroicons/vue/24/outline'

defineProps<{
  periodo: string
  metricas: any
  registrosRecientes: any[]
}>()

defineEmits<{
  'update:periodo': [value: string]
  cargarHitosDesarrollo: []
  cargarProgresosComunicacion: []
  cargarHabilidadesSociales: []
}>()
</script>

<style scoped>
.tab-pane {
  padding: 2rem;
}

.metricas-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 2rem;
}

.section-title {
  display: flex;
  align-items: center;
  gap: 0.75rem;
}

.section-title h3 {
  margin: 0;
  color: #1f2937;
}

.time-filters {
  display: flex;
  gap: 0.5rem;
}

.metricas-principales {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 1.5rem;
  margin-bottom: 2rem;
}

.metrica-principal {
  border: 1px solid #e2e8f0;
  border-radius: 12px;
  padding: 1.5rem;
  background: white;
}

.metrica-header {
  display: flex;
  align-items: center;
  gap: 1rem;
  margin-bottom: 1rem;
}

.metrica-icon {
  width: 60px;
  height: 60px;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.metrica-icon.desarrollo {
  background: #fef3c7;
  color: #92400e;
}

.metrica-icon.comunicacion {
  background: #dbeafe;
  color: #1e40af;
}

.metrica-icon.social {
  background: #dcfce7;
  color: #166534;
}

.metrica-info {
  display: flex;
  flex-direction: column;
}

.metrica-valor {
  font-size: 1.5rem;
  font-weight: 700;
  color: #1f2937;
}

.metrica-label {
  font-size: 0.875rem;
  color: #6b7280;
}

.graficos-section {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
  gap: 1.5rem;
  margin-bottom: 2rem;
}

.grafico-card {
  border: 1px solid #e2e8f0;
  border-radius: 12px;
  padding: 1.5rem;
  background: white;
}

.grafico-card h4 {
  margin: 0 0 1rem 0;
  color: #1f2937;
}

.grafico-placeholder {
  height: 200px;
  background: #f8fafc;
  border: 2px dashed #e2e8f0;
  border-radius: 8px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  color: #64748b;
}

.registros-recientes h4 {
  margin: 0 0 1rem 0;
  color: #1f2937;
}

.registros-list {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
}

.registro-item {
  display: flex;
  align-items: flex-start;
  gap: 1rem;
  padding: 1rem;
  border: 1px solid #e2e8f0;
  border-radius: 8px;
  background: white;
}

.registro-icon {
  width: 40px;
  height: 40px;
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.registro-icon.desarrollo {
  background: #fef3c7;
  color: #92400e;
}

.registro-icon.social {
  background: #dcfce7;
  color: #166534;
}

.registro-icon.terapia {
  background: #dbeafe;
  color: #1e40af;
}

.registro-content {
  flex: 1;
}

.registro-desc {
  color: #1f2937;
  margin-bottom: 0.5rem;
}

.registro-meta {
  display: flex;
  gap: 1rem;
  font-size: 0.875rem;
}

.registro-fecha {
  color: #6b7280;
}

.registro-categoria {
  color: #3b82f6;
  font-weight: 500;
}

.btn {
  padding: 0.75rem 1.5rem;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 500;
  transition: all 0.2s;
  text-decoration: none;
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  font-size: 0.875rem;
}

.btn-outline {
  background: transparent;
  border: 1px solid #d1d5db;
  color: #374151;
}

.btn-outline:hover {
  background: #f9fafb;
}

.btn-sm {
  padding: 0.5rem 1rem;
  font-size: 0.75rem;
}

.full-width {
  width: 100%;
  justify-content: center;
}

.icon-sm {
  width: 1.25rem;
  height: 1.25rem;
}

.icon-lg {
  width: 2rem;
  height: 2rem;
}

.icon-xxl {
  width: 3rem;
  height: 3rem;
}

@media (max-width: 768px) {
  .tab-pane {
    padding: 1rem;
  }
  
  .metricas-principales {
    grid-template-columns: 1fr;
  }
  
  .graficos-section {
    grid-template-columns: 1fr;
  }
  
  .metricas-header {
    flex-direction: column;
    gap: 1rem;
    align-items: flex-start;
  }
}
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\profile\tabcontent\card\ReportesRapido.vue
============================================================
<!-- src/components/profile/tabcontent/card/ReportesRapido.vue -->
<template>
  <div class="reportes-rapidos">
    <h4>Reportes RÃ¡pidos</h4>
    <div class="rapidos-grid">
      <button class="btn btn-outline" @click="$emit('generarReporteSesiones')">
        <CalendarIcon class="icon-sm" />
        Sesiones de Terapia
      </button>
      <button class="btn btn-outline" @click="$emit('generarReporteProgreso')">
        <ChartBarIcon class="icon-sm" />
        Progreso General
      </button>
      <button class="btn btn-outline" @click="$emit('generarReporteComportamiento')">
        <FaceSmileIcon class="icon-sm" />
        Comportamiento
      </button>
      <button class="btn btn-outline" @click="$emit('generarReporteMedico')">
        <HeartIcon class="icon-sm" />
        Historial MÃ©dico
      </button>
    </div>
  </div>
</template>

<script setup lang="ts">
import {
  CalendarIcon,
  ChartBarIcon,
  FaceSmileIcon,
  HeartIcon
} from '@heroicons/vue/24/outline'

defineEmits<{
  generarReporteSesiones: []
  generarReporteProgreso: []
  generarReporteComportamiento: []
  generarReporteMedico: []
}>()
</script>

<style scoped>
.reportes-rapidos h4 {
  margin: 0 0 1rem 0;
  color: #1f2937;
}

.rapidos-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1rem;
}

.btn {
  padding: 0.75rem 1.5rem;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 500;
  transition: all 0.2s;
  text-decoration: none;
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  font-size: 0.875rem;
}

.btn-outline {
  background: transparent;
  border: 1px solid #d1d5db;
  color: #374151;
}

.btn-outline:hover {
  background: #f9fafb;
}

.icon-sm {
  width: 1.25rem;
  height: 1.25rem;
}

@media (max-width: 768px) {
  .rapidos-grid {
    grid-template-columns: 1fr;
  }
}
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\profile\tabcontent\card\sesionesterapia\SesionesTerapia.vue
============================================================
<template>
  <div class="tab-pane">
    <div class="sesiones-header">
      <div class="section-title">
        <ChatBubbleLeftRightIcon class="icon-lg" />
        <h3>Sesiones de Terapia</h3>
      </div>
      <div class="header-actions">
        <button class="btn btn-outline" @click="imprimir">
          <PrinterIcon class="icon-sm" />
          Imprimir
        </button>
        <button class="btn btn-secondary" @click="$emit('cargarSesiones')">
          <ArrowPathIcon class="icon-sm" />
          Actualizar
        </button>
        <button class="btn btn-primary" @click="$emit('abrirModalSesion')">
          <PlusIcon class="icon-sm" />
          Nueva SesiÃ³n
        </button>
      </div>
    </div>

    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon total">
          <CalendarIcon class="icon-lg" />
        </div>
        <div class="stat-info">
          <span class="stat-number">{{ statsSesiones.total }}</span>
          <span class="stat-label">Total Sesiones</span>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon completed">
          <CheckCircleIcon class="icon-lg" />
        </div>
        <div class="stat-info">
          <span class="stat-number">{{ statsSesiones.completadas }}</span>
          <span class="stat-label">Completadas</span>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon pending">
          <ClockIcon class="icon-lg" />
        </div>
        <div class="stat-info">
          <span class="stat-number">{{ statsSesiones.pendientes }}</span>
          <span class="stat-label">Pendientes</span>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon goals">
          <FlagIcon class="icon-lg" />
        </div>
        <div class="stat-info">
          <span class="stat-number">{{ statsSesiones.objetivos }}</span>
          <span class="stat-label">Objetivos</span>
        </div>
      </div>
    </div>

    <div class="sesiones-list">
      <div v-if="loadingSesiones" class="loading-state">
        Cargando sesiones...
      </div>
      <div v-else-if="sesiones.length === 0" class="empty-state">
        <CalendarIcon class="icon-xxl" />
        <h4>No hay sesiones registradas</h4>
        <p>Comienza agregando la primera sesiÃ³n de terapia</p>
        <button class="btn btn-primary" @click="$emit('abrirModalSesion')">
          <PlusIcon class="icon-sm" />
          Crear Primera SesiÃ³n
        </button>
      </div>
      <div v-else class="sesiones-grid">
        <div class="sesion-card" v-for="sesion in sesiones" :key="sesion.id">
          <div class="sesion-header">
            <div class="sesion-fecha">
              <CalendarIcon class="icon-sm" />
              {{ formatFecha(sesion.scheduled_date) }}
            </div>
            <div class="sesion-estado" :class="sesion.estado">
              <CheckCircleIcon v-if="sesion.estado === 'completada'" class="icon-sm" />
              <ClockIcon v-else class="icon-sm" />
              {{ sesion.estado }}
            </div>
          </div>
          <div class="sesion-body">
            <h4 class="sesion-titulo">{{ sesion.objectives }}</h4>
            <div class="sesion-meta">
              <div class="meta-item">
                <UserIcon class="icon-xs" />
                {{ sesion.therapist }}
              </div>
              <div class="meta-item">
                <ClockIcon class="icon-xs" />
                {{ sesion.duration_minutes }} min
              </div>
            </div>
          </div>
          <div class="sesion-footer">
            <button class="btn btn-sm btn-outline" @click="$emit('verDetalleSesion', sesion.id)">
              <EyeIcon class="icon-xs" />
              Ver Detalle
            </button>
            <button class="btn btn-sm btn-primary" @click="$emit('editarSesion', sesion.id)">
              <PencilIcon class="icon-xs" />
              Editar
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import {
  ChatBubbleLeftRightIcon,
  ArrowPathIcon,
  PlusIcon,
  CalendarIcon,
  CheckCircleIcon,
  ClockIcon,
  FlagIcon,
  EyeIcon,
  PencilIcon,
  UserIcon,
  PrinterIcon  // âœ… NUEVO: Importar Ã­cono de impresora
} from '@heroicons/vue/24/outline'

defineProps<{
  loadingSesiones: boolean
  sesiones: any[]
  statsSesiones: any
}>()

defineEmits<{
  cargarSesiones: []
  abrirModalSesion: []
  verDetalleSesion: [id: number]
  editarSesion: [id: number]
}>()

const formatFecha = (fecha: string) => {
  return new Date(fecha).toLocaleDateString('es-CL')
}

// âœ… NUEVO: FunciÃ³n para llamar a la impresiÃ³n del navegador
const imprimir = () => {
  window.print()
}
</script>

<style scoped>
.tab-pane {
  padding: 2rem;
}

.sesiones-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 2rem;
}

.section-title {
  display: flex;
  align-items: center;
  gap: 0.75rem;
}

.section-title h3 {
  margin: 0;
  color: #1f2937;
}

.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1rem;
  margin-bottom: 2rem;
}

.stat-card {
  display: flex;
  align-items: center;
  gap: 1rem;
  padding: 1.5rem;
  border: 1px solid #e2e8f0;
  border-radius: 12px;
  background: white;
}

.stat-icon {
  width: 60px;
  height: 60px;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.stat-icon.total {
  background: #dbeafe;
  color: #1e40af;
}

.stat-icon.completed {
  background: #dcfce7;
  color: #166534;
}

.stat-icon.pending {
  background: #fef3c7;
  color: #92400e;
}

.stat-icon.goals {
  background: #f3e8ff;
  color: #7c3aed;
}

.stat-info {
  display: flex;
  flex-direction: column;
}

.stat-number {
  font-size: 1.5rem;
  font-weight: 700;
  color: #1f2937;
}

.stat-label {
  font-size: 0.875rem;
  color: #6b7280;
}

.sesiones-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
  gap: 1.5rem;
}

.sesion-card {
  border: 1px solid #e2e8f0;
  border-radius: 12px;
  overflow: hidden;
  background: white;
}

.sesion-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1rem 1.5rem;
  background: #f8fafc;
  border-bottom: 1px solid #e2e8f0;
}

.sesion-fecha {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  color: #374151;
  font-weight: 500;
}

.sesion-estado {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.25rem 0.75rem;
  border-radius: 20px;
  font-size: 0.75rem;
  font-weight: 500;
}

.sesion-estado.completada {
  background: #dcfce7;
  color: #166534;
}

.sesion-estado.pendiente {
  background: #fef3c7;
  color: #92400e;
}

.sesion-body {
  padding: 1.5rem;
}

.sesion-titulo {
  margin: 0 0 1rem 0;
  color: #1f2937;
  font-size: 1rem;
}

.sesion-meta {
  display: flex;
  gap: 1rem;
}

.meta-item {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-size: 0.875rem;
  color: #6b7280;
}

.sesion-footer {
  padding: 1rem 1.5rem;
  border-top: 1px solid #f1f5f9;
  display: flex;
  gap: 0.75rem;
}

.btn {
  padding: 0.75rem 1.5rem;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 500;
  transition: all 0.2s;
  text-decoration: none;
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  font-size: 0.875rem;
}

.btn-primary {
  background: #3b82f6;
  color: white;
}

.btn-primary:hover {
  background: #2563eb;
}

.btn-secondary {
  background: #6b7280;
  color: white;
}

.btn-secondary:hover {
  background: #4b5563;
}

.btn-outline {
  background: transparent;
  border: 1px solid #d1d5db;
  color: #374151;
}

.btn-outline:hover {
  background: #f9fafb;
}

.btn-sm {
  padding: 0.5rem 1rem;
  font-size: 0.75rem;
}

.loading-state {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  padding: 2rem;
  color: #6b7280;
  justify-content: center;
}

.empty-state {
  text-align: center;
  padding: 3rem;
  color: #6b7280;
}

.empty-state h4 {
  margin: 1rem 0 0.5rem 0;
  color: #374151;
}

.empty-state p {
  margin: 0 0 1.5rem 0;
}

.icon-xs {
  width: 1rem;
  height: 1rem;
}

.icon-sm {
  width: 1.25rem;
  height: 1.25rem;
}

.icon-lg {
  width: 2rem;
  height: 2rem;
}

.icon-xxl {
  width: 3rem;
  height: 3rem;
}

@media (max-width: 768px) {
  .tab-pane {
    padding: 1rem;
  }
  
  .sesiones-grid {
    grid-template-columns: 1fr;
  }
  
  .sesiones-header {
    flex-direction: column;
    gap: 1rem;
    align-items: flex-start;
  }
}
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\profile\tabcontent\documentos\DocumentosArchivos.vue
============================================================
<!-- src/components/profile/tabcontent/card/DocumentosArchivos.vue -->
<template>
  <div class="tab-pane">
    <div class="documentos-header">
      <div class="section-title">
        <FolderIcon class="icon-lg" />
        <h3>Documentos</h3>
      </div>
      <div class="header-actions">
        <button class="btn btn-secondary" @click="$emit('cargarDocumentos')">
          <ArrowPathIcon class="icon-sm" />
          Actualizar
        </button>
        <button class="btn btn-primary" @click="$emit('subirDocumento')">
          <CloudArrowUpIcon class="icon-sm" />
          Subir Documento
        </button>
      </div>
    </div>

    <!-- ESTADÃSTICAS DOCUMENTOS -->
    <div class="docs-stats">
      <div class="doc-stat">
        <DocumentTextIcon class="icon-lg" />
        <span class="stat-number">{{ statsDocumentos.total }}</span>
        <span class="stat-label">Total Documentos</span>
      </div>
      <div class="doc-stat">
        <PhotoIcon class="icon-lg" />
        <span class="stat-number">{{ statsDocumentos.imagenes }}</span>
        <span class="stat-label">ImÃ¡genes</span>
      </div>
      <div class="doc-stat">
        <VideoCameraIcon class="icon-lg" />
        <span class="stat-number">{{ statsDocumentos.videos }}</span>
        <span class="stat-label">Videos</span>
      </div>
      <div class="doc-stat">
        <DocumentChartBarIcon class="icon-lg" />
        <span class="stat-number">{{ statsDocumentos.reportes }}</span>
        <span class="stat-label">Reportes</span>
      </div>
    </div>

    <!-- LISTA DE DOCUMENTOS -->
    <div class="documentos-list">
      <div v-if="loadingDocumentos" class="loading-state">
        Cargando documentos...
      </div>
      <div v-else-if="documentos.length === 0" class="empty-state">
        <FolderOpenIcon class="icon-xxl" />
        <h4>No hay documentos</h4>
        <p>Comienza subiendo el primer documento</p>
        <button class="btn btn-primary" @click="$emit('subirDocumento')">
          <CloudArrowUpIcon class="icon-sm" />
          Subir Primer Documento
        </button>
      </div>
      <div v-else class="documentos-grid">
        <div class="documento-card" v-for="doc in documentos" :key="doc.id">
          <div class="doc-icon">
            <component :is="doc.icono" class="icon-xl" />
          </div>
          <div class="doc-content">
            <h4 class="doc-name">{{ doc.name }}</h4>
            <div class="doc-meta">
              <span class="doc-type">{{ doc.type }}</span>
              <span class="doc-date">{{ doc.fecha }}</span>
              <span class="doc-size">{{ doc.size }}</span>
            </div>
          </div>
          <div class="doc-actions">
            <button class="btn btn-icon" @click="$emit('descargarDocumento', doc.id)" title="Descargar">
              <ArrowDownTrayIcon class="icon-sm" />
            </button>
            <button class="btn btn-icon" @click="$emit('verDocumento', doc.id)" title="Vista previa">
              <EyeIcon class="icon-sm" />
            </button>
            <button class="btn btn-icon" @click="$emit('eliminarDocumento', doc.id)" title="Eliminar">
              <TrashIcon class="icon-sm" />
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import {
  FolderIcon,
  ArrowPathIcon,
  CloudArrowUpIcon,
  DocumentTextIcon,
  PhotoIcon,
  VideoCameraIcon,
  DocumentChartBarIcon,
  FolderOpenIcon,
  ArrowDownTrayIcon,
  EyeIcon,
  TrashIcon
} from '@heroicons/vue/24/outline'

defineProps<{
  loadingDocumentos: boolean
  documentos: any[]
  statsDocumentos: any
}>()

defineEmits<{
  cargarDocumentos: []
  subirDocumento: []
  descargarDocumento: [id: number]
  verDocumento: [id: number]
  eliminarDocumento: [id: number]
}>()
</script>

<style scoped>
.tab-pane {
  padding: 2rem;
}

.documentos-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 2rem;
}

.section-title {
  display: flex;
  align-items: center;
  gap: 0.75rem;
}

.section-title h3 {
  margin: 0;
  color: #1f2937;
}

.docs-stats {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: 1rem;
  margin-bottom: 2rem;
}

.doc-stat {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 1.5rem;
  border: 1px solid #e2e8f0;
  border-radius: 12px;
  background: white;
  text-align: center;
}

.documentos-grid {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.documento-card {
  display: flex;
  align-items: center;
  gap: 1rem;
  padding: 1.5rem;
  border: 1px solid #e2e8f0;
  border-radius: 12px;
  background: white;
}

.doc-icon {
  width: 60px;
  height: 60px;
  border-radius: 8px;
  background: #f8fafc;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #64748b;
}

.doc-content {
  flex: 1;
}

.doc-name {
  margin: 0 0 0.5rem 0;
  color: #1f2937;
}

.doc-meta {
  display: flex;
  gap: 1rem;
  font-size: 0.875rem;
  color: #6b7280;
}

.doc-actions {
  display: flex;
  gap: 0.5rem;
}

.btn {
  padding: 0.75rem 1.5rem;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 500;
  transition: all 0.2s;
  text-decoration: none;
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  font-size: 0.875rem;
}

.btn-primary {
  background: #3b82f6;
  color: white;
}

.btn-primary:hover {
  background: #2563eb;
}

.btn-secondary {
  background: #6b7280;
  color: white;
}

.btn-secondary:hover {
  background: #4b5563;
}

.btn-icon {
  padding: 0.5rem;
  border-radius: 6px;
  background: transparent;
  border: 1px solid #e2e8f0;
  color: #64748b;
}

.btn-icon:hover {
  background: #f8fafc;
}

.loading-state {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  padding: 2rem;
  color: #6b7280;
  justify-content: center;
}

.empty-state {
  text-align: center;
  padding: 3rem;
  color: #6b7280;
}

.empty-state h4 {
  margin: 1rem 0 0.5rem 0;
  color: #374151;
}

.empty-state p {
  margin: 0 0 1.5rem 0;
}

.icon-sm {
  width: 1.25rem;
  height: 1.25rem;
}

.icon-lg {
  width: 2rem;
  height: 2rem;
}

.icon-xl {
  width: 2.5rem;
  height: 2.5rem;
}

.icon-xxl {
  width: 3rem;
  height: 3rem;
}

@media (max-width: 768px) {
  .tab-pane {
    padding: 1rem;
  }
  
  .documentos-header {
    flex-direction: column;
    gap: 1rem;
    align-items: flex-start;
  }
}
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\profile\tabcontent\reportes\ReporteCompleto.vue
============================================================
<!-- src/components/profile/tabcontent/card/ReporteCompleto.vue -->
<template>
  <div class="tab-pane">
    <div class="reportes-header">
      <div class="section-title">
        <DocumentChartBarIcon class="icon-lg" />
        <h3>Reportes y AnÃ¡lisis</h3>
      </div>
    </div>

    <!-- ACCIONES PRINCIPALES -->
    <div class="reportes-actions">
      <div class="reporte-card" @click="$emit('generarReporteCompleto')">
        <div class="reporte-icon">
          <DocumentTextIcon class="icon-xl" />
        </div>
        <div class="reporte-content">
          <h4>Reporte Completo</h4>
          <p>Genera un reporte detallado con toda la informaciÃ³n del niÃ±o</p>
        </div>
        <ArrowRightIcon class="icon-sm" />
      </div>

      <div class="reporte-card" @click="$emit('compararProgreso')">
        <div class="reporte-icon">
          <ChartBarSquareIcon class="icon-xl" />
        </div>
        <div class="reporte-content">
          <h4>Comparar Progreso</h4>
          <p>Analiza la evoluciÃ³n entre diferentes perÃ­odos de tiempo</p>
        </div>
        <ArrowRightIcon class="icon-sm" />
      </div>

      <div class="reporte-card" @click="$emit('exportarDatos')">
        <div class="reporte-icon">
          <DocumentArrowDownIcon class="icon-xl" />
        </div>
        <div class="reporte-content">
          <h4>Exportar Datos</h4>
          <p>Exporta toda la informaciÃ³n en diferentes formatos</p>
        </div>
        <ArrowRightIcon class="icon-sm" />
      </div>

      <div class="reporte-card" @click="$emit('verDashboard')">
        <div class="reporte-icon">
          <PresentationChartLineIcon class="icon-xl" />
        </div>
        <div class="reporte-content">
          <h4>Dashboard Interactivo</h4>
          <p>Visualiza mÃ©tricas y tendencias en tiempo real</p>
        </div>
        <ArrowRightIcon class="icon-sm" />
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import {
  DocumentChartBarIcon,
  DocumentTextIcon,
  ChartBarSquareIcon,
  DocumentArrowDownIcon,
  PresentationChartLineIcon,
  ArrowRightIcon
} from '@heroicons/vue/24/outline'

defineEmits<{
  generarReporteCompleto: []
  compararProgreso: []
  exportarDatos: []
  verDashboard: []
}>()
</script>

<style scoped>
.tab-pane {
  padding: 2rem;
}

.reportes-header {
  margin-bottom: 2rem;
}

.section-title {
  display: flex;
  align-items: center;
  gap: 0.75rem;
}

.section-title h3 {
  margin: 0;
  color: #1f2937;
}

.reportes-actions {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 1.5rem;
  margin-bottom: 2rem;
}

.reporte-card {
  display: flex;
  align-items: center;
  gap: 1rem;
  padding: 1.5rem;
  border: 1px solid #e2e8f0;
  border-radius: 12px;
  background: white;
  cursor: pointer;
  transition: all 0.2s;
}

.reporte-card:hover {
  border-color: #3b82f6;
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.reporte-icon {
  width: 60px;
  height: 60px;
  border-radius: 8px;
  background: #dbeafe;
  color: #1e40af;
  display: flex;
  align-items: center;
  justify-content: center;
}

.reporte-content {
  flex: 1;
}

.reporte-content h4 {
  margin: 0 0 0.5rem 0;
  color: #1f2937;
}

.reporte-content p {
  margin: 0;
  color: #6b7280;
  font-size: 0.875rem;
}

.icon-sm {
  width: 1.25rem;
  height: 1.25rem;
}

.icon-lg {
  width: 2rem;
  height: 2rem;
}

.icon-xl {
  width: 2.5rem;
  height: 2.5rem;
}

@media (max-width: 768px) {
  .tab-pane {
    padding: 1rem;
  }
  
  .reportes-actions {
    grid-template-columns: 1fr;
  }
}
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\profile\tabcontent\TabContent.vue
============================================================
<template>
  <div class="tab-content">
    <div v-if="activeTab === 'general'" class="tab-pane">
      <div class="info-grid">
        <InformacionPersonal
          :personal-data="profileData?.cards?.personal"
        />

        <NecesidadesEspeciales
          :special-needs-data="profileData?.cards?.special_needs"
        />

        <RegistroPIE
          :pie-data="profileData?.cards?.pie"
        />

        <InformacionMedica
          :medical-data="profileData?.cards?.medical"
        />

        <InformacionEscolar
          :school-data="profileData?.cards?.school"
        />

        <InformacionTutor
          :guardian-data="profileData?.cards?.guardian"
        />

        <HistorialTerapias
          :therapy-data="profileData?.cards?.therapy"
        />

        <InformacionBasica
          :location-data="profileData?.cards?.location"
          :loading="loading"
        />

        <ContactoEmergencia
          :contactos="contactos"
          @gestionar-contactos="$emit('gestionarContactos')"
        />

        <RegistroDiagnostico
          :diagnosticos="diagnosticos"
          @add-diagnosis="$emit('add-diagnosis')"
        />

        <HistorialMedico
          :historial-count="historialCount"
          :medicamentos-count="medicamentosCount"
          @ver-historial-completo="$emit('verHistorialCompleto')"
        />

        <InteresesPrincipales
          v-if="childId"
          :key="`intereses-${childId}-${interestUpdateKey}`"
          :child-id="childId"
          @gestionar-intereses="$emit('gestionarIntereses')"
        />

      </div>
    </div>

    <div v-if="activeTab === 'sesiones'">
      <SesionesTerapia
        :loading-sesiones="loadingSesiones"
        :sesiones="sesiones"
        :stats-sesiones="statsSesiones"
        @cargar-sesiones="$emit('cargarSesiones')"
        @abrir-modal-sesion="$emit('abrirModalSesion')"
        @ver-detalle-sesion="$emit('verDetalleSesion', $event)"
        @editar-sesion="$emit('editarSesion', $event)"
      />
    </div>

    <div v-if="activeTab === 'progreso'">
      <ProgresoMetricas
        :periodo="periodo"
        :metricas="metricas"
        :registros-recientes="registrosRecientes"
        @update:periodo="$emit('update:periodo', $event)"
        @cargar-hitos-desarrollo="$emit('cargarHitosDesarrollo')"
        @cargar-progresos-comunicacion="$emit('cargarProgresosComunicacion')"
        @cargar-habilidades-sociales="$emit('cargarHabilidadesSociales')"
      />
    </div>

    <div v-if="activeTab === 'documentos'">
      <DocumentosArchivos
        :loading-documentos="loadingDocumentos"
        :documentos="documentos"
        :stats-documentos="statsDocumentos"
        @cargar-documentos="$emit('cargarDocumentos')"
        @subir-documento="$emit('subirDocumento')"
        @descargar-documento="$emit('descargarDocumento', $event)"
        @ver-documento="$emit('verDocumento', $event)"
        @eliminar-documento="$emit('eliminarDocumento', $event)"
      />
    </div>

    <div v-if="activeTab === 'reportes'">
      <ReporteCompleto
        @generar-reporte-completo="$emit('generarReporteCompleto')"
        @comparar-progreso="$emit('compararProgreso')"
        @exportar-datos="$emit('exportarDatos')"
        @ver-dashboard="$emit('verDashboard')"
      />
      <ReportesRapido
        @generar-reporte-sesiones="$emit('generarReporteSesiones')"
        @generar-reporte-progreso="$emit('generarReporteProgreso')"
        @generar-reporte-comportamiento="$emit('generarReporteComportamiento')"
        @generar-reporte-medico="$emit('generarReporteMedico')"
      />
    </div>
  </div>
</template>

<script setup lang="ts">
import { watch } from 'vue'

import InformacionPersonal from './card/informaciongeneral/InformacionPersonal.vue'
import NecesidadesEspeciales from './card/informaciongeneral/NecesidadesEspeciales.vue'
import RegistroPIE from './card/informaciongeneral/RegistroPIE.vue'
import InformacionMedica from './card/informaciongeneral/InformacionMedica.vue'
import InformacionEscolar from './card/informaciongeneral/InformacionEscolar.vue'
import InformacionTutor from './card/informaciongeneral/InformacionTutor.vue'
import HistorialTerapias from './card/informaciongeneral/HistorialTerapias.vue'
import InformacionBasica from './card/informaciongeneral/InformacionBasica.vue'
import InteresesPrincipales from './card/informaciongeneral/InteresesPrincipales.vue'

import ContactoEmergencia from './card/informaciongeneral/ContactoEmergencia.vue'
import RegistroDiagnostico from './card/informaciongeneral/RegistroDiagnostico.vue'
import HistorialMedico from './card/informaciongeneral/HistorialMedico.vue'

import SesionesTerapia from './card/sesionesterapia/SesionesTerapia.vue'
import ProgresoMetricas from './card/progresometricas/ProgresoMetricas.vue'
import DocumentosArchivos from './documentos/DocumentosArchivos.vue'
import ReporteCompleto from './reportes/ReporteCompleto.vue'
import ReportesRapido from './card/ReportesRapido.vue'

const props = defineProps<{
  activeTab: string
  profileData?: any
  loading: boolean
  contactos: any[]
  diagnosticos: any[]
  historialCount: number
  medicamentosCount: number
  loadingSesiones: boolean
  sesiones: any[]
  statsSesiones: any
  periodo: string
  metricas: any
  registrosRecientes: any[]
  loadingDocumentos: boolean
  documentos: any[]
  statsDocumentos: any
  childId?: string | number
  interestUpdateKey?: number
}>()

watch(() => props.profileData, (newVal) => {
  console.log('ğŸ“¦ [TabContent] profileData actualizado:', newVal)
  console.log('ğŸ†” [TabContent] childId recibido:', props.childId)
  console.log('ğŸ”‘ [TabContent] interestUpdateKey:', props.interestUpdateKey)
}, { immediate: true, deep: true })

defineEmits<{
  gestionarContactos: []
  verHistorialCompleto: []
  cargarSesiones: []
  abrirModalSesion: []
  verDetalleSesion: [id: number]
  editarSesion: [id: number]
  'update:periodo': [value: string]
  cargarHitosDesarrollo: []
  cargarProgresosComunicacion: []
  cargarHabilidadesSociales: []
  cargarDocumentos: []
  subirDocumento: []
  descargarDocumento: [id: number]
  verDocumento: [id: number]
  eliminarDocumento: [id: number]
  generarReporteCompleto: []
  compararProgreso: []
  exportarDatos: []
  verDashboard: []
  generarReporteSesiones: []
  generarReporteProgreso: []
  generarReporteComportamiento: []
  generarReporteMedico: []
  'add-diagnosis': []
  'gestionarIntereses': []
}>()
</script>

<style scoped>
.tab-content {
  background: white;
  border-radius: 12px;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  overflow: hidden;
}

.tab-pane {
  padding: 1.5rem;
}

.info-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
  gap: 1.5rem;
}

@media (max-width: 768px) {
  .tab-pane {
    padding: 1rem;
  }

  .info-grid {
    grid-template-columns: 1fr;
    gap: 1rem;
  }
}
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\sesiones\documentacion-sesion\CabeceraDocumentacion.vue
============================================================
<template>
  <header class="header-container">
    <div class="header-content">
      <!-- Icono y TÃ­tulo -->
      <div class="header-title-group">
        <div class="icon-wrapper">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-indigo-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
          </svg>
        </div>
        <div>
          <h1 class="main-title">
            Documentando SesiÃ³n #{{ sessionNumber }}
          </h1>
          <p class="sub-title">
            para <span class="font-semibold text-gray-800">{{ childName }}</span>
            <span v-if="childRut" class="text-gray-600 ml-2">({{ childRut }})</span>
          </p>
          
          <!-- NUEVA INFORMACIÃ“N ADICIONAL -->
          <div class="additional-info" v-if="showAdditionalInfo && hasAdditionalData">
            <div class="info-grid">
              <div class="info-item">
                <span class="info-label">Apoderado:</span>
                <span class="info-value">{{ guardianName || 'No especificado' }}</span>
              </div>
              <div class="info-item">
                <span class="info-label">Ingreso PIE:</span>
                <span class="info-value">{{ formatDate(entryDate) }}</span>
              </div>
              <div class="info-item">
                <span class="info-label">Total sesiones:</span>
                <span class="info-value">{{ totalSessions }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- BotÃ³n de AcciÃ³n -->
      <button class="back-button" @click="$emit('volver')">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M11 15l-3-3m0 0l3-3m-3 3h8M3 12a9 9 0 1118 0 9 9 0 01-18 0z" />
        </svg>
        <span>Volver al Perfil</span>
      </button>
    </div>
  </header>
</template>

<script setup lang="ts">
import { computed } from 'vue';

// Props actualizadas para recibir todos los datos del serializer
interface Props {
  childName: string;
  sessionNumber: number;
  childRut?: string;
  guardianName?: string;
  entryDate?: string;
  totalSessions?: number;
  showAdditionalInfo?: boolean;
}

const props = withDefaults(defineProps<Props>(), {
  childRut: '',
  guardianName: '',
  entryDate: '',
  totalSessions: 0,
  showAdditionalInfo: true
});

defineEmits<{
  (e: 'volver'): void;
}>();

// Computed para verificar si hay datos adicionales para mostrar
const hasAdditionalData = computed(() => {
  return props.guardianName || props.entryDate || props.totalSessions > 0;
});

// FunciÃ³n auxiliar para formatear fecha
const formatDate = (dateString?: string) => {
  if (!dateString) return 'No especificado';
  
  try {
    const date = new Date(dateString);
    return date.toLocaleDateString('es-CL', {
      day: '2-digit',
      month: '2-digit',
      year: 'numeric'
    });
  } catch (error) {
    return 'Fecha invÃ¡lida';
  }
};
</script>

<style scoped>
.header-container {
  @apply w-full bg-white border-b border-gray-200 shadow-sm;
}
.header-content {
  @apply max-w-7xl mx-auto p-4 sm:p-6 lg:p-8 flex justify-between items-center;
}
.header-title-group {
  @apply flex items-center gap-4;
}
.icon-wrapper {
  @apply hidden sm:flex items-center justify-center h-16 w-16 rounded-full bg-indigo-100;
}
.main-title {
  @apply text-xl sm:text-2xl font-bold text-gray-900;
}
.sub-title {
  @apply text-sm text-gray-500 mt-1;
}
.additional-info {
  @apply mt-3;
}
.info-grid {
  @apply flex flex-wrap gap-4 sm:gap-6;
}
.info-item {
  @apply flex items-center gap-2;
}
.info-label {
  @apply text-xs font-medium text-gray-500;
}
.info-value {
  @apply text-xs font-semibold text-gray-700;
}
.back-button {
  @apply inline-flex items-center gap-2 px-4 py-2 bg-white border border-gray-300 rounded-md text-sm font-semibold text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors;
}

/* Responsive adjustments */
@media (max-width: 640px) {
  .header-content {
    @apply flex-col items-start gap-4;
  }
  
  .header-title-group {
    @apply w-full;
  }
  
  .back-button {
    @apply self-end;
  }
  
  .info-grid {
    @apply flex-col gap-2;
  }
}
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\sesiones\documentacion-sesion\GestionObjetivosSesion.vue
============================================================
<template>
  <div class="card">
    <div class="card-header">
      <h3 class="card-title">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-indigo-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4" />
        </svg>
        Objetivos EspecÃ­ficos de la SesiÃ³n
      </h3>
      <button v-if="!showAddForm" @click="showAddForm = true" class="btn btn-primary btn-sm">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd" />
        </svg>
        AÃ±adir Objetivo
      </button>
    </div>

    <!-- Formulario para AÃ±adir Nuevo Objetivo -->
    <div v-if="showAddForm" class="add-form-container">
      <FormKit
        type="form"
        v-model="newGoalData"
        @submit="handleAddNewGoal"
        :actions="false"
        form-class="flex flex-col sm:flex-row items-start gap-4"
      >
        <FormKit
          type="text"
          name="description"
          placeholder="Describe el nuevo objetivo..."
          validation="required"
          outer-class="flex-grow w-full"
        />
        <FormKit
          type="select"
          name="priority"
          :options="priorityOptions"
          validation="required"
          outer-class="w-full sm:w-48"
        />
        <div class="flex gap-2 mt-2 sm:mt-0">
          <FormKit type="submit" :label="isAdding ? 'AÃ±adiendo...' : 'AÃ±adir'" :disabled="isAdding" />
          <button type="button" @click="showAddForm = false" class="btn btn-secondary">Cancelar</button>
        </div>
      </FormKit>
    </div>

    <!-- Tabla de Objetivos -->
    <div class="table-container">
      <div v-if="isLoading" class="loading-state">Cargando objetivos...</div>
      <div v-else-if="goals.length === 0" class="empty-state">
        <p>No hay objetivos definidos para esta sesiÃ³n.</p>
        <p>Comienza aÃ±adiendo el primero.</p>
      </div>
      <table v-else class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th scope="col">Prioridad</th>
            <th scope="col">DescripciÃ³n</th>
            <th scope="col">Progreso</th>
            <th scope="col">Estado</th>
            <th scope="col">Acciones</th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          <tr v-for="goal in goals" :key="goal.id">
            <td class="whitespace-nowrap">
              <span class="priority-badge" :class="`priority-${goal.priority}`">
                {{ goal.priority.charAt(0).toUpperCase() + goal.priority.slice(1) }}
              </span>
            </td>
            <td>{{ goal.description }}</td>
            <td class="w-48">
              <div class="flex items-center gap-2">
                <div class="w-full bg-gray-200 rounded-full h-2.5">
                  <div class="bg-blue-600 h-2.5 rounded-full" :style="{ width: `${goal.progress_percentage}%` }"></div>
                </div>
                <span class="text-sm font-medium text-gray-700">{{ goal.progress_percentage }}%</span>
              </div>
            </td>
            <td class="whitespace-nowrap">
              <div class="flex items-center">
                <input
                  :id="`achieved-${goal.id}`"
                  type="checkbox"
                  class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"
                  :checked="goal.achieved"
                  @change="toggleAchieved(goal, ($event.target as HTMLInputElement).checked)"
                />
                <label :for="`achieved-${goal.id}`" class="ml-2 block text-sm text-gray-900">
                  {{ goal.achieved ? 'Logrado' : 'En Progreso' }}
                </label>
              </div>
            </td>
            <td class="whitespace-nowrap">
              <button @click="handleDeleteGoal(goal.id)" class="btn-icon">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
                </svg>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, onMounted } from 'vue';
import { useAlertModalStore } from '@/store/alertModalStore';
import { createGoalForSession, deleteGoal, getGoalsForSession, type SessionGoal, updateGoal } from '@/services/sessionService';


const props = defineProps<{
  childId: number; // âœ… Necesario para las llamadas a la API
  sessionId: number;
}>();

const alertModal = useAlertModalStore();

const goals = ref<SessionGoal[]>([]);
const isLoading = ref(true);
const isAdding = ref(false);
const showAddForm = ref(false);
const newGoalData = ref({
  description: '',
  priority: 'media' as const,
});

const priorityOptions = [
  { value: 'alta', label: 'Alta' },
  { value: 'media', label: 'Media' },
  { value: 'baja', label: 'Baja' },
];

onMounted(fetchGoals);

async function fetchGoals() {
  isLoading.value = true;
  try {
    // âœ… CORRECCIÃ“N: Pasar ambos IDs a la funciÃ³n del servicio
    goals.value = await getGoalsForSession(props.childId, props.sessionId);
  } catch (error) {
    console.error("Error al cargar objetivos:", error);
    alertModal.error('Error', 'No se pudieron cargar los objetivos de la sesiÃ³n.');
  } finally {
    isLoading.value = false;
  }
}

async function handleAddNewGoal() {
  if (!newGoalData.value.description) return;
  isAdding.value = true;
  try {
    // âœ… CORRECCIÃ“N: Pasar ambos IDs a la funciÃ³n del servicio
    const newGoal = await createGoalForSession(props.childId, props.sessionId, newGoalData.value);
    goals.value.push(newGoal);
    showAddForm.value = false;
    newGoalData.value.description = '';
    newGoalData.value.priority = 'media';
  } catch (error) {
    console.error("Error al aÃ±adir objetivo:", error);
    alertModal.error('Error', 'No se pudo aÃ±adir el nuevo objetivo.');
  } finally {
    isAdding.value = false;
  }
}

async function handleDeleteGoal(goalId: number) {
  alertModal.confirm(
    'Confirmar EliminaciÃ³n',
    'Â¿EstÃ¡s seguro de que quieres eliminar este objetivo? Esta acciÃ³n no se puede deshacer.',
    async () => {
      try {
        // âœ… CORRECCIÃ“N: Pasar todos los IDs necesarios a la funciÃ³n del servicio
        await deleteGoal(props.childId, props.sessionId, goalId);
        goals.value = goals.value.filter(g => g.id !== goalId);
        alertModal.success('Eliminado', 'El objetivo ha sido eliminado.');
      } catch (error) {
        console.error("Error al eliminar objetivo:", error);
        alertModal.error('Error', 'No se pudo eliminar el objetivo.');
      }
    }
  );
}

async function toggleAchieved(goal: SessionGoal, isChecked: boolean) {
  const originalAchieved = goal.achieved;
  const originalProgress = goal.progress_percentage;
  
  goal.achieved = isChecked;
  goal.progress_percentage = isChecked ? 100 : originalProgress === 100 ? 0 : originalProgress;

  try {
    // âœ… CORRECCIÃ“N: Pasar todos los IDs necesarios a la funciÃ³n del servicio
    await updateGoal(props.childId, props.sessionId, goal.id, {
      achieved: goal.achieved,
      progress_percentage: goal.progress_percentage,
    });
  } catch (error) {
    console.error("Error al actualizar objetivo:", error);
    alertModal.error('Error', 'No se pudo actualizar el estado del objetivo.');
    // Revertir en caso de error
    goal.achieved = originalAchieved;
    goal.progress_percentage = originalProgress;
  }
}
</script>

<style scoped>
.card {
  @apply bg-white rounded-lg shadow border border-gray-200;
}
.card-header {
  @apply p-4 border-b border-gray-200 flex justify-between items-center;
}
.card-title {
  @apply text-lg font-semibold text-gray-800 flex items-center gap-3;
}
.add-form-container {
  @apply p-4 bg-gray-50;
}
.table-container {
  @apply overflow-x-auto;
}
.loading-state, .empty-state {
  @apply text-center p-8 text-gray-500;
}
th {
  @apply px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider;
}
td {
  @apply px-6 py-4 text-sm text-gray-700;
}
.priority-badge {
  @apply px-2.5 py-0.5 text-xs font-semibold rounded-full;
}
.priority-alta {
  @apply bg-red-100 text-red-800;
}
.priority-media {
  @apply bg-yellow-100 text-yellow-800;
}
.priority-baja {
  @apply bg-green-100 text-green-800;
}
.btn-icon {
  @apply text-gray-400 hover:text-red-600 transition-colors duration-200;
}
.btn {
    @apply inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white focus:outline-none focus:ring-2 focus:ring-offset-2;
}
.btn-primary {
    @apply bg-indigo-600 hover:bg-indigo-700 focus:ring-indigo-500;
}
.btn-sm {
    @apply px-3 py-1.5 text-xs;
}
.btn-secondary {
    @apply bg-white text-gray-700 border-gray-300 hover:bg-gray-50 focus:ring-indigo-500;
}
</style>



============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\sesiones\documentacion-sesion\SeccionEstadoAsistencia.vue
============================================================
<template>
  <div class="card">
    <div class="card-header">
      <h3 class="card-title">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-indigo-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
        </svg>
        Estado y Asistencia
      </h3>
    </div>
    <div class="card-body">
      <div class="form-grid">
        <!-- Estado de la Asistencia -->
        <FormKit
          type="select"
          name="attendance_status"
          label="Estado de la Asistencia"
          placeholder="Selecciona un estado"
          :options="attendanceOptions"
          help="Registra si el niÃ±o asistiÃ³, se ausentÃ³ o si la sesiÃ³n fue cancelada."
        />

        <!-- Motivo de CancelaciÃ³n (Condicional) -->
        <!-- Este campo solo aparece si se selecciona un estado de cancelaciÃ³n -->
        <FormKit
          type="textarea"
          name="cancellation_reason"
          label="Motivo de CancelaciÃ³n/Ausencia"
          placeholder="Describe brevemente el motivo..."
          rows="3"
          v-if="attendanceStatus && (attendanceStatus.includes('ausente') || attendanceStatus.includes('cancelado'))"
          help="Aplica para ausencias o cancelaciones."
        />

        <!-- Fecha y Hora Real -->
        <FormKit
          type="datetime-local"
          name="actual_date"
          label="Fecha y Hora de RealizaciÃ³n"
          help="La fecha y hora exacta en que se realizÃ³ la sesiÃ³n. Se llena automÃ¡ticamente si el estado es 'AsistiÃ³'."
        />

        <!-- DuraciÃ³n en Minutos -->
        <FormKit
          type="number"
          name="duration_minutes"
          label="DuraciÃ³n Real (minutos)"
          help="DuraciÃ³n final de la sesiÃ³n en minutos."
          validation="number|min:0"
        />
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
// Opciones para el campo de selecciÃ³n, basadas en el modelo de Django.
const attendanceOptions = [
  { value: 'asistio', label: 'AsistiÃ³' },
  { value: 'ausente_justificado', label: 'Ausente (Justificado)' },
  { value: 'ausente_sin_aviso', label: 'Ausente (Sin Aviso)' },
  { value: 'cancelado_terapeuta', label: 'Cancelado por Terapeuta' },
  { value: 'cancelado_familia', label: 'Cancelado por Familia' },
  { value: 'reprogramado', label: 'Reprogramado' },
  { value: 'suspendido', label: 'Suspendido' },
];

import { ref } from 'vue';

// Estado reactivo para el estado de asistencia
const attendanceStatus = ref<string | null>(null);

// Este componente es "tonto" (presentacional).
// No necesita lÃ³gica propia, ya que FormKit maneja el estado del formulario
// y la lÃ³gica condicional directamente en el template.
</script>

<style scoped>
.card {
  @apply bg-white rounded-lg shadow border border-gray-200;
}
.card-header {
  @apply p-4 border-b border-gray-200;
}
.card-title {
  @apply text-lg font-semibold text-gray-800 flex items-center gap-3;
}
.card-body {
  @apply p-4 md:p-6;
}
.form-grid {
  @apply grid grid-cols-1 gap-y-4;
}
</style>


============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\sesiones\documentacion-sesion\SeccionIntervenciones.vue
============================================================
<template>
  <div class="card">
    <div class="card-header">
      <h3 class="card-title">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-indigo-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M11 4a2 2 0 114 0v1a1 1 0 001 1h3a1 1 0 011 1v3a1 1 0 01-1 1h-1a2 2 0 100 4h1a1 1 0 011 1v3a1 1 0 01-1 1h-3a1 1 0 01-1-1v-1a2 2 0 10-4 0v1a1 1 0 01-1 1H7a1 1 0 01-1-1v-3a1 1 0 011-1h1a2 2 0 100-4H7a1 1 0 01-1-1V7a1 1 0 011-1h3a1 1 0 001-1V4z" />
        </svg>
        Intervenciones y TÃ©cnicas Aplicadas
      </h3>
    </div>
    <div class="card-body">
      <div class="form-grid">
        <!-- TÃ©cnicas y Estrategias Aplicadas -->
        <FormKit
          type="textarea"
          name="techniques_applied"
          label="TÃ©cnicas y Estrategias Aplicadas"
          placeholder="Ej: Se utilizÃ³ modelado para enseÃ±ar el saludo y tÃ©cnicas de respiraciÃ³n para la autorregulaciÃ³n."
          rows="5"
          help="Describe las metodologÃ­as, abordajes terapÃ©uticos o intervenciones especÃ­ficas que utilizaste."
        />

        <!-- Materiales y Recursos Utilizados -->
        <FormKit
          type="textarea"
          name="materials_used"
          label="Materiales y Recursos Utilizados"
          placeholder="Ej: Bloques de construcciÃ³n, pictogramas de emociones, pelota de terapia."
          rows="5"
          help="Menciona los juegos, instrumentos, herramientas terapÃ©uticas o tecnologÃ­a usada en la sesiÃ³n."
        />

        <!-- Intervenciones en Crisis Aplicadas -->
        <FormKit
          type="textarea"
          name="crisis_interventions"
          label="Intervenciones en Crisis (Si aplica)"
          placeholder="Ej: Se aplicÃ³ el protocolo de contenciÃ³n verbal, se retiraron estÃ­mulos estresantes y se guio al niÃ±o a un espacio de calma."
          rows="5"
          help="Si hubo una situaciÃ³n crÃ­tica o desregulaciÃ³n, describe las intervenciones especÃ­ficas que se llevaron a cabo."
          outer-class="col-span-1 sm:col-span-2"
        />
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
// Este componente es "tonto" (presentacional).
// No necesita lÃ³gica propia, ya que FormKit maneja el estado del formulario
// a travÃ©s del v-model en el componente padre (DocumentarSesionView.vue).
</script>

<style scoped>
.card {
  @apply bg-white rounded-lg shadow border border-gray-200;
}
.card-header {
  @apply p-4 border-b border-gray-200;
}
.card-title {
  @apply text-lg font-semibold text-gray-800 flex items-center gap-3;
}
.card-body {
  @apply p-4 md:p-6;
}
.form-grid {
  @apply grid grid-cols-1 sm:grid-cols-2 gap-x-6 gap-y-2;
}
</style>

============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\sesiones\documentacion-sesion\SeccionNotasClinicas.vue
============================================================
<template>
  <div class="card">
    <div class="card-header">
      <h3 class="card-title">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-indigo-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
        </svg>
        Notas ClÃ­nicas y Observaciones
      </h3>
    </div>
    <div class="card-body">
      <div class="form-grid">
        <!-- Estado Emocional al Inicio -->
        <FormKit
          type="textarea"
          name="emotional_state_start"
          label="Estado Emocional al Inicio"
          placeholder="Describe cÃ³mo llegÃ³ el niÃ±o a la sesiÃ³n: Ã¡nimo, disposiciÃ³n, comportamiento..."
          rows="4"
        />

        <!-- Estado Emocional al Finalizar -->
        <FormKit
          type="textarea"
          name="emotional_state_end"
          label="Estado Emocional al Finalizar"
          placeholder="Describe cÃ³mo terminÃ³ la sesiÃ³n el niÃ±o: cambios observados, respuesta emocional..."
          rows="4"
        />

        <!-- Fortalezas Observadas -->
        <FormKit
          type="textarea"
          name="strengths_observed"
          label="Fortalezas Observadas"
          placeholder="Menciona aspectos positivos, recursos del niÃ±o, logros espontÃ¡neos..."
          rows="4"
        />

        <!-- Dificultades Encontradas -->
        <FormKit
          type="textarea"
          name="challenges_encountered"
          label="Dificultades Encontradas"
          placeholder="Describe barreras, resistencias o contratiempos durante la sesiÃ³n..."
          rows="4"
        />

        <!-- Observaciones Generales -->
        <FormKit
          type="textarea"
          name="observations"
          label="Observaciones Generales"
          placeholder="Anota cualquier otra observaciÃ³n relevante que no encaje en las otras categorÃ­as."
          rows="5"
          outer-class="col-span-1 sm:col-span-2"
        />
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
// Este componente es "tonto" (presentacional).
// No necesita lÃ³gica propia, ya que FormKit maneja el estado del formulario
// a travÃ©s del v-model en el componente padre (DocumentarSesionView.vue).
</script>

<style scoped>
.card {
  @apply bg-white rounded-lg shadow border border-gray-200;
}
.card-header {
  @apply p-4 border-b border-gray-200;
}
.card-title {
  @apply text-lg font-semibold text-gray-800 flex items-center gap-3;
}
.card-body {
  @apply p-4 md:p-6;
}
.form-grid {
  @apply grid grid-cols-1 sm:grid-cols-2 gap-x-6 gap-y-2;
}
</style>

============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\sesiones\documentacion-sesion\SeccionPlanificacionFutura.vue
============================================================
<template>
  <div class="card">
    <div class="card-header">
      <h3 class="card-title">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-indigo-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        PlanificaciÃ³n Futura
      </h3>
    </div>
    <div class="card-body">
      <div class="form-grid">
        <!-- Tareas para Casa -->
        <FormKit
          type="textarea"
          name="homework_assigned"
          label="Tareas o Actividades para Casa"
          placeholder="Ej: Practicar la identificaciÃ³n de emociones con las tarjetas visuales."
          rows="4"
          help="Describe cualquier ejercicio o actividad asignada al niÃ±o o la familia para realizar entre sesiones."
        />

        <!-- Recomendaciones para la PrÃ³xima SesiÃ³n -->
        <FormKit
          type="textarea"
          name="next_session_recommendations"
          label="Recomendaciones para la PrÃ³xima SesiÃ³n"
          placeholder="Ej: Traer el juguete favorito del niÃ±o para trabajar el juego compartido."
          rows="4"
          help="Anotaciones o preparativos necesarios para la siguiente sesiÃ³n."
        />

        <!-- Enfoque para la PrÃ³xima SesiÃ³n -->
        <FormKit
          type="textarea"
          name="next_session_focus"
          label="Enfoque Principal para la PrÃ³xima SesiÃ³n"
          placeholder="Ej: Reforzar las habilidades de toma de turnos y la comunicaciÃ³n no verbal."
          rows="4"
          help="Temas pendientes, Ã¡reas a reforzar u objetivos para la siguiente intervenciÃ³n."
          outer-class="col-span-1 sm:col-span-2"
        />
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
// Este componente es "tonto" (presentacional).
// No necesita lÃ³gica propia, ya que FormKit maneja el estado del formulario
// a travÃ©s del v-model en el componente padre (DocumentarSesionView.vue).
</script>

<style scoped>
.card {
  @apply bg-white rounded-lg shadow border border-gray-200;
}
.card-header {
  @apply p-4 border-b border-gray-200;
}
.card-title {
  @apply text-lg font-semibold text-gray-800 flex items-center gap-3;
}
.card-body {
  @apply p-4 md:p-6;
}
.form-grid {
  @apply grid grid-cols-1 sm:grid-cols-2 gap-x-6 gap-y-2;
}
</style>

============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\sesiones\VerDetalleSesion.vue
============================================================
<template>
  <BaseModal
    :show="props.show"
    @close="handleClose"
    :title="`Detalles de la SesiÃ³n #${sessionData.session_number}`"
    size="lg"
  >
    <div v-if="sessionData" class="details-container">
      <!-- SecciÃ³n de InformaciÃ³n General -->
      <div class="section">
        <h3 class="section-title">InformaciÃ³n General</h3>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <DetailItem label="NiÃ±o" :value="sessionData.child_name || 'No especificado'" />
          <DetailItem label="Fecha Programada" :value="formatDate(sessionData.scheduled_date)" />
          <DetailItem label="Fecha RealizaciÃ³n" :value="formatDate(sessionData.actual_date) || 'No realizada'" />
          <DetailItem label="DuraciÃ³n" :value="`${sessionData.duration_minutes || 'N/A'} min`" />
          <DetailItem label="Tipo" :value="sessionData.session_type" />
          <DetailItem label="Modalidad" :value="sessionData.modality" />
        </div>
      </div>

      <!-- SecciÃ³n de Estado y Asistencia -->
      <div class="section">
        <h3 class="section-title">Estado y Asistencia</h3>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div>
            <p class="detail-label">Estado</p>
            <span
              class="px-3 py-1 text-sm font-medium rounded-full"
              :class="getStatusClass(sessionData.attendance_status)"
            >
              {{ getStatusLabel(sessionData.attendance_status) }}
            </span>
          </div>
          <DetailItem v-if="sessionData.cancellation_reason" label="Motivo de CancelaciÃ³n" :value="sessionData.cancellation_reason" />
        </div>
      </div>

      <!-- SecciÃ³n de Objetivos y Notas -->
      <div class="section">
        <h3 class="section-title">Objetivos y Notas Principales</h3>
        <div class="space-y-4">
          <DetailTextarea label="Objetivos de la SesiÃ³n" :content="sessionData.objectives" />
          <DetailTextarea label="Observaciones Generales" :content="sessionData.observations" />
          <DetailTextarea label="Fortalezas Observadas" :content="sessionData.strengths_observed" />
          <DetailTextarea label="Dificultades Encontradas" :content="sessionData.challenges_encountered" />
        </div>
      </div>
    </div>

    <!-- Footer del Modal -->
    <template #footer>
      <div class="flex justify-end">
        <button
          @click="handleClose"
          class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700"
        >
          Cerrar
        </button>
      </div>
    </template>
  </BaseModal>
</template>

<script setup lang="ts">
import { defineComponent } from 'vue';
import BaseModal from '@/components/modal/BaseModal.vue';

// --- PROPS Y EMITS ---
const props = defineProps<{
  show: boolean;
  sessionData: any; // Idealmente, deberÃ­as usar tu interfaz TherapySession aquÃ­
}>();

const emit = defineEmits<{
  (e: 'update:show', value: boolean): void;
}>();

// --- COMPONENTES INTERNOS ---
// PequeÃ±os componentes para mantener el template limpio
const DetailItem = defineComponent({
  props: ['label', 'value'],
  template: `
    <div>
      <p class="detail-label">{{ label }}</p>
      <p class="detail-value">{{ value }}</p>
    </div>
  `
});

const DetailTextarea = defineComponent({
  props: ['label', 'content'],
  template: `
    <div>
      <p class="detail-label">{{ label }}</p>
      <p class="detail-textarea">{{ content || 'No registrado' }}</p>
    </div>
  `
});

// --- MÃ‰TODOS ---
function handleClose() {
  emit('update:show', false);
}

// --- UTILIDADES (duplicadas de la vista padre para consistencia) ---
function getStatusClass(status: string) {
  const classes: { [key: string]: string } = {
    asistio: 'bg-green-100 text-green-800',
    pendiente: 'bg-yellow-100 text-yellow-800',
    cancelado_familia: 'bg-red-100 text-red-800'
  };
  return classes[status] || 'bg-gray-100 text-gray-800';
}

function getStatusLabel(status: string) {
  const labels: { [key: string]: string } = {
    asistio: 'AsistiÃ³',
    pendiente: 'Pendiente',
    cancelado_familia: 'Cancelada'
  };
  return labels[status] || status || 'No definido';
}

function formatDate(date: string) {
  if (!date) return null;
  return new Date(date).toLocaleDateString('es-CL', {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
    hour: '2-digit',
    minute: '2-digit'
  });
}
</script>

<style scoped>
.details-container {
  @apply space-y-6;
}
.section {
  @apply pb-4 border-b border-gray-200;
}
.section:last-child {
  @apply border-b-0 pb-0;
}
.section-title {
  @apply text-lg font-semibold text-gray-800 mb-3;
}
.detail-label {
  @apply text-sm font-medium text-gray-500 mb-1;
}
.detail-value {
  @apply text-base text-gray-800;
}
.detail-textarea {
  @apply text-base text-gray-800 bg-gray-50 p-3 rounded-md border border-gray-200 whitespace-pre-wrap;
}
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\toastglobal\ToastContainer.vue
============================================================
<!-- ToastContainer.vue -->
<!-- Este componente debe ser agregado en DashboardLayout.vue o App.vue -->

<template>
  <Teleport to="body">
    <div class="toast-container">
      <TransitionGroup name="toast-list" tag="div" class="toast-list">
        <ToastNotification
          v-for="notification in notifications"
          :key="notification.id"
          v-bind="notification"
          @close="handleClose"
        />
      </TransitionGroup>
    </div>
  </Teleport>
</template>

<script setup lang="ts">
import { storeToRefs } from 'pinia'
import { useNotificationStore } from '@/store/notificationStore'
import ToastNotification from '@/components/gestion/rutinas/shared/ToastNotification.vue'

const notificationStore = useNotificationStore()
const { notifications } = storeToRefs(notificationStore)

function handleClose(id: number | string) {
  notificationStore.removeNotification(Number(id))
}
</script>

<style scoped>
.toast-container {
  position: fixed;
  bottom: 1.5rem;
  right: 1.5rem;
  z-index: 9999;
  pointer-events: none;
  max-width: 420px;
}

.toast-list {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
}

/* Animaciones de TransitionGroup */
.toast-list-move,
.toast-list-enter-active,
.toast-list-leave-active {
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.toast-list-enter-from {
  opacity: 0;
  transform: translateX(100%);
}

.toast-list-leave-to {
  opacity: 0;
  transform: translateX(100%);
}

.toast-list-leave-active {
  position: absolute;
  right: 0;
}

/* Responsive */
@media (max-width: 640px) {
  .toast-container {
    left: 1rem;
    right: 1rem;
    bottom: 1rem;
    max-width: none;
  }
}
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\ui\alertas\Alert.vue
============================================================
<template>
  <!-- src\components\ui\alertas\Alert.vue -->
  <Teleport to="body">
    <div
      v-if="alert.show"
      class="fixed top-4 right-4 z-50 w-full max-w-sm"
    >
      <Transition
        enter-active-class="transition-all duration-300 ease-out"
        enter-from-class="opacity-0 transform translate-y-[-100%] scale-95"
        enter-to-class="opacity-100 transform translate-y-0 scale-100"
        leave-active-class="transition-all duration-200 ease-in"
        leave-from-class="opacity-100 transform translate-y-0 scale-100"
        leave-to-class="opacity-0 transform translate-y-[-20px] scale-95"
      >
        <div
          v-if="alert.show"
          role="alert"
          class="rounded-lg p-4 shadow-lg backdrop-blur-sm"
          :class="[
            backgroundClass,
            borderClass
          ]"
        >
          <div class="flex items-start gap-3">
            <!-- Icono dinÃ¡mico segÃºn tipo -->
            <div class="flex-shrink-0">
              <component
                :is="iconComponent"
                class="h-6 w-6"
                :class="iconColorClass"
              />
            </div>

            <div class="flex-1 min-w-0">
              <h4 class="font-semibold text-sm" :class="titleColorClass">
                {{ alert.title }}
              </h4>
              <p class="mt-1 text-sm" :class="messageColorClass">
                {{ alert.message }}
              </p>
            </div>

            <!-- BotÃ³n de cerrar (solo para error e info) -->
            <button
              v-if="alert.type !== 'success'"
              @click="alert.close"
              class="flex-shrink-0 rounded-lg p-1.5 transition-colors duration-150"
              :class="closeButtonClass"
              type="button"
              aria-label="Cerrar alerta"
            >
              <XMarkIcon class="h-5 w-5" />
            </button>
          </div>

          <!-- Barra de progreso para alertas de Ã©xito -->
          <div
            v-if="alert.type === 'success'"
            class="mt-3 h-1 bg-green-200 rounded-full overflow-hidden"
          >
            <div
              class="h-full bg-green-500 rounded-full transition-all duration-3000 ease-linear"
              :style="{ width: progressWidth + '%' }"
            ></div>
          </div>
        </div>
      </Transition>
    </div>
  </Teleport>
</template>

<script lang="ts" setup>
import { computed, onUnmounted, ref, watch } from 'vue'
import { useAlertStore } from '@/store/alertStore'

// Importar iconos desde @heroicons/vue
import { 
  CheckCircleIcon, 
  ExclamationCircleIcon, 
  ExclamationTriangleIcon,
  InformationCircleIcon, 
  XMarkIcon 
} from '@heroicons/vue/24/outline'

const alert = useAlertStore()
const progressWidth = ref(100)
let progressInterval: ReturnType<typeof setTimeout> | null = null
let autoCloseTimeout: ReturnType<typeof setTimeout> | null = null

// Componente de icono segÃºn el tipo
const iconComponent = computed(() => {
  switch (alert.type) {
    case 'success': return CheckCircleIcon
    case 'error': return ExclamationCircleIcon
    case 'warning': return ExclamationTriangleIcon
    default: return InformationCircleIcon
  }
})

// Clases de color para el icono
const iconColorClass = computed(() => {
  switch (alert.type) {
    case 'success': return 'text-green-600'
    case 'error': return 'text-red-600'
    case 'warning': return 'text-amber-600'
    default: return 'text-blue-600'
  }
})

// Clases de fondo y borde
const backgroundClass = computed(() => {
  switch (alert.type) {
    case 'success': return 'bg-green-50 border-l-4 border-l-green-500'
    case 'error': return 'bg-red-50 border-l-4 border-l-red-500'
    case 'warning': return 'bg-amber-50 border-l-4 border-l-amber-500'
    default: return 'bg-blue-50 border-l-4 border-l-blue-500'
  }
})

// Clases de borde
const borderClass = computed(() => {
  switch (alert.type) {
    case 'success': return 'border border-green-200'
    case 'error': return 'border border-red-200'
    case 'warning': return 'border border-amber-200'
    default: return 'border border-blue-200'
  }
})

// Clases de color para el tÃ­tulo
const titleColorClass = computed(() => {
  switch (alert.type) {
    case 'success': return 'text-green-800'
    case 'error': return 'text-red-800'
    case 'warning': return 'text-amber-800'
    default: return 'text-blue-800'
  }
})

// Clases de color para el mensaje
const messageColorClass = computed(() => {
  switch (alert.type) {
    case 'success': return 'text-green-700'
    case 'error': return 'text-red-700'
    case 'warning': return 'text-amber-700'
    default: return 'text-blue-700'
  }
})

// Clases para el botÃ³n de cerrar
const closeButtonClass = computed(() => {
  switch (alert.type) {
    case 'error': return 'text-red-400 hover:text-red-600 hover:bg-red-100'
    case 'warning': return 'text-amber-400 hover:text-amber-600 hover:bg-amber-100'
    default: return 'text-blue-400 hover:text-blue-600 hover:bg-blue-100'
  }
})

// Auto-cerrar alertas de Ã©xito despuÃ©s de 3 segundos
const startAutoClose = () => {
  if (alert.type === 'success') {
    progressWidth.value = 100
    
    // AnimaciÃ³n de la barra de progreso
    progressInterval = setInterval(() => {
      progressWidth.value -= 100 / 30 // 30 frames en 3 segundos
      if (progressWidth.value <= 0) {
        progressWidth.value = 0
        if (progressInterval) clearInterval(progressInterval)
      }
    }, 100)

    // Auto-cerrar despuÃ©s de 3 segundos
    autoCloseTimeout = setTimeout(() => {
      alert.close()
    }, 3000)
  }
}

// Limpiar timeouts
const clearTimeouts = () => {
  if (progressInterval) {
    clearInterval(progressInterval)
    progressInterval = null
  }
  if (autoCloseTimeout) {
    clearTimeout(autoCloseTimeout)
    autoCloseTimeout = null
  }
}

// Watch para detectar cuando se muestra una nueva alerta
watch(() => alert.show, (newValue) => {
  if (newValue) {
    clearTimeouts()
    startAutoClose()
  } else {
    clearTimeouts()
  }
})

// Limpiar al desmontar el componente
onUnmounted(() => {
  clearTimeouts()
})
</script>

<style scoped>
.transition-all {
  transition-property: all;
}

.duration-3000 {
  transition-duration: 3000ms;
}
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\ui\alertas\AlertModal.vue
============================================================
<!-- src/components/ui/alertas/AlertModal.vue -->
<template>
  <Teleport to="body">
    <Transition
      enter-active-class="transition-opacity duration-300 ease-out"
      enter-from-class="opacity-0"
      enter-to-class="opacity-100"
      leave-active-class="transition-opacity duration-200 ease-in"
      leave-from-class="opacity-100"
      leave-to-class="opacity-0"
    >
      <div 
        v-if="state.isOpen" 
        class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-50 backdrop-blur-sm"
        @click.self="state.showCloseButton ? close() : null"
      >
        <Transition
          enter-active-class="transition-all duration-300 ease-out"
          enter-from-class="opacity-0 transform scale-95 translate-y-4"
          enter-to-class="opacity-100 transform scale-100 translate-y-0"
          leave-active-class="transition-all duration-200 ease-in"
          leave-from-class="opacity-100 transform scale-100 translate-y-0"
          leave-to-class="opacity-0 transform scale-95 translate-y-4"
        >
          <div 
            class="w-full max-w-md rounded-lg shadow-xl"
            :class="modalClasses"
          >
            <!-- Header -->
            <div class="flex items-center p-4 border-b" :class="headerClasses">
              <div class="flex items-center justify-center w-10 h-10 rounded-full" :class="iconContainerClasses">
                <component :is="iconComponent" class="w-6 h-6" :class="iconClasses" />
              </div>
              <h3 class="ml-3 text-lg font-semibold" :class="titleClasses">
                {{ state.title }}
              </h3>
              <button
                v-if="state.showCloseButton"
                @click="close"
                class="ml-auto rounded-lg p-1.5 transition-colors duration-150"
                :class="closeButtonClasses"
                type="button"
                aria-label="Cerrar modal"
              >
                <XMarkIcon class="w-5 h-5" />
              </button>
            </div>

            <!-- Content -->
            <div class="p-4">
              <p class="text-sm" :class="messageClasses">
                {{ state.message }}
              </p>
            </div>

            <!-- Actions -->
            <div v-if="state.actions.length > 0" class="flex justify-end gap-3 p-4 border-t" :class="footerClasses">
              <button
                v-for="(action, index) in state.actions"
                :key="index"
                @click="action.handler"
                class="px-4 py-2 text-sm font-medium rounded-lg transition-colors duration-150 focus:outline-none focus:ring-2 focus:ring-offset-2"
                :class="getButtonClasses(action.variant)"
                type="button"
              >
                {{ action.label }}
              </button>
            </div>
          </div>
        </Transition>
      </div>
    </Transition>
  </Teleport>
</template>

<script setup lang="ts">
import { computed } from 'vue'
import { useAlertModalStore, type AlertModalType } from '@/store/alertModalStore'
import { 
  CheckCircleIcon, 
  ExclamationCircleIcon, 
  ExclamationTriangleIcon,
  InformationCircleIcon, 
  XMarkIcon 
} from '@heroicons/vue/24/outline'

const alertModalStore = useAlertModalStore()
const { state, close } = alertModalStore

// Icono segÃºn el tipo
const iconComponent = computed(() => {
  const icons: Record<AlertModalType, any> = {
    success: CheckCircleIcon,
    error: ExclamationCircleIcon,
    warning: ExclamationTriangleIcon,
    info: InformationCircleIcon
  }
  return icons[state.type]
})

// Clases dinÃ¡micas basadas en el tipo
const modalClasses = computed(() => {
  const base = 'bg-white'
  return base
})

const headerClasses = computed(() => {
  const classes: Record<AlertModalType, string> = {
    success: 'border-green-200',
    error: 'border-red-200',
    warning: 'border-yellow-200',
    info: 'border-blue-200'
  }
  return classes[state.type]
})

const iconContainerClasses = computed(() => {
  const classes: Record<AlertModalType, string> = {
    success: 'bg-green-100',
    error: 'bg-red-100',
    warning: 'bg-yellow-100',
    info: 'bg-blue-100'
  }
  return classes[state.type]
})

const iconClasses = computed(() => {
  const classes: Record<AlertModalType, string> = {
    success: 'text-green-600',
    error: 'text-red-600',
    warning: 'text-yellow-600',
    info: 'text-blue-600'
  }
  return classes[state.type]
})

const titleClasses = computed(() => {
  const classes: Record<AlertModalType, string> = {
    success: 'text-green-800',
    error: 'text-red-800',
    warning: 'text-yellow-800',
    info: 'text-blue-800'
  }
  return classes[state.type]
})

const messageClasses = computed(() => {
  const classes: Record<AlertModalType, string> = {
    success: 'text-green-700',
    error: 'text-red-700',
    warning: 'text-yellow-700',
    info: 'text-blue-700'
  }
  return classes[state.type]
})

const footerClasses = computed(() => {
  const classes: Record<AlertModalType, string> = {
    success: 'border-green-200',
    error: 'border-red-200',
    warning: 'border-yellow-200',
    info: 'border-blue-200'
  }
  return classes[state.type]
})

const closeButtonClasses = computed(() => {
  const classes: Record<AlertModalType, string> = {
    success: 'text-green-400 hover:text-green-600 hover:bg-green-100',
    error: 'text-red-400 hover:text-red-600 hover:bg-red-100',
    warning: 'text-yellow-400 hover:text-yellow-600 hover:bg-yellow-100',
    info: 'text-blue-400 hover:text-blue-600 hover:bg-blue-100'
  }
  return classes[state.type]
})

const getButtonClasses = (variant: string = 'primary') => {
  const base = 'px-4 py-2 text-sm font-medium rounded-lg transition-colors duration-150 focus:outline-none focus:ring-2 focus:ring-offset-2'
  
  const variants = {
    primary: {
      success: 'bg-green-600 text-white hover:bg-green-700 focus:ring-green-500',
      error: 'bg-red-600 text-white hover:bg-red-700 focus:ring-red-500',
      warning: 'bg-yellow-600 text-white hover:bg-yellow-700 focus:ring-yellow-500',
      info: 'bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500'
    },
    secondary: {
      success: 'bg-green-100 text-green-700 hover:bg-green-200 focus:ring-green-500',
      error: 'bg-red-100 text-red-700 hover:bg-red-200 focus:ring-red-500',
      warning: 'bg-yellow-100 text-yellow-700 hover:bg-yellow-200 focus:ring-yellow-500',
      info: 'bg-blue-100 text-blue-700 hover:bg-blue-200 focus:ring-blue-500'
    },
    danger: 'bg-red-600 text-white hover:bg-red-700 focus:ring-red-500'
  }

  if (variant === 'danger') {
    return `${base} ${variants.danger}`
  }

  const typeVariant = variants[variant as keyof typeof variants] as Record<AlertModalType, string>
  return `${base} ${typeVariant[state.type]}`
}
</script>

<style scoped>
/* Animaciones personalizadas */
.backdrop-blur-sm {
  backdrop-filter: blur(4px);
}

/* Asegurar que el modal estÃ© por encima de otros modales */
.z-50 {
  z-index: 9999;
}

/* Mejoras de accesibilidad */
button:focus {
  outline: 2px solid transparent;
  outline-offset: 2px;
}

/* Transiciones suaves */
.transition-all {
  transition-property: all;
}

.duration-300 {
  transition-duration: 300ms;
}

.duration-200 {
  transition-duration: 200ms;
}
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\ui\ConfirmModal.vue
============================================================
<template>
  <div class="fixed inset-0 z-50 overflow-y-auto">
    <div class="flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0">
      <!-- Fondo oscuro del modal -->
      <div class="fixed inset-0 transition-opacity bg-gray-500 bg-opacity-75" @click="$emit('close')"></div>

      <!-- Espacio invisible para alineaciÃ³n -->
      <span class="hidden sm:inline-block sm:align-middle sm:h-screen">&#8203;</span>

      <!-- Contenedor principal del modal -->
      <div class="inline-block px-4 pt-5 pb-4 overflow-hidden text-left align-bottom transition-all transform bg-white rounded-lg shadow-xl sm:my-8 sm:align-middle sm:max-w-sm sm:w-full sm:p-6" :class="modalClass">
        <!-- Icono y contenido -->
        <div class="sm:flex sm:items-start">
          <div class="flex items-center justify-center flex-shrink-0 w-12 h-12 mx-auto bg-red-100 rounded-full sm:mx-0 sm:h-10 sm:w-10" :class="iconContainerClass">
            <component :is="icon" class="w-6 h-6" :class="iconClass" />
          </div>
          <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left">
            <h3 class="text-lg font-medium leading-6 text-gray-900" id="modal-title">
              {{ title }}
            </h3>
            <div class="mt-2">
              <p class="text-sm text-gray-500">{{ message }}</p>
            </div>
          </div>
        </div>
        
        <!-- Botones de acciÃ³n -->
        <div class="mt-5 sm:mt-4 sm:flex sm:flex-row-reverse">
          <button type="button" class="inline-flex justify-center w-full px-4 py-2 text-base font-medium text-white border border-transparent rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 sm:ml-3 sm:w-auto sm:text-sm" :class="buttonClass" @click="$emit('confirm')">
            {{ confirmText }}
          </button>
          <button type="button" class="inline-flex justify-center w-full px-4 py-2 mt-3 text-base font-medium text-gray-700 bg-white border border-gray-300 rounded-md shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-color4 sm:mt-0 sm:w-auto sm:text-sm" @click="$emit('close')">
            {{ cancelText }}
          </button>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { computed } from 'vue';
import { 
  CheckCircleIcon, 
  ExclamationTriangleIcon, 
  ExclamationCircleIcon, 
  InformationCircleIcon 
} from '@heroicons/vue/24/outline';

// DefiniciÃ³n de props con valores por defecto y validaciÃ³n
const props = defineProps({
  // Tipo de modal que determina el color y el icono
  type: {
    type: String,
    default: 'info',
    validator: (value: string) => ['success', 'error', 'warning', 'info'].includes(value)
  },
  // TÃ­tulo del modal
  title: {
    type: String,
    default: 'Confirmar acciÃ³n'
  },
  // Mensaje descriptivo del modal
  message: {
    type: String,
    default: 'Â¿EstÃ¡s seguro de que quieres realizar esta acciÃ³n?'
  },
  // Texto del botÃ³n de confirmaciÃ³n
  confirmText: {
    type: String,
    default: 'Confirmar'
  },
  // Texto del botÃ³n de cancelaciÃ³n
  cancelText: {
    type: String,
    default: 'Cancelar'
  }
});

// EmisiÃ³n de eventos para cerrar y confirmar
defineEmits(['close', 'confirm']);

// Computed property para determinar el icono segÃºn el tipo de modal
const icon = computed(() => {
  switch (props.type) {
    case 'success': return CheckCircleIcon;
    case 'error': return ExclamationCircleIcon;
    case 'warning': return ExclamationTriangleIcon;
    default: return InformationCircleIcon;
  }
});

// Computed property para la clase del borde del modal segÃºn el tipo
const modalClass = computed(() => {
  switch (props.type) {
    case 'success': return 'border-green-500';
    case 'error': return 'border-red-500';
    case 'warning': return 'border-yellow-500';
    default: return 'border-blue-500';
  }
});

// Computed property para la clase del contenedor del icono segÃºn el tipo
const iconContainerClass = computed(() => {
  switch (props.type) {
    case 'success': return 'bg-green-100';
    case 'error': return 'bg-red-100';
    case 'warning': return 'bg-yellow-100';
    default: return 'bg-blue-100';
  }
});

// Computed property para la clase del icono segÃºn el tipo
const iconClass = computed(() => {
  switch (props.type) {
    case 'success': return 'text-green-600';
    case 'error': return 'text-red-600';
    case 'warning': return 'text-yellow-600';
    default: return 'text-blue-600';
  }
});

// Computed property para la clase del botÃ³n de confirmaciÃ³n segÃºn el tipo
const buttonClass = computed(() => {
  switch (props.type) {
    case 'success': return 'bg-green-600 hover:bg-green-700 focus:ring-green-500';
    case 'error': return 'bg-red-600 hover:bg-red-700 focus:ring-red-500';
    case 'warning': return 'bg-yellow-600 hover:bg-yellow-700 focus:ring-yellow-500';
    default: return 'bg-color4 hover:bg-color3 focus:ring-color5';
  }
});
</script>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\ui\NotificationModal.vue
============================================================
<template>
  <div class="fixed inset-0 z-50 overflow-y-auto">
    <div class="flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0">
      <div class="fixed inset-0 transition-opacity bg-gray-500 bg-opacity-75" @click="$emit('close')"></div>

      <span class="hidden sm:inline-block sm:align-middle sm:h-screen">&#8203;</span>

      <div class="inline-block px-4 pt-5 pb-4 overflow-hidden text-left align-bottom transition-all transform bg-white rounded-lg shadow-xl sm:my-8 sm:align-middle sm:max-w-sm sm:w-full sm:p-6" :class="modalClass">
        <div class="sm:flex sm:items-start">
          <div class="flex items-center justify-center flex-shrink-0 w-12 h-12 mx-auto bg-red-100 rounded-full sm:mx-0 sm:h-10 sm:w-10" :class="iconContainerClass">
            <component :is="icon" class="w-6 h-6" :class="iconClass" />
          </div>
          <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left">
            <h3 class="text-lg font-medium leading-6 text-gray-900" id="modal-title">
              {{ title }}
            </h3>
            <div class="mt-2">
              <p class="text-sm text-gray-500">{{ message }}</p>
            </div>
          </div>
        </div>
        <div class="mt-5 sm:mt-4 sm:flex sm:flex-row-reverse">
          <button type="button" class="inline-flex justify-center w-full px-4 py-2 text-base font-medium text-white border border-transparent rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 sm:ml-3 sm:w-auto sm:text-sm" :class="buttonClass" @click="$emit('confirm')">
            {{ confirmText }}
          </button>
          <button type="button" class="inline-flex justify-center w-full px-4 py-2 mt-3 text-base font-medium text-gray-700 bg-white border border-gray-300 rounded-md shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-color4 sm:mt-0 sm:w-auto sm:text-sm" @click="$emit('close')">
            Cancelar
          </button>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { computed } from 'vue';
import { CheckCircleIcon, ExclamationTriangleIcon, ExclamationCircleIcon, InformationCircleIcon } from '@heroicons/vue/24/outline';

const props = defineProps({
  type: {
    type: String,
    default: 'info',
    validator: (value: string) => ['success', 'error', 'warning', 'info'].includes(value)
  },
  title: String,
  message: String,
  confirmText: {
    type: String,
    default: 'Aceptar'
  }
});

defineEmits(['close', 'confirm']);

const icon = computed(() => {
  switch (props.type) {
    case 'success': return CheckCircleIcon;
    case 'error': return ExclamationCircleIcon;
    case 'warning': return ExclamationTriangleIcon;
    default: return InformationCircleIcon;
  }
});

const modalClass = computed(() => {
  switch (props.type) {
    case 'success': return 'border-green-500';
    case 'error': return 'border-red-500';
    case 'warning': return 'border-yellow-500';
    default: return 'border-blue-500';
  }
});

const iconContainerClass = computed(() => {
  switch (props.type) {
    case 'success': return 'bg-green-100';
    case 'error': return 'bg-red-100';
    case 'warning': return 'bg-yellow-100';
    default: return 'bg-blue-100';
  }
});

const iconClass = computed(() => {
  switch (props.type) {
    case 'success': return 'text-green-600';
    case 'error': return 'text-red-600';
    case 'warning': return 'text-yellow-600';
    default: return 'text-blue-600';
  }
});

const buttonClass = computed(() => {
  switch (props.type) {
    case 'success': return 'bg-green-600 hover:bg-green-700 focus:ring-green-500';
    case 'error': return 'bg-red-600 hover:bg-red-700 focus:ring-red-500';
    case 'warning': return 'bg-yellow-600 hover:bg-yellow-700 focus:ring-yellow-500';
    default: return 'bg-color4 hover:bg-color3 focus:ring-color5';
  }
});
</script>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\utils\paginator.vue
============================================================
<!-- src/components/utils/Paginator.vue -->
<template>
  <div class="flex flex-col sm:flex-row items-center justify-between gap-4 px-4 py-3 bg-white border-t border-gray-200">
    <!-- InformaciÃ³n de pÃ¡gina -->
    <div class="flex items-center gap-2 text-sm text-gray-700">
      <span>Mostrando</span>
      <span class="font-medium">{{ paginationInfo.startIndex + 1 }}</span>
      <span>a</span>
      <span class="font-medium">{{ paginationInfo.endIndex }}</span>
      <span>de</span>
      <span class="font-medium">{{ paginationInfo.totalItems }}</span>
      <span>resultados</span>
    </div>

    <!-- Controles de paginaciÃ³n -->
    <div class="flex items-center gap-2">
      <!-- Selector de tamaÃ±o de pÃ¡gina -->
      <div class="flex items-center gap-2 mr-4">
        <label for="pageSize" class="text-sm text-gray-700">Mostrar:</label>
        <select
          id="pageSize"
          :value="paginationInfo.pageSize"
          @change="handlePageSizeChange($event)"
          class="text-sm border border-gray-300 rounded-md px-2 py-1 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
        >
          <option value="10">10</option>
          <option value="25">25</option>
          <option value="50">50</option>
          <option value="100">100</option>
        </select>
      </div>

      <!-- NavegaciÃ³n -->
      <nav class="flex items-center gap-1">
        <!-- Primera pÃ¡gina -->
        <button
          @click="goToFirst"
          :disabled="paginationInfo.isFirstPage"
          class="p-2 text-gray-400 hover:text-gray-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
          title="Primera pÃ¡gina"
        >
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 19l-7-7 7-7m8 14l-7-7 7-7" />
          </svg>
        </button>

        <!-- PÃ¡gina anterior -->
        <button
          @click="goToPrevious"
          :disabled="!paginationInfo.hasPrevious"
          class="p-2 text-gray-400 hover:text-gray-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
          title="PÃ¡gina anterior"
        >
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
          </svg>
        </button>

        <!-- NÃºmeros de pÃ¡gina -->
        <div class="flex items-center gap-1">
          <button
            v-for="(page, index) in pageRange"
            :key="index"
            @click="page !== '...' ? goToPage(page as number) : null"
            :class="[
              'min-w-8 h-8 px-2 text-sm font-medium rounded-md transition-colors',
              page === '...' 
                ? 'text-gray-500 cursor-default' 
                : page === paginationInfo.currentPage
                ? 'bg-primary-600 text-white shadow-sm'
                : 'text-gray-700 hover:bg-gray-100 border border-gray-300'
            ]"
            :disabled="page === '...'"
          >
            {{ page }}
          </button>
        </div>

        <!-- PÃ¡gina siguiente -->
        <button
          @click="goToNext"
          :disabled="!paginationInfo.hasNext"
          class="p-2 text-gray-400 hover:text-gray-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
          title="PÃ¡gina siguiente"
        >
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
          </svg>
        </button>

        <!-- Ãšltima pÃ¡gina -->
        <button
          @click="goToLast"
          :disabled="paginationInfo.isLastPage"
          class="p-2 text-gray-400 hover:text-gray-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
          title="Ãšltima pÃ¡gina"
        >
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 5l7 7-7 7M5 5l7 7-7 7" />
          </svg>
        </button>
      </nav>
    </div>
  </div>
</template>

<script setup lang="ts">
import { usePaginator, type UsePaginatorReturn } from '@/composables/usePaginator'
import { watch } from 'vue'

interface Props {
  currentPage?: number
  pageSize?: number
  totalItems: number
  onPageChange?: (page: number) => void
}

const props = withDefaults(defineProps<Props>(), {
  currentPage: 1,
  pageSize: 10
})

const emit = defineEmits<{
  'page-change': [page: number]
  'page-size-change': [size: number]
}>()

// Usar el composable
const {
  paginationInfo,
  pageRange,
  goToPage,
  goToNext,
  goToPrevious,
  goToFirst,
  goToLast,
  setPageSize,
  setTotalItems
}: UsePaginatorReturn = usePaginator({
  initialPage: props.currentPage,
  initialPageSize: props.pageSize,
  totalItems: props.totalItems,
  onPageChange: (page: number) => {
    emit('page-change', page)
    props.onPageChange?.(page)
  }
})

const handlePageSizeChange = (event: Event) => {
  const target = event.target as HTMLSelectElement
  const newSize = parseInt(target.value, 10)
  setPageSize(newSize)
  emit('page-size-change', newSize)
}

// Watch for prop changes
watch(() => props.totalItems, (newTotal: number) => {
  setTotalItems(newTotal)
})

watch(() => props.currentPage, (newPage: number) => {
  if (newPage !== paginationInfo.value.currentPage) {
    goToPage(newPage)
  }
})

watch(() => props.pageSize, (newSize: number) => {
  if (newSize !== paginationInfo.value.pageSize) {
    setPageSize(newSize)
  }
})
</script>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components\utils\PreloaderChanger.vue
============================================================
<template>
  <div
    v-if="isLoading"
    class="fixed inset-0 z-50 flex items-center justify-center bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900"
  >
    <div class="relative">
      <!-- CÃ­rculos animados -->
      <div class="flex space-x-3">
        <div
          v-for="i in 3"
          :key="i"
          class="circle"
          :style="{ animationDelay: `${(i - 1) * 0.15}s` }"
        ></div>
      </div>

      <!-- Texto de carga (opcional) -->
      <p class="mt-8 text-center text-lg font-semibold text-white animate-pulse">
        Cargando...
      </p>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, onMounted } from 'vue';

const isLoading = ref(true);

// Props para controlar el preloader externamente
const props = withDefaults(
  defineProps<{
    duration?: number;
  }>(),
  {
    duration: 2000,
  }
);

// Emite un evento cuando termina de cargar
const emit = defineEmits<{
  (e: 'loaded'): void;
}>();

onMounted(() => {
  setTimeout(() => {
    isLoading.value = false;
    emit('loaded');
  }, props.duration);
});

// FunciÃ³n para mostrar/ocultar manualmente
const show = () => {
  isLoading.value = true;
};

const hide = () => {
  isLoading.value = false;
  emit('loaded');
};

// Exponer funciones para uso externo
defineExpose({
  show,
  hide,
});
</script>

<style scoped>
.circle {
  width: 1rem;
  height: 1rem;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border-radius: 50%;
  animation: bounce 0.6s infinite alternate;
  box-shadow: 0 4px 6px -1px rgba(102, 126, 234, 0.5),
              0 2px 4px -1px rgba(118, 75, 162, 0.3);
}

@keyframes bounce {
  0% {
    transform: translateY(0);
    opacity: 1;
  }
  100% {
    transform: translateY(-1.5rem);
    opacity: 0.7;
  }
}

/* AnimaciÃ³n de fade out cuando se oculta */
.fade-out {
  animation: fadeOut 0.5s ease-out forwards;
}

@keyframes fadeOut {
  from {
    opacity: 1;
  }
  to {
    opacity: 0;
  }
}
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\components.css
============================================================

============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\composables\padres\useLatestUpdate.ts
============================================================
// src/composables/useLatestUpdate.ts

import { ref, onMounted } from 'vue'
import { fetchLatestSessionUpdate } from '@/services/padres/parentService'
import type { LatestSessionUpdate } from '@/type/parent'
import { useAlertStore } from '@/store/alertStore'

/**
 * Composable para obtener el componente "Ãšltima ActualizaciÃ³n"
 */
export function useLatestUpdate() {
  const alert = useAlertStore()

  // 1. Estados reactivos
  const latestUpdate = ref<LatestSessionUpdate | null>(null)
  const isLoading = ref(true)
  const error = ref<string | null>(null)

  // 2. FunciÃ³n para cargar los datos
  const loadData = async () => {
    isLoading.value = true
    error.value = null
    try {
      latestUpdate.value = await fetchLatestSessionUpdate()
    } catch (err: any) {
      if (err.response?.status === 404) {
        // Esto es un 404 esperado (sin sesiones), no un error del sistema
        error.value = 'AÃºn no hay actualizaciones de tu terapeuta.'
        console.log('[useLatestUpdate] No se encontraron actualizaciones (404).')
      } else {
        // Esto es un error real (ej. 500)
        error.value = 'No se pudo cargar la Ãºltima actualizaciÃ³n.'
        alert.error('Error de Red', error.value)
      }
    } finally {
      isLoading.value = false
    }
  }

  // 3. Cargar los datos automÃ¡ticamente cuando se usa el composable
  onMounted(loadData)

  // 4. Exponer los estados al componente
  return {
    latestUpdate,
    isLoading,
    error
  }
}
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\composables\useAuth.ts
============================================================
// src/composables/useAuth.ts

// =====================================================================

// COMPOSABLE DE AUTENTICACIÃ“N

// Gestiona el login, logout y estado de autenticaciÃ³n del usuario

// Incluye manejo de roles, tokens JWT y redirecciÃ³n automÃ¡tica

// =====================================================================

 

import { ref, computed } from 'vue'

import { loginApi, logoutApi } from '@/services/authService.ts'

import { useAlertStore } from '@/store/alertStore.ts'

import { useRouter } from 'vue-router'

import type { User } from '@/type/user.ts'

 

// =====================================================================

// ESTADO GLOBAL REACTIVO

// Se inicializa fuera del composable para compartir entre instancias

// =====================================================================

 

// Usuario autenticado (null si no hay sesiÃ³n)

const user = ref<User | null>(null)

 

// Token JWT de acceso (se recupera de localStorage si existe)

const token = ref<String | null>(localStorage.getItem('access'))

 

// =====================================================================

// FUNCIÃ“N HELPER: Mapeo de roles del backend al frontend

// =====================================================================

 

/**

 * Convierte los nombres de roles del backend (espaÃ±ol) a formato frontend (inglÃ©s)

 *

 * Backend envÃ­a: ["Terapeuta"] o ["Padres"] o ["Admin"]

 * Frontend necesita: "therapist" | "parent" | "admin"

 *

 * @param rolesArray - Array de roles desde el backend (ej: ["Terapeuta"])

 * @returns Rol mapeado en formato frontend o null si no se puede mapear

 */

function mapRoleFromBackend(rolesArray: string[]): 'parent' | 'therapist' | 'admin' | null {

  // Validar que el parÃ¡metro sea un array vÃ¡lido y no vacÃ­o

  if (!rolesArray || !Array.isArray(rolesArray) || rolesArray.length === 0) {

    return null

  }

 

  // Tomar el primer rol y convertir a minÃºsculas para comparaciÃ³n

  const firstRole = rolesArray[0].toLowerCase()

 

  // Mapeo de roles: espaÃ±ol â†’ inglÃ©s

  if (firstRole.includes('terapeuta')) return 'therapist'

  if (firstRole.includes('padres') || firstRole.includes('parent')) return 'parent'

  if (firstRole.includes('admin')) return 'admin'

 

  // Si no coincide con ningÃºn rol conocido

  return null

}

 

// =====================================================================

// COMPOSABLE PRINCIPAL

// =====================================================================

 

export function useAuth() {

  // Instancias de router y store de alertas

  const router = useRouter()

  const alert = useAlertStore()

 

  // -------------------------------------------------------------------

  // COMPUTED PROPERTIES: Estado de autenticaciÃ³n y roles

  // -------------------------------------------------------------------

 

  /**

   * Indica si el usuario estÃ¡ autenticado

   * Requiere tanto token como datos de usuario

   */

  const isAuthenticated = computed(() => !!token.value && !!user.value)

 

  /**

   * Verifica si el usuario tiene rol de padre/apoderado

   */

  const isParent = computed(() => user.value?.role === 'parent')

 

  /**

   * Verifica si el usuario tiene rol de terapeuta

   */

  const isTherapist = computed(() => user.value?.role === 'therapist')

 

  /**

   * Verifica si el usuario tiene rol de administrador

   */

  const isAdmin = computed(() => user.value?.role === 'admin')

 

  /**

   * Determina la ruta del dashboard segÃºn el rol del usuario

   * Retorna la ruta apropiada o login si no hay usuario

   */

  const dashboardRoute = computed(() => {

    // Si no hay usuario autenticado, ir a login

    if (!user.value) return { name: 'login' }

 

    console.log('[useAuth] Determinando ruta para rol:', user.value.role)

 

    // Mapeo de roles a rutas del dashboard

    // IMPORTANTE: Se usa 'path' en lugar de 'name' para evitar problemas de routing

    switch (user.value.role) {

      case 'parent':

        return { path: '/parent' }

      case 'therapist':

        return { path: '/therapist' }

      case 'admin':

        return { path: '/admin' }

      default:

        // Si el rol no es reconocido, mostrar advertencia y redirigir a login

        console.warn('[useAuth] Rol desconocido:', user.value.role)

        return { name: 'login' }

    }

  })

 

  // -------------------------------------------------------------------

  // FUNCIÃ“N: Limpiar sesiÃ³n

  // -------------------------------------------------------------------

 

  /**

   * Elimina todos los datos de sesiÃ³n del localStorage y resetea el estado

   * Se usa en logout y cuando hay errores de autenticaciÃ³n

   */

  const clearSession = () => {

    // Eliminar datos persistidos

    localStorage.removeItem('access')

    localStorage.removeItem('refresh')

    localStorage.removeItem('user')

 

    // Resetear estado reactivo

    user.value = null

    token.value = null

  }

 

  // -------------------------------------------------------------------

  // FUNCIÃ“N: Login

  // -------------------------------------------------------------------

 

  /**

   * Autentica al usuario con email y contraseÃ±a

   *

   * Flujo:

   * 1. Llama al API de login

   * 2. Valida que la respuesta incluya un rol vÃ¡lido

   * 3. Guarda tokens y datos en localStorage

   * 4. Actualiza el estado reactivo

   * 5. Muestra alerta de Ã©xito

   * 6. Redirige al dashboard correspondiente

   *

   * @param email - Correo electrÃ³nico del usuario

   * @param password - ContraseÃ±a del usuario

   */

  const login = async (email: string, password: string) => {

    try {

      console.log('[useAuth] ğŸ” Iniciando login...', { email })

 

      // 1ï¸âƒ£ LLAMADA AL API

      // loginApi retorna: { access, refresh, user: {...} }

      const response = await loginApi(email, password)

      const { access, refresh, user: userData } = response

 

      console.log('[useAuth] âœ… Respuesta CRUDA del backend:', userData)

 

      // 2ï¸âƒ£ DETERMINAR Y VALIDAR EL ROL

      // Intentar obtener el rol del campo 'role' (preferido)

      let userRole = userData.role

 

      // FALLBACK: Si no viene 'role', mapearlo desde 'roles[]'
      if (!userRole && userData.roles && Array.isArray(userData.roles)) {
        console.warn('[useAuth] âš ï¸ Campo "role" ausente, mapeando desde "roles"...')
        const mappedRole = mapRoleFromBackend(userData.roles)
        if (mappedRole) {
          userRole = mappedRole
        }
        console.log('[useAuth] ğŸ”§ Rol mapeado:', userRole)
      }

 

      // VALIDACIÃ“N CRÃTICA: Sin rol vÃ¡lido no se puede continuar

      if (!userRole) {

        console.error('[useAuth] âŒ No se pudo determinar el rol:', {

          role: userData.role,

          roles: userData.roles

        })

        alert.error(

          'Error de configuraciÃ³n',

          'Tu cuenta no tiene un rol asignado. Contacta al administrador.'

        )

        clearSession()

        return // Detener ejecuciÃ³n

      }

 

      // 3ï¸âƒ£ CREAR OBJETO USER COMPLETO

      // Asegurar que el objeto tenga TODOS los campos necesarios

      const completeUserData: User = {

        ...userData,           // Copiar todos los campos del backend

        role: userRole         // âœ… Asegurar que 'role' siempre estÃ© presente

      }

 

      console.log('[useAuth] âœ… Usuario procesado:', {

        username: completeUserData.username,

        email: completeUserData.email,

        role: completeUserData.role,

        roles: completeUserData.roles

      })

 

      // 4ï¸âƒ£ PERSISTIR EN LOCALSTORAGE

      // Se guarda PRIMERO en localStorage antes de actualizar estado

      // Esto asegura que si hay error, los datos estÃ¡n disponibles

      localStorage.setItem('access', access)

      localStorage.setItem('refresh', refresh)

      localStorage.setItem('user', JSON.stringify(completeUserData))

 

      console.log('[useAuth] ğŸ’¾ Token guardado (preview):', access.substring(0, 30) + '...')

 

      // 5ï¸âƒ£ ACTUALIZAR ESTADO REACTIVO

      // Ahora que los datos estÃ¡n persistidos, actualizar el estado de Vue

      token.value = access

      user.value = completeUserData

 

      console.log('[useAuth] â™»ï¸ Estado reactivo actualizado')

 

      // 6ï¸âƒ£ NOTIFICACIÃ“N AL USUARIO

      // Mostrar alerta de Ã©xito con nombre del usuario

      alert.success('Â¡Bienvenido!', `Hola ${completeUserData.name}`)

 

      // 7ï¸âƒ£ DETERMINAR RUTA DE REDIRECCIÃ“N

      // Usar el computed property que mapea rol â†’ ruta

      const targetRoute = dashboardRoute.value

      console.log('[useAuth] ğŸš€ Redirigiendo a:', targetRoute, 'para rol:', completeUserData.role)

 

      // 8ï¸âƒ£ ESPERAR SINCRONIZACIÃ“N

      // Delay de 250ms para asegurar que:

      // - localStorage estÃ© completamente actualizado

      // - Los interceptores de Axios puedan leer el nuevo token

      // - El estado reactivo se haya propagado

      await new Promise(resolve => setTimeout(resolve, 250))

 

      // 9ï¸âƒ£ REDIRECCIÃ“N FINAL

      // Usar 'replace' en lugar de 'push' para no dejar login en historial

      await router.replace(targetRoute)

 

      console.log('[useAuth] âœ… Login completado exitosamente')

 

    } catch (error: any) {

      // MANEJO DE ERRORES

      console.error('[useAuth] âŒ Error en login:', error)

 

      // Extraer mensaje de error desde diferentes fuentes posibles

      const message =

        error?.response?.data?.detail ||  // Error del backend

        error?.message ||                 // Error de red/Axios

        'Las credenciales son incorrectas'  // Mensaje por defecto

 

      // Mostrar error al usuario

      alert.error('Error de autenticaciÃ³n', message)

 

      // Limpiar cualquier dato parcial que se haya guardado

      clearSession()

    }

  }

 

  // -------------------------------------------------------------------

  // FUNCIÃ“N: Logout

  // -------------------------------------------------------------------

 

  /**

   * Cierra la sesiÃ³n del usuario

   *

   * Flujo:

   * 1. Llama al API para invalidar el token en el servidor

   * 2. Limpia los datos locales (siempre, incluso si el API falla)

   * 3. Redirige al login

   */

  const logout = async () => {

    try {

      // Intentar invalidar el token en el servidor

      await logoutApi()

    } catch (error) {

      // Si falla, solo loguear pero continuar con el logout local

      console.error('[useAuth] Error en logout:', error)

      alert.warning('Advertencia', 'Error al cerrar sesiÃ³n en el servidor')

    } finally {

      // SIEMPRE ejecutar el logout local (aunque el server falle)

      clearSession()

      alert.success('SesiÃ³n cerrada', 'Has cerrado sesiÃ³n correctamente')

 

      // Redirigir al login

      router.push({ name: 'login' })

    }

  }

 

  // -------------------------------------------------------------------

  // FUNCIÃ“N: Inicializar autenticaciÃ³n

  // -------------------------------------------------------------------

 

  /**

   * Restaura la sesiÃ³n desde localStorage al cargar la aplicaciÃ³n

   *

   * Se ejecuta:

   * - Al crear el composable (primera vez)

   * - Al recargar la pÃ¡gina

   *

   * Valida que:

   * - Existan datos en localStorage

   * - Los datos sean vÃ¡lidos (JSON parseable)

   * - El usuario tenga un rol vÃ¡lido

   */

  const initializeAuth = () => {

    const storedUser = localStorage.getItem('user')

    const storedToken = localStorage.getItem('access')

 

    // Verificar que existan ambos datos

    if (storedUser && storedToken) {

      try {

        // Parsear el JSON del usuario

        const parsedUser = JSON.parse(storedUser)

 

        // VALIDAR/MAPEAR ROL

        let userRole = parsedUser.role

 

        // Si no tiene 'role' pero sÃ­ 'roles', mapear automÃ¡ticamente

        if (!userRole && parsedUser.roles) {

          console.warn('[initializeAuth] âš ï¸ Usuario recuperado sin rol, mapeando...')

          userRole = mapRoleFromBackend(parsedUser.roles)

 

          // Actualizar el objeto y re-guardar en localStorage

          parsedUser.role = userRole

          localStorage.setItem('user', JSON.stringify(parsedUser))

        }

 

        // Si aÃºn no hay rol vÃ¡lido, limpiar sesiÃ³n

        if (!userRole) {

          console.warn('[initializeAuth] âš ï¸ No se pudo recuperar rol vÃ¡lido, limpiando sesiÃ³n')

          clearSession()

          return

        }

 

        // Todo OK: Restaurar el estado

        user.value = parsedUser

        token.value = storedToken

 

        console.log('[initializeAuth] â™»ï¸ Usuario recuperado:', {

          username: parsedUser.username,

          role: parsedUser.role

        })

      } catch (error) {

        // Si hay error al parsear (datos corruptos), limpiar todo

        console.error('[initializeAuth] âŒ Error al parsear user:', error)

        clearSession()

      }

    }

  }

 

  // -------------------------------------------------------------------

  // AUTO-INICIALIZACIÃ“N

  // Se ejecuta automÃ¡ticamente al importar el composable

  // -------------------------------------------------------------------

 

  if (!user.value && localStorage.getItem('user')) {

    initializeAuth()

  }

 

  // -------------------------------------------------------------------

  // API PÃšBLICA DEL COMPOSABLE

  // -------------------------------------------------------------------

 

  return {

    // Estado

    user,              // Usuario autenticado (reactivo)

    token,             // Token JWT (reactivo)

 

    // Computed properties

    isAuthenticated,   // true si hay sesiÃ³n vÃ¡lida

    isParent,          // true si es padre/apoderado

    isTherapist,       // true si es terapeuta

    isAdmin,           // true si es administrador

    dashboardRoute,    // Ruta del dashboard segÃºn rol

 

    // MÃ©todos

    login,             // Autenticar usuario

    logout,            // Cerrar sesiÃ³n

    initializeAuth     // Restaurar sesiÃ³n desde localStorage

  }

}
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\composables\useCropper.ts
============================================================
// src/composables/useCropper.ts

import { ref, computed } from 'vue'
import type { Ref } from 'vue'
import type { CropperResult, CropperSettings } from '@/type/cropper.types'

export function useCropper(settings?: CropperSettings) {
  const cropperRef = ref<any>(null)
  const zoom = ref(0)
  const rotation = ref(0)
  const isProcessing = ref(false)
  
  // Zoom
  const zoomIn = () => {
    if (cropperRef.value) {
      cropperRef.value.zoom(1.1)
      zoom.value = Math.min(zoom.value + 10, 200)
    }
  }
  
  const zoomOut = () => {
    if (cropperRef.value) {
      cropperRef.value.zoom(0.9)
      zoom.value = Math.max(zoom.value - 10, 0)
    }
  }
  
  // RotaciÃ³n
  const rotate = (degrees: number) => {
    if (cropperRef.value) {
      rotation.value = (rotation.value + degrees) % 360
      cropperRef.value.rotate(degrees)
    }
  }
  
  // Reset
  const reset = () => {
    if (cropperRef.value) {
      cropperRef.value.reset()
      zoom.value = 0
      rotation.value = 0
    }
  }
  
  // Obtener resultado
  const getResult = async (): Promise<CropperResult | null> => {
    if (!cropperRef.value) return null
    
    try {
      isProcessing.value = true
      
      const { canvas, coordinates } = cropperRef.value.getResult()
      
      // Convertir canvas a Blob
      const blob = await new Promise<Blob>((resolve, reject) => {
        canvas.toBlob(
          (b: Blob | null) => {
            if (b) resolve(b)
            else reject(new Error('No se pudo crear Blob'))
          },
          'image/jpeg',
          0.85
        )
      })
      
      return { blob, canvas, coordinates }
    } catch (error) {
      console.error('[useCropper] Error obteniendo resultado:', error)
      return null
    } finally {
      isProcessing.value = false
    }
  }
  
  return {
    cropperRef,
    zoom,
    rotation,
    isProcessing,
    zoomIn,
    zoomOut,
    rotate,
    reset,
    getResult
  }
}
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\composables\useFormDraft.ts
============================================================
// src/composables/useFormDraft.ts

import { ref, watch, onMounted, onUnmounted, computed, nextTick } from 'vue'
import { useFormDraftStore } from '@/store/formDraftStore'
import { FormDraft, FormDraftConfig } from '@/types/formDraft'

interface UseFormDraftOptions {
  formId: string
  autoSave?: boolean
  autoSaveDelay?: number
  maxDrafts?: number
  draftExpiryDays?: number
  storage?: 'localStorage' | 'sessionStorage' | 'memory'
}

export function useFormDraft(options: UseFormDraftOptions) {
  const {
    formId,
    autoSave = true,
    autoSaveDelay = 2000,
    maxDrafts = 5,
    draftExpiryDays = 7,
    storage = 'localStorage'
  } = options

  const store = useFormDraftStore()
  const currentStep = ref(1)
  const formData = ref<Record<string, any>>({})
  const hasUnsavedChanges = ref(false)
  const isRecovering = ref(false)
  const lastSaveTime = ref<Date | null>(null)
  
  let autoSaveTimer: number | null = null
  let isInitialized = false

  // ConfiguraciÃ³n
  const config: FormDraftConfig = {
    formId,
    storage,
    autoSave,
    autoSaveDelay,
    maxDrafts,
    draftExpiryDays
  }

  // âœ… CORREGIDO: Computed con tipos explÃ­citos
  const drafts = computed(() => store.getDraftsByFormId(formId))
  
  // âœ… CORREGIDO: Tipos explÃ­citos para latest y current
  const latestDraft = computed(() => {
    if (drafts.value.length === 0) return null
    return drafts.value.reduce((latest: FormDraft, current: FormDraft) => 
      current.metadata.updatedAt > latest.metadata.updatedAt ? current : latest, 
      drafts.value[0]
    )
  })
  
  const hasExistingDrafts = computed(() => drafts.value.length > 0)
  
  // âœ… CORREGIDO: Acceso seguro a recoveryOptions con valor por defecto
  const recoveryOptions = computed(() => {
    // Si store.recoveryOptions es undefined, usar valores por defecto
    if (!store.recoveryOptions) {
      console.warn('âš ï¸ store.recoveryOptions es undefined, usando valores por defecto')
      return {
        allowRecovery: true,
        showRecoveryModal: true,
        autoRecover: false
      }
    }
    return store.recoveryOptions
  })
  
  const canRecover = computed(() => 
    hasExistingDrafts.value && recoveryOptions.value.allowRecovery
  )

  // MÃ©todos
  const scheduleAutoSave = () => {
    if (!autoSave || !store.autoSaveEnabled || isRecovering.value) return

    if (autoSaveTimer) {
      clearTimeout(autoSaveTimer)
    }

    autoSaveTimer = window.setTimeout(() => {
      saveDraft()
    }, autoSaveDelay)
  }

  const saveDraft = () => {
    if (!hasUnsavedChanges.value && !isInitialized) return

    const draftData = { ...formData.value }
    const step = currentStep.value
    const title = `Borrador - Paso ${step}`

    try {
      if (store.currentDraft?.metadata.formId === formId) {
        store.updateDraft(store.currentDraft.metadata.id, draftData, step)
      } else {
        store.createDraft(formId, draftData, step, title, draftExpiryDays)
      }

      hasUnsavedChanges.value = false
      lastSaveTime.value = new Date()
      
      console.log(`ğŸ’¾ Borrador guardado para ${formId} - Paso ${step}`)
    } catch (error) {
      console.error('âŒ Error al guardar borrador:', error)
    }
  }

  const recoverDraft = async (draftId?: string): Promise<boolean> => {
    let draft: FormDraft | null = null
    
    try {
      if (draftId) {
        draft = store.loadDraft(draftId)
      } else {
        draft = store.loadLatestDraft(formId)
      }

      if (draft) {
        isRecovering.value = true
        
        // Esperar al siguiente tick para asegurar que la UI estÃ© lista
        await nextTick()
        
        // Restaurar datos
        Object.assign(formData.value, draft.data)
        currentStep.value = draft.metadata.step
        
        console.log(`ğŸ”„ Borrador recuperado: ${formId} - Paso ${currentStep.value}`)
        
        // PequeÃ±o delay para asegurar que todo estÃ© cargado
        setTimeout(() => {
          isRecovering.value = false
          hasUnsavedChanges.value = false
        }, 100)
        
        return true
      }
    } catch (error) {
      console.error('âŒ Error al recuperar borrador:', error)
      isRecovering.value = false
    }
    
    return false
  }

  const deleteDraft = (draftId: string) => {
    try {
      store.deleteDraft(draftId)
    } catch (error) {
      console.error('âŒ Error al eliminar borrador:', error)
    }
  }

  const clearAllDrafts = () => {
    try {
      store.clearFormDrafts(formId)
      hasUnsavedChanges.value = false
    } catch (error) {
      console.error('âŒ Error al limpiar borradores:', error)
    }
  }

  const discardChanges = () => {
    try {
      if (store.currentDraft) {
        recoverDraft(store.currentDraft.metadata.id)
      } else {
        formData.value = {}
        currentStep.value = 1
      }
      hasUnsavedChanges.value = false
    } catch (error) {
      console.error('âŒ Error al descartar cambios:', error)
    }
  }

  const forceSave = () => {
    if (autoSaveTimer) {
      clearTimeout(autoSaveTimer)
    }
    saveDraft()
  }

  // âœ… CORREGIDO: Watchers con manejo de errores
  watch(formData, () => {
    if (isInitialized && !isRecovering.value) {
      hasUnsavedChanges.value = true
      scheduleAutoSave()
    }
  }, { deep: true })

  watch(currentStep, () => {
    if (isInitialized && !isRecovering.value) {
      hasUnsavedChanges.value = true
      scheduleAutoSave()
    }
  })

  // Lifecycle
  onMounted(async () => {
    try {
      // Cargar borradores existentes
      store.loadDrafts()
      
      // âœ… CORREGIDO: VerificaciÃ³n segura con optional chaining
      if (hasExistingDrafts.value && recoveryOptions.value?.autoRecover) {
        console.log('ğŸ”„ RecuperaciÃ³n automÃ¡tica activada...')
        await recoverDraft()
      } else if (hasExistingDrafts.value) {
        console.log('ğŸ“ Borradores disponibles pero recuperaciÃ³n automÃ¡tica desactivada')
      }
      
      isInitialized = true
    } catch (error) {
      console.error('âŒ Error en onMounted de useFormDraft:', error)
      isInitialized = true // Marcar como inicializado incluso con error
    }
  })

  onUnmounted(() => {
    if (autoSaveTimer) {
      clearTimeout(autoSaveTimer)
    }
    
    // Guardar final al desmontar
    if (hasUnsavedChanges.value) {
      saveDraft()
    }
  })

  // ExposiciÃ³n pÃºblica
  return {
    // Estado
    formData,
    currentStep,
    hasUnsavedChanges,
    isRecovering,
    lastSaveTime,
    
    // Computed
    drafts,
    latestDraft,
    hasExistingDrafts,
    canRecover,
    recoveryOptions, // âœ… EXPORTAR para debugging
    
    // MÃ©todos
    saveDraft,
    recoverDraft,
    deleteDraft,
    clearAllDrafts,
    discardChanges,
    forceSave,
    scheduleAutoSave
  }
}
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\composables\useInactivityLogout.ts
============================================================
/* ruta de este archivo es src\composables\useInactivityLogout.ts */
import { ref, onMounted, onUnmounted } from 'vue'
import { useAuth } from './useAuth.ts'
import { useAlertStore } from '@/store/alertStore.ts'


/**
 * Cierra sesiÃ³n automÃ¡ticamente tras inactividad del usuario,
 * mostrando un modal de advertencia con contador regresivo.
 * @param timeoutMs Tiempo total de inactividad permitido (ej: 20 min = 1_200_000 ms)
 */
export function useInactivityLogout(timeoutMs = 20 * 60 * 1000) {
  const { logout } = useAuth()
  const alertStore = useAlertStore()

  const showWarningModal = ref(false)
  const countdown = ref(60) // segundos restantes
  let inactivityTimer: number | undefined
  let warningTimer: number | undefined
  let countdownInterval: number | undefined

  const resetTimer = () => {
    clearTimeout(inactivityTimer)
    clearTimeout(warningTimer)
    clearInterval(countdownInterval)

    showWarningModal.value = false
    countdown.value = 60

    // âš ï¸ Mostrar advertencia 1 minuto antes de cerrar sesiÃ³n
    warningTimer = window.setTimeout(() => {
      showWarningModal.value = true
      alertStore.trigger(
        'warning',
        'Inactividad detectada',
        'Tu sesiÃ³n se cerrarÃ¡ en 1 minuto por inactividad.'
      )

      // â³ Iniciar contador regresivo
      countdownInterval = window.setInterval(() => {
        if (countdown.value > 0) {
          countdown.value--
        }
      }, 1000)
    }, timeoutMs - 60 * 1000)

    // â¹ï¸ Cerrar sesiÃ³n al cumplirse el tiempo
    inactivityTimer = window.setTimeout(async () => {
      console.warn('[Inactividad] Cerrando sesiÃ³n por inactividad...')
      await logout()
    }, timeoutMs)
  }

  const keepSessionAlive = () => {
    resetTimer()
  }

  onMounted(() => {
    window.addEventListener('mousemove', resetTimer)
    window.addEventListener('keydown', resetTimer)
    window.addEventListener('click', resetTimer)
    window.addEventListener('scroll', resetTimer)
    resetTimer()
  })

  onUnmounted(() => {
    window.removeEventListener('mousemove', resetTimer)
    window.removeEventListener('keydown', resetTimer)
    window.removeEventListener('click', resetTimer)
    window.removeEventListener('scroll', resetTimer)
    clearTimeout(inactivityTimer)
    clearTimeout(warningTimer)
    clearInterval(countdownInterval)
  })

  return {
    showWarningModal,
    keepSessionAlive,
    countdown
  }
}

============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\composables\useMetricas.ts
============================================================
// src/composables/useMetricas.ts
import { ref, onMounted } from 'vue';
import { metricasService } from '@/services/metricasService';
import { MetricasData } from '@/type/metricas';
import { parseApiError, getUserFriendlyErrorMessage } from '@/exceptions/apiError';

/**
 * Composable para manejar el estado de las mÃ©tricas del dashboard
 * 
 * Responsabilidades:
 * - Estado reactivo de mÃ©tricas, loading y error
 * - LÃ³gica de fetching y caching
 * - Manejo de errores usando el sistema existente
 * - Auto-refresh opcional
 */

export function useMetricas() {
  // Estado reactivo
  const metricas = ref<MetricasData | null>(null);
  const loading = ref(false);
  const error = ref<string | null>(null);

  /**
   * Carga las mÃ©tricas desde el servicio
   * 
   * Flujo: metricasService â†’ http.ts â†’ API â†’ Actualiza estado
   */
  const cargarMetricas = async () => {
    loading.value = true;
    error.value = null;
    
    try {
      metricas.value = await metricasService.getMetricasDashboard();
    } catch (err) {
      // Usa el sistema de errores existente de tu aplicaciÃ³n
      const apiError = parseApiError(err);
      error.value = getUserFriendlyErrorMessage(apiError);
      console.error('Error cargando mÃ©tricas:', apiError);
    } finally {
      loading.value = false;
    }
  };

  /**
   * Recarga las mÃ©tricas (Ãºtil para botÃ³n de actualizar)
   */
  const recargarMetricas = async () => {
    await cargarMetricas();
  };

  // Auto-cargar al usar el composable (opcional)
  onMounted(() => {
    cargarMetricas();
  });

  return {
    // Estado
    metricas,
    loading,
    error,
    
    // Acciones
    cargarMetricas,
    recargarMetricas,
  };
}
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\composables\useNneFacade.ts
============================================================
// src/composables/useNneFacade.ts
// -------------------------------------------------------------
// Este composable actÃºa como un "Facade" (fachada).
// Es decir, expone una interfaz simple y clara para que los
// componentes Vue trabajen con NNE (niÃ±os/estudiantes) y Padres,
// ocultando la complejidad de los servicios internos (Axios, rutas, etc).
//
// Flujo general:
//   Componente Vue -> useNneFacade -> nneService.ts (Axios) -> Backend DRF -> BD
//
// Ventajas:
// - Los componentes no necesitan saber cÃ³mo se llaman los endpoints.
// - Si maÃ±ana cambias Axios por otra librerÃ­a, o cambias las rutas,
//   solo modificas los servicios internos, no todos los componentes.
// - Mantienes el frontend mÃ¡s limpio, desacoplado y fÃ¡cil de mantener.
// -------------------------------------------------------------

import { ref } from 'vue'
import {
  createNneApi,
  createParentApi,
  searchParentsApi
} from '../services/nneService.ts'
import type { NneFormData, ParentUser } from '../type/nne.ts'

export function useNneFacade() {
  // Estado reactivo para manejar resultados y loading
  const parents = ref<ParentUser[]>([])
  const isLoading = ref(false)

  // -----------------------------------------------------------
  // Crear un nuevo NEE (niÃ±o/estudiante)
  // -----------------------------------------------------------
  const createNne = async (form: NneFormData) => {
    isLoading.value = true
    try {
      // Delegamos la llamada al servicio especializado
      const nne = await createNneApi(form)
      return nne
    } finally {
      isLoading.value = false
    }
  }

  // -----------------------------------------------------------
  // Crear un nuevo padre/tutor
  // -----------------------------------------------------------
  const createParent = async (parent: Omit<ParentUser, 'id'>) => {
    isLoading.value = true
    try {
      const newParent = await createParentApi(parent)
      return newParent
    } finally {
      isLoading.value = false
    }
  }

  // -----------------------------------------------------------
  // Buscar padres por nombre, rut o email
  // -----------------------------------------------------------
  const searchParents = async (q: string) => {
    isLoading.value = true
    try {
      parents.value = await searchParentsApi(q)
    } finally {
      isLoading.value = false
    }
  }

  // -----------------------------------------------------------
  // Retornamos la interfaz simplificada (la fachada)
  // -----------------------------------------------------------
  return {
    // Estado
    parents,
    isLoading,

    // Acciones
    createNne,
    createParent,
    searchParents
  }
}
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\composables\usePaginator.ts
============================================================
// src/composables/usePaginator.ts
import { ref, computed, watch, readonly } from 'vue'

interface PaginationState {
  currentPage: number
  pageSize: number
  totalItems: number
}

interface PaginationOptions {
  initialPage?: number
  initialPageSize?: number
  totalItems?: number
  onPageChange?: (page: number) => void
}

export function usePaginator(options: PaginationOptions = {}) {
  const {
    initialPage = 1,
    initialPageSize = 10,
    totalItems = 0,
    onPageChange
  } = options

  // Estado reactivo (sin totalPages aquÃ­)
  const state = ref<PaginationState>({
    currentPage: initialPage,
    pageSize: initialPageSize,
    totalItems
  })

  // totalPages como computed separado
  const totalPages = computed(() => 
    Math.ceil(state.value.totalItems / state.value.pageSize) || 1
  )

  // Computed properties
  const paginationInfo = computed(() => ({
    currentPage: state.value.currentPage,
    pageSize: state.value.pageSize,
    totalItems: state.value.totalItems,
    totalPages: totalPages.value,
    startIndex: (state.value.currentPage - 1) * state.value.pageSize,
    endIndex: Math.min(state.value.currentPage * state.value.pageSize, state.value.totalItems),
    hasPrevious: state.value.currentPage > 1,
    hasNext: state.value.currentPage < totalPages.value,
    isFirstPage: state.value.currentPage === 1,
    isLastPage: state.value.currentPage === totalPages.value
  }))

  const pageRange = computed(() => {
    const delta = 2
    const range: (number | string)[] = []
    const total = totalPages.value
    const current = state.value.currentPage

    for (
      let i = Math.max(2, current - delta);
      i <= Math.min(total - 1, current + delta);
      i++
    ) {
      range.push(i)
    }

    if (current - delta > 2) {
      range.unshift('...')
    }
    if (current + delta < total - 1) {
      range.push('...')
    }

    range.unshift(1)
    if (total !== 1) {
      range.push(total)
    }

    return range
  })

  // MÃ©todos
  const goToPage = (page: number) => {
    if (page >= 1 && page <= totalPages.value && page !== state.value.currentPage) {
      state.value.currentPage = page
      onPageChange?.(page)
    }
  }

  const goToNext = () => {
    if (paginationInfo.value.hasNext) {
      goToPage(state.value.currentPage + 1)
    }
  }

  const goToPrevious = () => {
    if (paginationInfo.value.hasPrevious) {
      goToPage(state.value.currentPage - 1)
    }
  }

  const goToFirst = () => {
    goToPage(1)
  }

  const goToLast = () => {
    goToPage(totalPages.value)
  }

  const setPageSize = (size: number) => {
    state.value.pageSize = Math.max(1, size)
    state.value.currentPage = 1
    onPageChange?.(1)
  }

  const setTotalItems = (total: number) => {
    state.value.totalItems = Math.max(0, total)
    // Adjust current page if it's beyond the new total
    if (state.value.currentPage > totalPages.value && totalPages.value > 0) {
      state.value.currentPage = totalPages.value
      onPageChange?.(state.value.currentPage)
    }
  }

  const reset = (newOptions?: Partial<PaginationOptions>) => {
    state.value.currentPage = newOptions?.initialPage || initialPage
    state.value.pageSize = newOptions?.initialPageSize || initialPageSize
    state.value.totalItems = newOptions?.totalItems || totalItems
  }

  // Watch for external totalItems changes
  watch(
    () => totalItems,
    (newTotal) => {
      setTotalItems(newTotal)
    }
  )

  return {
    // State
    state: readonly(state),
    
    // Computed
    paginationInfo,
    pageRange,
    totalPages,
    
    // Methods
    goToPage,
    goToNext,
    goToPrevious,
    goToFirst,
    goToLast,
    setPageSize,
    setTotalItems,
    reset
  }
}

// Tipo de retorno para TypeScript
export type UsePaginatorReturn = ReturnType<typeof usePaginator>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\composables\usePhotoUpload.ts
============================================================
// src/composables/usePhotoUpload.ts

import { ref, computed } from 'vue'
import type { Ref } from 'vue'
import { photoService } from '@/services/photoService'
import type { PhotoUploadResponse } from '@/services/photoService'

export function usePhotoUpload(childId: Ref<number>) {
  // Estados
  const isUploading = ref(false)
  const uploadProgress = ref(0)
  const error = ref<string | null>(null)
  const uploadedPhoto = ref<PhotoUploadResponse | null>(null)

  /**
   * Validar archivo ORIGINAL (antes de procesarlo)
   * Solo para archivos File, NO para Blobs procesados
   */
  const validateFile = async (file: File): Promise<boolean> => {
    error.value = null

    try {
      console.log('[usePhotoUpload] Validando archivo original:', {
        name: file.name,
        type: file.type,
        size: `${(file.size / 1024 / 1024).toFixed(2)} MB`
      })

      const validation = await photoService.validateImage(file)
      
      if (!validation.valid) {
        error.value = validation.error || 'Imagen invÃ¡lida'
        return false
      }

      console.log('[usePhotoUpload] âœ… ValidaciÃ³n exitosa')
      return true
    } catch (err: any) {
      console.error('[usePhotoUpload] Error validando:', err)
      error.value = err.message || 'Error al validar la imagen'
      return false
    }
  }

  /**
   * Subir foto al servidor
   * NO VALIDA - asume que ya fue validada antes
   */
  const uploadPhoto = async (file: File | Blob): Promise<string> => {
    try {
      isUploading.value = true
      uploadProgress.value = 0
      error.value = null

      console.log('[usePhotoUpload] ğŸ“¤ Iniciando upload...', {
        childId: childId.value,
        fileName: file instanceof File ? file.name : 'processed-image.jpg',
        fileSize: `${(file.size / 1024 / 1024).toFixed(2)} MB`
      })

      // ğŸ”¥ NO VALIDAR AQUÃ - ya se validÃ³ el archivo original
      
      // Convertir a File si es Blob
      const fileToUpload = file instanceof File 
        ? file 
        : new File([file], `photo_${Date.now()}.jpg`, { type: 'image/jpeg' })

      // Callback de progreso
      const onProgress = (progress: number) => {
        uploadProgress.value = progress
        console.log(`[usePhotoUpload] ğŸ“Š Progreso: ${progress}%`)
      }

      // Llamar al servicio
      const response = await photoService.uploadChildPhoto(
        childId.value,
        fileToUpload,
        onProgress
      )

      // Guardar respuesta
      uploadedPhoto.value = response
      uploadProgress.value = 100

      console.log('[usePhotoUpload] âœ… Upload exitoso:', response.url_medium)

      return response.url_medium

    } catch (err: any) {
      console.error('[usePhotoUpload] âŒ Error en upload:', err)
      error.value = err.message || 'Error al subir la foto'
      throw err
    } finally {
      isUploading.value = false
    }
  }

  /**
   * Obtener foto actual del hijo
   */
  const fetchCurrentPhoto = async (): Promise<void> => {
    try {
      error.value = null

      const response = await photoService.getChildPhoto(childId.value)
      
      if (response.has_photo && response.photo) {
        uploadedPhoto.value = response.photo
      }

    } catch (err: any) {
      console.error('[usePhotoUpload] Error obteniendo foto:', err)
      error.value = err.message || 'Error al obtener la foto'
    }
  }

  /**
   * Eliminar foto actual
   */
  const deletePhoto = async (): Promise<void> => {
    try {
      error.value = null
      isUploading.value = true

      await photoService.deleteChildPhoto(childId.value)
      
      uploadedPhoto.value = null

    } catch (err: any) {
      console.error('[usePhotoUpload] Error eliminando foto:', err)
      error.value = err.message || 'Error al eliminar la foto'
      throw err
    } finally {
      isUploading.value = false
    }
  }

  /**
   * Reset del composable
   */
  const reset = () => {
    isUploading.value = false
    uploadProgress.value = 0
    error.value = null
    uploadedPhoto.value = null
  }

  // Computed
  const currentPhotoUrl = computed(() => {
    return uploadedPhoto.value?.url_medium || null
  })

  const hasPhoto = computed(() => {
    return uploadedPhoto.value !== null
  })

  return {
    // Estados
    isUploading,
    uploadProgress,
    error,
    uploadedPhoto,
    currentPhotoUrl,
    hasPhoto,

    // MÃ©todos
    validateFile,
    uploadPhoto,
    fetchCurrentPhoto,
    deletePhoto,
    reset
  }
}
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\composables\useRutValidation.ts
============================================================
// src/composables/useRutValidation.ts

import { ref, computed, watch } from 'vue';
import { validarRut, validarRutProgresivo, formatearRut, type RutValidationResult } from '@/utils/rutValidator';
import { checkRutAvailabilityApi, validateChildRutApi } from '@/services/nneService';

/**
 * Composable para validaciÃ³n reactiva de RUT - VERSIÃ“N MEJORADA
 */
export function useRutValidation() {
  const rutValue = ref('');
  const rutValidation = ref<RutValidationResult | null>(null);
  const isCheckingAvailability = ref(false);
  const availabilityError = ref<string | null>(null);
  const isAvailable = ref<boolean | null>(null);
  const lastCheckedRut = ref<string>(''); // âœ… NUEVO: Track del Ãºltimo RUT verificado

  /**
   * Resetear estado de disponibilidad cuando el RUT cambia significativamente
   */
  watch(rutValue, (newRut, oldRut) => {
    // Si el RUT cambiÃ³ completamente, resetear disponibilidad
    if (newRut !== oldRut && !isPartialRut(newRut)) {
      console.log('ğŸ”„ RUT cambiado, reseteando disponibilidad:', newRut);
      availabilityError.value = null;
      isAvailable.value = null;
      lastCheckedRut.value = '';
    }
  });

  /**
   * Determinar si un RUT es parcial (en proceso de escritura)
   */
  const isPartialRut = (rut: string): boolean => {
    const rutLimpio = rut.replace(/\./g, '').replace(/-/g, '').trim();
    return rutLimpio.length > 0 && rutLimpio.length < 9;
  };

  /**
   * ValidaciÃ³n sincrÃ³nica del RUT
   */
  const validateRutSync = (rut: string = rutValue.value): RutValidationResult => {
    console.log('ğŸ”„ Validando RUT:', rut || '<empty>');
    
    const result = validarRutProgresivo(rut);
    rutValidation.value = result;
    
    // âœ… MEJORADO: Resetear disponibilidad solo si el RUT cambiÃ³ significativamente
    if ((!result.isPartial && !result.isValid) || rut !== rutValue.value) {
      availabilityError.value = null;
      isAvailable.value = null;
      lastCheckedRut.value = '';
    }
    
    return result;
  };

  /**
   * ValidaciÃ³n asincrÃ³nica de disponibilidad del RUT - VERSIÃ“N MEJORADA
   */
// En useRutValidation.ts - MODIFICAR la funciÃ³n checkRutAvailability

const checkRutAvailability = async (rut: string = rutValue.value): Promise<boolean> => {
  // âœ… MEJORADO: ValidaciÃ³n mÃ¡s estricta para RUT obligatorio
  if (!rut || rut.trim() === '') {
    availabilityError.value = 'El RUT es obligatorio para el registro de niÃ±os'
    isAvailable.value = false
    lastCheckedRut.value = ''
    return false
  }

  // âœ… NUEVO: ValidaciÃ³n de formato mÃ¡s estricta
  const validation = validarRut(rut)
  if (!validation.isValid && !validation.isPartial) {
    availabilityError.value = validation.message || 'Formato de RUT invÃ¡lido'
    isAvailable.value = false
    lastCheckedRut.value = ''
    return false
  }

  // No verificar disponibilidad para RUTs parciales
  if (validation.isPartial) {
    availabilityError.value = null
    isAvailable.value = null
    lastCheckedRut.value = ''
    return false
  }

  // âœ… VERIFICACIÃ“N: Usar el nuevo endpoint especÃ­fico para niÃ±os
  if (rut === lastCheckedRut.value && isAvailable.value !== null) {
    console.log('âš¡ RUT ya verificado recientemente, usando cache:', rut)
    return isAvailable.value
  }

  lastCheckedRut.value = rut
  isCheckingAvailability.value = true
  availabilityError.value = null

  try {
    console.log('ğŸ” Verificando disponibilidad del RUT para niÃ±o:', rut)
    
    // âœ… CAMBIO: Usar la nueva funciÃ³n especÃ­fica para niÃ±os
    const validationResult = await validateChildRutApi(validation.rutNormalized!)
    
    console.log('âœ… Resultado validaciÃ³n RUT niÃ±o:', validationResult)
    
    isAvailable.value = validationResult.isAvailable
    
    if (!validationResult.isValid) {
      availabilityError.value = validationResult.message || 'RUT invÃ¡lido'
      isAvailable.value = false
    } else if (!validationResult.isAvailable) {
      availabilityError.value = 'El RUT ya estÃ¡ registrado para otro niÃ±o en el sistema'
    } else {
      availabilityError.value = null
    }
    
    return validationResult.isValid && validationResult.isAvailable
  } catch (error: any) {
    console.error('âŒ Error verificando disponibilidad de RUT para niÃ±o:', error)
    
    // âœ… MEJORADO: Manejo especÃ­fico de errores para ingreso_fichas
    if (error?.response?.status === 400) {
      // Error de validaciÃ³n del backend
      const errorData = error.response.data
      if (errorData.rut) {
        availabilityError.value = Array.isArray(errorData.rut) 
          ? errorData.rut[0] 
          : errorData.rut
      } else {
        availabilityError.value = 'Error validando el RUT'
      }
    } else if (error?.response?.status === 404) {
      // Endpoint no disponible, usar validaciÃ³n local
      availabilityError.value = null
      isAvailable.value = true // Asumir disponible temporalmente
      return true
    } else {
      availabilityError.value = 'Error al verificar disponibilidad del RUT'
      isAvailable.value = false
    }
    
    lastCheckedRut.value = ''
    return false
  } finally {
    isCheckingAvailability.value = false
  }
}

  /**
   * Forzar re-verificaciÃ³n de disponibilidad (ignorar cache)
   */
  const recheckAvailability = async (): Promise<boolean> => {
    console.log('ğŸ”„ Forzando re-verificaciÃ³n de RUT:', rutValue.value);
    lastCheckedRut.value = ''; // Resetear cache
    return await checkRutAvailability(rutValue.value);
  };

  /**
   * Formatear el RUT actual
   */
  const formatCurrentRut = (): string => {
    return formatearRut(rutValue.value);
  };

  /**
   * Actualizar valor del RUT
   */
  const setRutValue = (newValue: string) => {
    console.log('ğŸ“ Set RUT Value:', newValue || '<empty>');
    rutValue.value = newValue;
  };

  // Computed properties
  const isValid = computed(() => {
    return rutValidation.value?.isValid === true && 
           isAvailable.value !== false && 
           !availabilityError.value;
  });

  const isPartial = computed(() => {
    return rutValidation.value?.isPartial === true;
  });

  const hasSyncError = computed(() => {
    return rutValidation.value?.isValid === false && !rutValidation.value?.isPartial;
  });

  const hasAsyncError = computed(() => {
    return availabilityError.value !== null;
  });

  const errorMessage = computed(() => {
    if (rutValidation.value?.isPartial) return null;
    return rutValidation.value?.message || availabilityError.value;
  });

  const isLoading = computed(() => isCheckingAvailability.value);

  /**
   * Resetear el estado completamente
   */
  const reset = () => {
    rutValue.value = '';
    rutValidation.value = null;
    isCheckingAvailability.value = false;
    availabilityError.value = null;
    isAvailable.value = null;
    lastCheckedRut.value = '';
  };

  return {
    // Estado
    rutValue,
    rutValidation,
    isCheckingAvailability,
    availabilityError,
    isAvailable,
    
    // MÃ©todos
    validateRutSync,
    checkRutAvailability,
    recheckAvailability, // âœ… NUEVO: MÃ©todo para forzar re-verificaciÃ³n
    formatCurrentRut,
    setRutValue,
    reset,
    
    // Computados
    isValid,
    isPartial,
    hasSyncError,
    hasAsyncError,
    errorMessage,
    isLoading
  };
}

export default useRutValidation;
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\composables\useRutValidationForChild.ts
============================================================

============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\env.d.ts
============================================================
/// <reference types="vite/client" />

declare module '*.vue' {
  import type { DefineComponent } from 'vue'
  const component: DefineComponent<{}, {}, any>
  export default component
}
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\exceptions\apiError.ts
============================================================
// src/exceptions/apiError.ts

declare global {
  interface ErrorConstructor {
    captureStackTrace(targetObject: object, constructorOpt?: Function): void;
  }
}

/**
 * Tipos de errores de la API
 */
export enum ApiErrorType {
  VALIDATION_ERROR = 'VALIDATION_ERROR',
  CONFLICT_ERROR = 'CONFLICT_ERROR',
  NETWORK_ERROR = 'NETWORK_ERROR',
  AUTHENTICATION_ERROR = 'AUTHENTICATION_ERROR',
  AUTHORIZATION_ERROR = 'AUTHORIZATION_ERROR',
  SERVER_ERROR = 'SERVER_ERROR',
  CLIENT_ERROR = 'CLIENT_ERROR',
  UNKNOWN_ERROR = 'UNKNOWN_ERROR'
}

/**
 * Interfaz para errores de validaciÃ³n de campos
 */
export interface FieldValidationError {
  field: string
  message: string
  value?: any
}

/**
 * Clase personalizada para errores de API
 */
export class ApiError extends Error {
  constructor(
    public message: string,
    public type: ApiErrorType,
    public status?: number,
    public details?: any,
    public fieldErrors?: FieldValidationError[],
    public originalError?: any
  ) {
    super(message)
    this.name = 'ApiError'
    
    // Mantiene el stack trace adecuado
    if (Error.captureStackTrace) {
      Error.captureStackTrace(this, ApiError)
    }
  }

  /**
   * Verifica si es un error de validaciÃ³n
   */
  get isValidationError(): boolean {
    return this.type === ApiErrorType.VALIDATION_ERROR
  }

  /**
   * Verifica si es un error de conflicto (duplicados)
   */
  get isConflictError(): boolean {
    return this.type === ApiErrorType.CONFLICT_ERROR
  }

  /**
   * Verifica si es un error de red
   */
  get isNetworkError(): boolean {
    return this.type === ApiErrorType.NETWORK_ERROR
  }

  /**
   * Verifica si es un error de autenticaciÃ³n
   */
  get isAuthenticationError(): boolean {
    return this.type === ApiErrorType.AUTHENTICATION_ERROR
  }

  /**
   * Verifica si es un error de autorizaciÃ³n
   */
  get isAuthorizationError(): boolean {
    return this.type === ApiErrorType.AUTHORIZATION_ERROR
  }

  /**
   * Obtiene errores de campo especÃ­ficos
   */
  getFieldError(fieldName: string): FieldValidationError | undefined {
    return this.fieldErrors?.find(error => error.field === fieldName)
  }

  /**
   * Verifica si un campo especÃ­fico tiene error
   */
  hasFieldError(fieldName: string): boolean {
    return this.fieldErrors?.some(error => error.field === fieldName) || false
  }

  /**
   * Convierte el error a un objeto plano para logging
   */
  toLogObject() {
    return {
      name: this.name,
      message: this.message,
      type: this.type,
      status: this.status,
      fieldErrors: this.fieldErrors,
      stack: this.stack
    }
  }
}

/**
 * FunciÃ³n para parsear errores de Axios/API y convertirlos en ApiError
 */
export function parseApiError(error: any): ApiError {
  console.error('ğŸ”§ Parseando error original:', error)

  // Error de conexiÃ³n/red
  if (error.code === 'NETWORK_ERROR' || !error.response) {
    return new ApiError(
      'Error de conexiÃ³n. Verifique su conexiÃ³n a internet e intente nuevamente.',
      ApiErrorType.NETWORK_ERROR,
      undefined,
      { originalError: error.message },
      undefined,
      error
    )
  }

  const status = error.response?.status
  const data = error.response?.data

  console.error(`ğŸ“Š Error HTTP ${status}:`, data)

  // Errores de validaciÃ³n (400)
  if (status === 400 && data?.errors) {
    const fieldErrors: FieldValidationError[] = []
    
    // Procesar errores de campos especÃ­ficos
    for (const field in data.errors) {
      const messages = Array.isArray(data.errors[field]) 
        ? data.errors[field] 
        : [data.errors[field]]
      
      messages.forEach(message => {
        fieldErrors.push({
          field,
          message: String(message),
          value: undefined
        })
      })
    }

    // Mensaje principal basado en los errores de campo
    let mainMessage = 'Errores de validaciÃ³n en los datos ingresados.'
    if (fieldErrors.length > 0) {
      const firstError = fieldErrors[0]
      mainMessage = `Error de validaciÃ³n: ${firstError.field} - ${firstError.message}`
    }

    return new ApiError(
      mainMessage,
      ApiErrorType.VALIDATION_ERROR,
      status,
      data,
      fieldErrors,
      error
    )
  }

  // Conflictos - recursos duplicados (409)
  if (status === 409) {
    let conflictMessage = 'El recurso ya existe en el sistema.'
    const fieldErrors: FieldValidationError[] = []

    // Procesar conflictos especÃ­ficos por campo
    if (data?.errors) {
      for (const field in data.errors) {
        const messages = Array.isArray(data.errors[field]) 
          ? data.errors[field] 
          : [data.errors[field]]
        
        messages.forEach(message => {
          fieldErrors.push({
            field,
            message: String(message),
            value: undefined
          })
        })
      }

      if (fieldErrors.length > 0) {
        const firstError = fieldErrors[0]
        conflictMessage = `Conflicto: ${firstError.field} - ${firstError.message}`
      }
    } else if (data?.detail) {
      conflictMessage = data.detail
    } else if (data?.message) {
      conflictMessage = data.message
    }

    return new ApiError(
      conflictMessage,
      ApiErrorType.CONFLICT_ERROR,
      status,
      data,
      fieldErrors,
      error
    )
  }

  // No autorizado (401)
  if (status === 401) {
    return new ApiError(
      'No autorizado. Su sesiÃ³n ha expirado o no tiene permisos para esta acciÃ³n.',
      ApiErrorType.AUTHENTICATION_ERROR,
      status,
      data,
      undefined,
      error
    )
  }

  // Prohibido (403)
  if (status === 403) {
    return new ApiError(
      'Acceso prohibido. No tiene permisos para realizar esta acciÃ³n.',
      ApiErrorType.AUTHORIZATION_ERROR,
      status,
      data,
      undefined,
      error
    )
  }

  // Error interno del servidor (500)
  if (status === 500) {
    return new ApiError(
      'Error interno del servidor. Por favor, intente mÃ¡s tarde.',
      ApiErrorType.SERVER_ERROR,
      status,
      data,
      undefined,
      error
    )
  }

  // Error del cliente (4xx)
  if (status >= 400 && status < 500) {
    const message = data?.detail || data?.message || `Error del cliente (${status})`
    return new ApiError(
      message,
      ApiErrorType.CLIENT_ERROR,
      status,
      data,
      undefined,
      error
    )
  }

  // Error del servidor (5xx)
  if (status >= 500) {
    return new ApiError(
      'Error del servidor. Por favor, intente mÃ¡s tarde.',
      ApiErrorType.SERVER_ERROR,
      status,
      data,
      undefined,
      error
    )
  }

  // Error desconocido
  const unknownMessage = data?.detail || data?.message || error.message || 'Error desconocido en la API'
  return new ApiError(
    unknownMessage,
    ApiErrorType.UNKNOWN_ERROR,
    status,
    data,
    undefined,
    error
  )
}

/**
 * Helper para crear errores de validaciÃ³n especÃ­ficos
 */
export function createValidationError(
  message: string, 
  fieldErrors?: FieldValidationError[]
): ApiError {
  return new ApiError(
    message,
    ApiErrorType.VALIDATION_ERROR,
    400,
    undefined,
    fieldErrors
  )
}

/**
 * Helper para crear errores de conflicto especÃ­ficos
 */
export function createConflictError(
  message: string,
  fieldErrors?: FieldValidationError[]
): ApiError {
  return new ApiError(
    message,
    ApiErrorType.CONFLICT_ERROR,
    409,
    undefined,
    fieldErrors
  )
}

/**
 * Helper para verificar si un error es de tipo ApiError
 */
export function isApiError(error: any): error is ApiError {
  return error instanceof ApiError
}

/**
 * Helper para obtener el mensaje de error mÃ¡s amigable para el usuario
 */
export function getUserFriendlyErrorMessage(error: any): string {
  if (isApiError(error)) {
    return error.message
  }

  if (error?.response?.data?.detail) {
    return error.response.data.detail
  }

  if (error?.response?.data?.message) {
    return error.response.data.message
  }

  if (error?.message) {
    return error.message
  }

  return 'Ha ocurrido un error inesperado. Por favor, intente nuevamente.'
}
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\layouts\DashboardLayout.vue
============================================================
<template>
  <div class="flex h-screen bg-gray-100">
    <Sidebar :isOpen="isSidebarOpen" @toggle="toggleSidebar" />
    
    <div class="flex-1 flex flex-col overflow-hidden">
      <TopNavbar :isSidebarOpen="isSidebarOpen" @toggle-sidebar="toggleSidebar" />
      
      <main
        class="flex-1 overflow-y-auto p-4"
        :class="{'ml-64': isSidebarOpen, 'ml-16': !isSidebarOpen}"
      >
        <div class="container mx-auto px-4 py-6">
        
       
          <router-view />
             <Breadcrumbs class="mb-4" />
        </div>
      </main>
    </div>

    <SessionWarningModal
      :visible="showWarningModal"
      :onKeepAlive="keepSessionAlive"
    />
  </div>
    <ToastContainer />
</template>

<script setup lang="ts">
import { ref } from 'vue'
import Sidebar from '../components/dashboard/Sidebar.vue'
import TopNavbar from '../components/dashboard/TopNavbar.vue'
import SessionWarningModal from '@/components/modal/SessionWarningModal.vue'
import ToastContainer from '@/components/toastglobal/ToastContainer.vue'

// ===================================================================
// INICIO DE LA MODIFICACIÃ“N: IMPORTAR BREADCRUMBS
// 
// Importamos el nuevo componente Breadcrumbs que creamos.
// AsegÃºrate de que la ruta '@/components/layout/Breadcrumbs.vue' sea correcta.
// ===================================================================
import Breadcrumbs from '@/components/layout/Breadcrumbs.vue'
// FIN DE LA MODIFICACIÃ“N

// ğŸ‘‡ Importamos el composable de inactividad
import { useInactivityLogout } from '@/composables/useInactivityLogout'

const isSidebarOpen = ref(true)

const toggleSidebar = () => {
  isSidebarOpen.value = !isSidebarOpen.value
}

// ğŸ‘‡ Activamos el cierre de sesiÃ³n por inactividad (20 minutos)
// y capturamos las propiedades que devuelve
const { showWarningModal, keepSessionAlive } = useInactivityLogout(20 * 60 * 1000)
</script>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\layouts\ParentLayout.vue
============================================================
<!-- src/layouts/ParentLayout.vue -->
<template>
  <div class="flex h-screen bg-gray-50">
    <!-- Sidebar para padres -->
    <ParentSidebar 
      :isOpen="isSidebarOpen" 
      @toggle="toggleSidebar" 
    />
    
    <div class="flex-1 flex flex-col overflow-hidden">
      <!-- Navbar para padres -->
      <ParentNavbar 
        :isSidebarOpen="isSidebarOpen" 
        @toggle-sidebar="toggleSidebar" 
      />
      
      <main
        class="flex-1 overflow-y-auto p-4"
        :class="{'ml-64': isSidebarOpen, 'ml-16': !isSidebarOpen}"
      >
        <div class="container mx-auto px-4 py-6">
          <!-- Breadcrumbs (reutilizado, ya es dinÃ¡mico) -->
          <Breadcrumbs class="mb-4" />
          
          <!-- Contenido dinÃ¡mico de las vistas -->
          <router-view />
        </div>
      </main>
    </div>

    <!-- Componentes compartidos -->
    <SessionWarningModal
      :visible="showWarningModal"
      :onKeepAlive="keepSessionAlive"
    />
    <ToastContainer />
  </div>
</template>

<script setup lang="ts">
import { ref } from 'vue'

// Componentes especÃ­ficos de padres
import ParentSidebar from '@/components/dashboard/padres/ParentSidebar.vue'
import ParentNavbar from '@/components/dashboard/padres/ParentNavbar.vue'

// Componentes compartidos
import Breadcrumbs from '@/components/layout/Breadcrumbs.vue'
import SessionWarningModal from '@/components/modal/SessionWarningModal.vue'
import ToastContainer from '@/components/toastglobal/ToastContainer.vue'

// Composable de inactividad
import { useInactivityLogout } from '@/composables/useInactivityLogout'

const isSidebarOpen = ref(true)

const toggleSidebar = () => {
  isSidebarOpen.value = !isSidebarOpen.value
}

// Cierre de sesiÃ³n por inactividad (20 minutos)
const { showWarningModal, keepSessionAlive } = useInactivityLogout(20 * 60 * 1000)
</script>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\main.ts
============================================================
// src/main.ts
import { createApp } from 'vue'
import App from './App.vue'
import router from './router'
import '@/style.css'

// Pinia
import { createPinia } from 'pinia'

// FormKit
import { plugin, defaultConfig } from '@formkit/vue'
import '@formkit/themes/genesis'
// Si tienes un archivo de configuraciÃ³n personalizada de FormKit, puedes importarlo aquÃ­:
// import formKitConfig from './formkit.config'

// Crear la app
const app = createApp(App)
const pinia = createPinia()

app
  .use(pinia)
  .use(router)
  .use(plugin, defaultConfig) // <-- Esto registra <FormKit /> globalmente

// Montar la app
app.mount('#app')



============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\router\index.ts
============================================================
// src/router/index.ts
import { createRouter, createWebHistory, type RouteLocationNormalized, type NavigationGuardNext, type RouteRecordRaw } from 'vue-router'
import DashboardLayout from '@/layouts/DashboardLayout.vue'
import ParentLayout from '@/layouts/ParentLayout.vue'

import therapistRoutes from './therapist.routes'
import parentRoutes from './parent.routes'

declare module 'vue-router' {
  interface RouteMeta {
    requiresAuth?: boolean
    role?: 'therapist' | 'parent' | 'admin'
    breadcrumb?: string | (() => string)
  }
}

const routes: RouteRecordRaw[] = [
  {
    path: '/login',
    name: 'login',
    meta: { requiresAuth: false },
    component: () => import('@/views/auth/LoginView.vue')
  },

  // RUTAS TERAPEUTAS
  {
    path: '/therapist',
    component: DashboardLayout,
    meta: { 
      requiresAuth: true,
      role: 'therapist'
    },
    children: therapistRoutes
  },

  // RUTAS PADRES
  {
    path: '/parent',
    component: ParentLayout,
    meta: { 
      requiresAuth: true,
      role: 'parent'
    },
    children: parentRoutes
  },

  // REDIRECCIÃ“N RAÃZ
  {
    path: '/',
    redirect: () => {
      const userRole = getUserRole()
      console.log('[Router] Redirigiendo desde /, rol detectado:', userRole)
      
      if (userRole === 'parent') {
        return '/parent'
      } else if (userRole === 'therapist') {
        return '/therapist'
      }
      
      return '/login'
    }
  },

  // 404
  {
    path: '/:pathMatch(.*)*',
    name: 'not-found',
    component: () => import('@/views/errors/NotFoundView.vue')
  }
]

const router = createRouter({
  history: createWebHistory(),
  routes
})

// ğŸ”¥ NAVIGATION GUARD MEJORADO
router.beforeEach((
  to: RouteLocationNormalized, 
  from: RouteLocationNormalized, 
  next: NavigationGuardNext
) => {
  const isAuthenticated = !!localStorage.getItem('access')
  const userRole = getUserRole()

  console.log('[Router Guard] Navegando:', {
    from: from.path,
    to: to.path,
    isAuth: isAuthenticated,
    userRole: userRole,
    requiredRole: to.meta.role
  })

  // 1. Verificar autenticaciÃ³n
  if (to.meta.requiresAuth && !isAuthenticated) {
    console.log('[Router Guard] âŒ No autenticado, redirigiendo a login')
    return next({ name: 'login' })
  }

  // 2. Si estÃ¡ en login y ya estÃ¡ autenticado
  if (to.name === 'login' && isAuthenticated) {
    console.log('[Router Guard] âœ… Ya autenticado, redirigiendo a dashboard')
    
    if (userRole === 'parent') {
      return next('/parent')
    } else if (userRole === 'therapist') {
      return next('/therapist')
    }
    return next('/therapist')
  }

  // 3. Verificar permisos de rol
  const requiredRole = to.meta.role
  if (requiredRole && userRole && userRole !== requiredRole) {
    console.warn(`[Router Guard] âš ï¸ Rol incorrecto. Requerido: ${requiredRole}, Actual: ${userRole}`)
    
    // Redirigir a su dashboard correcto
    if (userRole === 'parent') {
      return next('/parent')
    } else if (userRole === 'therapist') {
      return next('/therapist')
    }
  }

  console.log('[Router Guard] âœ… Permitiendo navegaciÃ³n')
  next()
})

// ğŸ”¥ HELPER MEJORADO
function getUserRole(): 'parent' | 'therapist' | 'admin' | null {
  try {
    // ğŸ”¥ OPCIÃ“N 1: Leer desde localStorage 'user'
    const userData = localStorage.getItem('user')
    if (userData) {
      const user = JSON.parse(userData)
      
      // âœ… Buscar en campo 'role' (singular)
      if (user.role) {
        console.log('[getUserRole] âœ… Rol encontrado en user.role:', user.role)
        return user.role
      }
      
      // âœ… Fallback: Buscar en 'roles' (array)
      if (user.roles && Array.isArray(user.roles) && user.roles.length > 0) {
        const firstRole = user.roles[0]
        const mappedRole = firstRole.toLowerCase().includes('terapeuta') ? 'therapist' :
                          firstRole.toLowerCase().includes('padres') ? 'parent' :
                          firstRole.toLowerCase().includes('admin') ? 'admin' : null
        
        console.log('[getUserRole] âš ï¸ Usando roles[0]:', firstRole, 'â†’', mappedRole)
        return mappedRole
      }
    }

    console.warn('[getUserRole] âŒ No se encontrÃ³ rol en localStorage')
    return null
  } catch (error) {
    console.error('[getUserRole] Error:', error)
    return null
  }
}

function parseJWT(token: string): Record<string, any> | null {
  try {
    const base64Url = token.split('.')[1]
    const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/')
    const jsonPayload = decodeURIComponent(
      atob(base64)
        .split('')
        .map((c) => '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2))
        .join('')
    )
    return JSON.parse(jsonPayload)
  } catch (error) {
    console.error('[parseJWT] Error:', error)
    return null
  }
}

export default router
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\router\parent.routes.ts
============================================================
// src/router/parent.routes.ts

/**
 * RUTAS DEL PANEL DE PADRES/FAMILIA
 * Todas las rutas bajo /parent/
 * 
 * Estructura simplificada:
 * - Dashboard simple
 * - Mis hijos
 * - Registro diario
 * - Rutinas
 * - MedicaciÃ³n
 * - Mensajes
 * - Reportes
 */

export default [
  // Dashboard principal padres
  {
    path: '',
    name: 'parent-dashboard',
    meta: { breadcrumb: 'Inicio' },
    component: () => import('@/views/dashboard/padres/DashboardView.vue')
  },

  // Mis hijos
  {
    path: 'mis-hijos',
    name: 'parent-mis-hijos',
    meta: { breadcrumb: 'Mis Hijos' },
    component: () => import('@/views/dashboard/padres/MisHijosView.vue')
  },

  // Detalle de un hijo
  {
    path: 'hijos/:id',
    name: 'parent-hijo-detalle',
    component: () => import('@/views/dashboard/padres/HijoDetalleView.vue'),
    props: true,
    meta: { breadcrumb: 'Detalle de mi Hijo' }
  },

  // Registro diario
  {
    path: 'registro-diario',
    name: 'parent-registro-diario',
    meta: { breadcrumb: 'Registro Diario' },
    component: () => import('@/views/dashboard/padres/RegistroDiarioView.vue')
  },

  // Rutinas
  {
    path: 'rutinas',
    name: 'parent-rutinas',
    meta: { breadcrumb: 'Rutinas' },
    component: () => import('@/views/dashboard/padres/RutinasView.vue')
  },

  // MedicaciÃ³n
  {
    path: 'medicacion',
    name: 'parent-medicacion',
    meta: { breadcrumb: 'MedicaciÃ³n' },
    component: () => import('@/views/dashboard/padres/MedicacionView.vue')
  },

  // Mensajes/Feedback
  {
    path: 'mensajes',
    name: 'parent-mensajes',
    meta: { breadcrumb: 'Mensajes' },
    component: () => import('@/views/dashboard/padres/MensajesView.vue')
  },

  // Reportes
  {
    path: 'reportes',
    name: 'parent-reportes',
    meta: { breadcrumb: 'Reportes' },
    component: () => import('@/views/dashboard/padres/ReportesView.vue')
  },

  // ConfiguraciÃ³n (opcional)
  {
    path: 'configuracion',
    name: 'parent-configuracion',
    meta: { breadcrumb: 'ConfiguraciÃ³n' },
    component: () => import('@/views/dashboard/padres/ConfiguracionView.vue')
  }
]
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\router\therapist.routes.ts
============================================================
// src/router/therapist.routes.ts

/**
 * RUTAS DEL PANEL DE TERAPEUTAS
 * Todas las rutas bajo /therapist/
 */

import PerfilNinoLayout from '@/views/dashboard/perfil_nino/PerfilNinoLayout.vue'
import { useNinoActivoStore } from '@/store/ninoActivoStore'

const RouteShell = { template: '<router-view />' }

export default [
  // Dashboard principal
  { 
    path: '', 
    name: 'dashboard', 
    meta: { breadcrumb: 'Inicio' },
    component: () => import('@/views/dashboard/DashboardView.vue') 
  },

  // GestiÃ³n NNA
  {
    path: 'ingreso-nna', 
    name: 'gestion-nna-parent',
    component: RouteShell,
    meta: { breadcrumb: 'GestiÃ³n NNA' },
    children: [
      {
        path: '', 
        name: 'lista-nna',
        component: () => import('@/views/dashboard/IngresoNneDashboard.vue')
      },
      {
        path: ':id',
        name: 'perfil-nino',
        component: PerfilNinoLayout,
        props: true,
        meta: { 
          breadcrumb: () => {
            const ninoStore = useNinoActivoStore()
            return ninoStore.hasData 
              ? ninoStore.nombreNino
              : 'Perfil del NiÃ±o'
          }
        },
        children: [
          {
            path: '',
            redirect: { name: 'perfil-nino-resumen' }
          },
          {
            path: 'resumen',
            name: 'perfil-nino-resumen',
            component: () => import('@/views/dashboard/PerfilSeguimientoPersonal.vue'),
            props: true,
            meta: { breadcrumb: 'Resumen' }
          },
          {
            path: 'hitos-logros',
            name: 'perfil-nino-hitos',
            component: () => import('@/views/dashboard/perfil_nino/HitosLogrosView.vue'),
            props: true,
            meta: { breadcrumb: 'Hitos y Logros' }
          },
          {
            path: 'rutinas',
            name: 'perfil-nino-rutinas',
            component: () => import('@/views/dashboard/perfil_nino/RutinasView.vue'),
            props: true,
            meta: { breadcrumb: 'Rutinas' }
          },
          {
            path: 'cognitivo',
            name: 'perfil-nino-cognitivo',
            component: () => import('@/views/dashboard/perfil_nino/CognitivoView.vue'),
            props: true,
            meta: { breadcrumb: 'P. Cognitivo' }
          },
          {
            path: 'habilidades-sociales',
            name: 'perfil-nino-habilidades',
            component: () => import('@/views/dashboard/perfil_nino/HabilidadesSocialesView.vue'),
            props: true,
            meta: { breadcrumb: 'H. Sociales' }
          },
          {
            path: 'sensorial',
            name: 'perfil-nino-sensorial',
            component: () => import('@/views/dashboard/perfil_nino/SensorialView.vue'),
            props: true,
            meta: { breadcrumb: 'Sensorial' }
          },
          {
            path: 'comunicacion',
            name: 'perfil-nino-comunicacion',
            component: () => import('@/views/dashboard/perfil_nino/ComunicacionView.vue'),
            props: true,
            meta: { breadcrumb: 'ComunicaciÃ³n' }
          },
          {
            path: 'autonomia',
            name: 'perfil-nino-autonomia',
            component: () => import('@/views/dashboard/perfil_nino/AutonomiaView.vue'),
            props: true,
            meta: { breadcrumb: 'AutonomÃ­a' }
          },
          {
            path: 'regulacion',
            name: 'perfil-nino-regulacion',
            component: () => import('@/views/dashboard/perfil_nino/RegulacionView.vue'),
            props: true,
            meta: { breadcrumb: 'RegulaciÃ³n' }
          },
          {
            path: 'detonantes-crisis',
            name: 'perfil-nino-detonantes',
            component: () => import('@/views/dashboard/perfil_nino/DetonantesCrisisView.vue'),
            props: true,
            meta: { breadcrumb: 'Detonantes' }
          },
          {
            path: 'tareas',
            name: 'perfil-nino-tareas',
            component: () => import('@/views/dashboard/perfil_nino/TareasView.vue'),
            props: true,
            meta: { breadcrumb: 'Tareas' }
          },
          {
            path: 'sesiones',
            name: 'perfil-nino-sesiones',
            component: () => import('@/views/dashboard/perfil_nino/SesionesNinoView.vue'),
            props: true,
            meta: { breadcrumb: 'Sesiones' }
          }
        ]
      }
    ]
  },

  // Hitos
  { 
    path: 'histos', 
    name: 'histos', 
    meta: { breadcrumb: 'Histos' },
    component: () => import('@/views/dashboard/HistosView.vue') 
  },

  // Sesiones
  { 
    path: 'sesiones',
    name: 'sesiones',
    meta: { breadcrumb: 'Sesiones (General)' },
    component: () => import('@/views/dashboard/SessionesView.vue') 
  },
  
  // Documentar sesiÃ³n
  {
    path: 'ninos/:childId/sesiones/:sessionId/documentar',
    name: 'documentar-sesion',
    component: () => import('@/views/dashboard/DocumentarSesionView.vue'),
    props: true,
    meta: { breadcrumb: 'Documentar SesiÃ³n' }
  },
  
  // Reportes
  { 
    path: 'reportes', 
    name: 'reportes', 
    meta: { breadcrumb: 'Reportes' },
    component: () => import('@/views/dashboard/ReportesView.vue') 
  },

  // ConfiguraciÃ³n
  { 
    path: 'configuracion', 
    name: 'configuracion', 
    meta: { breadcrumb: 'ConfiguraciÃ³n' },
    component: () => import('@/views/dashboard/ConfiguracionView.vue') 
  },

  // Establecimientos
  { 
    path: 'establecimientos', 
    name: 'establecimientos', 
    meta: { breadcrumb: 'Establecimientos' },
    component: () => import('@/views/dashboard/EstablecimientosView.vue') 
  }
]
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\services\authService.ts
============================================================
// src/services/authService.ts
// Paso 3: Funciones para llamar al backend (autenticaciÃ³n)

import type { User } from "@/type/user.ts"
import http from "./http.ts"



interface LoginResponse {
  access: string
  refresh: string
  user: User
  message: string
}

/**
 * Inicia sesiÃ³n en el backend con email y contraseÃ±a
 */
export async function loginApi(email: string, password: string): Promise<LoginResponse> {
  const { data } = await http.post('/user/login/', { email, password })
  return data
}

/**
 * Cierra sesiÃ³n en el backend invalidando el refresh token
 */
export async function logoutApi(): Promise<void> {
  const refresh = localStorage.getItem('refresh')

  // Si no hay refresh token, devolvemos una promesa resuelta
  if (!refresh) return Promise.resolve()

  await http.post('/user/logout/', { refresh })
}

/**
 * Renueva el access token usando el refresh token
 */
export async function refreshTokenApi(): Promise<{ access: string }> {
  const refresh = localStorage.getItem('refresh')
  if (!refresh) throw new Error('No refresh token disponible')

  const { data } = await http.post('/user/refresh/', { refresh })
  return data // { access: 'nuevo_token' }
}

============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\services\childService.ts
============================================================
// src/services/childService.ts

import http from '@/services/http'

export interface ChildInfo {
  id: number
  nombre_completo: string
  first_name: string
  last_name: string
  fecha_nacimiento: string | null
  edad: number | null
  has_photo: boolean
  photo_url: string | null
}

export interface ParentChildrenResponse {
  count: number
  children: ChildInfo[]
}

export const childService = {
  /**
   * Obtener hijos del padre logueado
   * GET /api/core/parent/children/
   */
  async getMyChildren(): Promise<ParentChildrenResponse> {
    try {
      console.log('[childService] ğŸ” Obteniendo hijos del padre...')
      
      const response = await http.get<ParentChildrenResponse>('/core/parent/children/')
      
      console.log('[childService] âœ… Hijos obtenidos:', {
        count: response.data.count,
        children: response.data.children.map(c => `${c.id}: ${c.nombre_completo}`)
      })
      
      return response.data
    } catch (error: any) {
      console.error('[childService] âŒ Error obteniendo hijos:', error)
      throw new Error(error?.response?.data?.detail || 'Error al obtener hijos')
    }
  }
}

export default childService
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\services\filtroService.ts
============================================================
// src/services/filtroService.ts
// Servicio para gestiÃ³n de filtros y listado de NNA

import http from './http'
import { parseApiError, ApiError, getUserFriendlyErrorMessage } from '@/exceptions/apiError'

// =====================================================
// INTERFACES Y TIPOS
// =====================================================

/**
 * Interfaz para los datos de NNA provenientes de la API
 */
export interface NnaFromApi {
  id: number
  first_name: string
  last_name: string
  full_name: string
  rut: string
  birth_date: string
  current_grade: string
  created_at: string
  commune_name: string
  region_name: string
  address: string
  attended_where_name?: string
  usuarios_count: number
  autism_level_value: string
  autism_level_display: string
  pie_status: 'active' | 'inactive'
  pie_status_display: string
  school_journey: 'morning' | 'afternoon'
  photo_url?: string      // âœ¨ NUEVO: URL de la foto
  has_photo?: boolean     // âœ¨ NUEVO: Indicador de foto
}

/**
 * Interfaz para la respuesta paginada de la API
 */
export interface NnaListResponse {
  results: NnaFromApi[]
  pagination: {
    count: number
    total_pages: number
    current_page: number
    has_next: boolean
    has_previous: boolean
    page_size: number
  }
}

/**
 * Interfaz para los filtros disponibles
 */
export interface AvailableFilters {
  grades: string[]
  statuses: string[]
  communes: string[]
  regions: string[]
  autism_levels: string[]
  school_journeys: string[]
}

/**
 * Interfaz para los parÃ¡metros de bÃºsqueda
 */
export interface SearchParams {
  page?: number
  page_size?: number
  search?: string
  grade?: string
  status?: string
  commune?: string
  region?: string
  autism_level?: string
  school_journey?: string
}

/**
 * Interfaz para comunas por regiÃ³n
 */
export interface CommuneByRegion {
  id: number
  name: string
  region_id: number
}

// =====================================================
// FUNCIONES PRINCIPALES
// =====================================================

/**
 * Obtiene la lista de NNA con paginaciÃ³n y filtros
 * @param params - ParÃ¡metros de bÃºsqueda y paginaciÃ³n
 * @returns Lista paginada de NNA
 */
export const getNnaListApi = async (params: SearchParams = {}): Promise<NnaListResponse> => {
  try {
    console.log('ğŸ“‹ Obteniendo lista de NNA con parÃ¡metros:', params)
    
    const response = await http.get('/ingreso/listar/', {
      params: {
        page: params.page || 1,
        page_size: params.page_size || 10,
        search: params.search || '',
        grade: params.grade || '',
        status: params.status || '',
        commune: params.commune || '',
        region: params.region || '',
        autism_level: params.autism_level || '',
        school_journey: params.school_journey || ''
      }
    })
    
    console.log('âœ… Lista de NNA obtenida exitosamente:', {
      count: response.data.pagination?.count,
      total_pages: response.data.pagination?.total_pages,
      results_count: response.data.results?.length,
      con_fotos: response.data.results?.filter((n: any) => n.photo_url).length
    })
    
    return response.data
    
  } catch (error: any) {
    console.error('âŒ Error al obtener lista de NNA:', error)
    throw parseApiError(error)
  }
}

/**
 * Obtiene los filtros disponibles para el formulario
 * @returns Objeto con arrays de filtros disponibles
 */
export const getAvailableFiltersApi = async (): Promise<AvailableFilters> => {
  try {
    console.log('ğŸ¯ Obteniendo filtros disponibles')
    
    const response = await http.get('/ingreso/filtros/disponibles/')
    
    console.log('âœ… Filtros disponibles obtenidos:', response.data)
    
    // Mapear la respuesta de la API a nuestra interfaz
    return {
      grades: response.data.grades || [],
      statuses: response.data.statuses || [],
      communes: response.data.communes || [],
      regions: response.data.regions || [],
      autism_levels: response.data.autism_levels || [],
      school_journeys: response.data.school_journeys || []
    }
    
  } catch (error: any) {
    console.error('âŒ Error al obtener filtros disponibles:', error)
    throw parseApiError(error)
  }
}

/**
 * Obtiene las comunas por regiÃ³n
 * @param regionId - ID de la regiÃ³n (opcional)
 * @returns Lista de comunas
 */
export const getCommunesByRegionApi = async (regionId?: number): Promise<CommuneByRegion[]> => {
  try {
    console.log('ğŸ—ºï¸ Obteniendo comunas por regiÃ³n:', regionId || 'todas')
    
    const params = regionId ? { region_id: regionId } : {}
    const response = await http.get('/ingreso/comunas/por-region/', { params })
    
    console.log('âœ… Comunas obtenidas:', response.data.length)
    
    return response.data
    
  } catch (error: any) {
    console.error('âŒ Error al obtener comunas por regiÃ³n:', error)
    throw parseApiError(error)
  }
}

// =====================================================
// FUNCIONES DE TRANSFORMACIÃ“N
// =====================================================

/**
 * Transforma los datos de la API al formato esperado por el componente TablaFiltro
 * âœ¨ ACTUALIZADO: Ahora incluye photo_url y has_photo para mostrar fotos en tabla
 */
export const transformNnaForTable = (nnaFromApi: NnaFromApi) => {
  return {
    id: nnaFromApi.id,
    first_name: nnaFromApi.first_name,
    last_name: nnaFromApi.last_name,
    birth_date: nnaFromApi.birth_date,
    current_grade: nnaFromApi.current_grade,
    status: nnaFromApi.pie_status === 'active' ? 'active' : 'suspended',
    last_session: nnaFromApi.created_at, // Usamos created_at como Ãºltima sesiÃ³n por ahora
    
    // Campos adicionales que podrÃ­an ser Ãºtiles
    rut: nnaFromApi.rut,
    full_name: nnaFromApi.full_name,
    commune_name: nnaFromApi.commune_name,
    region_name: nnaFromApi.region_name,
    address: nnaFromApi.address,
    autism_level: nnaFromApi.autism_level_display,
    school_journey: nnaFromApi.school_journey,
    
    // âœ¨ NUEVO: Campos para mostrar foto en tabla
    photo_url: nnaFromApi.photo_url,      // URL de la foto subida por padre
    has_photo: nnaFromApi.has_photo,      // Indicador de si tiene foto
    pie_status_display: nnaFromApi.pie_status_display,  // Estado para mostrar
    attended_where_name: nnaFromApi.attended_where_name,  // InstituciÃ³n
    usuarios_count: nnaFromApi.usuarios_count,  // Contador de usuarios
    autism_level_value: nnaFromApi.autism_level_value  // Valor numÃ©rico del nivel
  }
}

/**
 * Transforma una lista de NNA de la API al formato de tabla
 * âœ¨ ACTUALIZADO: Ahora incluye photo_url para cada NNA
 */
export const transformNnaListForTable = (nnaList: NnaFromApi[]) => {
  console.log('[filtroService] ğŸ“· Transformando', nnaList.length, 'NNA para tabla...')
  
  const transformedList = nnaList.map(nna => {
    const transformed = transformNnaForTable(nna)
    
    // Log de debugging para primeros NNA
    if (nnaList.indexOf(nna) < 3) {
      console.log(`[filtroService] ğŸ“· NNA transformado - ID: ${transformed.id}, foto: ${transformed.photo_url ? 'âœ…' : 'âŒ'}`)
    }
    
    return transformed
  })
  
  console.log('[filtroService] âœ… TransformaciÃ³n completada:', {
    total: transformedList.length,
    con_foto: transformedList.filter(n => n.photo_url).length,
    sin_foto: transformedList.filter(n => !n.photo_url).length
  })
  
  return transformedList
}

// =====================================================
// HELPERS Y UTILIDADES
// =====================================================

/**
 * Calcula la edad a partir de la fecha de nacimiento
 */
export const calculateAge = (birthDate: string): number => {
  const today = new Date()
  const birth = new Date(birthDate)
  let age = today.getFullYear() - birth.getFullYear()
  const monthDiff = today.getMonth() - birth.getMonth()
  
  if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
    age--
  }
  
  return age
}

/**
 * Formatea la fecha para mostrar en la tabla
 */
export const formatLastSession = (date: string): string => {
  if (!date) return 'Nunca'
  
  const sessionDate = new Date(date)
  const today = new Date()
  const yesterday = new Date(today)
  yesterday.setDate(yesterday.getDate() - 1)
  
  if (sessionDate.toDateString() === today.toDateString()) {
    return 'Hoy'
  } else if (sessionDate.toDateString() === yesterday.toDateString()) {
    return 'Ayer'
  } else {
    return sessionDate.toLocaleDateString('es-CL', { 
      day: '2-digit', 
      month: '2-digit', 
      year: 'numeric' 
    })
  }
}

/**
 * Obtiene las iniciales para el avatar
 */
export const getInitials = (firstName: string, lastName: string) => {
  return `${firstName.charAt(0)}${lastName.charAt(0)}`.toUpperCase()
}

// =====================================================
// EXPORTS CONSOLIDADOS
// =====================================================

export default {
  // Funciones principales
  getNnaListApi,
  getAvailableFiltersApi,
  getCommunesByRegionApi,
  
  // Funciones de transformaciÃ³n
  transformNnaForTable,
  transformNnaListForTable,
  
  // Utilidades
  calculateAge,
  formatLastSession,
  getInitials,
  
  // Helpers de error (re-exportados)
  parseApiError,
  getUserFriendlyErrorMessage
}
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\services\formPersistenceService.ts
============================================================
// src/services/formPersistenceService.ts

import { FormDraft, StorageStrategy } from '@/type/formDraft'

const STORAGE_KEYS = {
  DRAFTS: 'form-drafts',
  CONFIG: 'form-drafts-config'
} as const

export class FormPersistenceService {
  private strategy: StorageStrategy
  private memoryStorage: Map<string, FormDraft> = new Map()

  constructor(strategy: StorageStrategy = 'localStorage') {
    this.strategy = strategy
    this.cleanupExpiredDrafts()
  }

  private getStorage(): Storage | null {
    if (typeof window === 'undefined') return null

    switch (this.strategy) {
      case 'localStorage':
        return window.localStorage
      case 'sessionStorage':
        return window.sessionStorage
      default:
        return null
    }
  }

  private serializeDraft(draft: FormDraft): string {
    return JSON.stringify({
      ...draft,
      metadata: {
        ...draft.metadata,
        createdAt: draft.metadata.createdAt.toISOString(),
        updatedAt: draft.metadata.updatedAt.toISOString(),
        expiresAt: draft.metadata.expiresAt?.toISOString()
      }
    })
  }

  private deserializeDraft(raw: string): FormDraft {
    const parsed = JSON.parse(raw)
    return {
      ...parsed,
      metadata: {
        ...parsed.metadata,
        createdAt: new Date(parsed.metadata.createdAt),
        updatedAt: new Date(parsed.metadata.updatedAt),
        expiresAt: parsed.metadata.expiresAt ? new Date(parsed.metadata.expiresAt) : undefined
      }
    }
  }

  private getMemoryDrafts(): FormDraft[] {
    return Array.from(this.memoryStorage.values())
  }

  private setMemoryDrafts(drafts: FormDraft[]): void {
    this.memoryStorage.clear()
    drafts.forEach(draft => {
      this.memoryStorage.set(draft.metadata.id, draft)
    })
  }

  // Obtener todos los borradores
  getAllDrafts(): FormDraft[] {
    try {
      switch (this.strategy) {
        case 'memory':
          return this.getMemoryDrafts()
        
        case 'sessionStorage':
        case 'localStorage':
          const storage = this.getStorage()
          if (!storage) return []
          
          const draftsRaw = storage.getItem(STORAGE_KEYS.DRAFTS)
          if (!draftsRaw) return []
          
          const drafts: FormDraft[] = JSON.parse(draftsRaw).map((draftRaw: string) =>
            this.deserializeDraft(draftRaw)
          )
          return drafts
          
        default:
          return []
      }
    } catch (error) {
      console.error('Error al cargar borradores:', error)
      return []
    }
  }

  // Guardar un borrador
  saveDraft(draft: FormDraft): void {
    try {
      const drafts = this.getAllDrafts()
      const existingIndex = drafts.findIndex(d => d.metadata.id === draft.metadata.id)

      if (existingIndex >= 0) {
        drafts[existingIndex] = draft
      } else {
        drafts.push(draft)
      }

      switch (this.strategy) {
        case 'memory':
          this.setMemoryDrafts(drafts)
          break
        
        case 'sessionStorage':
        case 'localStorage':
          const storage = this.getStorage()
          if (!storage) return
          
          const serializedDrafts = drafts.map(d => this.serializeDraft(d))
          storage.setItem(STORAGE_KEYS.DRAFTS, JSON.stringify(serializedDrafts))
          break
      }
    } catch (error) {
      console.error('Error al guardar borrador:', error)
    }
  }

  // Obtener un borrador por ID
  getDraft(id: string): FormDraft | null {
    const drafts = this.getAllDrafts()
    return drafts.find(d => d.metadata.id === id) || null
  }

  // Obtener borradores por formId
  getDraftsByFormId(formId: string): FormDraft[] {
    const drafts = this.getAllDrafts()
    return drafts.filter(d => d.metadata.formId === formId)
  }

  // Eliminar un borrador
  deleteDraft(id: string): void {
    try {
      const drafts = this.getAllDrafts().filter(d => d.metadata.id !== id)
      
      switch (this.strategy) {
        case 'memory':
          this.setMemoryDrafts(drafts)
          break
        
        case 'sessionStorage':
        case 'localStorage':
          const storage = this.getStorage()
          if (!storage) return
          
          const serializedDrafts = drafts.map(d => this.serializeDraft(d))
          storage.setItem(STORAGE_KEYS.DRAFTS, JSON.stringify(serializedDrafts))
          break
      }
    } catch (error) {
      console.error('Error al eliminar borrador:', error)
    }
  }

  // Limpiar todos los borradores de un formulario
  clearFormDrafts(formId: string): void {
    try {
      const drafts = this.getAllDrafts().filter(d => d.metadata.formId !== formId)
      
      switch (this.strategy) {
        case 'memory':
          this.setMemoryDrafts(drafts)
          break
        
        case 'sessionStorage':
        case 'localStorage':
          const storage = this.getStorage()
          if (!storage) return
          
          const serializedDrafts = drafts.map(d => this.serializeDraft(d))
          storage.setItem(STORAGE_KEYS.DRAFTS, JSON.stringify(serializedDrafts))
          break
      }
    } catch (error) {
      console.error('Error al limpiar borradores del formulario:', error)
    }
  }

  // Limpiar todos los borradores
  clearAllDrafts(): void {
    try {
      switch (this.strategy) {
        case 'memory':
          this.memoryStorage.clear()
          break
        
        case 'sessionStorage':
        case 'localStorage':
          const storage = this.getStorage()
          if (!storage) return
          storage.removeItem(STORAGE_KEYS.DRAFTS)
          break
      }
    } catch (error) {
      console.error('Error al limpiar borradores:', error)
    }
  }

  // Generar un ID Ãºnico
  generateDraftId(): string {
    return `draft_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`
  }

  // Limpiar borradores expirados
  private cleanupExpiredDrafts(): void {
    try {
      const drafts = this.getAllDrafts()
      const now = new Date()
      const validDrafts = drafts.filter(draft => {
        if (!draft.metadata.expiresAt) return true
        return new Date(draft.metadata.expiresAt) > now
      })

      if (validDrafts.length !== drafts.length) {
        switch (this.strategy) {
          case 'memory':
            this.setMemoryDrafts(validDrafts)
            break
          
          case 'sessionStorage':
          case 'localStorage':
            const storage = this.getStorage()
            if (!storage) return
            
            const serializedDrafts = validDrafts.map(d => this.serializeDraft(d))
            storage.setItem(STORAGE_KEYS.DRAFTS, JSON.stringify(serializedDrafts))
            break
        }
        
        console.log(`ğŸ§¹ Limpiados ${drafts.length - validDrafts.length} borradores expirados`)
      }
    } catch (error) {
      console.error('Error al limpiar borradores expirados:', error)
    }
  }

  // Verificar si hay borradores para un formulario
  hasDrafts(formId: string): boolean {
    return this.getDraftsByFormId(formId).length > 0
  }

  // Obtener el borrador mÃ¡s reciente de un formulario
  getLatestDraft(formId: string): FormDraft | null {
    const drafts = this.getDraftsByFormId(formId)
    if (drafts.length === 0) return null
    
    return drafts.reduce((latest, current) => 
      current.metadata.updatedAt > latest.metadata.updatedAt ? current : latest
    )
  }
}

// Instancia por defecto
export const formPersistenceService = new FormPersistenceService('localStorage')
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\services\hitosService.ts
============================================================
// src/services/hitosService.ts

import http from './http'; // Adjust path to your configured HTTP client (e.g., axios instance)
import type { Milestone, MilestoneFormData } from '@/type/hitoServiceInterface'; // Import interfaces

const BASE_URL = '/seguimiento/ninos'; // Base URL part for children

/**
 * Fetches all milestones for a specific child.
 * GET /api/seguimiento/ninos/{childId}/hitos-desarrollo/
 */
async function getMilestones(childId: number | string): Promise<Milestone[]> {
  try {
    const response = await http.get<Milestone[]>(`${BASE_URL}/${childId}/hitos-desarrollo/`);
    // Sort by date descending before returning
    return response.data.sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());
  } catch (error) {
    console.error(`Error fetching milestones for child ${childId}:`, error);
    throw error; // Re-throw to be handled by the component
  }
}

/**
 * Creates a new milestone for a specific child.
 * POST /api/seguimiento/ninos/{childId}/hitos-desarrollo/
 */
async function createMilestone(childId: number | string, data: MilestoneFormData): Promise<Milestone> {
  try {
    // Note: If handling file uploads (evidence_image), you'd need FormData
    // const formData = new FormData();
    // Object.entries(data).forEach(([key, value]) => {
    //   if (value !== null && value !== undefined) {
    //     if (key === 'evidence_image' && value instanceof File) {
    //       formData.append(key, value, value.name);
    //     } else if (typeof value === 'string' || typeof value === 'number' || typeof value === 'boolean') {
    //       formData.append(key, String(value));
    //     }
    //   }
    // });
    // const response = await http.post<Milestone>(`${BASE_URL}/${childId}/hitos-desarrollo/`, formData, {
    //   headers: { 'Content-Type': 'multipart/form-data' },
    // });

    // Without file upload:
    const response = await http.post<Milestone>(`${BASE_URL}/${childId}/hitos-desarrollo/`, data);
    return response.data;
  } catch (error) {
    console.error(`Error creating milestone for child ${childId}:`, error);
    throw error;
  }
}

/**
 * Updates an existing milestone.
 * PATCH /api/seguimiento/ninos/{childId}/hitos-desarrollo/{milestoneId}/
 */
async function updateMilestone(childId: number | string, milestoneId: number | string, data: Partial<MilestoneFormData>): Promise<Milestone> {
  try {
    // Similar logic for FormData if handling file uploads needed here too
    const response = await http.patch<Milestone>(`${BASE_URL}/${childId}/hitos-desarrollo/${milestoneId}/`, data);
    return response.data;
  } catch (error) {
    console.error(`Error updating milestone ${milestoneId} for child ${childId}:`, error);
    throw error;
  }
}

/**
 * Deletes a milestone.
 * DELETE /api/seguimiento/ninos/{childId}/hitos-desarrollo/{milestoneId}/
 */
async function deleteMilestone(childId: number | string, milestoneId: number | string): Promise<void> {
  try {
    await http.delete(`${BASE_URL}/${childId}/hitos-desarrollo/${milestoneId}/`);
  } catch (error) {
    console.error(`Error deleting milestone ${milestoneId} for child ${childId}:`, error);
    throw error;
  }
}

// Optional: Get a single milestone
/**
 * Fetches details for a single milestone.
 * GET /api/seguimiento/ninos/{childId}/hitos-desarrollo/{milestoneId}/
 */
async function getMilestoneById(childId: number | string, milestoneId: number | string): Promise<Milestone> {
  try {
    const response = await http.get<Milestone>(`${BASE_URL}/${childId}/hitos-desarrollo/${milestoneId}/`);
    return response.data;
  } catch (error) {
    console.error(`Error fetching milestone ${milestoneId} for child ${childId}:`, error);
    throw error;
  }
}


// Export all functions
export const hitosService = {
  getMilestones,
  createMilestone,
  updateMilestone,
  deleteMilestone,
  getMilestoneById, // optional
};
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\services\http.ts
============================================================
// src/services/http.ts
// -------------------------------------------------------------
// ConfiguraciÃ³n global de Axios para toda la aplicaciÃ³n.
// - Usa la URL base definida en .env (VITE_API_BASE_URL).
// - AÃ±ade automÃ¡ticamente el token de acceso en cada request.
// - Maneja expiraciÃ³n de tokens con refresh automÃ¡tico.
// - Si el refresh falla, limpia la sesiÃ³n y redirige al login.
// -------------------------------------------------------------

import axios from 'axios'
import { refreshTokenApi } from './authService'

// Crear instancia de Axios con configuraciÃ³n base
const http = axios.create({
  baseURL: import.meta.env.VITE_API_BASE_URL, // URL definida en .env
  timeout: 30000,
  headers: {
    'Content-Type': 'application/json',
  },
})

// -------------------------------------------------------------
// Interceptor de REQUEST
// Se ejecuta antes de cada peticiÃ³n y aÃ±ade el token de acceso
// -------------------------------------------------------------
http.interceptors.request.use(config => {
  const token = localStorage.getItem('access')
  if (token) {
    config.headers.Authorization = `Bearer ${token}`
  }
  return config
})

// -------------------------------------------------------------
// Interceptor de RESPONSE
// Maneja errores globales y lÃ³gica de refresh de token
// -------------------------------------------------------------
http.interceptors.response.use(
  response => response,
  async error => {
    const originalRequest = error.config

    // Caso: token expirado y aÃºn no se intentÃ³ refrescar
    if (error.response?.status === 401 && !originalRequest._retry) {
      originalRequest._retry = true
      try {
        // Intentar renovar el access token
        const { access } = await refreshTokenApi()
        localStorage.setItem('access', access)

        // Actualizar header y reintentar la peticiÃ³n original
        originalRequest.headers.Authorization = `Bearer ${access}`
        return http(originalRequest)
      } catch (refreshError) {
        // Si falla el refresh, limpiar sesiÃ³n y redirigir al login
        localStorage.removeItem('access')
        localStorage.removeItem('refresh')
        localStorage.removeItem('user')
        window.location.href = '/login'
      }
    }

    // Si no es un error 401 o ya fallÃ³ el refresh, rechazar
    return Promise.reject(error)
  }
)

export default http
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\services\metricasService.ts
============================================================
// src/services/metricasService.ts
import http from './http';
import { MetricasData } from '@/type/metricas';

/**
 * Servicio dedicado para operaciones relacionadas con mÃ©tricas
 * 
 * Responsabilidades:
 * - ComunicaciÃ³n con endpoints de mÃ©tricas
 * - TransformaciÃ³n de datos del backend al frontend
 * - CentralizaciÃ³n de llamadas API para mÃ©tricas
 */

export const metricasService = {
  /**
   * Obtiene las mÃ©tricas del dashboard desde el backend
   * 
   * Flujo: http.ts â†’ API (/ingreso/metricas/) â†’ Transforma respuesta
   */
  async getMetricasDashboard(): Promise<MetricasData> {
    try {
      console.log('ğŸ“Š Solicitando mÃ©tricas del dashboard...');
      
      // NOTA: http.ts ya incluye la base URL, solo necesitamos el endpoint relativo
      const response = await http.get('/ingreso/metricas/');
      
      console.log('âœ… MÃ©tricas recibidas:', response.data);
      return response.data;
    } catch (error) {
      console.error('âŒ Error en metricasService:', error);
      throw error; // El error serÃ¡ manejado por el composable
    }
  },

  /**
   * Obtiene mÃ©tricas con filtros especÃ­ficos (para futura implementaciÃ³n)
   */
  async getMetricasConFiltros(filtros: any): Promise<MetricasData> {
    // ImplementaciÃ³n futura para mÃ©tricas filtradas
    const response = await http.get('/ingreso/metricas/', { params: filtros });
    return response.data;
  }
};

export default metricasService;
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\services\nneService.ts
============================================================
/// src/services/nneService.ts - VERSIÃ“N COMPLETAMENTE CORREGIDA
import http from './http'
import type { ParentUser, ParentUserCreate, NneFormData } from '@/type/nne'
import { parseApiError, ApiError, ApiErrorType, getUserFriendlyErrorMessage } from '@/exceptions/apiError'

// =====================================================
// INTERFACES PARA ESTABLECIMIENTOS
// =====================================================

interface Establishment {
  id: number
  name: string
  rbd: string | null
  address: string
  commune: number
  region: number
  establishment_type: number
  establishment_type_detail?: {
    id: number
    name: string
    description: string
  }
  commune_detail?: {
    id: number
    name: string
  }
  region_detail?: {
    id: number
    name: string
  }
}

// =====================================================
// INTERFAZ PARA DATOS REALES DEL BACKEND
// =====================================================

interface BackendNneData {
  first_name: string
  last_name: string
  rut: string
  birth_date: string
  gender: string
  establishment: number
  region: number
  commune: number
  street: string
  street_number: string
  current_grade: string
  school_journey: string
  adaptation_notes: string
  has_special_needs: boolean
  special_needs_type: string
  autism_level: string
  pie_diagnosis: string
  pie_entry_date: string | null
  pie_status: string
  allergies: string
  current_medication: string
  emergency_contact: string
  emergency_phone: string
  medical_notes: string
  guardian_consent: boolean
  consent_date: string
  has_previous_therapies: boolean
  therapies_detail: string
  referred_by: string
  referred_by_detail: string
  attended_where: number
  usuarios: number[]
}

// =====================================================
// FUNCIÃ“N DE TRANSFORMACIÃ“N CRÃTICA - COMPLETAMENTE CORREGIDA
// =====================================================

const transformToBackendFormat = (frontendData: NneFormData): BackendNneData => {
  console.log('ğŸ”„ Transformando datos frontend -> backend:', frontendData)
  
  // âœ… CONVERSIONES CRÃTICAS:
  // - Strings 'true'/'false' â†’ booleanos true/false
  // - Asegurar nÃºmeros para IDs
  // - Campos opcionales con valores por defecto
  
  return {
    first_name: frontendData.first_name,
    last_name: frontendData.last_name,
    rut: frontendData.rut,
    birth_date: frontendData.birth_date,
    gender: frontendData.gender,
    establishment: Number(frontendData.establishment) || 0,
    region: Number(frontendData.region) || 0, // âœ… CORRECCIÃ“N 1: 'region' ya existe en NneFormData
    commune: Number(frontendData.commune) || 0,
    street: frontendData.street,
    street_number: frontendData.street_number,
    current_grade: frontendData.current_grade,
    school_journey: frontendData.school_journey,
    adaptation_notes: frontendData.school_adaptation_notes || '', // âœ… CORRECCIÃ“N 2: 'school_adaptation_notes'
    has_special_needs: frontendData.special_needs, // âœ… CORRECCIÃ“N 3: 'special_needs'
    special_needs_type: frontendData.special_needs_type || 'none',
    autism_level: frontendData.autism_level_value || 'none', // âœ… CORRECCIÃ“N 4: 'autism_level_value'
    pie_diagnosis: frontendData.pie_diagnosis || '',
    pie_entry_date: frontendData.pie_entry_date || null,
    pie_status: frontendData.pie_status || 'none',
    allergies: frontendData.allergies || 'Ninguna',
    current_medication: frontendData.current_medication || 'Ninguna',
    emergency_contact: frontendData.emergency_contact || '',
    emergency_phone: frontendData.emergency_phone || '',
    medical_notes: frontendData.medical_notes || '',
    
    // âœ… CORRECCIONES CRÃTICAS PARA PASO 7 - CONSENTIMIENTO:
    guardian_consent: frontendData.guardian_consent, // âœ… CORRECCIÃ“N 5: Eliminado === 'true'
    consent_date: frontendData.consent_date || new Date().toISOString().split('T')[0],
    
    // âœ… CORRECCIONES CRÃTICAS PARA PASO 6 - TERAPIAS:
    has_previous_therapies: frontendData.previous_therapies, // âœ… CORRECCIÃ“N 5/6: Eliminado === 'true' y nombre corregido
    therapies_detail: frontendData.previous_therapies_detail || '', // âœ… CORRECCIÃ“N 8: 'previous_therapies_detail'
    referred_by: frontendData.referred_by || '',
    referred_by_detail: frontendData.referred_by_detail || '',
    attended_where: Number(frontendData.attended_where) || 0,
    
    usuarios: frontendData.usuarios || []
  }
}

// =====================================================
// FUNCIONES SIMPLIFICADAS PARA ESTABLECIMIENTOS EDUCATIVOS
// =====================================================

/**
 * ğŸ” BÃºsqueda simplificada de establecimientos educativos por nombre o RBD
 * Solo retorna establecimientos con RBD (escuelas, liceos, colegios)
 */
export const searchEducationalEstablishmentsApi = async (query: string): Promise<Array<{value: number; label: string}>> => {
  try {
    console.log(`ğŸ” Buscando establecimientos educativos: "${query}"`)
    
    if (!query || query.length < 2) {
      console.log('âš¡ Query muy corta, retornando array vacÃ­o')
      return []
    }
    
    const response = await http.get('/establishments/establishments/search/', {
      params: { 
        name: query,
        rbd: query // Buscar tanto por nombre como por RBD
      }
    })
    
    console.log('âœ… Respuesta bÃºsqueda establecimientos:', response.data)
    
    let establishmentsData = response.data
    if (!Array.isArray(establishmentsData)) {
      console.warn('âš ï¸ Respuesta no es un array:', establishmentsData)
      return []
    }
    
    // ğŸ”¥ FILTRO CRÃTICO: Solo establecimientos con RBD (educativos)
    const educationalEstablishments = establishmentsData.filter((est: Establishment) => 
      est.rbd && est.rbd.trim() !== '' // Solo establecimientos con RBD
    )
    
    const mappedEstablishments = educationalEstablishments.map((est: Establishment) => ({
      value: est.id,
      label: `${est.name} ${est.rbd ? `(RBD: ${est.rbd})` : ''} - ${est.commune_detail?.name || 'Sin comuna'}`
    }))
    
    console.log(`âœ… ${mappedEstablishments.length} establecimientos educativos encontrados para "${query}"`)
    return mappedEstablishments
    
  } catch (error: any) {
    console.error('âŒ Error en bÃºsqueda de establecimientos:', error)
    throw parseApiError(error)
  }
}

/**
 * ğŸ” Obtener todos los establecimientos educativos (para selects grandes)
 */
export const getAllEducationalEstablishmentsApi = async (): Promise<Array<{value: number; label: string}>> => {
  try {
    console.log('ğŸ« Cargando todos los establecimientos educativos...')
    
    const response = await http.get('/establishments/establishments/')
    
    let establishmentsData = response.data
    if (!Array.isArray(establishmentsData)) {
      return []
    }
    
    // Filtrar solo establecimientos con RBD
    const educationalEstablishments = establishmentsData.filter((est: Establishment) => 
      est.rbd && est.rbd.trim() !== ''
    )
    
    const mappedEstablishments = educationalEstablishments.map((est: Establishment) => ({
      value: est.id,
      label: `${est.name} ${est.rbd ? `(RBD: ${est.rbd})` : ''} - ${est.commune_detail?.name || 'Sin comuna'}`
    }))
    
    console.log(`âœ… ${mappedEstablishments.length} establecimientos educativos cargados`)
    return mappedEstablishments
    
  } catch (error: any) {
    console.error('âŒ Error al cargar establecimientos:', error)
    throw parseApiError(error)
  }
}

/**
 * ğŸ“‹ Obtener detalle completo de un establecimiento
 */
export const getEstablishmentDetailApi = async (establishmentId: number): Promise<Establishment> => {
  try {
    const response = await http.get(`/establishments/establishments/${establishmentId}/`)
    return response.data
  } catch (error: any) {
    console.error(`âŒ Error al obtener detalle establecimiento ${establishmentId}:`, error)
    throw parseApiError(error)
  }
}

// =====================================================
// ENDPOINTS DE PADRES/TUTORES - CORREGIDOS
// =====================================================

export const searchParentsApi = async (query: string): Promise<ParentUser[]> => {
  try {
    console.log(`ğŸ” Buscando padres con query: "${query}"`)
    
    const response = await http.get('/user/padres/buscar/', {
      params: { q: query }
    })
    
    let resultsArray: any[] = []
    if (Array.isArray(response.data)) {
      resultsArray = response.data
    } else if (response.data.results && Array.isArray(response.data.results)) {
      resultsArray = response.data.results
    } else if (response.data.data && Array.isArray(response.data.data)) {
      resultsArray = response.data.data
    } else {
      console.warn('âš ï¸ Estructura de respuesta no reconocida:', response.data)
      return []
    }
    
    // âœ… CORRECCIÃ“N 7: 'mappedResults' ahora coincide con la interfaz ParentUser (que ya incluye 'role')
    const mappedResults: ParentUser[] = resultsArray.map((parent: any) => ({
      id: parent.id,
      username: parent.username || parent.email?.split('@')[0] || `user_${parent.id}`,
      email: parent.email,
      first_name: parent.first_name || parent.nombres || '',
      last_name: parent.last_name || parent.apellidos || '',
      rut: parent.rut,
      phone: parent.phone || parent.telefono || null,
      role: parent.role || (Array.isArray(parent.roles) ? parent.roles[0] : 'Padres') || 'Padres'
    }))
    
    const filteredResults = mappedResults.filter(user => 
      user.role === 'Padres' || !user.role
    )
    
    return filteredResults
  } catch (error: any) {
    console.error('âŒ Error en bÃºsqueda de padres:', error)
    throw parseApiError(error)
  }
}

export const createParentApi = async (parentData: ParentUserCreate): Promise<ParentUser> => {
  try {
    const response = await http.post('/user/padres/crear/', {
      ...parentData,
      role: 'Padres'
    })
    const responseData = response.data.data || response.data
    
    // âœ… CORRECCIÃ“N 7: El objeto de retorno ahora coincide con ParentUser (que ya incluye 'role')
    return {
      id: responseData.id,
      username: responseData.username,
      email: responseData.email,
      first_name: responseData.first_name,
      last_name: responseData.last_name,
      rut: responseData.rut,
      phone: responseData.phone || null,
      role: 'Padres'
    }
  } catch (error: any) {
    console.error('âŒ Error al crear padre:', error)
    throw parseApiError(error)
  }
}

export const getParentByIdApi = async (parentId: number): Promise<ParentUser> => {
  try {
    const response = await http.get(`/user/padres/${parentId}/`)
    return {
      id: response.data.id,
      username: response.data.username,
      email: response.data.email,
      first_name: response.data.first_name,
      last_name: response.data.last_name,
      rut: response.data.rut,
      phone: response.data.phone || null
      // 'role' es opcional en ParentUser, asÃ­ que estÃ¡ bien no devolverlo aquÃ­
    }
  } catch (error: any) {
    console.error(`âŒ Error al obtener padre ID ${parentId}:`, error)
    throw parseApiError(error)
  }
}

export const getParentsByIdsApi = async (parentIds: number[]): Promise<ParentUser[]> => {
  try {
    const promises = parentIds.map(id => getParentByIdApi(id))
    return await Promise.all(promises)
  } catch (error) {
    console.error('âŒ Error al obtener mÃºltiples padres:', error)
    return []
  }
}

// =====================================================
// ENDPOINTS DE NNE (NIÃ‘OS) - CORREGIDOS
// =====================================================

export const createNneApi = async (nneData: NneFormData): Promise<any> => {
  try {
    const backendData = transformToBackendFormat(nneData)
    console.log('ğŸš€ Enviando datos transformados al backend:', backendData)
    const response = await http.post('/ingreso/crear/', backendData)
    return response.data
  } catch (error: any) {
    console.error('âŒ Error al crear NNE:', error)
    throw parseApiError(error)
  }
}

export const createNneIngresoApi = async (nneData: NneFormData): Promise<any> => {
  return createNneApi(nneData)
}

export const getNneListApi = async (filters?: any): Promise<any[]> => {
  try {
    const response = await http.get('/nne/', { // âœ… Slash inicial agregado
      params: filters
    })
    return response.data
  } catch (error: any) {
    console.error('âŒ Error al obtener lista de NNE:', error)
    throw parseApiError(error)
  }
}

export const getNneByIdApi = async (nneId: number): Promise<any> => {
  try {
    const response = await http.get(`/nne/${nneId}/`) // âœ… Slash inicial agregado
    return response.data
  } catch (error: any) {
    console.error(`âŒ Error al obtener NNE ID ${nneId}:`, error)
    throw parseApiError(error)
  }
}

export const updateNneApi = async (nneId: number, nneData: Partial<NneFormData>): Promise<any> => {
  try {
    const response = await http.put(`/nne/${nneId}/`, nneData)
    return response.data
  } catch (error: any) {
    console.error(`âŒ Error al actualizar NNE ID ${nneId}:`, error)
    throw parseApiError(error)
  }
}

// =====================================================
// UTILIDADES Y HELPERS
// =====================================================

export const checkEmailAvailabilityApi = async (email: string): Promise<boolean> => {
  try {
    const response = await http.get('/user/check-email/', { params: { email } })
    return response.data.available
  } catch {
    return false
  }
}

// En nneService.ts - MODIFICAR la funciÃ³n existente

export const checkRutAvailabilityApi = async (rut: string): Promise<boolean> => {
  try {
    // âœ… NUEVO: Usar el endpoint de ingreso_fichas en lugar de user
    const response = await http.get('/ingreso/check-rut/', { 
      params: { rut } 
    })
    return response.data.available
  } catch (error: any) {
    console.error('âŒ Error verificando disponibilidad de RUT (ingreso_fichas):', error)
    
    // âœ… NUEVO: Manejo especÃ­fico de errores
    if (error.response?.status === 404) {
      // Endpoint no existe aÃºn, asumir disponible (modo compatibilidad)
      console.warn('âš ï¸ Endpoint /ingreso/check-rut/ no disponible, asumiendo RUT disponible')
      return true
    }
    
    return false
  }
}



// En nneService.ts - AGREGAR nueva funciÃ³n

/**
 * âœ… NUEVO: ValidaciÃ³n especÃ­fica para RUT de niÃ±os
 * Incluye validaciÃ³n de formato y disponibilidad
 */
export const validateChildRutApi = async (rut: string): Promise<{
  isValid: boolean;
  isAvailable: boolean;
  message?: string;
  rutNormalized?: string;
}> => {
  try {
    const response = await http.post('/ingreso/validate-rut/', { rut })
    return response.data
  } catch (error: any) {
    console.error('âŒ Error validando RUT de niÃ±o:', error)
    
    // Fallback: validaciÃ³n bÃ¡sica en frontend si el endpoint no existe
    if (error.response?.status === 404) {
      return {
        isValid: /^\d{7,8}-[0-9kK]$/.test(rut),
        isAvailable: true, // Asumir disponible hasta que backend confirme
        message: 'ValidaciÃ³n local (servicio no disponible)'
      }
    }
    
    throw parseApiError(error)
  }
}

export const getCommunesApi = async (): Promise<any[]> => {
  try {
    const response = await http.get('/geo/comunas/')
    return response.data
  } catch {
    return []
  }
}



// En nneService.ts - AGREGAR nueva funciÃ³n

/**
 * âœ… NUEVO: Obtener lista paginada de padres
 * @param page PÃ¡gina actual (por defecto 1)
 * @param pageSize TamaÃ±o de pÃ¡gina (por defecto 5)
 * @param search TÃ©rmino de bÃºsqueda opcional
 */
export const getParentsListApi = async (
  page: number = 1, 
  pageSize: number = 5,
  search: string = ''
): Promise<{
  results: ParentUser[];
  count: number;
  total_pages: number;
  current_page: number;
  page_size: number;
  next: boolean;
  previous: boolean;
  next_page?: number;
  previous_page?: number;
}> => {
  try {
    console.log(`ğŸ“¥ Solicitando lista de padres - PÃ¡gina ${page}, TamaÃ±o: ${pageSize}`)
    
    const response = await http.get('/user/padres/listar/', {
      params: { 
        page, 
        page_size: pageSize,
        search: search || undefined
      }
    })
    
    console.log(`âœ… Lista de padres recibida: ${response.data.count} padres totales`)
    return response.data
    
  } catch (error: any) {
    console.error('âŒ Error al obtener lista de padres:', error)
    throw parseApiError(error)
  }
}

// =====================================================
// FUNCIONES GEOGRÃFICAS COMPLETAMENTE CORREGIDAS
// =====================================================

export const getRegionsApi = async (): Promise<Array<{value: number; label: string}>> => {
  try {
    console.log('ğŸ—ºï¸ Cargando regiones desde el backend...')
    
    const response = await http.get('/geolocalization/regions/')
    
    console.log('âœ… Respuesta completa de regiones:', response.data)
    
    let regionsData = response.data
    
    if (!Array.isArray(regionsData)) {
      console.warn('âš ï¸ Respuesta de regiones no es un array:', regionsData)
      return []
    }
    
    const mappedRegions = regionsData.map((region: any) => ({
      value: region.id,
      label: region.name
    }))
    
    console.log('âœ… Regiones mapeadas:', mappedRegions.length)
    return mappedRegions
    
  } catch (error: any) {
    console.error('âŒ Error al cargar regiones:', error)
    throw parseApiError(error)
  }
}

export const getCommunesByRegionApi = async (regionId: number): Promise<Array<{value: number; label: string}>> => {
  try {
    console.log(`ğŸ˜ï¸ Cargando comunas para regiÃ³n ${regionId}...`)
    
    const response = await http.get('/geolocalization/communes/by_region/', {
      params: { region_id: regionId }
    })
    
    console.log('âœ… Respuesta completa de comunas:', response.data)
    
    let communesData = response.data
    
    if (!Array.isArray(communesData)) {
      console.warn('âš ï¸ Respuesta de comunas no es un array:', communesData)
      return []
    }
    
    const mappedCommunes = communesData.map((commune: any) => ({
      value: commune.id,
      label: commune.name
    }))
    
    console.log(`âœ… ${mappedCommunes.length} comunas cargadas para regiÃ³n ${regionId}`)
    return mappedCommunes
    
  } catch (error: any) {
    console.error(`âŒ Error al cargar comunas para regiÃ³n ${regionId}:`, error)
    throw parseApiError(error)
  }
}

// =====================================================
// HELPERS DE ERRORES
// =====================================================

// En nneService.ts - ACTUALIZAR handleRutValidationError

export const handleRutValidationError = (error: ApiError): { title: string; message: string } => {
  const rutError = error.getFieldError('rut')

  // âœ… MEJORADO: Mensajes especÃ­ficos para ingreso_fichas
  if (rutError?.message.includes('DÃ­gito verificador incorrecto')) {
    return {
      title: 'Error en dÃ­gito verificador del RUT',
      message: `El RUT ingresado tiene un error en el dÃ­gito verificador.\n\n${rutError.message}`
    }
  }

  if (rutError?.message.includes('ya estÃ¡ registrado en el sistema para otro niÃ±o')) {
    return {
      title: 'RUT ya registrado',
      message: 'El RUT ingresado ya estÃ¡ registrado para otro niÃ±o en el sistema.'
    }
  }

  if (rutError?.message.includes('El RUT es obligatorio para el registro de niÃ±os')) {
    return {
      title: 'RUT obligatorio',
      message: 'El RUT es un campo obligatorio para el registro de niÃ±os.'
    }
  }

  if (rutError?.message.includes('Formato de RUT invÃ¡lido')) {
    return {
      title: 'Formato de RUT incorrecto',
      message: 'El RUT debe tener el formato: 12345678-9 (con guiÃ³n y dÃ­gito verificador).'
    }
  }

  // âœ… NUEVO: Mensaje genÃ©rico para errores de RUT
  if (rutError) {
    return {
      title: 'Error en RUT',
      message: rutError.message || 'Por favor verifique el RUT ingresado.'
    }
  }

  return { title: 'Error en RUT', message: getUserFriendlyErrorMessage(error) }
}

export const getErrorDisplayInfo = (error: any): { title: string; message: string } => {
  if (error instanceof ApiError) {
    if (error.hasFieldError('rut')) {
      return handleRutValidationError(error)
    }

    switch (error.type) {
      case ApiErrorType.VALIDATION_ERROR:
        return { title: 'Error de validaciÃ³n', message: getUserFriendlyErrorMessage(error) }
      case ApiErrorType.CONFLICT_ERROR:
        return { title: 'Conflicto de datos', message: getUserFriendlyErrorMessage(error) }
      case ApiErrorType.NETWORK_ERROR:
        return { title: 'Error de conexiÃ³n', message: getUserFriendlyErrorMessage(error) }
      case ApiErrorType.AUTHENTICATION_ERROR:
        return { title: 'Error de autenticaciÃ³n', message: getUserFriendlyErrorMessage(error) }
      case ApiErrorType.AUTHORIZATION_ERROR:
        return { title: 'Error de autorizaciÃ³n', message: getUserFriendlyErrorMessage(error) }
      case ApiErrorType.SERVER_ERROR:
        return { title: 'Error del servidor', message: getUserFriendlyErrorMessage(error) }
      default:
        return { title: 'Error', message: getUserFriendlyErrorMessage(error) }
    }
  }

  return { title: 'Error', message: getUserFriendlyErrorMessage(error) }
}

// =====================================================
// EXPORTS CONSOLIDADOS
// =====================================================

export default {
  // ğŸ” BÃºsqueda simplificada de establecimientos educativos
  searchEducationalEstablishmentsApi,
  getAllEducationalEstablishmentsApi,
  getEstablishmentDetailApi,
  
  // ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Funciones de padres
  searchParentsApi,
  createParentApi,
  getParentByIdApi,
  getParentsByIdsApi,
  
  // ğŸ‘¶ Funciones de NNE
  createNneApi,
  createNneIngresoApi,
  getNneListApi,
  getNneByIdApi,
  updateNneApi,
  
  // ğŸ—ºï¸ Funciones geogrÃ¡ficas
  checkEmailAvailabilityApi,
  checkRutAvailabilityApi,
  getCommunesApi,
  getRegionsApi,
  getCommunesByRegionApi,
  
  // ğŸ› ï¸ Utilidades
  getErrorDisplayInfo,
  getUserFriendlyErrorMessage,
  transformToBackendFormat
}
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\services\padres\parentService.ts
============================================================
// src/services/parentService.ts

import http from '@/services/http' // âœ… Tu instancia de Axios
import type { LatestSessionUpdate } from '@/type/parent' // âœ… El tipo que acabamos de crear

/**
 * Llama al nuevo endpoint del backend para obtener la Ãºltima
 * actualizaciÃ³n de sesiÃ³n para el padre logueado.
 *
 * Endpoint: GET /seguimiento/parent/latest-update/
 * (Tu 'http.ts' ya aÃ±ade el prefijo '/api')
 */
export const fetchLatestSessionUpdate = async (): Promise<LatestSessionUpdate> => {
  try {
    console.log('[parentService] ğŸ” Obteniendo Ãºltima actualizaciÃ³n de sesiÃ³n...')
    
    // Tu http.ts se encarga del 'baseURL' y del token
    const { data } = await http.get<LatestSessionUpdate>('/seguimiento/parent/latest-update/')
    
    console.log('[parentService] âœ… ActualizaciÃ³n obtenida.')
    return data
  
  } catch (error: any) {
    // El composable/componente que llame a esto manejarÃ¡ el error
    console.error("Error al cargar la Ãºltima actualizaciÃ³n:", error)
    throw error
  }
}

// AquÃ­ puedes agregar mÃ¡s funciones de servicio para padres en el futuro
// export const fetchMisFacturas = async (): ...
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\services\photoService.ts
============================================================
// src/services/photoService.ts

import http from '@/services/http'
import type { AxiosProgressEvent } from 'axios'

/**
 * INTERFACES DE RESPUESTAS
 */
export interface PhotoUploadResponse {
  id: string
  image_type: string
  title: string
  alt_text: string
  url_thumbnail: string
  url_medium: string
  url_large: string
  url_original: string
  width: number
  height: number
  file_size: number
  uploaded_at: string
  is_optimized: boolean
}

export interface ChildPhotoResponse {
  has_photo: boolean
  photo: PhotoUploadResponse | null
}

/**
 * SERVICIO DE GESTIÃ“N DE FOTOS
 * Maneja la subida, obtenciÃ³n y eliminaciÃ³n de fotos de perfil de niÃ±os
 */
export const photoService = {
  /**
   * Subir foto de perfil de un hijo
   * POST /api/core/parent/children/{childId}/photo/
   * 
   * @param childId - ID del niÃ±o
   * @param imageFile - Archivo de imagen a subir
   * @param onProgress - Callback opcional para trackear progreso (0-100)
   * @returns Promise con datos de la foto subida
   */
  async uploadChildPhoto(
    childId: number,
    imageFile: File,
    onProgress?: (progress: number) => void
  ): Promise<PhotoUploadResponse> {
    try {
      // Crear FormData para envÃ­o multipart
      const formData = new FormData()
      formData.append('image', imageFile)
      formData.append('image_type', 'profile')
      formData.append('title', `Foto de perfil`)
      formData.append('alt_text', `Foto de perfil`)

      console.log('[photoService] ğŸ“¤ Subiendo foto:', {
        childId,
        fileName: imageFile.name,
        fileSize: `${(imageFile.size / 1024 / 1024).toFixed(2)} MB`,
        fileType: imageFile.type
      })

      // ğŸ”¥ CON /core/ en la ruta
      const response = await http.post<PhotoUploadResponse>(
        `/core/parent/children/${childId}/photo/`,
        formData,
        {
          headers: {
            'Content-Type': 'multipart/form-data'
          },
          timeout: 30000, // 30 segundos para uploads de imÃ¡genes
          onUploadProgress: (progressEvent: AxiosProgressEvent) => {
            if (progressEvent.total && onProgress) {
              const progress = Math.round(
                (progressEvent.loaded * 100) / progressEvent.total
              )
              console.log(`[photoService] ğŸ“Š Progreso: ${progress}%`)
              onProgress(progress)
            }
          }
        }
      )

      console.log('[photoService] âœ… Foto subida exitosamente:', {
        id: response.data.id,
        urls: {
          thumbnail: response.data.url_thumbnail,
          medium: response.data.url_medium
        }
      })

      return response.data

    } catch (error: any) {
      console.error('[photoService] âŒ Error subiendo foto:', error)

      // Extraer mensaje de error mÃ¡s especÃ­fico
      const message = 
        error?.response?.data?.detail ||
        error?.response?.data?.image?.[0] ||
        error?.response?.data?.error ||
        error?.message ||
        'Error al subir la foto'

      throw new Error(message)
    }
  },

  /**
   * Obtener foto actual del hijo
   * GET /api/core/parent/children/{childId}/photo/
   * 
   * @param childId - ID del niÃ±o
   * @returns Promise con datos de la foto (o null si no tiene)
   */
  async getChildPhoto(childId: number): Promise<ChildPhotoResponse> {
    try {
      console.log('[photoService] ğŸ” Obteniendo foto del hijo:', childId)

      // ğŸ”¥ CON /core/ en la ruta
      const response = await http.get<ChildPhotoResponse>(
        `/core/parent/children/${childId}/photo/`
      )

      console.log('[photoService] âœ… Foto obtenida:', {
        hasPhoto: response.data.has_photo,
        photoId: response.data.photo?.id
      })

      return response.data

    } catch (error: any) {
      console.error('[photoService] âš ï¸ Error obteniendo foto:', error)

      // Si es 404, significa que el niÃ±o no tiene foto (no es error)
      if (error?.response?.status === 404) {
        console.log('[photoService] â„¹ï¸ El niÃ±o no tiene foto de perfil')
        return {
          has_photo: false,
          photo: null
        }
      }

      const message = 
        error?.response?.data?.detail ||
        error?.message ||
        'Error al obtener la foto'

      throw new Error(message)
    }
  },

  /**
   * Eliminar foto del hijo (volver a placeholder)
   * DELETE /api/core/parent/children/{childId}/photo/
   * 
   * @param childId - ID del niÃ±o
   */
  async deleteChildPhoto(childId: number): Promise<void> {
    try {
      console.log('[photoService] ğŸ—‘ï¸ Eliminando foto del hijo:', childId)

      // ğŸ”¥ CON /core/ en la ruta
      await http.delete(`/core/parent/children/${childId}/photo/`)

      console.log('[photoService] âœ… Foto eliminada exitosamente')

    } catch (error: any) {
      console.error('[photoService] âŒ Error eliminando foto:', error)

      const message = 
        error?.response?.data?.detail ||
        error?.message ||
        'Error al eliminar la foto'

      throw new Error(message)
    }
  },

  /**
   * Obtener todas las fotos de un hijo (galerÃ­a de logros, etc.)
   * GET /api/core/parent/children/{childId}/photos/
   * 
   * @param childId - ID del niÃ±o
   * @param imageType - Tipo de imagen a filtrar (opcional)
   * @returns Promise con array de fotos
   */
  async getChildPhotos(
    childId: number,
    imageType?: string
  ): Promise<PhotoUploadResponse[]> {
    try {
      console.log('[photoService] ğŸ–¼ï¸ Obteniendo fotos del hijo:', childId)

      const params = imageType ? { image_type: imageType } : {}

      // ğŸ”¥ CON /core/ en la ruta
      const response = await http.get<PhotoUploadResponse[]>(
        `/core/parent/children/${childId}/photos/`,
        { params }
      )

      console.log('[photoService] âœ… Fotos obtenidas:', response.data.length)

      return response.data

    } catch (error: any) {
      console.error('[photoService] âŒ Error obteniendo fotos:', error)

      const message = 
        error?.response?.data?.detail ||
        error?.message ||
        'Error al obtener las fotos'

      throw new Error(message)
    }
  },

  /**
   * Validar imagen en el cliente ANTES de subir al servidor
   * Valida: formato, tamaÃ±o, dimensiones mÃ­nimas
   * 
   * @param file - Archivo de imagen a validar
   * @returns Objeto con resultado de validaciÃ³n y mensaje de error (si aplica)
   */
  async validateImage(file: File): Promise<{ valid: boolean; error?: string }> {
    console.log('[photoService] ğŸ” Validando imagen:', file.name)

    // 1. Validar tipo de archivo
    const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/webp']
    if (!allowedTypes.includes(file.type)) {
      console.warn('[photoService] âš ï¸ Formato no vÃ¡lido:', file.type)
      return {
        valid: false,
        error: 'Formato no vÃ¡lido. Usa JPG, PNG o WebP.'
      }
    }

    // 2. Validar tamaÃ±o del archivo (mÃ¡x 10MB)
    const maxSizeMB = 10
    const sizeMB = file.size / (1024 * 1024)
    if (sizeMB > maxSizeMB) {
      console.warn('[photoService] âš ï¸ Archivo muy grande:', sizeMB.toFixed(2), 'MB')
      return {
        valid: false,
        error: `Archivo muy grande (${sizeMB.toFixed(1)}MB). MÃ¡ximo ${maxSizeMB}MB.`
      }
    }

    // 3. Validar dimensiones mÃ­nimas (200x200px)
    try {
      const dimensions = await this.getImageDimensions(file)
      
      console.log('[photoService] ğŸ“ Dimensiones:', dimensions)

      if (dimensions.width < 200 || dimensions.height < 200) {
        console.warn('[photoService] âš ï¸ Imagen muy pequeÃ±a:', dimensions)
        return {
          valid: false,
          error: `Imagen muy pequeÃ±a (${dimensions.width}x${dimensions.height}px). MÃ­nimo 200x200px.`
        }
      }

      console.log('[photoService] âœ… ValidaciÃ³n exitosa')
      return { valid: true }

    } catch (error) {
      console.error('[photoService] âŒ Error validando imagen:', error)
      return {
        valid: false,
        error: 'No se pudo leer la imagen. Verifica que sea un archivo vÃ¡lido.'
      }
    }
  },

  /**
   * Obtener dimensiones de una imagen
   * Funciona con File y Blob
   * 
   * @param file - Archivo de imagen
   * @returns Promise con width y height en pÃ­xeles
   */
  async getImageDimensions(file: File | Blob): Promise<{ width: number; height: number }> {
    return new Promise((resolve, reject) => {
      const img = new Image()
      const objectUrl = URL.createObjectURL(file)

      // Timeout para evitar espera infinita
      const timeout = setTimeout(() => {
        URL.revokeObjectURL(objectUrl)
        reject(new Error('Timeout al cargar la imagen'))
      }, 5000) // 5 segundos

      img.onload = () => {
        clearTimeout(timeout)
        URL.revokeObjectURL(objectUrl)
        resolve({
          width: img.width,
          height: img.height
        })
      }

      img.onerror = (error) => {
        clearTimeout(timeout)
        URL.revokeObjectURL(objectUrl)
        console.error('[photoService] Error cargando imagen:', error)
        reject(new Error('No se pudo cargar la imagen. Verifica el formato.'))
      }

      // Asignar src DESPUÃ‰S de los listeners
      img.src = objectUrl
    })
  },

  /**
   * Crear URL temporal para preview de imagen
   * IMPORTANTE: Liberar despuÃ©s con revokePreviewUrl()
   * 
   * @param file - Archivo de imagen
   * @returns URL blob temporal
   */
  createPreviewUrl(file: File): string {
    const url = URL.createObjectURL(file)
    console.log('[photoService] ğŸ”— URL de preview creada:', url)
    return url
  },

  /**
   * Liberar URL temporal de preview
   * Previene memory leaks
   * 
   * @param url - URL blob a liberar
   */
  revokePreviewUrl(url: string): void {
    try {
      URL.revokeObjectURL(url)
      console.log('[photoService] ğŸ—‘ï¸ URL de preview liberada')
    } catch (error) {
      console.warn('[photoService] âš ï¸ Error liberando URL:', error)
    }
  },

  /**
   * Comprimir imagen en el cliente antes de subir (opcional)
   * Reduce el tamaÃ±o del archivo sin pÃ©rdida significativa de calidad
   * 
   * Requiere: npm install browser-image-compression
   * 
   * @param file - Archivo de imagen original
   * @param maxSizeMB - TamaÃ±o mÃ¡ximo despuÃ©s de comprimir
   * @returns Promise con archivo comprimido
   */
  async compressImage(file: File, maxSizeMB: number = 1): Promise<File> {
    try {
      // Nota: Implementar solo si instalas browser-image-compression
      // const imageCompression = await import('browser-image-compression')
      
      // const options = {
      //   maxSizeMB,
      //   maxWidthOrHeight: 1920,
      //   useWebWorker: true
      // }
      
      // return await imageCompression.default(file, options)

      console.warn('[photoService] âš ï¸ CompresiÃ³n no implementada. Instalar: npm install browser-image-compression')
      return file

    } catch (error) {
      console.error('[photoService] âŒ Error comprimiendo imagen:', error)
      throw new Error('Error al comprimir la imagen')
    }
  }
}

/**
 * EXPORT POR DEFECTO
 * Permite: import photoService from '@/services/photoService'
 */
export default photoService

============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\services\profileService.ts
============================================================
// src/services/profileService.ts
// ==================================================
// SERVICIO EXPANDIDO PARA TODOS LOS DATOS DEL PERFIL
// ==================================================
// OBJETIVO: Transformar todos los datos del API para las nuevas tarjetas
// ESTRUCTURA: API normalizada â†’ TransformaciÃ³n completa â†’ Componentes
// ==================================================

// src/services/profileService.ts
// src/services/profileService.ts
import http from './http';

export class ProfileService {
  
  async getChildProfile(id: string) {
    try {
      const response = await http.get(`/ingreso/ver/${id}/`);
      const apiData = response.data;
      
      console.log('ğŸ“¦ Datos completos del API:', apiData);
      
      return this.transformCompleteData(apiData);
      
    } catch (error) {
      console.error('âŒ Error en ProfileService:', error);
      throw error;
    }
  }
  
  private transformCompleteData(apiData: any) {
    return {
      // ğŸ¯ DATOS PARA EL HEADER
      header: {
        // âœ… --- INICIO DE LA CORRECCIÃ“N --- âœ…
        // Estos campos faltaban y son necesarios para
        // que PerfilHeader.vue pueda mostrar y actualizar la foto.
        id: apiData.id || 0,
        photo_url: apiData.photo_url || null,
        has_photo: apiData.has_photo || false,
        // âœ… --- FIN DE LA CORRECCIÃ“N --- âœ…
        
        first_name: apiData.personal_profile?.first_name || '',
        last_name: apiData.personal_profile?.last_name || '',  
        rut: apiData.personal_profile?.rut || '',
        age: apiData.personal_profile?.age || 0,
        grade: apiData.school_info?.current_grade || '',
        autism_level: apiData.special_needs_info?.autism_level_display || 'Sin revisiÃ³n'
      },

      // ğŸƒ DATOS PARA TODAS LAS TARJETAS
      cards: {
        // ğŸ“‹ InformaciÃ³n Personal
        personal: {
          full_name: apiData.personal_profile?.full_name,
          rut: apiData.personal_profile?.rut,
          birth_date: this.formatDate(apiData.personal_profile?.birth_date),
          age: apiData.personal_profile?.age,
          gender: this.formatGender(apiData.personal_profile?.gender),
          created_at: this.formatDateTime(apiData.personal_profile?.created_at)
        },

        // ğŸ§© Necesidades Especiales
        special_needs: {
          has_special_needs: apiData.special_needs_info?.has_special_needs,
          special_needs_type: apiData.special_needs_info?.special_needs_type_display,
          autism_level: apiData.special_needs_info?.autism_level_display,
          created_at: this.formatDateTime(apiData.special_needs_info?.created_at)
        },

        // ğŸ“ Registro PIE
        pie: {
          diagnosis: apiData.pie_record?.diagnosis,
          entry_date: this.formatDate(apiData.pie_record?.entry_date),
          status: apiData.pie_record?.status_display,
          created_at: this.formatDateTime(apiData.pie_record?.created_at)
        },

        // ğŸ¥ InformaciÃ³n MÃ©dica
        medical: {
          allergies: apiData.medical_profile?.allergies || 'No registra',
          current_medication: apiData.medical_profile?.current_medication || 'No registra',
          emergency_contact: apiData.medical_profile?.emergency_contact,
          emergency_phone: apiData.medical_profile?.emergency_phone,
          medical_notes: apiData.medical_profile?.medical_notes,
          has_allergies: apiData.medical_profile?.has_allergies,
          has_medication: apiData.medical_profile?.has_medication,
          created_at: this.formatDateTime(apiData.medical_profile?.created_at)
        },

        // ğŸ« InformaciÃ³n Escolar
        school: {
          current_grade: apiData.school_info?.current_grade,
          school_journey: apiData.school_info?.school_journey_display,
          adaptation_notes: apiData.school_info?.adaptation_notes,
          created_at: this.formatDateTime(apiData.school_info?.created_at)
        },

        // ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ InformaciÃ³n del Tutor
        guardian: {
          guardian_consent: apiData.guardian_info?.guardian_consent ? 'SÃ­' : 'No',
          consent_date: this.formatDate(apiData.guardian_info?.consent_date),
          usuarios_info: apiData.usuarios_info || [],
          created_at: this.formatDateTime(apiData.guardian_info?.created_at)
        },

        // ğŸ§ª Historial de Terapias
        therapy: {
          has_previous_therapies: apiData.therapy_history?.has_previous_therapies ? 'SÃ­' : 'No',
          therapies_detail: apiData.therapy_history?.therapies_detail,
          referred_by: apiData.therapy_history?.referred_by_display,
          referred_by_detail: apiData.therapy_history?.referred_by_detail,
          attended_where: apiData.therapy_history?.attended_where_name,
          created_at: this.formatDateTime(apiData.therapy_history?.created_at)
        },

        // ğŸ“ InformaciÃ³n de UbicaciÃ³n
        location: {
          establishment: apiData.establishment_detail?.name,
          street: apiData.street,
          street_number: apiData.street_number,
          full_address: apiData.full_address,
          commune: apiData.commune_detail?.name,
          region: apiData.region_detail?.name
        }
      },

      // ğŸ“ CONTACTOS DE EMERGENCIA (nuevo)
      emergencyContacts: this.extractEmergencyContacts(apiData)
    };
  }

  /**
   * ğŸ†• Extraer contactos de emergencia del perfil mÃ©dico
   */
  private extractEmergencyContacts(apiData: any): any[] {
    const contacts: any[] = [];
    
    // Contacto desde medical_profile
    if (apiData.medical_profile?.emergency_contact) {
      contacts.push({
        id: 1,
        name: apiData.medical_profile.emergency_contact,
        relationship: 'Contacto de Emergencia',
        phone: apiData.medical_profile.emergency_phone || 'No especificado'
      });
    }

    // Contactos desde usuarios_info (tutores/apoderados)
    if (apiData.usuarios_info && Array.isArray(apiData.usuarios_info)) {
      apiData.usuarios_info.forEach((usuario: any, index: number) => {
        contacts.push({
          id: index + 2,
          name: usuario.full_name,
          relationship: 'Apoderado',
          phone: usuario.phone || usuario.email || 'No especificado',
          email: usuario.email
        });
      });
    }

    console.log('ğŸ“ Contactos de emergencia extraÃ­dos:', contacts);
    return contacts;
  }

  private formatDate(dateString: string): string {
    if (!dateString) return 'No especificada';
    
    try {
      const date = new Date(dateString);
      return date.toLocaleDateString('es-CL');
    } catch {
      return dateString;
    }
  }

  private formatDateTime(dateTimeString: string): string {
    if (!dateTimeString) return 'No especificada';
    
    try {
      const date = new Date(dateTimeString);
      return date.toLocaleString('es-CL');
    } catch {
      return dateTimeString;
    }
  }

  private formatGender(gender: string): string {
    const genderMap: { [key: string]: string } = {
      'male': 'Masculino',
      'female': 'Femenino', 
      'other': 'Otro',
      'unspecified': 'No especificado'
    };
    
    return genderMap[gender] || 'No especificado';
  }
}

export const profileService = new ProfileService();
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\services\rutinas\routinesApi.ts
============================================================
// src/services/rutinas/routinesApi.ts
// -------------------------------------------------------------
// Servicio de API para el MÃ³dulo de Rutinas
//
// Este archivo centraliza todas las llamadas al backend de Django
// relacionadas con la gestiÃ³n de rutinas diarias.
//
// Dependencias:
// - /src/services/http.ts: Instancia de Axios preconfigurada
//   (maneja baseURL, autenticaciÃ³n y refresh de tokens).
// - /src/type/rutinas: Definiciones de TypeScript para
//   todas las interfaces y tipos de datos de rutinas.
//
// Arquitectura de URL:
// El baseURL de http.ts es: http://127.0.0.1:8000/api
// Las rutas en este archivo son relativas a esa base.
// -------------------------------------------------------------

import http from '@/services/http'
import type { AxiosResponse } from 'axios'
import type { WizardStrategy } from '@/type/rutinas/rutinas'

// --- ImportaciÃ³n de Tipos Centralizados ---
// Asumimos que todas las interfaces estÃ¡n definidas en este archivo
import type {
  DailyRoutineList,
  DailyRoutineDetail,
  RoutineWriteData,
  RoutineSchedule,
  RoutineStep,
  RoutineStrategy,
  WizardBasicInfo,
  WizardSchedule,
  WizardStep,
  WizardStrategies,
  LogCreateData,
  LogEntry,
  ToggleStatusResponse,
  CloneRoutineData,
  ApiFilters,
  EffectivenessReport,
  ComparisonData
} from '@/type/rutinas/rutinas'
import { RoutineCreateData } from '@/store/rutinas/routinesStore'

/**
 * Helper para construir la URL base de las rutinas anidadas de un niÃ±o.
 * El resultado es: /seguimiento/ninos/{childId}/rutinas-diarias
 */
const API_BASE_URL = (childId: number) => `/seguimiento/ninos/${childId}/rutinas-diarias`

// --- DefiniciÃ³n del Servicio de API ---

export const routinesApi = {

  // ==========================================================
  // 1. DailyRoutineViewSet (CRUD Principal de Rutinas)
  // ==========================================================

  /**
   * Obtiene la lista de todas las rutinas para un niÃ±o.
   * GET /api/seguimiento/ninos/{childId}/rutinas-diarias/
   */
  getRoutines(childId: number, params?: ApiFilters): Promise<AxiosResponse<DailyRoutineList[]>> {
    return http.get(API_BASE_URL(childId) + '/', { params })
  },

  /**
   * Obtiene el detalle completo de una rutina.
   * GET /api/seguimiento/ninos/{childId}/rutinas-diarias/{routineId}/
   */
  getRoutineDetail(childId: number, routineId: number): Promise<AxiosResponse<DailyRoutineDetail>> {
    return http.get(`${API_BASE_URL(childId)}/${routineId}/`)
  },

  /**
   * Crea una nueva rutina (Usado por el Wizard - Paso 1).
   * POST /api/seguimiento/ninos/{childId}/rutinas-diarias/
   * (Se espera que la API devuelva el objeto DailyRoutineDetail)
   */
/**
   * Crea una nueva rutina.
   * POST /api/seguimiento/ninos/{childId}/rutinas-diarias/
   * (Se espera que la API devuelva el objeto DailyRoutineDetail)
   */
  createRoutine(childId: number, data: RoutineCreateData): Promise<AxiosResponse<DailyRoutineDetail>> { // <-- Tipo CORREGIDO aquÃ­
    // AsegÃºrate de importar RoutineCreateData si no lo estaba ya
    return http.post(`${API_BASE_URL(childId)}/`, data)
  },

  /**
   * Actualiza parcialmente una rutina existente.
   * PATCH /api/seguimiento/ninos/{childId}/rutinas-diarias/{routineId}/
   */
  updateRoutine(childId: number, routineId: number, data: Partial<RoutineWriteData>): Promise<AxiosResponse<DailyRoutineDetail>> {
    return http.patch(`${API_BASE_URL(childId)}/${routineId}/`, data)
  },

  /**
   * Archiva (soft delete) una rutina.
   * DELETE /api/seguimiento/ninos/{childId}/rutinas-diarias/{routineId}/
   */
  deleteRoutine(childId: number, routineId: number): Promise<AxiosResponse<void>> {
    return http.delete(`${API_BASE_URL(childId)}/${routineId}/`)
  },

  // ==========================================================
  // 2. Acciones Personalizadas (en DailyRoutineViewSet)
  // ==========================================================

  /**
   * Pausa o reactiva una rutina.
   * POST /api/seguimiento/ninos/{childId}/rutinas-diarias/{routineId}/toggle_status/
   */
  toggleStatus(childId: number, routineId: number): Promise<AxiosResponse<ToggleStatusResponse>> {
    return http.post(`${API_BASE_URL(childId)}/${routineId}/toggle_status/`)
  },

  /**
   * Clona una rutina existente.
   * POST /api/seguimiento/ninos/{childId}/rutinas-diarias/{routineId}/clone/
   */
  cloneRoutine(childId: number, routineId: number, data: CloneRoutineData): Promise<AxiosResponse<DailyRoutineDetail>> {
    return http.post(`${API_BASE_URL(childId)}/${routineId}/clone/`, data)
  },

  // ==========================================================
  // 3. Recursos Anidados (Horarios, Pasos, Estrategias)
  // ==========================================================

  /**
   * Crea un nuevo horario (Usado por el Wizard - Paso 2).
   * POST /.../rutinas-diarias/{routineId}/horarios/
   */
  createSchedule(childId: number, routineId: number, data: WizardSchedule): Promise<AxiosResponse<RoutineSchedule>> {
    return http.post(`${API_BASE_URL(childId)}/${routineId}/horarios/`, data)
  },

  /**
   * Crea un nuevo paso (Usado por el Wizard - Paso 3).
   * POST /.../rutinas-diarias/{routineId}/pasos/
   */
  createStep(childId: number, routineId: number, data: WizardStep): Promise<AxiosResponse<RoutineStep>> {
    return http.post(`${API_BASE_URL(childId)}/${routineId}/pasos/`, data)
  },

  /**
   * Reordena la lista de pasos.
   * POST /.../rutinas-diarias/{routineId}/pasos/reorder/
   */
  reorderSteps(childId: number, routineId: number, stepIds: number[]): Promise<AxiosResponse<void>> {
    return http.post(`${API_BASE_URL(childId)}/${routineId}/pasos/reorder/`, { step_ids: stepIds })
  },
  
 /**
 * Crea la configuraciÃ³n general de estrategias (Usado por el Wizard - Paso 4).
 * POST /.../rutinas-diarias/{routineId}/estrategias/
 */
createStrategyConfig(childId: number, routineId: number, data: WizardStrategies): Promise<AxiosResponse<RoutineStrategy>> {
  return http.post(`${API_BASE_URL(childId)}/${routineId}/estrategias/`, data)
},

/**
 * Crea una estrategia individual (si el backend lo soporta).
 * POST /.../rutinas-diarias/{routineId}/estrategias-individuales/
 * NOTA: Este endpoint podrÃ­a no existir en tu backend actual
 */
/**
 * Crea una estrategia individual (si el backend lo soporta).
 * POST /.../rutinas-diarias/{routineId}/estrategias-individuales/ ??? <-- Revisa este endpoint
 * NOTA: Este endpoint podrÃ­a no existir en tu backend actual
 */
createIndividualStrategy(childId: number, routineId: number, data: WizardStrategy): Promise<AxiosResponse<any>> { // <-- Cambiado el tipo aquÃ­
  // Verifica si la URL del endpoint es correcta segÃºn tu urls.py
  return http.post(`${API_BASE_URL(childId)}/${routineId}/estrategias-individuales/`, data)
},
  
  /**
   * Actualiza las estrategias (para ediciÃ³n fuera del wizard).
   * PATCH /.../rutinas-diarias/{routineId}/estrategias/
   */
  updateStrategy(childId: number, routineId: number, data: Partial<WizardStrategies>): Promise<AxiosResponse<RoutineStrategy>> {
    // Nota: El backend usa get_or_create, un POST podrÃ­a fallar si ya existe.
    // Un PATCH (o PUT) es mÃ¡s seguro para actualizaciones.
    // Asumimos que el backend tiene un ID fijo para la estrategia (ej: /.../estrategias/1/) o maneja PUT/PATCH en la raÃ­z.
    // Esta implementaciÃ³n asume que puedes hacer PATCH a la raÃ­z.
    return http.patch(`${API_BASE_URL(childId)}/${routineId}/estrategias/`, data)
  },

  // ==========================================================
  // 4. Registros de Cumplimiento (Logs)
  // ==========================================================
  
  /**
   * Crea un nuevo registro de cumplimiento.
   * POST /.../rutinas-diarias/{routineId}/registros/
   */
  createLog(childId: number, routineId: number, data: LogCreateData): Promise<AxiosResponse<LogEntry>> {
    return http.post(`${API_BASE_URL(childId)}/${routineId}/registros/`, data)
  },

  /**
   * Obtiene la lista de registros para una rutina.
   * GET /.../rutinas-diarias/{routineId}/registros/
   */
  getLogs(childId: number, routineId: number, params?: any): Promise<AxiosResponse<LogEntry[]>> {
    return http.get(`${API_BASE_URL(childId)}/${routineId}/registros/`, { params })
  },

  // ==========================================================
  // 5. Vistas de AnalÃ­tica (Reportes)
  // ==========================================================

  /**
   * Obtiene las rutinas programadas para hoy.
   * GET /api/seguimiento/ninos/{childId}/rutinas-diarias/agenda-hoy/
   */
  getDailyAgenda(childId: number): Promise<AxiosResponse<DailyRoutineList[]>> {
    return http.get(`${API_BASE_URL(childId)}/agenda-hoy/`)
  },

  /**
   * Compara dos rutinas (para RutinasComparisonView).
   * GET /api/seguimiento/ninos/{childId}/rutinas-diarias/comparar/
   */
  getComparison(childId: number, routineAId: number, routineBId: number, periodDays: number): Promise<AxiosResponse<ComparisonData>> {
    const params = {
      routine_a: routineAId,
      routine_b: routineBId,
      period_days: periodDays
    }
    return http.get(`${API_BASE_URL(childId)}/comparar/`, { params })
  },

  /**
   * Obtiene el reporte de efectividad (para RutinasAnalyticsView).
   * GET /.../rutinas-diarias/{routineId}/effectiveness_report/
   */
  getEffectivenessReport(childId: number, routineId: number, periodDays: number = 30): Promise<AxiosResponse<EffectivenessReport>> {
    return http.get(`${API_BASE_URL(childId)}/${routineId}/effectiveness_report/`, {
      params: { period_days: periodDays }
    })
  }
}
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\services\sessionService.ts
============================================================
import http from './http'

// --- INTERFACES PARA SESIONES ---

/**
 * Define la estructura de datos necesaria para crear una nueva sesiÃ³n de terapia.
 * Se utiliza como el cuerpo (payload) de la peticiÃ³n POST.
 */
interface CreateTherapySessionPayload {
  scheduled_date: string
  duration_minutes: number
  session_type: string
  modality: string
  objectives: string
}

/**
 * Representa el objeto completo de una sesiÃ³n de terapia, tal como lo devuelve la API.
 * Proporciona un tipado estricto para una mayor seguridad y autocompletado en el cÃ³digo.
 * âœ… Se ha aÃ±adido 'child_name' como opcional para la vista de lista.
 */
export interface TherapySession {
  id: number
  child: number
  therapist: number
  session_number: number
  session_type: string
  modality: string
  scheduled_date: string
  actual_date: string | null
  duration_minutes: number
  attendance_status: string | null
  cancellation_reason: string | null
  objectives: string
  session_focus: string | null
  emotional_state_start: string | null
  emotional_state_end: string | null
  materials_used: string | null
  techniques_applied: string | null
  challenges_encountered: string | null
  strengths_observed: string | null
  observations: string | null
  crisis_interventions: string | null
  homework_assigned: string | null
  next_session_recommendations: string | null
  next_session_focus: string | null
  collaborative_team: number[]
  created_at: string
  updated_at: string
  child_name?: string // Necesario para la vista de lista general
}

/**
 * âœ… NUEVA INTERFAZ: Representa los datos detallados de una sesiÃ³n
 * segÃºn TherapySessionDetailSerializer del backend.
 * Incluye informaciÃ³n contextual del niÃ±o y apoderado.
 */
export interface TherapySessionDetail extends TherapySession {
  child_name: string
  child_rut: string
  guardian_name: string
  entry_date: string
  total_sessions: number
}

// --- INTERFACES PARA OBJETIVOS DE SESIÃ“N ---

/**
 * Define la estructura para crear un nuevo objetivo dentro de una sesiÃ³n.
 */
export interface CreateGoalPayload {
  description: string;
  priority: 'alta' | 'media' | 'baja';
}

/**
 * Representa el objeto completo de un objetivo de sesiÃ³n.
 */
export interface SessionGoal {
  id: number;
  session: number;
  description: string;
  achieved: boolean;
  achievement_notes: string;
  progress_percentage: number;
  priority: 'alta' | 'media' | 'baja';
  created_at: string;
  updated_at: string;
}


/**
 * âœ… NUEVA INTERFAZ: Representa las mÃ©tricas de terapia
 * que devuelve el endpoint /metricas/ del backend.
 */
export interface TherapyMetrics {
  sessions_count: number;
  completed_sessions: number;
  upcoming_sessions: number;
  attendance_rate: number;
  goals_count: number;
  goals_achieved: number;
  success_rate: number;
  avg_session_duration: number;
}


/**
 * âœ… NUEVA INTERFAZ: Representa la respuesta completa
 * de MeasurableDataAPIView (la vista de /metricas/)
 */
export interface MetricsApiResponse {
  child_info: any;
  development_metrics: any;
  therapy_metrics: TherapyMetrics; // <-- Esto es lo que nos importa
  timeline_data: any;
}



// --- INTERFACES PARA DIAGNÃ“STICOS ---

export interface Diagnosis {
  id: number;
  child: number;
  diagnosis_type: string; // 'primary', 'secondary', 'comorbidity' etc.
  description: string;
  diagnosis_date: string; // Formato YYYY-MM-DD
  diagnosed_by: number | null; // ID del usuario que diagnosticÃ³ (si aplica)
  severity: string | null;
  notes: string | null;
  is_active: boolean;
  created_at: string;
}

export interface CreateDiagnosisPayload {
  diagnosis_type: string;
  description: string;
  diagnosis_date: string; // Formato YYYY-MM-DD
  severity?: string;
  // âœ… AÃ‘ADIR/CORREGIR ESTOS:
  cie10_code?: string | null; // Hacerlos opcionales
  observations?: string | null; // Corregir 'notes' a 'observations'
  notes?: string;
  is_active?: boolean;
}


// --- INTERFACES PARA INTERESES --- (NUEVO BLOQUE)

/**
 * Representa el objeto completo de un interÃ©s estable, tal como lo devuelve la API.
 */
export interface Interest {
  id: number;
  child: number;
  // âœ… CORREGIDO: Usar 'category' en lugar de 'interest_type' para coincidir con el modelo
  category: string; // 'food', 'games', 'music', etc.
  description: string;
  intensity: string; // 'mild', 'moderate', 'strong', 'obsessive'
  // âœ… CORREGIDO: Usar 'therapeutic_utility' en lugar de 'notes' para coincidir con el modelo
  therapeutic_utility: string | null;
  created_at: string;
}

/**
 * Define la estructura de datos necesaria para crear un nuevo interÃ©s estable.
 */
export interface CreateInterestPayload {
  description: string;
  category: string;
  intensity: string;
  therapeutic_utility?: string | null; // Opcional y permite null
}




// ===============================================
// FUNCIONES PARA GESTIONAR SESIONES (TherapySession)
// ===============================================

/**
 * âœ… NUEVA FUNCIÃ“N: Obtiene una lista de TODAS las sesiones a las que el terapeuta tiene acceso.
 * Ideal para la vista principal de "GestiÃ³n de Sesiones".
 * @returns Un array con todas las sesiones.
 */
export async function getAllTherapySessions(): Promise<TherapySession[]> {
  const endpoint = `/seguimiento/sesiones-terapia/all/`;
  const { data } = await http.get(endpoint);
  return data;
}

/**
 * Crea una nueva sesiÃ³n de terapia para un niÃ±o especÃ­fico.
 * Llama al endpoint: POST /seguimiento/ninos/{childId}/sesiones-terapia/
 */
export async function createTherapySession(
  childId: number,
  sessionData: CreateTherapySessionPayload
): Promise<TherapySession> {
  const endpoint = `/seguimiento/ninos/${childId}/sesiones-terapia/`
  const { data } = await http.post(endpoint, sessionData)
  return data
}

/**
 * Obtiene la lista de todas las sesiones de terapia para un niÃ±o especÃ­fico.
 * Llama al endpoint: GET /seguimiento/ninos/{childId}/sesiones-terapia/
 */
export async function getTherapySessionsForChild(childId: number): Promise<TherapySession[]> {
  const endpoint = `/seguimiento/ninos/${childId}/sesiones-terapia/`
  const { data } = await http.get(endpoint)
  return data
}

/**
 * âœ… ACTUALIZADA: Obtiene los detalles completos de una sesiÃ³n de terapia especÃ­fica.
 * Ahora usa TherapySessionDetail que incluye datos contextuales del niÃ±o.
 * Llama al endpoint: GET /seguimiento/ninos/{childId}/sesiones-terapia/{sessionId}/
 */
export async function getTherapySessionById(childId: number, sessionId: number): Promise<TherapySessionDetail> {
  const endpoint = `/seguimiento/ninos/${childId}/sesiones-terapia/${sessionId}/`
  const { data } = await http.get(endpoint)
  return data
}

/**
 * Actualiza una sesiÃ³n de terapia existente (para guardar la documentaciÃ³n).
 * Llama al endpoint: PATCH /seguimiento/ninos/{childId}/sesiones-terapia/{sessionId}/
 */
export async function updateTherapySession(
  childId: number,
  sessionId: number,
  updatedData: Partial<TherapySession>
): Promise<TherapySession> {
  const endpoint = `/seguimiento/ninos/${childId}/sesiones-terapia/${sessionId}/`
  const { data } = await http.patch(endpoint, updatedData)
  return data
}

// ===============================================
// FUNCIONES PARA GESTIONAR OBJETIVOS (SessionGoal)
// ===============================================

/**
 * Obtiene todos los objetivos de una sesiÃ³n especÃ­fica.
 */
export async function getGoalsForSession(childId: number, sessionId: number): Promise<SessionGoal[]> {
  const endpoint = `/seguimiento/ninos/${childId}/sesiones-terapia/${sessionId}/objetivos/`;
  const { data } = await http.get(endpoint);
  return data;
}

/**
 * Crea un nuevo objetivo para una sesiÃ³n especÃ­fica.
 */
export async function createGoalForSession(childId: number, sessionId: number, goalData: CreateGoalPayload): Promise<SessionGoal> {
  const endpoint = `/seguimiento/ninos/${childId}/sesiones-terapia/${sessionId}/objetivos/`;
  const { data } = await http.post(endpoint, goalData);
  return data;
}

/**
 * Actualiza un objetivo especÃ­fico.
 */
export async function updateGoal(childId: number, sessionId: number, goalId: number, updatedData: Partial<SessionGoal>): Promise<SessionGoal> {
  const endpoint = `/seguimiento/ninos/${childId}/sesiones-terapia/${sessionId}/objetivos/${goalId}/`;
  const { data } = await http.patch(endpoint, updatedData);
  return data;
}

/**
 * Elimina un objetivo especÃ­fico.
 */
export async function deleteGoal(childId: number, sessionId: number, goalId: number): Promise<void> {
  const endpoint = `/seguimiento/ninos/${childId}/sesiones-terapia/${sessionId}/objetivos/${goalId}/`;
  await http.delete(endpoint);
}

// ===============================================
// âœ… NUEVA FUNCIÃ“N PARA OBTENER MÃ‰TRICAS
// ===============================================

/**
 * Obtiene las mÃ©tricas de terapia (stats) para un niÃ±o especÃ­fico.
 * Llama al endpoint: GET /seguimiento/ninos/{childId}/metricas/
 */
export async function getTherapyMetricsForChild(childId: number): Promise<TherapyMetrics> {
  const endpoint = `/seguimiento/ninos/${childId}/metricas/`;
  
  // Hacemos la llamada al endpoint de mÃ©tricas
  const { data } = await http.get<MetricsApiResponse>(endpoint);
  
  // Devolvemos solo el objeto 'therapy_metrics' que contiene los contadores
  return data.therapy_metrics;
}



// ===============================================
// FUNCIONES PARA GESTIONAR DIAGNÃ“STICOS (Diagnosis)
// ===============================================

/**
 * Obtiene la lista de diagnÃ³sticos para un niÃ±o especÃ­fico.
 * Llama a: GET /seguimiento/ninos/{childId}/diagnosticos/
 */
export async function getDiagnosesForChild(childId: number): Promise<Diagnosis[]> {
  const endpoint = `/seguimiento/ninos/${childId}/diagnosticos/`;
  const { data } = await http.get(endpoint);
  return data;
}

/**
 * Crea un nuevo diagnÃ³stico para un niÃ±o especÃ­fico.
 * Llama a: POST /seguimiento/ninos/{childId}/diagnosticos/
 */
export async function createDiagnosisForChild(childId: number, diagnosisData: CreateDiagnosisPayload): Promise<Diagnosis> {
  const endpoint = `/seguimiento/ninos/${childId}/diagnosticos/`;
  const { data } = await http.post(endpoint, diagnosisData);
  return data;
}

// Puedes aÃ±adir aquÃ­ funciones para updateDiagnosis y deleteDiagnosis si las necesitas



// Puedes aÃ±adir aquÃ­ funciones para updateDiagnosis y deleteDiagnosis si las necesitas


// ===============================================
// FUNCIONES PARA GESTIONAR INTERESES (Interest) (NUEVO BLOQUE)
// ===============================================

/**
 * Obtiene la lista de intereses estables de un niÃ±o.
 * Llama a: GET /seguimiento/ninos/{childId}/intereses/
 */
export async function getInterestsForChild(childId: number): Promise<Interest[]> {
  const endpoint = `/seguimiento/ninos/${childId}/intereses/`;
  const { data } = await http.get(endpoint);
  return data;
}

/**
 * Crea un nuevo interÃ©s estable para un niÃ±o.
 * Llama a: POST /seguimiento/ninos/{childId}/intereses/
 */
export async function createInterestForChild(childId: number, interestData: CreateInterestPayload): Promise<Interest> {
  const endpoint = `/seguimiento/ninos/${childId}/intereses/`;
  const { data } = await http.post(endpoint, interestData);
  return data;
}

// Puedes aÃ±adir aquÃ­ funciones para updateInterest y deleteInterest si las necesitas
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\store\alertModalStore.ts
============================================================
// src/store/alertModalStore.ts
import { defineStore } from 'pinia'
import { ref } from 'vue'

export type AlertModalType = 'success' | 'error' | 'info' | 'warning'
export type AlertModalAction = {
  label: string
  handler: () => void
  variant?: 'primary' | 'secondary' | 'danger'
}

interface AlertModalState {
  isOpen: boolean
  type: AlertModalType
  title: string
  message: string
  actions: AlertModalAction[]
  showCloseButton: boolean
}

export const useAlertModalStore = defineStore('alertModal', () => {
  // Estado reactivo
  const state = ref<AlertModalState>({
    isOpen: false,
    type: 'info',
    title: '',
    message: '',
    actions: [],
    showCloseButton: true
  })

  // MÃ©todos para mostrar diferentes tipos de alertas
  const show = (type: AlertModalType, title: string, message: string, actions: AlertModalAction[] = []) => {
    state.value = {
      isOpen: true,
      type,
      title,
      message,
      actions: actions.length > 0 ? actions : [{ label: 'Aceptar', handler: close, variant: 'primary' }],
      showCloseButton: actions.length === 0
    }
  }

  const success = (title: string, message: string, actions?: AlertModalAction[]) => {
    show('success', title, message, actions)
  }

  const error = (title: string, message: string, actions?: AlertModalAction[]) => {
    show('error', title, message, actions)
  }

  const warning = (title: string, message: string, actions?: AlertModalAction[]) => {
    show('warning', title, message, actions)
  }

  const info = (title: string, message: string, actions?: AlertModalAction[]) => {
    show('info', title, message, actions)
  }

  const close = () => {
    state.value.isOpen = false
    // Reset despuÃ©s de un pequeÃ±o delay para permitir la animaciÃ³n
    setTimeout(() => {
      state.value = {
        isOpen: false,
        type: 'info',
        title: '',
        message: '',
        actions: [],
        showCloseButton: true
      }
    }, 300)
  }

  // MÃ©todo para confirmaciones (sÃ­/no)
  const confirm = (title: string, message: string, onConfirm: () => void, onCancel?: () => void) => {
    show('warning', title, message, [
      {
        label: 'Cancelar',
        handler: () => {
          onCancel?.()
          close()
        },
        variant: 'secondary'
      },
      {
        label: 'Confirmar',
        handler: () => {
          onConfirm()
          close()
        },
        variant: 'primary'
      }
    ])
  }

  return {
    state: state as unknown as AlertModalState,
    show,
    success,
    error,
    warning,
    info,
    confirm,
    close
  }
})
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\store\alertStore.ts
============================================================
/* src\store\alertStore.ts */

import { defineStore } from 'pinia'

export type AlertType = 'success' | 'error' | 'info' | 'warning'

interface AlertState {
  show: boolean
  type: AlertType
  title: string
  message: string
}

export const useAlertStore = defineStore('alert', {
  state: (): AlertState => ({
    show: false,
    type: 'info',
    title: '',
    message: ''
  }),
  actions: {
    trigger(type: AlertType, title: string, message: string) {
      this.type = type
      this.title = title
      this.message = message
      this.show = true
    },
    close() {
      this.show = false
      // Resetear valores despuÃ©s de cerrar
      setTimeout(() => {
        this.type = 'info'
        this.title = ''
        this.message = ''
      }, 300) // Esperar a que termine la animaciÃ³n de salida
    },
    success(title: string, message: string) {
      this.trigger('success', title, message)
    },
    error(title: string, message: string) {
      this.trigger('error', title, message)
    },
    warning(title: string, message: string) {
      this.trigger('warning', title, message)
    },
    info(title: string, message: string) {
      this.trigger('info', title, message)
    }
  }
})
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\store\childStore.ts
============================================================

============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\store\formDraftStore.ts
============================================================
// src/store/formDraftStore.ts

import { defineStore } from 'pinia'
import { ref, computed } from 'vue'
import { FormDraft, FormDraftMetadata, DraftRecoveryOptions } from '@/types/formDraft'
import { formPersistenceService } from '@/services/formPersistenceService'

export const useFormDraftStore = defineStore('formDraft', () => {
  // Estado
  const drafts = ref<FormDraft[]>([])
  const currentDraft = ref<FormDraft | null>(null)
  const autoSaveEnabled = ref(true)
  const lastSavedAt = ref<Date | null>(null)
  
  // âœ… CORREGIDO: recoveryOptions como reactive object normal
  const recoveryOptions = ref<DraftRecoveryOptions>({
    allowRecovery: true,
    showRecoveryModal: true,
    autoRecover: false
  })

  // Getters
  const draftsCount = computed(() => drafts.value.length)
  const hasCurrentDraft = computed(() => currentDraft.value !== null)
  const lastSavedText = computed(() => {
    if (!lastSavedAt.value) return 'Nunca'
    
    const now = new Date()
    const diffMs = now.getTime() - lastSavedAt.value.getTime()
    const diffMins = Math.floor(diffMs / 60000)
    
    if (diffMins < 1) return 'Hace unos segundos'
    if (diffMins < 60) return `Hace ${diffMins} minuto${diffMins > 1 ? 's' : ''}`
    
    const diffHours = Math.floor(diffMins / 60)
    if (diffHours < 24) return `Hace ${diffHours} hora${diffHours > 1 ? 's' : ''}`
    
    const diffDays = Math.floor(diffHours / 24)
    return `Hace ${diffDays} dÃ­a${diffDays > 1 ? 's' : ''}`
  })

  // Acciones
  const loadDrafts = () => {
    drafts.value = formPersistenceService.getAllDrafts()
  }

  const createDraft = (formId: string, data: any, step: number, title: string, expiresInDays: number = 7) => {
    const id = formPersistenceService.generateDraftId()
    const now = new Date()
    const expiresAt = new Date()
    expiresAt.setDate(expiresAt.getDate() + expiresInDays)

    const metadata: FormDraftMetadata = {
      id,
      formId,
      createdAt: now,
      updatedAt: now,
      step,
      title,
      expiresAt
    }

    const draft: FormDraft = { metadata, data }
    formPersistenceService.saveDraft(draft)
    drafts.value.push(draft)
    currentDraft.value = draft
    lastSavedAt.value = now
    
    return draft
  }

  const updateDraft = (id: string, data: any, step: number) => {
    const draftIndex = drafts.value.findIndex((d: FormDraft) => d.metadata.id === id)
    if (draftIndex === -1) return

    const draft = drafts.value[draftIndex]
    draft.data = data
    draft.metadata.step = step
    draft.metadata.updatedAt = new Date()

    formPersistenceService.saveDraft(draft)
    drafts.value[draftIndex] = draft
    currentDraft.value = draft
    lastSavedAt.value = new Date()
  }

  const setCurrentDraft = (draft: FormDraft | null) => {
    currentDraft.value = draft
  }

  const loadDraft = (id: string) => {
    const draft = formPersistenceService.getDraft(id)
    setCurrentDraft(draft)
    return draft
  }

  const loadLatestDraft = (formId: string) => {
    const draft = formPersistenceService.getLatestDraft(formId)
    setCurrentDraft(draft)
    return draft
  }

  const deleteDraft = (id: string) => {
    formPersistenceService.deleteDraft(id)
    drafts.value = drafts.value.filter((d: FormDraft) => d.metadata.id !== id)
    if (currentDraft.value?.metadata.id === id) {
      setCurrentDraft(null)
    }
  }

  const clearFormDrafts = (formId: string) => {
    formPersistenceService.clearFormDrafts(formId)
    drafts.value = drafts.value.filter((d: FormDraft) => d.metadata.formId !== formId)
    if (currentDraft.value?.metadata.formId === formId) {
      setCurrentDraft(null)
    }
  }

  const clearAllDrafts = () => {
    formPersistenceService.clearAllDrafts()
    drafts.value = []
    setCurrentDraft(null)
    lastSavedAt.value = null
  }

  const getDraftsByFormId = (formId: string) => {
    return drafts.value.filter((d: FormDraft) => d.metadata.formId === formId)
  }

  const hasDraftsForForm = (formId: string) => {
    return formPersistenceService.hasDrafts(formId)
  }

  // âœ… CORREGIDO: setRecoveryOptions con tipo correcto
  const setRecoveryOptions = (options: Partial<DraftRecoveryOptions>) => {
    recoveryOptions.value = { ...recoveryOptions.value, ...options }
  }

  const toggleAutoSave = (enabled: boolean) => {
    autoSaveEnabled.value = enabled
  }

  // Cargar borradores al inicializar
  loadDrafts()

  return {
    // Estado
    drafts,
    currentDraft,
    autoSaveEnabled,
    lastSavedAt,
    recoveryOptions, // âœ… Ya es un ref, no necesita .value adicional

    // Getters
    draftsCount,
    hasCurrentDraft,
    lastSavedText,

    // Acciones
    loadDrafts,
    createDraft,
    updateDraft,
    setCurrentDraft,
    loadDraft,
    loadLatestDraft,
    deleteDraft,
    clearFormDrafts,
    clearAllDrafts,
    getDraftsByFormId,
    hasDraftsForForm,
    setRecoveryOptions,
    toggleAutoSave
  }
})
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\store\ninoActivoStore.ts
============================================================
import { defineStore } from 'pinia';
// ğŸ‘‡ *** 1. IMPORTA TU SERVICIO REAL *** ğŸ‘‡
import { profileService } from '@/services/profileService'; // AsegÃºrate que la ruta sea correcta

// ğŸ‘‡ *** 2. DEFINE UNA INTERFAZ MÃS COMPLETA *** ğŸ‘‡
//    (Basada en la estructura que DEVUELVE profileService.transformCompleteData)
//    Ajusta esto segÃºn la estructura EXACTA de tu transformCompleteData
interface TransformedProfileData {
  header: {
    first_name: string;
    last_name: string;
    rut: string;
    age: number;
    grade: string;
    autism_level: string;
  };
  cards: {
    personal: {
      full_name: string;
      rut: string;
      birth_date: string; // Ya formateada por el service
      age: number;
      gender: string; // Ya formateado
      created_at: string; // Ya formateado
    };
    special_needs: any; // Define mÃ¡s si es necesario
    pie: any;
    medical: any;
    school: any;
    guardian: any;
    therapy: any;
    location: any;
  };
  emergencyContacts: any[];
}

// Interfaz principal del perfil en el store (Incluye el ID)
export interface NinoProfile extends TransformedProfileData {
  id: string; // AÃ±adimos el ID aquÃ­
}


// Define el estado inicial
interface State {
  perfil: NinoProfile | null;
  isLoading: boolean;
  error: string | null;
}

/**
 * Store de Pinia para gestionar el estado del perfil del niÃ±o
 * que estÃ¡ actualmente activo (siendo visto) en la aplicaciÃ³n.
 */
export const useNinoActivoStore = defineStore('ninoActivo', {

  // 1. ESTADO (State)
  state: (): State => ({
    perfil: null,
    isLoading: false,
    error: null,
  }),

  // 2. GETTERS (Propiedades computadas)
  getters: {
    /**
     * Devuelve el nombre completo del niÃ±o activo.
     */
    nombreNino: (state): string => {
      // Accede a la estructura transformada
      return state.perfil?.cards?.personal?.full_name || 'Cargando...';
    },

    /**
     * Devuelve el ID del niÃ±o activo.
     */
    ninoId: (state): string | null => {
      // El ID ahora estÃ¡ en el nivel superior del perfil
      return state.perfil?.id || null;
    },

    /**
     * Indica si hay un perfil cargado.
     */
    hasData: (state): boolean => {
      return !!state.perfil;
    },

    // Puedes aÃ±adir mÃ¡s getters para acceder a otros datos si los necesitas
    // Ejemplo:
    // edadNino: (state): number | string => {
    //   return state.perfil?.header?.age ?? 'N/A';
    // },
    // rutNino: (state): string => {
    //    return state.perfil?.cards?.personal?.rut ?? 'N/A';
    // }
  },

  // 3. ACCIONES (MÃ©todos)
  actions: {

    /**
     * Carga el perfil de un niÃ±o por su ID usando el profileService.
     */
    async fetchNinoActivo(childId: string) {
      // Evita recargas innecesarias
      if (this.isLoading || (this.perfil && this.perfil.id === childId)) {
        console.log(`fetchNinoActivo: Skipping fetch for ${childId} (already loading or loaded)`);
        return;
      }

      console.log(`ğŸš€ fetchNinoActivo: Iniciando carga para niÃ±o ID: ${childId}`);
      this.isLoading = true;
      this.perfil = null;
      this.error = null;

      try {
        // --- ğŸ‘‡ *** 3. USA TU SERVICIO REAL AQUÃ *** ğŸ‘‡ ---
        // Llama a getChildProfile que ya transforma los datos
        const transformedData = await profileService.getChildProfile(childId);
        console.log('âœ… Datos transformados recibidos del service:', transformedData);

        // --- âŒ ELIMINA O COMENTA EL BLOQUE MOCK ---
        /*
        const datosNinoMock: NinoProfile = await new Promise(resolve =>
          setTimeout(() => { ... }, 800)
        )
        */

        // Asigna los datos transformados al estado, aÃ±adiendo el ID explÃ­citamente
        // ya que la funciÃ³n transform no lo incluye en la raÃ­z
        this.perfil = {
          id: childId, // AÃ±ade el ID
          ...transformedData // El resto de los datos transformados
        };
        console.log('âœ… Perfil actualizado en el store:', this.perfil);

      } catch (err: any) {
        console.error(`âŒ Error en fetchNinoActivo para ID ${childId}:`, err);
        // Intenta obtener un mensaje de error mÃ¡s especÃ­fico si es posible
        this.error = err.message || 'No se pudo cargar la informaciÃ³n del niÃ±o.';
        // PodrÃ­as aÃ±adir lÃ³gica para errores especÃ­ficos (ej. 404 Not Found)
        // if (err.response?.status === 404) {
        //   this.error = `No se encontrÃ³ el perfil para el niÃ±o con ID ${childId}.`;
        // }
      } finally {
        this.isLoading = false;
        console.log(`ğŸ fetchNinoActivo: Carga finalizada para niÃ±o ID: ${childId}`);
      }
    },

    /**
     * Limpia los datos del niÃ±o activo.
     */
    limpiarNinoActivo() {
      console.log('ğŸ§¹ Limpiando datos del niÃ±o activo en el store.');
      this.perfil = null;
      this.isLoading = false;
      this.error = null;
    },
  },
})
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\store\notificationStore.ts
============================================================
// src/store/notificationStore.ts

import { defineStore } from 'pinia'
import { ref } from 'vue'

export interface Notification {
  id: number
  type: 'success' | 'error' | 'warning' | 'info'
  title?: string
  message: string
  duration?: number
  showProgress?: boolean
}

export const useNotificationStore = defineStore('notifications', () => {
  // Estado
  const notifications = ref<Notification[]>([])
  let notificationIdCounter = 0

  // AcciÃ³n: Agregar notificaciÃ³n
  function addNotification(options: Omit<Notification, 'id'>) {
    const id = Date.now() + (notificationIdCounter++)
    
    const notification: Notification = {
      id,
      type: options.type || 'info',
      title: options.title,
      message: options.message,
      duration: options.duration ?? 5000,
      showProgress: options.showProgress ?? true
    }

    notifications.value.push(notification)

    console.log('ğŸ“¢ NotificaciÃ³n aÃ±adida:', { id, type: notification.type, message: notification.message })

    // Auto-eliminar despuÃ©s de la duraciÃ³n (fallback por si el componente falla)
    const duration = notification.duration ?? 0
    if (duration > 0) {
      setTimeout(() => {
        removeNotification(id)
      }, duration + 500) // +500ms para dar tiempo a la animaciÃ³n
    }

    return id
  }

  // AcciÃ³n: Eliminar notificaciÃ³n
  function removeNotification(id: number) {
    const index = notifications.value.findIndex(n => n.id === id)
    if (index !== -1) {
      notifications.value.splice(index, 1)
      console.log('ğŸ—‘ï¸ NotificaciÃ³n eliminada:', id)
    }
  }

  // AcciÃ³n: Limpiar todas las notificaciones
  function clearAll() {
    notifications.value = []
    console.log('ğŸ§¹ Todas las notificaciones eliminadas')
  }

  // MÃ©todos de conveniencia
  function success(message: string, title?: string, duration?: number) {
    return addNotification({ type: 'success', message, title, duration })
  }

  function error(message: string, title?: string, duration?: number) {
    return addNotification({ type: 'error', message, title, duration })
  }

  function warning(message: string, title?: string, duration?: number) {
    return addNotification({ type: 'warning', message, title, duration })
  }

  function info(message: string, title?: string, duration?: number) {
    return addNotification({ type: 'info', message, title, duration })
  }

  return {
    // Estado
    notifications,
    
    // Acciones
    addNotification,
    removeNotification,
    clearAll,
    
    // MÃ©todos de conveniencia
    success,
    error,
    warning,
    info
  }
})
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\store\rutinas\routinesStore.ts
============================================================
// stores/routinesStore.ts

import { defineStore } from 'pinia'
// (Asumiendo que tu cliente de API tambiÃ©n estÃ¡ tipado)
import { routinesApi } from '@/services/rutinas/routinesApi'

// =============================================================================
// INTERFACES (Basadas en los Serializers de Django)
// =============================================================================

/**
 * Filtros de estado para el store.
 */
export type RoutineStatusFilter = 'active' | 'paused' | 'archived' | 'draft' | 'all'

/**
 * Objeto de filtros del store.
 */
export interface RoutineFilters {
  status: RoutineStatusFilter
  routineType: string | null
  search: string
}

/**
 * Objeto para la API de listado (DailyRoutineListSerializer)
 [cite_start]* [cite: 54, 55]
 */
export interface DailyRoutineList {
  id: number
  name: string
  routine_type: string
  routine_type_display: string
  status: string
  status_display: string
  is_active: boolean
  child_name: string
  total_steps: number
  completion_rate_7days: number | null
  date_started: string
  created_at: string
}

/**
 * Objeto para la API de detalle (DailyRoutineDetailSerializer)
 * Es un superconjunto de 'DailyRoutineList'.
 [cite_start]* [cite: 58, 59, 60, 61, 62]
 */
export interface DailyRoutineDetail extends DailyRoutineList {
  description: string
  // (AquÃ­ se tiparÃ­an los objetos anidados si se definieran)
  schedules: any[] // DeberÃ­a ser RoutineSchedule[]
  steps: any[] // DeberÃ­a ser RoutineStep[]
  strategies: any | null // DeberÃ­a ser RoutineStrategy | null
  motivation: any | null // DeberÃ­a ser RoutineMotivation | null
  independence_goal: any | null // DeberÃ­a ser RoutineIndependenceGoal | null
  coordination: any | null // DeberÃ­a ser RoutineCoordination | null
  challenges: any | null // DeberÃ­a ser RoutineChallenge | null
  evaluations: any[] // DeberÃ­a ser RoutineEvaluation[]
}

/**
 * Datos para crear una rutina (DailyRoutineWriteSerializer)
 [cite_start]* [cite: 63]
 */
// Reemplaza la interfaz RoutineCreateData en routinesStore.ts:

/**
 * Datos para crear una rutina (DailyRoutineWriteSerializer)
 */
export interface RoutineCreateData {
  name: string
  routine_type: string
  description?: string  // Ahora es opcional
  status: 'active' | 'draft'  // Ahora es requerido
  is_active?: boolean
  date_started?: string | null
  date_ended?: string | null
}
/**
 * Datos para actualizar una rutina (PATCH)
 */
export type RoutineUpdateData = Partial<RoutineCreateData>

/**
 * ParÃ¡metros de filtro para la API.
 */
export interface ApiFilters {
  status?: string
  routine_type?: string
  is_active?: boolean
}

/**
 * Respuesta de la API para 'toggleStatus'.
 */
export interface ToggleStatusResponse {
  status: string
  message: string
}

/**
 * Tipado del estado del store de Pinia.
 */
export interface RoutinesState {
  routines: DailyRoutineList[]
  currentRoutine: DailyRoutineDetail | null
  loading: boolean
  error: string | null
  filters: RoutineFilters
}

// =============================================================================
// DEFINICIÃ“N DEL STORE
// =============================================================================

export const useRoutinesStore = defineStore('routines', {
  state: (): RoutinesState => ({
    routines: [],
    currentRoutine: null,
    loading: false,
    error: null,
    filters: {
      status: 'active',
      routineType: null,
      search: ''
    }
  }),

  getters: {
    activeRoutines: (state: RoutinesState): DailyRoutineList[] =>
      state.routines.filter(r => r.is_active && r.status === 'active'),

    archivedRoutines: (state: RoutinesState): DailyRoutineList[] =>
      state.routines.filter(r => r.status === 'archived'),

    /**
     * Devuelve rutinas filtradas segÃºn los filtros locales del store.
     */
    filteredRoutines: (state: RoutinesState): DailyRoutineList[] => {
      let filtered = state.routines

      if (state.filters.status !== 'all') {
        filtered = filtered.filter(r => r.status === state.filters.status)
      }

      if (state.filters.routineType) {
        filtered = filtered.filter(r => r.routine_type === state.filters.routineType)
      }

      if (state.filters.search) {
        const search = state.filters.search.toLowerCase()
        filtered = filtered.filter(r =>
          r.name.toLowerCase().includes(search)
        )
      }

      return filtered
    },

    getRoutineById: (state: RoutinesState) => 
      (id: number): DailyRoutineList | undefined =>
        state.routines.find(r => r.id === id)
  },

  actions: {
    /**
     * Carga la lista de rutinas para un niÃ±o.
     */
    async fetchRoutines(childId: number, filters: ApiFilters = {}): Promise<void> {
      this.loading = true
      this.error = null

      try {
        // (Asumiendo que routinesApi.getRoutines devuelve { data: DailyRoutineList[] })
        const response = await routinesApi.getRoutines(childId, filters)
        this.routines = response.data
      } catch (err: any) {
        this.error = err.message
        throw err
      } finally {
        this.loading = false
      }
    },

    /**
     * Carga el detalle completo de una rutina.
     */
    async fetchRoutineDetail(childId: number, routineId: number): Promise<DailyRoutineDetail> {
      this.loading = true

      try {
        // (Asumiendo que routinesApi.getRoutineDetail devuelve { data: DailyRoutineDetail })
        const response = await routinesApi.getRoutineDetail(childId, routineId)
        this.currentRoutine = response.data
        return response.data
      } catch (err: any) {
        this.error = err.message
        throw err
      } finally {
        this.loading = false
      }
    },

    /**
     * Crea una nueva rutina.
     */
    async createRoutine(childId: number, data: RoutineCreateData): Promise<DailyRoutineList> {
      this.loading = true

      try {
        // (Asumiendo que la API devuelve el objeto 'DailyRoutineList' al crear)
        const response = await routinesApi.createRoutine(childId, data)
        this.routines.push(response.data)
        return response.data
      } catch (err: any) {
        this.error = err.message
        throw err
      } finally {
        this.loading = false
      }
    },

    /**
     * Actualiza una rutina existente.
     */
    async updateRoutine(childId: number, routineId: number, data: RoutineUpdateData): Promise<DailyRoutineList> {
      this.loading = true

      try {
        const response = await routinesApi.updateRoutine(childId, routineId, data)
        const index = this.routines.findIndex(r => r.id === routineId)
        if (index !== -1) {
          // Actualiza el objeto en el listado
          this.routines[index] = { ...this.routines[index], ...response.data }
        }
        return response.data
      } catch (err: any) {
        this.error = err.message
        throw err
      } finally {
        this.loading = false
      }
    },

    /**
     * "Elimina" (archiva) una rutina.
     */
    async deleteRoutine(childId: number, routineId: number): Promise<void> {
      this.loading = true

      try {
        await routinesApi.deleteRoutine(childId, routineId)
        // La API (views.py) no borra, sino que archiva.
        // Por consistencia, actualizamos el estado local o recargamos.
        // OpciÃ³n 1: Filtrar (como en el JS)
        // this.routines = this.routines.filter(r => r.id !== routineId)
        
        // OpciÃ³n 2: Actualizar estado (mÃ¡s preciso)
        const index = this.routines.findIndex(r => r.id === routineId)
        if (index !== -1) {
          this.routines[index].status = 'archived'
          this.routines[index].is_active = false
        }
        
      } catch (err: any) {
        this.error = err.message
        throw err
      } finally {
        this.loading = false
      }
    },

    /**
     * Clona una rutina existente.
     */
    async cloneRoutine(childId: number, routineId: number, newName: string): Promise<DailyRoutineList> {
      this.loading = true

      try {
        const response = await routinesApi.cloneRoutine(childId, routineId, {
          new_name: newName,
          copy_steps: true,
          copy_strategies: true
        })
        this.routines.push(response.data) // AÃ±ade la nueva rutina clonada
        return response.data
      } catch (err: any) {
        this.error = err.message
        throw err
      } finally {
        this.loading = false
      }
    },

    /**
     * Alterna el estado de una rutina (activa/pausada).
     */
    async toggleStatus(childId: number, routineId: number): Promise<ToggleStatusResponse> {
      this.loading = true

      try {
        const response = await routinesApi.toggleStatus(childId, routineId)
        const index = this.routines.findIndex(r => r.id === routineId)
        if (index !== -1) {
          this.routines[index].status = response.data.status
          this.routines[index].is_active = response.data.status === 'active'
        }
        return response.data
      } catch (err: any) {
        this.error = err.message
        throw err
      } finally {
        this.loading = false
      }
    },

    /**
     * Actualiza los filtros del store.
     */
    setFilters(filters: Partial<RoutineFilters>): void {
      this.filters = { ...this.filters, ...filters }
    },

    /**
     * Limpia el estado de error.
     */
clearError(): void {
  this.error = null
},

    
// Agregar este mÃ©todo en la secciÃ³n de actions del routinesStore.ts
// Justo despuÃ©s del mÃ©todo clearError()

/**
 * AÃ±ade una rutina directamente al estado local sin hacer peticiÃ³n a la API.
 * Ãštil cuando ya tienes el objeto de rutina (ej: despuÃ©s de crearla en el wizard).
 */
addRoutineLocal(routine: DailyRoutineList): void {
  // Verificar que no exista ya en el array
  const exists = this.routines.some(r => r.id === routine.id)
  if (!exists) {
    this.routines.push(routine)
  }
}
  }
})


============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\store\rutinas\routineWizardStore.ts
============================================================
// src/store/rutinas/routineWizardStore.ts

import { defineStore } from 'pinia'
import { routinesApi } from '@/services/rutinas/routinesApi'
// Importa useRoutinesStore para aÃ±adir la rutina al final
import { useRoutinesStore } from './routinesStore'
// Importa los tipos necesarios desde el archivo centralizado
// Ya no necesitamos importar WizardBasicInfo, etc. aquÃ­ si las definimos y exportamos localmente
import type { DailyRoutineList } from '@/type/rutinas/rutinas' // AsegÃºrate que la ruta sea correcta

// =============================================================================
// INTERFACES (Definidas y Exportadas Localmente)
// =============================================================================

// --- Paso 1: InformaciÃ³n BÃ¡sica ---
export interface WizardBasicInfo { // <-- EXPORT AÃ‘ADIDO
  name: string
  routine_type: string | null
  description: string
  status: 'draft' | 'active'
}

// --- Paso 2: Horarios ---
export interface WizardSchedule { // <-- EXPORT AÃ‘ADIDO
  start_time: string
  estimated_duration_minutes: number | null
  days_of_week: string[]
}

// --- Paso 3: Pasos ---
export interface WizardStep {
  id?: number | string  // âœ… AGREGAR ESTA LÃNEA
  action: string
  description: string
  estimated_minutes: number | null
  visual_support: string
  requires_supervision: boolean
  is_skippable: boolean
}

// --- Paso 4: Estrategias (Individual) ---
export interface WizardStrategy { // <-- EXPORT AÃ‘ADIDO
  id?: number | string  // âœ… OPCIONAL - se asigna dinÃ¡micamente
  strategy_type: string
  description: string
  related_step_order: number | null
}

// --- Paso 4: Estrategias (ConfiguraciÃ³n General) ---
export interface WizardStrategies { // <-- EXPORT AÃ‘ADIDO
  flexibility_level: 'low' | 'medium' | 'high' | null
  change_tolerance_notes: string
  needs_advance_warning: boolean
  warning_time_minutes: number | null
  warning_method: string | null
  transition_strategies: string
  calming_strategies: string
  visual_supports_needed: boolean
  visual_support_type: string | null
}

// --- Estado Principal del Store ---
export interface RoutineWizardState { // <-- EXPORT AÃ‘ADIDO
  childId: number | null
  basicInfo: WizardBasicInfo
  schedules: WizardSchedule[]
  steps: WizardStep[]
  strategies: WizardStrategy[] // Array de estrategias individuales
  strategiesConfig: WizardStrategies // ConfiguraciÃ³n general de estrategias
  isLoading: boolean
  error: string | null
}

// =============================================================================
// VALORES POR DEFECTO
// =============================================================================

// FunciÃ³n para obtener el estado inicial de basicInfo
const getDefaultBasicInfo = (): WizardBasicInfo => ({
  name: '',
  routine_type: null,
  description: '', // AsegÃºrate que coincida con el tipo (string, no undefined)
  status: 'draft',
})

// FunciÃ³n para obtener el estado inicial de strategiesConfig
const getDefaultStrategiesConfig = (): WizardStrategies => ({
  flexibility_level: 'medium',
  change_tolerance_notes: '',
  needs_advance_warning: false,
  warning_time_minutes: 5,
  warning_method: null,
  transition_strategies: '',
  calming_strategies: '',
  visual_supports_needed: false,
  visual_support_type: null,
})

// =============================================================================
// DEFINICIÃ“N DEL STORE
// =============================================================================

export const useRoutineWizardStore = defineStore('routineWizard', {

  state: (): RoutineWizardState => ({
    childId: null,
    basicInfo: getDefaultBasicInfo(),
    schedules: [],
    steps: [],
    strategies: [], // Array vacÃ­o para estrategias individuales
    strategiesConfig: getDefaultStrategiesConfig(), // ConfiguraciÃ³n general
    isLoading: false,
    error: null,
  }),

  getters: {
    /**
     * Valida si el Paso 1 (InformaciÃ³n BÃ¡sica) estÃ¡ completo.
     */
    isStep1Valid: (state): boolean => {
      return !!state.basicInfo.name &&
             state.basicInfo.name.length >= 4 && // Ajustado a validaciÃ³n FormKit
             !!state.basicInfo.routine_type
    },

    /**
     * Valida si el Paso 2 (Horarios) estÃ¡ completo.
     * Es vÃ¡lido incluso sin horarios.
     */
    isStep2Valid: (): boolean => {
      // PodrÃ­as aÃ±adir validaciÃ³n mÃ¡s compleja si los horarios fueran obligatorios
      // o si hubiera reglas entre ellos.
      return true
    },

    /**
     * Valida si el Paso 3 (Pasos) estÃ¡ completo.
     * Requiere al menos un paso con una acciÃ³n definida.
     */
    isStep3Valid: (state): boolean => {
      return state.steps.length > 0 &&
             state.steps.every(step => !!step.action && step.action.trim().length > 0)
    },

    /**
     * Valida si el Paso 4 (Estrategias) estÃ¡ completo.
     * Por ahora, se considera siempre vÃ¡lido.
     */
    isStep4Valid: (): boolean => {
      // PodrÃ­as aÃ±adir validaciÃ³n si ciertos campos de strategiesConfig
      // fueran obligatorios basados en otras selecciones.
      return true
    },
  },

  actions: {
    /**
     * Inicializa el store con el ID del niÃ±o y resetea los datos.
     */
    initialize(childId: number) {
      this.reset() // Limpia datos previos
      this.childId = childId
      console.log(`Wizard Store inicializado para childId: ${childId}`)
    },

    /**
     * Resetea el estado del store a sus valores por defecto.
     */
    reset() {
      this.childId = null
      this.basicInfo = getDefaultBasicInfo()
      this.schedules = []
      this.steps = []
      this.strategies = []
      this.strategiesConfig = getDefaultStrategiesConfig()
      this.isLoading = false
      this.error = null
      console.log('Wizard Store reseteado')
    },

    /**
     * Orquesta la creaciÃ³n completa de la rutina llamando a la API secuencialmente.
     * @returns {Promise<DailyRoutineList>} La rutina bÃ¡sica creada (DailyRoutineList).
     * @throws {Error} Si falla la creaciÃ³n o el rollback.
     */
    async submitAllData(): Promise<DailyRoutineList> {
      // --- ValidaciÃ³n Preliminar ---
      if (this.childId === null) {
        console.error('submitAllData: childId es null')
        throw new Error("No se ha proporcionado un ID de niÃ±o.")
      }
      // Validar que todos los pasos requeridos sean vÃ¡lidos (opcional, defensa extra)
      if (!this.isStep1Valid || !this.isStep3Valid) {
         console.error('submitAllData: Pasos 1 o 3 no son vÃ¡lidos', {s1: this.isStep1Valid, s3: this.isStep3Valid})
         throw new Error("Por favor, completa todos los campos obligatorios en los pasos anteriores.")
      }

      // --- Inicio del Proceso ---
      const childId = this.childId // Asegura que no sea null para TypeScript
      this.isLoading = true
      this.error = null
      const routinesStore = useRoutinesStore()
      let createdRoutineId: number | null = null // Variable para guardar el ID de la rutina creada

      try {
        console.log('Wizard: Iniciando submitAllData...')
        // --- 1. Crear la Rutina Principal ---
        console.log('Wizard: Creando rutina principal...', this.basicInfo)
        const routineResponse = await routinesApi.createRoutine(
          childId,
          // AsegÃºrate que el objeto enviado coincida con RoutineCreateData o WizardBasicInfo segÃºn routinesApi
          {
            ...this.basicInfo,
            // El backend espera routine_type como string, no null
            routine_type: this.basicInfo.routine_type || '', // Convierte null a string vacÃ­o si es necesario
            description: this.basicInfo.description || '', // EnvÃ­a string vacÃ­o si no hay descripciÃ³n
          }
        )
        createdRoutineId = routineResponse.data.id // Guarda el ID devuelto por la API
        const newRoutine = routineResponse.data // Guarda el objeto completo

        // --- VERIFICACIÃ“N CRÃTICA ---
        if (!createdRoutineId || typeof createdRoutineId !== 'number') {
          console.error('Wizard: No se obtuvo un ID vÃ¡lido para la rutina creada:', createdRoutineId)
          throw new Error("Error crÃ­tico: No se pudo obtener el ID de la rutina principal creada desde la API.");
        }
        console.log(`Wizard: Rutina principal creada con ID: ${createdRoutineId}`)

        // --- 2. Crear Elementos Anidados (en paralelo) ---
        const promises: Promise<any>[] = []
        console.log('Wizard: Preparando creaciÃ³n de elementos anidados...')

        // 2a. Horarios
        if (this.schedules.length > 0) {
          console.log(`Wizard: AÃ±adiendo ${this.schedules.length} horarios a las promesas...`)
          this.schedules.forEach(schedule => {
            promises.push(
              routinesApi.createSchedule(childId, createdRoutineId!, schedule)
            )
          })
        }

        // 2b. Pasos (aÃ±adiendo el 'order')
        if (this.steps.length > 0) {
          console.log(`Wizard: AÃ±adiendo ${this.steps.length} pasos a las promesas...`)
          this.steps.forEach((step, index) => {
            const stepDataWithOrder = { ...step, order: index + 1 }
            promises.push(
              routinesApi.createStep(childId, createdRoutineId!, stepDataWithOrder)
            )
          })
        }

        // 2c. Estrategias individuales (SI TU BACKEND LO SOPORTA)
        if (this.strategies.length > 0) {
           console.log(`Wizard: AÃ±adiendo ${this.strategies.length} estrategias individuales a las promesas...`)
           this.strategies.forEach(strategy => {
             // AsegÃºrate que la API y el backend soporten esto
             promises.push(
               routinesApi.createIndividualStrategy(childId, createdRoutineId!, strategy)
             )
           })
        }

        // 2d. ConfiguraciÃ³n general de estrategias
        // Solo la enviamos si tiene datos o si siempre debe existir
        // (PodrÃ­as aÃ±adir una comprobaciÃ³n si getDefaultStrategiesConfig() representa un estado "vacÃ­o")
        console.log('Wizard: AÃ±adiendo configuraciÃ³n general de estrategias a las promesas...')
        promises.push(
          routinesApi.createStrategyConfig(childId, createdRoutineId!, this.strategiesConfig)
        )

        // Esperar a que todas las promesas de creaciÃ³n de sub-elementos terminen
        console.log(`Wizard: Ejecutando ${promises.length} promesas en paralelo...`)
        await Promise.all(promises)
        console.log('Wizard: Elementos anidados creados exitosamente.')

        // --- 3. Ã‰xito Final ---
        this.isLoading = false

        // AÃ±adir la nueva rutina (con datos bÃ¡sicos) al store principal localmente
        // Esto actualiza la UI sin necesidad de un fetch completo inmediato
        routinesStore.addRoutineLocal(newRoutine as DailyRoutineList) // Usa la acciÃ³n local
        console.log('Wizard: Rutina aÃ±adida al store principal localmente.')

        return newRoutine // Devuelve la rutina creada

      } catch (err: any) {
        // --- Manejo de Errores ---
        console.error('Wizard: Error durante submitAllData:', err)
        this.isLoading = false
        // Intenta obtener un mensaje de error especÃ­fico
        this.error = err?.response?.data?.detail || err?.response?.data?.error || err?.message || "OcurriÃ³ un error desconocido durante la creaciÃ³n."

        // --- 4. ROLLBACK (Intentar eliminar la rutina base si se creÃ³) ---
        if (createdRoutineId !== null) {
          console.warn(`Wizard: Intentando Rollback - Eliminando rutina base ID: ${createdRoutineId}`)
          try {
            await routinesApi.deleteRoutine(childId, createdRoutineId)
            console.log(`Wizard: Rollback exitoso - Rutina ${createdRoutineId} eliminada.`)
          } catch (deleteErr: any) {
            console.error("Wizard: Error CRÃTICO durante el Rollback:", deleteErr)
            // Informar al usuario que puede haber quedado una rutina incompleta
            this.error = `Error al crear los detalles de la rutina. Es posible que se haya creado una rutina incompleta (${this.basicInfo.name}). Por favor, revÃ­sala o contacta a soporte. Detalle: ${this.error}`
          }
        }

        // Relanzar el error para que el componente Wizard lo capture
        throw new Error(this.error || 'An unknown error occurred')
      }
    }, // Fin de submitAllData
  }, // Fin de actions
}) // Fin de defineStore
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\style.css
============================================================
@tailwind base;
@tailwind components;
@tailwind utilities;



:root {
  --sidebar-width: 250px;
  --sidebar-width-collapsed: 70px;
  --topmenu-height: 64px;
}

/* Transiciones suaves para el sidebar */
.sidebar-transition {
  transition: width 0.3s ease;
}
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\type\cropper.types.ts
============================================================
// src/types/cropper.types.ts

export interface CropperCoordinates {
  left: number
  top: number
  width: number
  height: number
}

export interface CropperTransforms {
  rotate: number
  flip: {
    horizontal: boolean
    vertical: boolean
  }
}

export interface CropperSettings {
  aspectRatio: number
  minWidth: number
  minHeight: number
  maxWidth?: number
  maxHeight?: number
}

export interface CropperResult {
  blob: Blob
  canvas: HTMLCanvasElement
  coordinates: CropperCoordinates
}
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\type\formDraft.ts
============================================================
// src/types/formDraft.ts

export interface FormDraftMetadata {
  id: string
  formId: string
  createdAt: Date
  updatedAt: Date
  step: number
  title: string
  dataPreview?: string
  expiresAt?: Date
}

export interface FormDraft<T = any> {
  metadata: FormDraftMetadata
  data: T
}

export interface FormDraftState {
  drafts: FormDraft[]
  currentDraft: FormDraft | null
  autoSaveEnabled: boolean
  lastSavedAt: Date | null
}

export type StorageStrategy = 'localStorage' | 'sessionStorage' | 'memory'

export interface DraftRecoveryOptions {
  allowRecovery: boolean
  showRecoveryModal: boolean
  autoRecover: boolean
}

export interface FormDraftConfig {
  formId: string
  storage: StorageStrategy
  autoSave: boolean
  autoSaveDelay: number
  maxDrafts: number
  draftExpiryDays: number
}
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\type\hitoServiceInterface.ts
============================================================
// src/type/hitoServiceInterface.ts

/**
 * Interface representing the data structure of a Milestone
 * as received from the backend API (matching DevelopmentMilestoneSerializer).
 */
export interface Milestone {
  id: number | string;
  child: number | string; // ID of the child
  date: string; // YYYY-MM-DD format
  age_at_milestone: string | null; // e.g., "7a 5m" or null
  category: string; // e.g., 'communication', 'motor'
  category_display: string; // e.g., 'ComunicaciÃ³n', 'Motor'
  description: string;
  observations: string | null;
  proficiency_level: string; // e.g., 'emerging', 'mastered'
  proficiency_level_display: string; // e.g., 'Emergente', 'Dominado'
  context: string; // e.g., 'therapy', 'home'
  context_display: string; // e.g., 'En terapia', 'En casa'
  support_level: string; // e.g., 'independent', 'verbal_cue'
  support_level_display: string; // e.g., 'Independiente', 'IndicaciÃ³n verbal'
  functional_impact: string | null;
  previous_records_count: number;
  registered_by: number | null; // ID of the user who registered
  registered_by_name: string | null; // Full name of the user
  created_at: string; // ISO 8601 date-time string
  // Add evidence_image: string | null; if you re-enable it later
}

/**
 * Interface representing the data structure for creating or updating
 * a Milestone (matching the fields the API expects in POST/PATCH).
 */
export interface MilestoneFormData {
  date: string; // YYYY-MM-DD format
  category: string;
  description: string;
  observations?: string | null; // Optional
  proficiency_level: string;
  context: string;
  support_level: string;
  functional_impact?: string | null; // Optional
  // Add evidence_image?: File | null; if you re-enable it later
}
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\type\metricas.ts
============================================================
// src/types/metricas.ts

/**
 * Interfaces TypeScript para las mÃ©tricas del dashboard
 * 
 * Estas interfaces definen la estructura de datos que esperamos 
 * del backend, asegurando type safety en todo el frontend
 */

export interface ResumenGeneral {
  total_ninos: number;
  con_necesidades_especiales: number;
  porcentaje_con_nee: number;
  en_programa_pie: number;
  nuevos_este_mes: number;
}

export interface PerfilClinico {
  nivel_autismo_1: number;
  nivel_autismo_2: number;
  nivel_autismo_3: number;
  nee_permanentes: number;
  nee_transitorias: number;
}

export interface GestionOperativa {
  sin_consentimiento: number;
  en_evaluacion_pie: number;
  con_medicacion_activa: number;
  con_alergias_registradas: number;
  sin_establecimiento: number;
}

export interface DistribucionDemografica {
  por_genero: {
    masculino: number;
    femenino: number;
    otro: number;
  };
  rango_etario: {
    '0_5': number;
    '6_12': number;
    '13_18': number;
  };
}

export interface MetricasData {
  resumen_general: ResumenGeneral;
  perfil_clinico: PerfilClinico;
  gestion_operativa: GestionOperativa;
  distribucion_demografica: DistribucionDemografica;
  metadata?: {
    ultima_actualizacion: string;
    usuario: string;
    total_filtrado: number;
  };
}

// Props para componentes
export interface MetricCardProps {
  titulo: string;
  valor: string | number;
  subtitulo?: string;
  tendencia?: 'positiva' | 'negativa' | 'neutral';
  icono?: string;
  loading?: boolean;
  color?: string;
}

export interface MetricCardGridProps {
  metricas: MetricasData | null;
  loading: boolean;
  error: string | null;
}
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\type\nne.ts
============================================================
// src/types/nne.ts

/**
 * Representa la estructura de datos que se envÃ­a al backend
 * cuando se crea un nuevo NEE (NiÃ±o, NiÃ±a o Estudiante).
 * * EstÃ¡ dividido en pasos (1 a 4) para reflejar el formulario multipasos.
 */
export interface NneFormData {
  // Paso 1: Datos bÃ¡sicos del niÃ±o
  first_name: string              // Nombres del niÃ±o
  last_name: string               // Apellidos del niÃ±o
  rut: string                     // RUT en formato chileno (ej: 12.345.678-9)
  birth_date: string              // Fecha de nacimiento (ISO string: YYYY-MM-DD)
  gender: string                  // GÃ©nero (ej: "male", "female", "other")
  street: string                  // Calle de residencia
  street_number: string           // NÃºmero de la calle
  region: number | null           // âœ… CORRECCIÃ“N: AÃ±adido para coincidir con nneService.ts
  commune: number | null            // ID de la comuna (relaciÃ³n con tabla de comunas)
  establishment: number | null    // ID del establecimiento (si aplica)
  current_grade: string           // Curso actual (ej: "1Â° BÃ¡sico")
  school_journey: string          // Jornada escolar (ej: "morning", "afternoon")
  school_adaptation_notes?: string // Notas de adaptaciÃ³n escolar (opcional)

  // Paso 2: InformaciÃ³n mÃ©dica y diagnÃ³sticos
  special_needs: boolean          // Indica si tiene necesidades especiales
  special_needs_type?: string    // Tipo de necesidad especial (ej: "permanent", "temporary")
  autism_level_value?: string    // Nivel de autismo (ej: "level_1", "level_2", "no_review")
  pie_diagnosis?: string           // DiagnÃ³stico PIE (opcional)
  pie_entry_date?: string | null   // Fecha de ingreso al PIE (puede ser null)
  pie_status?: string              // Estado en PIE (ej: "active", "inactive")
  allergies?: string               // Alergias conocidas
  current_medication?: string    // MedicaciÃ³n actual
  emergency_contact?: string       // Nombre del contacto de emergencia
  emergency_phone?: string         // TelÃ©fono del contacto de emergencia
  medical_notes?: string           // Notas mÃ©dicas adicionales

  // Paso 3: Padres/Tutores asociados
  usuarios: number[]              // IDs de usuarios con rol "Padres" asociados al niÃ±o

  // Paso 4: Consentimiento y antecedentes
  guardian_consent: boolean       // Consentimiento del apoderado (true/false)
  consent_date?: string | null     // Fecha del consentimiento (ISO string o null)
  previous_therapies: boolean     // Indica si tuvo terapias previas
  previous_therapies_detail?: string // Detalle de terapias previas (opcional)
  referred_by?: string             // QuiÃ©n refiriÃ³ al niÃ±o (ej: "school", "doctor")
  referred_by_detail?: string    // Detalle de la referencia (ej: "Orientadora escolar")
  attended_where?: string          // Lugar donde asistiÃ³ previamente
}

/**
 * Representa un usuario con rol "Padre".
 * Este tipo corresponde a lo que devuelve el backend
 * cuando se consulta o se asocia un padre existente.
 */
export interface ParentUser {
  id: number                      // ID Ãºnico del padre en la base de datos
  username: string                // Nombre de usuario (login)
  email: string                   // Correo electrÃ³nico
  first_name: string              // Nombres
  last_name: string               // Apellidos
  rut: string                     // RUT del padre
  phone?: string                  // TelÃ©fono de contacto (opcional)
  role?: string                   // âœ… CORRECCIÃ“N: AÃ±adido para coincidir con nneService.ts
}

/**
 * Representa el payload necesario para crear un nuevo padre/tutor.
 * Se separa de `ParentUser` porque aquÃ­ sÃ­ se requiere `password`,
 * mientras que en la respuesta del backend nunca se expone.
 */
export interface ParentUserCreate {
  first_name: string              // Nombres
  last_name: string               // Apellidos
  rut: string                     // RUT
  email: string                   // Correo electrÃ³nico
  phone?: string                  // TelÃ©fono (opcional)
  username: string                // Nombre de usuario (login)
  password: string                // ContraseÃ±a (requerida al crear)
}
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\type\parent.ts
============================================================
// src/type/parent.ts

/**
 * Define la estructura de datos que devuelve el endpoint
 * GET /api/seguimiento/parent/latest-update/
 * * Basado en ParentLatestUpdateSerializer de Django.
 */
export interface LatestSessionUpdate {
  child_name: string
  therapist_full_name: string
  message: string
  session_date: string // string en formato ISO (ej: "2025-11-10T09:00:00Z")
}
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\type\PhotoUpload.ts
============================================================

============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\type\rutinas\rutinas.ts
============================================================
// src/type/rutinas.ts
// -------------------------------------------------------------
// Definiciones de TypeScript para el MÃ³dulo de Rutinas
//
// Este archivo contiene todas las interfaces y tipos de datos
// que se utilizan para la comunicaciÃ³n entre el frontend (Vue/Pinia)
// y el backend (Django REST Framework).
// -------------------------------------------------------------

// =============================================================
// 1. TIPOS BÃSICOS Y DE FILTRO
// =============================================================

/**
 * Tipos de estado de rutina para los filtros del store.
 */
export type RoutineStatusFilter = 'active' | 'paused' | 'archived' | 'draft' | 'all'

/**
 * Objeto de filtros para el estado local del store (Pinia).
 */
export interface RoutineFilters {
  status: RoutineStatusFilter
  routineType: string | null
  search: string
}

/**
 * Objeto de filtros para los query params de la API.
 */
export interface ApiFilters {
  status?: string
  routine_type?: string
  is_active?: boolean
  date_from?: string
  date_to?: string
}

// =============================================================
// 2. INTERFACES DE COMPONENTES DE RUTINA (Serializers Anidados)
// =============================================================

/**
 * Horario de una rutina (RoutineScheduleSerializer)
 */
export interface RoutineSchedule {
  id: number
  start_time: string // "HH:mm:ss"
  estimated_duration_minutes: number | null
  days_of_week: string[] // ['monday', 'tuesday', ...]
}

/**
 * Paso de una rutina (RoutineStepSerializer)
 */
export interface RoutineStep {
  id: number
  order: number
  action: string
  description: string
  estimated_minutes: number | null
  visual_support: string | null // URL o path
  requires_supervision: boolean
  is_skippable: boolean
  common_difficulties: string
  strategies: string
}

/**
 * Estrategias de una rutina (RoutineStrategySerializer)
 */
export interface RoutineStrategy {
  id: number
  flexibility_level: 'low' | 'medium' | 'high'
  flexibility_level_display: string
  change_tolerance_notes: string
  needs_advance_warning: boolean
  warning_time_minutes: number | null
  warning_method: string
  warning_method_display: string
  transition_strategies: string
  calming_strategies: string
  visual_supports_needed: boolean
  visual_support_type: string
  visual_support_type_display: string
}

/**
 * MotivaciÃ³n de una rutina (RoutineMotivationSerializer)
 */
export interface RoutineMotivation {
  id: number
  uses_reinforcement: boolean
  reinforcement_system: string
  motivators: string
}

/**
 * Metas de independencia (RoutineIndependenceGoalSerializer)
 */
export interface RoutineIndependenceGoal {
  id: number
  current_level: string
  current_level_display: string
  target_level: string
  target_level_display: string
  success_criteria: string
}

/**
 * CoordinaciÃ³n (RoutineCoordinationSerializer)
 */
export interface RoutineCoordination {
  id: number
  family_involvement: string
  parent_training_needed: boolean
  school_coordination_notes: string
  tracking_method: string
  tracking_method_display: string
  next_review_date: string | null
}

/**
 * DesafÃ­os (RoutineChallengeSerializer)
 */
export interface RoutineChallenge {
  id: number
  common_challenges: string
  trigger_points: string
}

/**
 * EvaluaciÃ³n (RoutineEvaluationSerializer)
 */
export interface RoutineEvaluation {
  id: number
  evaluation_date: string
  effectiveness_rating: number
  effectiveness_notes: string
  evaluated_by_name: string
}

// =============================================================
// 3. INTERFACES PRINCIPALES DE RUTINA (Serializers Principales)
// =============================================================

/**
 * Objeto para la API de listado (DailyRoutineListSerializer)
 */
export interface DailyRoutineList {
  id: number
  name: string
  routine_type: string
  routine_type_display: string
  status: string
  status_display: string
  is_active: boolean
  child_name: string
  total_steps: number
  completion_rate_7days: number | null
  date_started: string
  created_at: string
}

/**
 * Objeto para la API de detalle (DailyRoutineDetailSerializer)
 * Hereda de List e incluye todas las relaciones anidadas.
 */
export interface DailyRoutineDetail extends DailyRoutineList {
  description: string
  child: number
  created_by_name: string
  date_ended: string | null
  
  // Relaciones anidadas
  schedules: RoutineSchedule[]
  steps: RoutineStep[]
  strategies: RoutineStrategy | null
  motivation: RoutineMotivation | null
  independence_goal: RoutineIndependenceGoal | null
  coordination: RoutineCoordination | null
  challenges: RoutineChallenge | null
  evaluations: RoutineEvaluation[]
}

/**
 * Objeto para crear/actualizar una rutina (DailyRoutineWriteSerializer)
 */
export interface RoutineWriteData {
  name: string
  routine_type: string
  description?: string
  status?: string
  is_active?: boolean
  date_started?: string | null
  date_ended?: string | null
}

// =============================================================
// 4. INTERFACES DEL ASISTENTE (Wizard Store)
// =============================================================

/**
 * Paso 1: InformaciÃ³n BÃ¡sica (Wizard)
 */
export interface WizardBasicInfo {
  name: string
  routine_type: string | null
  description: string
  status: 'draft' | 'active'
}

/**
 * Paso 2: Horarios (Wizard)
 */
export interface WizardSchedule {
  id?: number | string
  start_time: string // "HH:mm"
  estimated_duration_minutes: number | null
  days_of_week: string[] // ['monday', 'tuesday', ...]
}

/**
 * Paso 3: Pasos (Wizard)
 */
export interface WizardStep {
  // 'id' y 'order' se gestionan en el backend
  action: string
  description: string
  estimated_minutes: number | null
  visual_support: string // (Asumimos URL o path)
  requires_supervision: boolean
  is_skippable: boolean
}

// --- AÃ‘ADIR ESTA INTERFAZ ---
/**
 * Representa una estrategia individual aÃ±adida en el wizard.
 * (Ajusta los campos segÃºn lo que necesites guardar por estrategia)
 */
export interface WizardStrategy { // <-- La interfaz que faltaba
    id?: number | string  // âœ… AGREGAR ESTA LÃNEA
  strategy_type: string // Ej: 'calming', 'transition', 'visual_support'
  description: string   // Ej: 'Usar temporizador visual', 'Ofrecer objeto sensorial'
  related_step_order?: number | null // Opcional: A quÃ© paso se asocia
  // AÃ±ade otros campos si son necesarios por estrategia individual
}

/**
 * Paso 4: Estrategias (Wizard)
 */
export interface WizardStrategies {
  flexibility_level: 'low' | 'medium' | 'high' | null
  change_tolerance_notes: string
  needs_advance_warning: boolean
  warning_time_minutes: number | null
  warning_method: string | null
  transition_strategies: string
  calming_strategies: string
  visual_supports_needed: boolean
  visual_support_type: string | null
}

// =============================================================
// 5. INTERFACES DE REGISTROS (Completion Logs)
// =============================================================

/**
 * Detalle de un paso completado (StepCompletionSerializer)
 */
export interface StepCompletion {
  id: number
  step: number
  step_order: number
  step_action: string
  completed: boolean
  had_difficulty: boolean
  time_taken_seconds: number | null
  support_needed: 'none' | 'verbal' | 'visual' | 'physical' | 'full'
  notes: string
}

/**
 * Objeto para crear un detalle de paso (StepCompletionCreateSerializer)
 */
export interface StepCompletionCreateData {
  step_id: number
  completed: boolean
  had_difficulty: boolean
  time_taken_seconds?: number | null
  support_needed?: 'none' | 'verbal' | 'visual' | 'physical' | 'full'
  notes?: string
}

/**
 * Registro de cumplimiento (RoutineCompletionLogDetailSerializer)
 */
export interface LogEntry {
  id: number
  routine: number
  routine_name: string
  child_name: string
  logged_by_name: string
  date: string
  start_time: string
  end_time: string
  actual_duration_minutes: number
  completion_status: 'completed' | 'completed_help' | 'partial' | 'skipped'
  completion_status_display: string
  support_level_needed: 'none' | 'low' | 'medium' | 'high'
  support_level_display: string
  independence_rating: number | null // 1-5
  went_well: string
  difficulties: string
  modifications_made: string
  crisis_occurred: boolean
  crisis_details: string
  emotional_state_start: string
  emotional_state_start_display: string
  emotional_state_end: string
  emotional_state_end_display: string
  completion_percentage: number
  
  // Relaciones anidadas
  step_completions: StepCompletion[]
  // (steps_completed y steps_with_difficulty son listas de IDs o objetos RoutineStep)
  steps_completed: RoutineStep[]
  steps_with_difficulty: RoutineStep[]
}

/**
 * Objeto para crear un registro (RoutineCompletionLogCreateSerializer)
 */
export interface LogCreateData {
  date: string
  start_time: string
  end_time: string
  actual_duration_minutes?: number
  completion_status: 'completed' | 'completed_help' | 'partial' | 'skipped'
  support_level_needed: 'none' | 'low' | 'medium' | 'high'
  independence_rating?: number | null
  went_well?: string
  difficulties?: string
  modifications_made?: string
  crisis_occurred?: boolean
  crisis_details?: string
  emotional_state_start?: string
  emotional_state_end?: string
  notes?: string
  
  // Array anidado para creaciÃ³n en batch
  step_completions: StepCompletionCreateData[]
}

// =============================================================
// 6. INTERFACES DE ACCIONES Y ANALÃTICAS (API Views)
// =============================================================

/**
 * Respuesta de la acciÃ³n 'toggleStatus'.
 */
export interface ToggleStatusResponse {
  status: string
  message: string
}

/**
 * Payload para la acciÃ³n 'clone'.
 */
export interface CloneRoutineData {
  new_name: string
  copy_steps?: boolean
  copy_strategies?: boolean
}

/**
 * Datos de una rutina para la comparaciÃ³n.
 */
interface ComparisonRoutineData {
  name: string
  metrics: {
    total_logs: number
    completion_rate: number
    crisis_rate: number
    avg_independence: number
  }
}

/**
 * Respuesta de la API de 'RoutineComparisonView'.
 */
export interface ComparisonData {
  period_days: number
  routine_a: ComparisonRoutineData
  routine_b: ComparisonRoutineData
  winner: 'routine_a' | 'routine_b' | null
  recommendation: string
}

/**
 * Respuesta de la API de 'effectiveness_report'.
 */
export interface EffectivenessReport {
  routine_id: number
  routine_name: string
  period_days: number
  total_logs: number
  metrics: {
    completed: number
    partial: number
    skipped: number
    completion_rate: number
    crisis_count: number
    crisis_rate: number
    avg_independence: number
  }
  problematic_steps: {
    step: string
    difficulty_count: number
  }[]
  recommendations: string[]
  needs_review: boolean
}
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\type\user.ts
============================================================
// Paso 5: DefiniciÃ³n del tipo de usuario
export interface User {
  id: number
  email: string
  username: string
  rut: string
  name: string
   first_name: string  // ğŸ”¥ AGREGAR
  last_name: string   // ğŸ”¥ AGREGAR
  estado: string
  is_admin: boolean
  is_superuser: boolean
  roles: string[]
  permissions: string[]
  last_access: string

  
  // ğŸ”¥ AGREGAR ESTE CAMPO CRÃTICO
  role: 'parent' | 'therapist' | 'admin'  // Rol principal del usuario
}



============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\utils\rutValidator.ts
============================================================
// src/utils/rutValidator.ts

/**
 * Utilidades para validaciÃ³n y formateo de RUT chileno en el frontend
 */

export interface RutValidationResult {
  isValid: boolean;
  message?: string;
  rutNormalized?: string;
  rutFormatted?: string;
  calculatedDv?: string;
  inputDv?: string;
  isPartial?: boolean; // Nuevo: indica si es un RUT parcial (en escritura)
}

/**
 * Calcula el dÃ­gito verificador de un RUT chileno
 */
export function calcularDigitoVerificador(rutSinDv: string): string {
  const rutLimpio = rutSinDv.replace(/\D/g, '');
  
  let suma = 0;
  let multiplicador = 2;
  
  for (let i = rutLimpio.length - 1; i >= 0; i--) {
    suma += parseInt(rutLimpio.charAt(i)) * multiplicador;
    multiplicador = multiplicador === 7 ? 2 : multiplicador + 1;
  }
  
  const resto = suma % 11;
  const dvCalculado = 11 - resto;
  
  if (dvCalculado === 11) return '0';
  if (dvCalculado === 10) return 'K';
  return dvCalculado.toString();
}

/**
 * Valida un RUT chileno con soporte para escritura progresiva
 */
export function validarRut(rut: string): RutValidationResult {
  if (!rut || typeof rut !== 'string') {
    return {
      isValid: false,
      message: 'El RUT no puede estar vacÃ­o',
      isPartial: false
    };
  }

  // Limpiar y normalizar el RUT
  const rutLimpio = rut.replace(/\./g, '').replace(/-/g, '').toUpperCase().trim();
  
  // Si estÃ¡ completamente vacÃ­o despuÃ©s de limpiar
  if (rutLimpio.length === 0) {
    return {
      isValid: false,
      message: 'El RUT no puede estar vacÃ­o',
      isPartial: false
    };
  }

  // âœ… NUEVO: ValidaciÃ³n progresiva - permitir escritura incompleta
  // Solo nÃºmeros mientras se escribe (sin DV todavÃ­a)
  if (/^\d{1,8}$/.test(rutLimpio)) {
    return {
      isValid: false, // No es vÃ¡lido aÃºn, pero es un RUT parcial
      message: 'ContinuÃ© escribiendo el RUT...',
      rutNormalized: rutLimpio,
      isPartial: true // Importante: indica que estÃ¡ en proceso
    };
  }

  // âœ… NUEVO: RUT con guiÃ³n pero sin DV completo (ej: "12345678-")
  if (/^\d{7,8}-$/.test(rutLimpio)) {
    return {
      isValid: false,
      message: 'Falta el dÃ­gito verificador',
      rutNormalized: rutLimpio,
      isPartial: true
    };
  }

  // âœ… NUEVO: RUT con formato parcial con puntos (ej: "12.345.678-")
  if (/^\d{1,2}\.?\d{0,3}\.?\d{0,3}-?$/.test(rut) && rutLimpio.length < 9) {
    return {
      isValid: false,
      message: 'ContinuÃ© escribiendo el RUT...',
      rutNormalized: rutLimpio,
      isPartial: true
    };
  }

  // ValidaciÃ³n de formato completo (RUT terminado)
  if (!/^(\d{7,8})([0-9K])$/.test(rutLimpio)) {
    return {
      isValid: false,
      message: 'Formato de RUT invÃ¡lido. Debe ser "12345678-9"',
      isPartial: false
    };
  }

  // Separar nÃºmero y dÃ­gito verificador
  const numero = rutLimpio.slice(0, -1);
  const dvIngresado = rutLimpio.slice(-1);

  // Calcular dÃ­gito verificador
  const dvCalculado = calcularDigitoVerificador(numero);

  // Comparar dÃ­gitos verificadores
  if (dvCalculado !== dvIngresado) {
    return {
      isValid: false,
      message: `DÃ­gito verificador incorrecto. Esperado '${dvCalculado}', recibido '${dvIngresado}'`,
      rutNormalized: `${numero}-${dvIngresado}`,
      calculatedDv: dvCalculado,
      inputDv: dvIngresado,
      isPartial: false
    };
  }

  // RUT vÃ¡lido
  const rutNormalizado = `${numero}-${dvCalculado}`;
  const rutFormateado = formatearRut(rutNormalizado);

  return {
    isValid: true,
    rutNormalized: rutNormalizado,
    rutFormatted: rutFormateado,
    calculatedDv: dvCalculado,
    inputDv: dvIngresado,
    isPartial: false
  };
}

/**
 * Valida si un RUT tiene formato vÃ¡lido o estÃ¡ en proceso de escritura
 */
export function validarRutProgresivo(rut: string): RutValidationResult {
  const resultado = validarRut(rut);
  
  // Si es un RUT parcial, no lo consideramos como error para la UI
  // pero tÃ©cnicamente no es vÃ¡lido para envÃ­o
  if (resultado.isPartial) {
    return {
      ...resultado,
      message: undefined // No mostrar mensaje de error para RUTs parciales
    };
  }
  
  return resultado;
}

/**
 * Formatea un RUT con puntos y guiÃ³n
 */
export function formatearRut(rut: string): string {
  if (!rut) return '';
  
  // Limpiar el RUT pero mantener el guiÃ³n si existe
  const rutLimpio = rut.replace(/\./g, '').toUpperCase().trim();
  
  // Si es un RUT parcial sin guiÃ³n, no formatear con puntos aÃºn
  if (!rutLimpio.includes('-') && rutLimpio.length <= 8) {
    return rutLimpio;
  }
  
  // Separar nÃºmero y dÃ­gito verificador
  const partes = rutLimpio.split('-');
  const numero = partes[0];
  const dv = partes[1] || '';
  
  if (numero.length < 8) return rutLimpio;
  
  // Formatear el nÃºmero con puntos
  let numeroFormateado = numero
    .split('')
    .reverse()
    .join('')
    .replace(/(\d{3})/g, '$1.')
    .split('')
    .reverse()
    .join('')
    .replace(/^\./, '');
  
  return dv ? `${numeroFormateado}-${dv}` : numeroFormateado;
}

/**
 * Limpia y normaliza un RUT (remueve puntos y espacios)
 */
export function limpiarRut(rut: string): string {
  if (!rut) return '';
  return rut.replace(/\./g, '').replace(/-/g, '').toUpperCase().trim();
}

/**
 * Valida si un RUT tiene formato vÃ¡lido (sin verificar dÃ­gito verificador)
 */
export function validarFormatoRut(rut: string): boolean {
  if (!rut) return false;
  const rutLimpio = limpiarRut(rut);
  return /^(\d{7,8})([0-9K])$/.test(rutLimpio);
}

/**
 * Hook/composable para usar en componentes Vue (alternativa al composable separado)
 */
export function useRutValidation() {
  return {
    validarRut,
    formatearRut,
    limpiarRut,
    validarFormatoRut,
    calcularDigitoVerificador
  };
}

export default {
  validarRut,
  formatearRut,
  limpiarRut,
  validarFormatoRut,
  calcularDigitoVerificador,
  useRutValidation
};
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\views\auth\LoginView.vue
============================================================
<template>
  <div
    class="min-h-screen flex items-center justify-center px-4 py-12 bg-gradient-to-br from-amber-50 to-yellow-50"
    style="background-color: #fffaf2;"
  >
    <!-- Container principal con sombra sutil -->
    <div class="max-w-md w-full space-y-8">
      <!-- Card principal -->
      <div class="bg-white rounded-2xl shadow-xl p-8 border border-yellow-100/50">
        
        <!-- Header con logo -->
        <div class="text-center mb-8">
          <div class="flex justify-center mb-6">
            <img 
              :src="logoUrl" 
              alt="Logo" 
              class="h-12 w-auto drop-shadow-sm"
            >
          </div>
          <h2 class="text-2xl font-bold text-amber-900" style="color: #311906;">
            Iniciar SesiÃ³n
          </h2>
          <p class="mt-2 text-sm text-stone-600" style="color: #8c8377;">
            Accede a tu cuenta para continuar
          </p>
        </div>

        <!-- Formulario -->
        <FormKit
          type="form"
          submit-label="Iniciar SesiÃ³n"
          @submit="handleLogin"
          :classes="{
            form: 'space-y-6',
            messages: 'text-red-500 text-sm mt-1',
            message: 'text-red-500 text-sm'
          }"
        >
          <!-- Campo Email -->
          <FormKit
            name="email"
            type="email"
            label="Correo ElectrÃ³nico"
            placeholder="tu@ejemplo.com"
            validation="required|email"
            :classes="{
              outer: 'mb-6',
              label: 'block text-sm font-semibold mb-2 text-amber-900',
              input: 'w-full px-4 py-3 bg-amber-50 border-2 border-yellow-200 rounded-xl focus:border-yellow-400 focus:bg-white focus:outline-none focus:ring-2 focus:ring-yellow-200/50 transition-all duration-200 text-amber-900 placeholder-stone-400',
              messages: 'text-red-500 text-sm mt-1'
            }"
            :style="{
              '--fk-color-primary': '#ffe923'
            }"
          />

          <!-- Campo Password -->
          <FormKit
            name="password"
            type="password"
            label="ContraseÃ±a"
            placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
            validation="required"
            :classes="{
              outer: 'mb-8',
              label: 'block text-sm font-semibold mb-2 text-amber-900',
              input: 'w-full px-4 py-3 bg-amber-50 border-2 border-yellow-200 rounded-xl focus:border-yellow-400 focus:bg-white focus:outline-none focus:ring-2 focus:ring-yellow-200/50 transition-all duration-200 text-amber-900 placeholder-stone-400',
              messages: 'text-red-500 text-sm mt-1'
            }"
          />

          <!-- BotÃ³n Submit personalizado -->
          <template #submit="{ disabled, label }">
            <button
              type="submit"
              :disabled="Boolean(disabled)"
              class="group relative w-full flex justify-center py-3 px-4 border border-transparent text-sm font-semibold rounded-xl text-amber-900 bg-gradient-to-r from-yellow-300 to-yellow-400 hover:from-yellow-400 hover:to-yellow-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-yellow-400 transition-all duration-200 transform hover:scale-[1.02] active:scale-[0.98] shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none"
              style="background: linear-gradient(135deg, #fffb5c 0%, #ffe923 100%); color: #311906;"
            >
              <span class="absolute left-0 inset-y-0 flex items-center pl-3">
                <svg 
                  class="h-5 w-5 text-amber-800 group-hover:text-amber-900 transition-colors" 
                  xmlns="http://www.w3.org/2000/svg" 
                  viewBox="0 0 20 20" 
                  fill="currentColor"
                >
                  <path fill-rule="evenodd" d="M10 1a4.5 4.5 0 00-4.5 4.5V9H5a2 2 0 00-2 2v6a2 2 0 002 2h10a2 2 0 002-2v-6a2 2 0 00-2-2h-.5V5.5A4.5 4.5 0 0010 1zm3 8V5.5a3 3 0 10-6 0V9h6z" clip-rule="evenodd" />
                </svg>
              </span>
              {{ label }}
            </button>
          </template>
        </FormKit>

        <!-- Enlaces adicionales -->
        <div class="mt-6 text-center">
          <a 
            href="#" 
            class="text-sm font-medium hover:underline transition-colors duration-200" 
            style="color: #8c8377;"
          >
            Â¿Olvidaste tu contraseÃ±a?
          </a>
        </div>
      </div>

      <!-- Footer -->
      <div class="text-center">
        <p class="text-xs" style="color: #8c8377;">
          Protegido por medidas de seguridad avanzadas
        </p>
      </div>
    </div>
  </div>
</template>

<script lang="ts" setup>
import { useAuth } from '@/composables/useAuth'
import logoHorizontal from '../../assets/img/principal_divermind.svg'

const { login } = useAuth()

// URL del logo
const logoUrl = logoHorizontal

const handleLogin = (formData: { email: string; password: string }) => {
  login(formData.email, formData.password)
}
</script>

<style scoped>
:deep(.formkit-form) {
  --fk-color-primary: #ffe923;
  --fk-color-primary-contrast: #311906;
}

.group:hover .absolute {
  transform: translateX(1px);
}

:deep(.formkit-input:focus) {
  box-shadow: 0 0 0 3px rgba(255, 233, 35, 0.1);
}
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\views\dashboard\ConfiguracionView.vue
============================================================
<template>
    <div>
        <h2 class="font-bold text-center">contenido de configuracion</h2>
    </div>
</template>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\views\dashboard\DashboardView.vue
============================================================
<template>
  <div class="dashboard-view p-6">
    <h1 class="text-3xl font-bold text-gray-900 mb-6">
      Dashboard Principal
    </h1>

    <p class="text-lg text-gray-600 mb-8">
      Resumen del estado general de la plataforma y los NNA.
    </p>

    <MetricCardGrid 
      :metricas="metricasData"
      :loading="metricasLoading"
      :error="metricasError"
      @refresh="recargarMetricas"
    />
    
    </div>
</template>

<script setup lang="ts">
import { onMounted } from 'vue'
import MetricCardGrid from '@/components/ninos/SubComponentes/metricasCard/MetricCardGrid.vue'
import { useMetricas } from '@/composables/useMetricas'

// âœ… LÃ³gica de mÃ©tricas AÃ‘ADIDA
const { 
  metricas: metricasData, 
  loading: metricasLoading, 
  error: metricasError, 
  cargarMetricas, 
  recargarMetricas 
} = useMetricas()

// âœ… Cargar las mÃ©tricas al montar este componente
onMounted(() => {
  cargarMetricas()
})
</script>

<style scoped>
/* Puedes agregar estilos especÃ­ficos para tu dashboard si lo necesitas */
.dashboard-view {
  max-width: 1200px;
  margin: 0 auto;
}
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\views\dashboard\DocumentarSesionView.vue
============================================================
<template>
  <div class="documentacion-vista bg-gray-50 min-h-screen">
    <!-- 1. Cabecera de la Vista - CORREGIDO: Pasando todas las props -->
    <CabeceraDocumentacion
      v-if="sessionData"
      :child-name="sessionData.child_name || 'NiÃ±o'"
      :session-number="sessionData.session_number"
      :child-rut="sessionData.child_rut"
      :guardian-name="sessionData.guardian_name"
      :entry-date="sessionData.entry_date"
      :total-sessions="sessionData.total_sessions"
      @volver="navegarAlPerfil"
    />

    <!-- Estado de Carga -->
    <div v-if="isLoading" class="loading-state">
      <svg class="animate-spin h-8 w-8 text-blue-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
      </svg>
      <p class="text-gray-600 mt-4">Cargando datos de la sesiÃ³n...</p>
    </div>

    <!-- Contenido Principal del Formulario -->
    <main v-if="!isLoading && sessionData" class="p-4 sm:p-6 lg:p-8 max-w-7xl mx-auto">
      <FormKit
        type="form"
        v-model="sessionData"
        @submit="handleGuardarInforme"
        :actions="false"
        #default="{ value }"
      >
        <!-- Layout de 2 Columnas -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
          
          <!-- Columna Principal (Izquierda) -->
          <div class="lg:col-span-2 flex flex-col gap-8">
            <!-- âœ… CORRECCIÃ“N: Se pasan ambos props necesarios al componente hijo -->
            <GestionObjetivosSesion :child-id="childId" :session-id="sessionId" />
            <SeccionNotasClinicas />
            <SeccionIntervenciones />
            <SeccionPlanificacionFutura />
          </div>

          <!-- Columna Lateral (Derecha) -->
          <div class="lg:col-span-1">
            <div class="sticky top-24">
              <SeccionEstadoAsistencia />
            </div>
          </div>
        </div>

        <!-- Acciones del Formulario (Guardar / Cancelar) -->
        <div class="mt-12 pt-6 border-t border-gray-200 flex justify-end items-center gap-4">
          <button
            type="button"
            class="px-6 py-2 bg-white border border-gray-300 rounded-md text-sm font-semibold text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
            @click="navegarAlPerfil"
          >
            Cancelar
          </button>
          <FormKit
            type="submit"
            :label="isSaving ? 'Guardando...' : 'Guardar Informe'"
            :disabled="isSaving"
          />
        </div>
      </FormKit>
    </main>
  </div>
</template>

<script setup lang="ts">
import { ref, onMounted } from 'vue'
import { useRoute, useRouter } from 'vue-router'
import type { FormKitNode } from '@formkit/core'
import { getTherapySessionById, updateTherapySession, type TherapySessionDetail } from '@/services/sessionService'
import { useAlertModalStore } from '@/store/alertModalStore'
import { useAlertStore } from '@/store/alertStore'

// Importar los componentes de secciÃ³n
import CabeceraDocumentacion from '@/components/sesiones/documentacion-sesion/CabeceraDocumentacion.vue'
import SeccionEstadoAsistencia from '@/components/sesiones/documentacion-sesion/SeccionEstadoAsistencia.vue'
import SeccionNotasClinicas from '@/components/sesiones/documentacion-sesion/SeccionNotasClinicas.vue'
import SeccionIntervenciones from '@/components/sesiones/documentacion-sesion/SeccionIntervenciones.vue'
import SeccionPlanificacionFutura from '@/components/sesiones/documentacion-sesion/SeccionPlanificacionFutura.vue'
import GestionObjetivosSesion from '@/components/sesiones/documentacion-sesion/GestionObjetivosSesion.vue'

const route = useRoute()
const router = useRouter()
const alertModal = useAlertModalStore()
const alert = useAlertStore()

const childId = Number(route.params.childId)
const sessionId = Number(route.params.sessionId)

// CORREGIDO: Usar el tipo especÃ­fico TherapySessionDetail
const sessionData = ref<TherapySessionDetail | null>(null)
const isLoading = ref(true)
const isSaving = ref(false)

// DEBUG: Log para verificar que el componente padre se monta
onMounted(() => {
  console.log('ğŸ  Componente padre DocumentacionSesion.vue - MONTADO')
  console.log('ğŸ”— ParÃ¡metros de ruta:', { childId, sessionId })
  
  if (!childId || !sessionId) {
    console.error('âŒ Error: childId o sessionId no vÃ¡lidos')
    alertModal.error('Error', 'No se ha proporcionado un ID de niÃ±o o sesiÃ³n vÃ¡lido en la URL.')
    router.push({ name: 'dashboard' })
    return
  }
  cargarDatosSesion()
})

async function cargarDatosSesion() {
  console.log('ğŸ”„ Iniciando carga de datos de sesiÃ³n...')
  isLoading.value = true
  try {
    console.log(`ğŸ“¡ Llamando a getTherapySessionById(${childId}, ${sessionId})`)
    const data = await getTherapySessionById(childId, sessionId)
    console.log('âœ… Datos recibidos del backend:', data)
    
    sessionData.value = data
    // âŒ ELIMINADO: No sobrescribir child_name con valor fijo
    // sessionData.value.child_name = "Nombre del NiÃ±o" // <- ESTO CAUSABA EL PROBLEMA
    
    console.log('ğŸ“¦ sessionData despuÃ©s de asignar:', sessionData.value)
  } catch (error) {
    console.error("âŒ Error al cargar la sesiÃ³n:", error)
    alertModal.error('Error de Carga', 'No se pudieron cargar los datos de la sesiÃ³n.')
  } finally {
    isLoading.value = false
    console.log('ğŸ Carga de datos completada, isLoading:', false)
  }
}

async function handleGuardarInforme(formData: any, node: FormKitNode) {
  console.log('ğŸ’¾ Iniciando guardado de informe...', formData)
  isSaving.value = true
  try {
    // Excluir campos que no son parte del modelo TherapySession base
    const { child_name, child_rut, guardian_name, entry_date, total_sessions, ...payload } = formData
    console.log('ğŸ“¤ Payload para actualizar:', payload)
    
    await updateTherapySession(childId, sessionId, payload)
    
    console.log('âœ… Informe guardado exitosamente')
    alert.success('Informe Guardado', 'La documentaciÃ³n de la sesiÃ³n se ha guardado correctamente.')
    alertModal.success('Informe Guardado', 'La documentaciÃ³n de la sesiÃ³n se ha guardado correctamente.')
    
    navegarAlPerfil()
  } catch (error: any) {
    console.error("âŒ Error al guardar el informe:", error)
    if (error.response && error.response.status === 400) {
      console.error('ğŸ“‹ Errores de validaciÃ³n:', error.response.data)
      node.setErrors(error.response.data)
    } else {
      alertModal.error('Error al Guardar', 'OcurriÃ³ un problema al intentar guardar el informe.')
      alert.error('Error al Guardar', 'OcurriÃ³ un problema al intentar guardar el informe.')
    }
  } finally {
    isSaving.value = false
    console.log('ğŸ Guardado completado, isSaving:', false)
  }
}

function navegarAlPerfil() {
  console.log('ğŸ”™ Navegando al perfil del niÃ±o...')
  if (childId) {
    router.push({ name: 'perfil-nino', params: { id: childId } })
  } else {
    router.push({ name: 'dashboard' })
  }
}
</script>

<style scoped>
.loading-state {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  padding: 4rem;
  min-height: 50vh;
}
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\views\dashboard\EstablecimientosView.vue
============================================================
<template>
    <div>
        <h2 class="font-bold text-center">contenido dashboard</h2>
    </div>
</template>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\views\dashboard\HistosView.vue
============================================================


<template>
    <div>
        <h2 class="font-bold text-center">contenido dashboard</h2>
    </div>
</template>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\views\dashboard\IngresoNneDashboard.vue
============================================================
<template>
  <div class="p-6">
    <div class="header-section">
      <h1 class="text-2xl font-bold mb-6">GestiÃ³n de NNA</h1>
      
      <button
        @click="openNnaModal"
        class="bg-color3 hover:bg-color4 text-white px-4 py-2 rounded transition-colors duration-200"
      >
        Agregar Nuevo NNA
      </button>
    </div>

    <TablaFiltro 
      :data="nnaList" 
      :loading="cargando" 
      @view="manejarView" 
      @edit="manejarEdit" 
      @delete="manejarDelete"
    />

    <BaseModal 
      v-if="showNnaModal"
      v-model:show="showNnaModal"
      title="Registro de Nuevo NNA"
      size="xl"
      @close="handleModalClose"
    >
      <div class="nna-form-container">
        <NneMultiStepForm
          :editData="editingNnaData"
          @submit="handleNnaSubmit"
          @cancel="handleNnaCancel"
        />
      </div>

      <template #footer>
        <div class="modal-footer-content">
          <div class="footer-info">
            <p class="text-sm text-gray-600">
              Complete todos los pasos para registrar el nuevo NNA en el sistema.
            </p>
          </div>
          <div class="footer-actions">
            <button
              @click="handleNnaCancel"
              class="px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors"
            >
              Cancelar
            </button>
          </div>
        </div>
      </template>
    </BaseModal>

    <BaseModal
      v-if="showSuccessModal"
      v-model:show="showSuccessModal"
      title="Â¡Registro Exitoso!"
      size="md"
      @close="closeSuccessModal"
    >
      <div class="success-content">
         </div>
      <template #footer>
        </template>
    </BaseModal>
  </div>
</template>

<script setup lang="ts">
import { ref, onMounted, defineAsyncComponent } from 'vue'
import BaseModal from '@/components/modal/BaseModal.vue'
import TablaFiltro from '@/components/ninos/TablaFiltro.vue'
import filtroService, { transformNnaListForTable } from '@/services/filtroService'
// âŒ import MetricCardGrid from '@/components/ninos/SubComponentes/metricasCard/MetricCardGrid.vue'
// âŒ import { useMetricas } from '@/composables/useMetricas'
import { useAlertModalStore } from '@/store/alertModalStore'

// âœ… IMPORTAR EL SERVICIO DE NNE
import { createNneApi } from '@/services/nneService'
import { parseApiError, getUserFriendlyErrorMessage } from '@/exceptions/apiError'

// Alert modal store
const alertModal = useAlertModalStore()

// âŒ Estado de mÃ©tricas ELIMINADO
// const { ... } = useMetricas()

// Estado principal
const nnaList = ref<any[]>([])
const cargando = ref(false)
const showNnaModal = ref(false)
const showSuccessModal = ref(false)
const editingNnaData = ref<any>(undefined)
const isSubmitting = ref(false)

// ... (estado de successMessage y createdChildInfo sin cambios) ...
const successMessage = ref({
  title: 'NNA registrado correctamente',
  body: 'El registro se ha completado exitosamente y estÃ¡ disponible en el sistema.'
})
const createdChildInfo = ref<any>(null)

// ... (estado de paginaciÃ³n y filtros sin cambios) ...
const pagination = ref({
  count: 0,
  total_pages: 0,
  current_page: 1,
  page_size: 10,
  has_next: false,
  has_previous: false
})
const selectedFilters = ref({
  search: '',
  grade: '',
  status: '',
  commune: '',
  region: '',
  autism_level: '',
  school_journey: ''
})

// ... (ImportaciÃ³n asÃ­ncrona de NneMultiStepForm sin cambios) ...
const NneMultiStepForm = defineAsyncComponent(() =>
  import('@/components/forms/multi-step/NneMultiStepForm.vue')
)

// Cargar datos al montar el componente
onMounted(async () => {
  await cargarNnaList()
})

// FunciÃ³n para cargar datos del backend (sin cambios)
const cargarNnaList = async (page = 1) => {
  try {
    cargando.value = true
    console.log('ğŸ”„ Cargando lista de NNA desde el backend...')

    const response = await filtroService.getNnaListApi({
      page,
      page_size: pagination.value.page_size,
      ...selectedFilters.value
    })

    nnaList.value = transformNnaListForTable(response.results)
    pagination.value = response.pagination

    console.log(`âœ… ${nnaList.value.length} NNA cargados en pÃ¡gina ${pagination.value.current_page}`)
  } catch (error) {
    console.error('âŒ Error al cargar lista de NNA:', error)
    alertModal.error(
      'Error al cargar datos',
      'No se pudo cargar la lista de NNA. Por favor, intente nuevamente.'
    )
  } finally {
    cargando.value = false
  }
}

// âœ… CORREGIDO: handleNnaSubmit AHORA NO RECARGA MÃ‰TRICAS
const handleNnaSubmit = async (formData: any) => {
  console.log('ğŸ“¥ ========== HANDLER SUBMIT RECIBIDO ==========')
  // ... (logs de datos) ...
  
  try {
    isSubmitting.value = true
    
    console.log('ğŸš€ Llamando a createNneApi...')
    const response = await createNneApi(formData)
    
    console.log('âœ… ========== RESPUESTA DEL BACKEND ==========')
    // ... (logs de respuesta) ...
    
    const responseData = response.data || response
    
    // ... (actualizar successMessage y createdChildInfo sin cambios) ...
    createdChildInfo.value = responseData
    successMessage.value = {
      title: 'Â¡Registro Exitoso!',
      body: `La ficha de ${responseData.nombre} ha sido creada correctamente.`
    }
    
    // âŒ Recargar solo la lista, NO las mÃ©tricas
    await cargarNnaList(pagination.value.current_page)
    
    // ... (resto de la funciÃ³n: cerrar modal, mostrar Ã©xito, etc. sin cambios) ...
    showNnaModal.value = false
    showSuccessModal.value = true
    
    setTimeout(() => {
      editingNnaData.value = undefined
    }, 300)
    
    alertModal.success(
      'Â¡Ã‰xito!',
      `La ficha de ${responseData.nombre} ha sido creada correctamente.`
    )
    
  } catch (error: any) {
    // ... (manejo de errores sin cambios) ...
    console.error('âŒ ========== ERROR AL CREAR NNA ==========')
    const parsedError = parseApiError(error)
    const errorMessage = getUserFriendlyErrorMessage(parsedError)
    alertModal.error(
      'Error al registrar NNA',
      errorMessage || 'No se pudo registrar el NNA. Por favor, verifique los datos e intente nuevamente.'
    )
    
  } finally {
    isSubmitting.value = false
    console.log('ğŸ ========== FIN HANDLER SUBMIT ==========')
  }
}

// ... (resto de funciones: openNnaModal, editNna, handleModalClose, handleNnaCancel, closeSuccessModal, addAnotherNna, manejarView, manejarEdit, manejarDelete, recargarDatos, defineExpose ... SIN CAMBIOS) ...
// FunciÃ³n para abrir el modal de nuevo NNA
const openNnaModal = () => {
  editingNnaData.value = undefined
  createdChildInfo.value = null
  showNnaModal.value = true
}

// FunciÃ³n para abrir modal en modo ediciÃ³n
const editNna = (nnaData: any) => {
  editingNnaData.value = nnaData
  showNnaModal.value = true
}

// Manejar cierre del modal
const handleModalClose = () => {
  showNnaModal.value = false
  setTimeout(() => {
    editingNnaData.value = undefined
  }, 300)
}

// Manejar cancelaciÃ³n desde el formulario
const handleNnaCancel = () => {
  handleModalClose()
}

// Cerrar modal de Ã©xito
const closeSuccessModal = () => {
  showSuccessModal.value = false
  createdChildInfo.value = null
}

// Agregar otro NNA despuÃ©s del Ã©xito
const addAnotherNna = () => {
  showSuccessModal.value = false
  createdChildInfo.value = null
  setTimeout(() => {
    openNnaModal()
  }, 100)
}

// Manejadores para la tabla
const manejarView = (nna: any) => {
  console.log('ğŸ‘ï¸ Ver NNA:', nna)
}

const manejarEdit = (nna: any) => {
  console.log('âœï¸ Editar NNA:', nna)
  editNna(nna)
}

const manejarDelete = (nna: any) => {
  console.log('ğŸ—‘ï¸ Eliminar NNA:', nna)
  if (confirm(`Â¿EstÃ¡s seguro de eliminar a ${nna.first_name} ${nna.last_name}?`)) {
    // AquÃ­ deberÃ­as llamar al endpoint real de borrado
    nnaList.value = nnaList.value.filter(item => item.id !== nna.id)
  }
}

// FunciÃ³n para recargar datos
const recargarDatos = async () => {
  await cargarNnaList(pagination.value.current_page)
}

// Exponer funciones para uso en el template
defineExpose({
  openNnaModal,
  editNna,
  recargarDatos
})
</script>

<style scoped>
/* ... (todos tus estilos <style scoped> se mantienen igual) ... */
.header-section {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 2rem;
}

.nna-form-container {
  min-height: 600px;
  max-height: 80vh;
  overflow-y: auto;
}

.modal-footer-content {
  display: flex;
  justify-content: space-between;
  align-items: center;
  width: 100%;
}

.footer-info {
  flex: 1;
}

.footer-actions {
  display: flex;
  gap: 0.5rem;
}

.success-content {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 2rem 0;
}

.success-icon {
  margin-bottom: 1rem;
}

.success-text {
  text-align: center;
  width: 100%;
}

/* Responsive design */
@media (max-width: 768px) {
  .header-section {
    flex-direction: column;
    align-items: flex-start;
    gap: 1rem;
  }
  
  .modal-footer-content {
    flex-direction: column;
    gap: 1rem;
    text-align: center;
  }
  
  .nna-form-container {
    min-height: 500px;
    max-height: 70vh;
  }
}

/* Animaciones */
:deep(.modal-container) {
  animation: modalSlideIn 0.3s ease-out;
}

@keyframes modalSlideIn {
  from {
    opacity: 0;
    transform: translateY(-50px) scale(0.95);
  }
  to {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

/* Estilos para botones */
button:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

button:not(:disabled):hover {
  transform: translateY(-1px);
}

.transition-colors {
  transition: all 0.2s ease;
}
</style>

<style>
/* ... (todos tus estilos <style> globales se mantienen igual) ... */
.modal-overlay {
  backdrop-filter: blur(4px);
}

.bg-color3 {
  background-color: #3b82f6;
}

.bg-color4 {
  background-color: #2563eb;
}
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\views\dashboard\padres\ConfiguracionView.vue
============================================================

============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\views\dashboard\padres\DashboardView.vue
============================================================
<!-- src/views/dashboard/padres/DashboardView.vue -->
<template>
  <div class="space-y-6">
    
    <!-- LOADING -->
    <div v-if="isLoading" class="flex items-center justify-center py-12">
      <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-sky-500"></div>
      <p class="ml-4 text-gray-600">Cargando informaciÃ³n...</p>
    </div>
    
    <!-- SIN HIJOS -->
    <div v-else-if="!currentChild" class="bg-yellow-50 border border-yellow-200 rounded-xl p-6">
      <div class="flex items-start gap-4">
        <div class="text-4xl">âš ï¸</div>
        <div>
          <h3 class="text-lg font-semibold text-yellow-900">No tienes hijos registrados</h3>
          <p class="text-sm text-yellow-700 mt-1">
            Por favor contacta al administrador para registrar a tu hijo en el sistema.
          </p>
        </div>
      </div>
    </div>
    
    <!-- CON HIJO -->
    <div v-else class="bg-white rounded-xl shadow-soft p-6">
      <div class="flex items-start gap-6">
        
        <!-- FOTO DE PERFIL CON BOTÃ“N -->
        <div class="relative group" :key="photoKey">
          <!-- Avatar -->
          <div class="w-32 h-32 rounded-full overflow-hidden ring-4 ring-sky-100 shadow-md">
            <img
              v-if="childPhotoUrl"
              :src="childPhotoUrl"
              :alt="`Foto de ${childName}`"
              class="w-full h-full object-cover"
              @error="handleImageError"
            />
            <div
              v-else
              :class="[
                'w-full h-full flex items-center justify-center',
                'bg-gradient-to-br from-sky-400 to-blue-500 text-white',
                'text-4xl font-bold'
              ]"
            >
              {{ childInitials }}
            </div>
          </div>

          <!-- Overlay con botÃ³n (visible en hover) -->
          <div
            class="absolute inset-0 rounded-full bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity duration-200 flex items-center justify-center"
          >
            <PhotoUploadButton
              variant="icon"
              size="md"
              :loading="false"
              @click="openPhotoModal"
            />
          </div>
        </div>

        <!-- INFO DEL HIJO -->
        <div class="flex-1">
          <div class="flex items-start justify-between">
            <div>
              <h1 class="text-3xl font-bold text-gray-900">
                ğŸ‘‹ Â¡Bienvenido/a, {{ parentName }}!
              </h1>
              <div class="mt-2 space-y-1">
                <p class="text-xl font-semibold text-gray-700">
                  {{ childName }}
                </p>
                <p class="text-sm text-gray-500">
                  {{ childAge }} aÃ±os
                </p>
              </div>
            </div>

            <!-- BotÃ³n cambiar foto (visible siempre en desktop) -->
            <PhotoUploadButton
              variant="secondary"
              size="sm"
              label="Cambiar foto"
              class="hidden md:flex"
              @click="openPhotoModal"
            />
          </div>

          <!-- Estado actual -->
          <div class="mt-4 flex items-center gap-4">
            <div class="flex items-center gap-2">
              <span class="text-2xl">ğŸ’š</span>
              <span class="text-sm font-medium text-gray-700">
                Estado hoy: <span class="text-green-600">Tranquilo</span>
              </span>
            </div>
            <div class="flex items-center gap-2">
              <span class="text-2xl">ğŸ˜Š</span>
              <span class="text-sm font-medium text-gray-700">
                Ãnimo: <span class="text-blue-600">Contento</span>
              </span>
            </div>
          </div>

          <!-- PrÃ³xima sesiÃ³n -->
          <div class="mt-4 p-3 bg-sky-50 border border-sky-200 rounded-lg">
            <p class="text-sm font-medium text-sky-900">
              ğŸ¥ PrÃ³xima sesiÃ³n: <span class="font-bold">MaÃ±ana 10:00 AM</span>
            </p>
          </div>
        </div>
      </div>

      <!-- Mensaje del terapeuta -->
      <SessionUltimaNotificacion />


        <!-- finMensaje del terapeuta -->
    
    </div>

    <!-- RESTO DEL DASHBOARD -->
    <div v-if="currentChild" class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <!-- AquÃ­ puedes agregar mÃ¡s secciones -->
      <div class="bg-white rounded-xl shadow-soft p-6">
        <h3 class="text-lg font-semibold text-gray-900 mb-4">PrÃ³ximas actividades</h3>
        <p class="text-sm text-gray-600">No hay actividades programadas.</p>
      </div>
    </div>

  </div>

  <!-- MODAL DE SUBIDA DE FOTO -->
  <PhotoUploadModal
    v-if="currentChild"
    v-model:visible="showPhotoModal"
    :child-id="childId"
    :child-name="childName"
    :current-photo-url="childPhotoUrl"
    @success="handlePhotoSuccess"
  />
</template>

<script setup lang="ts">
import { ref, onMounted, computed } from 'vue'
import PhotoUploadButton from '@/components/common/PhotoUploadButton.vue'
import PhotoUploadModal from '@/components/dashboard/padres/PhotoUploadModal.vue'
import { useAuth } from '@/composables/useAuth'
import { useAlertStore } from '@/store/alertStore'
import { childService, type ChildInfo } from '@/services/childService'
import SessionUltimaNotificacion from '@/components/dashboard/padres/sesiones/SessionUltimaNotificacion.vue'

const { user } = useAuth()
const alert = useAlertStore()

// Estado
const showPhotoModal = ref(false)
const children = ref<ChildInfo[]>([])
const selectedChild = ref<ChildInfo | null>(null)
const isLoading = ref(true)
const photoKey = ref(0)  // ğŸ”¥ AGREGAR: Key para forzar re-render

// Datos del padre
const parentName = computed(() => {
  if (!user.value) return 'Usuario'
  const userName = user.value.name || user.value.username || 'Usuario'
  return userName.split(' ')[0]
})

// Datos del hijo seleccionado
const currentChild = computed(() => selectedChild.value || children.value[0] || null)

const childId = computed(() => currentChild.value?.id || 0)
const childName = computed(() => currentChild.value?.nombre_completo || 'Sin nombre')
const childAge = computed(() => currentChild.value?.edad || 0)

// URL de la foto con timestamp para evitar cachÃ©
const childPhotoUrl = computed(() => {
  const url = currentChild.value?.photo_url
  if (!url) return null
  
  // Construir URL absoluta
  let fullUrl = url
  if (!url.startsWith('http')) {
    const baseURL = import.meta.env.VITE_API_BASE_URL || 'http://127.0.0.1:8000'
    fullUrl = `${baseURL.replace('/api', '')}${url}`
  }
  
  // ğŸ”¥ AGREGAR: Timestamp para evitar cachÃ© del navegador
  const timestamp = Date.now()
  return `${fullUrl}?t=${timestamp}`
})

const childInitials = computed(() => {
  if (!currentChild.value) return '?'
  const parts = currentChild.value.nombre_completo.split(' ')
  return parts.map(p => p[0]).join('').slice(0, 2).toUpperCase()
})

// MÃ©todos
const fetchChildren = async () => {
  try {
    isLoading.value = true
    console.log('[DashboardView] ğŸ” Obteniendo hijos...')
    
    const response = await childService.getMyChildren()
    
    children.value = response.children
    
    console.log('[DashboardView] âœ… Hijos cargados:', response.count)
    
    if (children.value.length > 0) {
      selectedChild.value = children.value[0]
      console.log('[DashboardView] ğŸ‘¤ Hijo seleccionado:', selectedChild.value.nombre_completo)
      console.log('[DashboardView] ğŸ“· Foto URL:', childPhotoUrl.value)
    } else {
      console.warn('[DashboardView] âš ï¸ No hay hijos registrados')
      alert.info(
        'No tienes hijos registrados',
        'Por favor contacta al administrador para registrar a tu hijo.'
      )
    }
  } catch (error: any) {
    console.error('[DashboardView] âŒ Error cargando hijos:', error)
    alert.error(
      'Error',
      'No se pudieron cargar los datos de tu hijo. Intenta recargar la pÃ¡gina.'
    )
  } finally {
    isLoading.value = false
  }
}

const openPhotoModal = () => {
  if (!currentChild.value) {
    alert.warning(
      'Sin hijo seleccionado',
      'No se puede subir foto sin un hijo asociado.'
    )
    return
  }
  
  console.log('[DashboardView] ğŸ“¸ Abriendo modal de foto')
  showPhotoModal.value = true
}

const handlePhotoSuccess = (photoUrl: string) => {
  console.log('[DashboardView] âœ… Foto actualizada:', photoUrl)
  
  // ğŸ”¥ MÃ‰TODO 1: Actualizar el objeto completo (forzar reactividad)
  if (currentChild.value) {
    const updatedChild = {
      ...currentChild.value,
      photo_url: photoUrl,
      has_photo: true
    }
    
    // Actualizar en el array de children
    const index = children.value.findIndex(c => c.id === currentChild.value!.id)
    if (index !== -1) {
      children.value[index] = updatedChild
    }
    
    // Actualizar selectedChild
    selectedChild.value = updatedChild
    
    // ğŸ”¥ MÃ‰TODO 2: Incrementar key para forzar re-render
    photoKey.value++
    
    console.log('[DashboardView] ğŸ”„ Foto actualizada en estado local, key:', photoKey.value)
  }
  
  showPhotoModal.value = false
}

// ğŸ”¥ AGREGAR: Handler para errores de carga de imagen
const handleImageError = (event: Event) => {
  console.error('[DashboardView] âŒ Error cargando imagen:', event)
  // Opcional: Mostrar placeholder o reintentar
}

// Lifecycle
onMounted(() => {
  console.log('[DashboardView] ğŸš€ Montando dashboard')
  fetchChildren()
})
</script>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\views\dashboard\padres\HijoDetalleView.vue
============================================================
<template>
    <h2>detalles del hijo</h2>
</template>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\views\dashboard\padres\MedicacionView.vue
============================================================

============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\views\dashboard\padres\MensajesView.vue
============================================================

============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\views\dashboard\padres\MisHijosView.vue
============================================================

============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\views\dashboard\padres\RegistroDiarioView.vue
============================================================

============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\views\dashboard\padres\ReportesView.vue
============================================================

============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\views\dashboard\padres\RutinasView.vue
============================================================

============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\views\dashboard\PerfilSeguimientoPersonal.vue
============================================================
<template>
  <div class="perfil-seguimiento">
    <PerfilHeader
      :nna-data="headerData"
      @ver-dashboard="verDashboard"
      @exportar-datos="exportarDatos"
    />

    <div class="tabs-container">
      <nav class="tabs-nav">
        <button
          v-for="tab in tabs"
          :key="tab.id"
          :class="['tab-button', { active: activeTab === tab.id }]"
          @click="activeTab = tab.id"
        >
          <component :is="tab.icon" class="icon-sm" />
          {{ tab.label }}
        </button>
      </nav>

      <TabContent
        :active-tab="activeTab"
        :profile-data="profileData"
        :child-id="childId"
        :loading="loading"
        :contactos="contactos"
        :diagnosticos="diagnosticosList"
        :historial-count="historialCount"
        :medicamentos-count="medicamentosCount"
        :loading-sesiones="loadingSesiones"
        :sesiones="sesiones"
        :stats-sesiones="statsSesiones"
        :periodo="periodo"
        :metricas="metricas"
        :registros-recientes="registrosRecientes"
        :loading-documentos="loadingDocumentos"
        :documentos="documentos"
        :stats-documentos="statsDocumentos"
        :interest-update-key="interestUpdateKey"
        @gestionar-contactos="gestionarContactos"
        @ver-historial-completo="verHistorialCompleto"
        @cargar-sesiones="cargarSesiones"
        @abrir-modal-sesion="abrirModalSesion"
        @ver-detalle-sesion="verDetalleSesion"
        @editar-sesion="editarSesion"
        @update:periodo="(value) => (periodo = value)"
        @cargar-hitos-desarrollo="cargarHitosDesarrollo"
        @cargar-progresos-comunicacion="cargarProgresosComunicacion"
        @cargar-habilidades-sociales="cargarHabilidadesSociales"
        @cargar-documentos="cargarDocumentos"
        @subir-documento="subirDocumento"
        @descargar-documento="descargarDocumento"
        @ver-documento="verDocumento"
        @eliminar-documento="eliminarDocumento"
        @generar-reporte-completo="generarReporteCompleto"
        @comparar-progreso="compararProgreso"
        @exportar-datos="exportarDatos"
        @ver-dashboard="verDashboard"
        @generar-reporte-sesiones="generarReporteSesiones"
        @generar-reporte-progreso="generarReporteProgreso"
        @generar-reporte-comportamiento="generarReporteComportamiento"
        @generar-reporte-medico="generarReporteMedico"
        @add-diagnosis="abrirModalDiagnostico"
        @gestionar-intereses="abrirModalIntereses"
      />
    </div>

    <NuevaSession
      v-if="childId"
      v-model:show="showModalSesion"
      :child-id="parseInt(childId)"
      @sesionCreada="handleSesionCreada"
    />

    <DiagnosticoModal
      v-if="childId && showDiagnosticoModal"
      v-model:show="showDiagnosticoModal"
      :child-id="parseInt(childId)"
      @diagnosis-created="handleDiagnosticoCreado"
    />

    <InteresModal
      v-if="childId && showInteresModal"
      v-model:show="showInteresModal"
      :child-id="parseInt(childId)"
      @interest-created="handleInteresCreado"
    />
  </div>
</template>

<script setup lang="ts">
import { profileService } from '@/services/profileService'
import { ref, onMounted, watch, computed } from 'vue'
import { useRoute } from 'vue-router'

import PerfilHeader from '@/components/profile/header/PerfilHeader.vue'
import TabContent from '@/components/profile/tabcontent/TabContent.vue'
import NuevaSession from '@/components/forms/sesiones/NuevaSession.vue'
import DiagnosticoModal from '@/components/profile/profile/modals/DiagnosticoModal.vue'
import InteresModal from '@/components/profile/profile/modals/InteresModal.vue'

import {
  getTherapySessionsForChild,
  getTherapyMetricsForChild,
  getDiagnosesForChild,
  type Diagnosis,
  type TherapySession,
  type TherapyMetrics
} from '@/services/sessionService'

import {
  UserCircleIcon,
  ChatBubbleLeftRightIcon,
  ChartBarIcon,
  FolderIcon,
  DocumentChartBarIcon
} from '@heroicons/vue/24/outline'

const route = useRoute()
const childId = ref<string>(route.params.id as string)

const profileData = ref<any>(null)
const loading = ref(false)
const activeTab = ref('general')

const sesiones = ref<TherapySession[]>([])
const loadingSesiones = ref(false)
const showModalSesion = ref(false)
const statsSesiones = ref({ total: 0, completadas: 0, pendientes: 0, objetivos: 0 })

const diagnosticosList = ref<Diagnosis[]>([])
const showDiagnosticoModal = ref(false)
const loadingDiagnosticos = ref(false)

const showInteresModal = ref(false)
const interestUpdateKey = ref(0)

const periodo = ref('30d')
const documentos = ref<any[]>([])
const loadingDocumentos = ref(false)
const metricas = ref({ hitos_desarrollo: 0, progresos_comunicacion: 0, habilidades_sociales: 0 })
const statsDocumentos = ref({ total: 0, imagenes: 0, videos: 0, reportes: 0 })
const registrosRecientes = ref([])

const headerData = computed(() => profileData.value?.header || null)
const contactos = computed(() => profileData.value?.emergencyContacts || [])
const historialCount = computed(() => 0)
const medicamentosCount = computed(() => {
  return profileData.value?.cards?.medical?.has_medication ? 1 : 0
})

const tabs = ref([
  { id: 'general', label: 'InformaciÃ³n General', icon: UserCircleIcon },
  { id: 'sesiones', label: 'Sesiones de Terapia', icon: ChatBubbleLeftRightIcon },
  { id: 'progreso', label: 'Progreso y MÃ©tricas', icon: ChartBarIcon },
  { id: 'documentos', label: 'Documentos', icon: FolderIcon },
  { id: 'reportes', label: 'Reportes', icon: DocumentChartBarIcon }
])

onMounted(async () => {
  if (!childId.value) return

  loading.value = true
  loadingSesiones.value = true
  loadingDiagnosticos.value = true

  await Promise.all([
    cargarDatosNino(),
    cargarSesiones(),
    cargarMetricasSesiones(),
    cargarDiagnosticos()
  ])

  loading.value = false
})

watch(
  () => route.params.id,
  (newId) => {
    childId.value = newId as string
    if (childId.value) {
      cargarDatosNino()
      cargarSesiones()
      cargarMetricasSesiones()
      cargarDiagnosticos()
      interestUpdateKey.value++
    }
  }
)

const cargarDatosNino = async () => {
  if (!childId.value) return
  loading.value = true
  try {
    console.log(`ğŸ”„ Cargando perfil del niÃ±o ID: ${childId.value}`)
    const data = await profileService.getChildProfile(childId.value)
    profileData.value = data
    console.log('âœ… Datos completos cargados:', profileData.value)
  } catch (error) {
    console.error('âŒ Error cargando perfil:', error)
  } finally {
    loading.value = false
  }
}

const cargarSesiones = async () => {
  if (!childId.value) return
  loadingSesiones.value = true
  try {
    console.log(`â³ Cargando sesiones para el niÃ±o ID: ${childId.value}...`)
    const data = await getTherapySessionsForChild(parseInt(childId.value))
    sesiones.value = data
    console.log(`âœ… ${data.length} sesiones cargadas.`)
  } catch (error) {
    console.error('âŒ Error cargando sesiones:', error)
    sesiones.value = []
  } finally {
    loadingSesiones.value = false
  }
}

const cargarMetricasSesiones = async () => {
  if (!childId.value) return
  try {
    console.log(`â³ Cargando mÃ©tricas de sesiones para el niÃ±o ID: ${childId.value}...`)
    const metrics: TherapyMetrics = await getTherapyMetricsForChild(parseInt(childId.value))
    statsSesiones.value = {
      total: metrics.sessions_count,
      completadas: metrics.completed_sessions,
      pendientes: metrics.upcoming_sessions,
      objetivos: metrics.goals_count
    }
    console.log('âœ… MÃ©tricas de sesiones cargadas:', statsSesiones.value)
  } catch (error) {
    console.error('âŒ Error cargando mÃ©tricas de sesiones:', error)
    statsSesiones.value = { total: 0, completadas: 0, pendientes: 0, objetivos: 0 }
  }
}

const cargarDiagnosticos = async () => {
  if (!childId.value) return
  loadingDiagnosticos.value = true
  try {
    console.log(`â³ Cargando diagnÃ³sticos para el niÃ±o ID: ${childId.value}...`)
    const data = await getDiagnosesForChild(parseInt(childId.value))
    diagnosticosList.value = data
    console.log(`âœ… ${data.length} diagnÃ³sticos cargados.`)
  } catch (error) {
    console.error('âŒ Error al cargar diagnÃ³sticos:', error)
    diagnosticosList.value = []
  } finally {
    loadingDiagnosticos.value = false
  }
}

const cargarDocumentos = async () => {
  if (!childId.value) return
  loadingDocumentos.value = true
  try {
    console.log('â³ Cargando documentos...')
    documentos.value = []
  } catch (error) {
    console.error('âŒ Error cargando documentos:', error)
  } finally {
    loadingDocumentos.value = false
  }
}

const gestionarContactos = () => { console.log('ğŸ“ Gestionar contactos') }
const verHistorialCompleto = () => { console.log('ğŸ“‹ Ver historial completo') }

const abrirModalSesion = () => {
  showModalSesion.value = true
}

const abrirModalDiagnostico = () => {
  console.log('â• Abriendo modal para agregar diagnÃ³stico...')
  showDiagnosticoModal.value = true
}

const abrirModalIntereses = () => {
  console.log('âœ¨ Abriendo modal para gestionar intereses...')
  showInteresModal.value = true
}

const handleInteresCreado = () => {
  console.log('ğŸ’¡ InterÃ©s creado/actualizado. Cerrando modal y forzando recarga de tarjeta.')
  showInteresModal.value = false
  interestUpdateKey.value++
}

const handleDiagnosticoCreado = () => {
  console.log('ğŸ©º DiagnÃ³stico creado exitosamente. Recargando lista...')
  showDiagnosticoModal.value = false
  cargarDiagnosticos()
}

const handleSesionCreada = () => {
  console.log('ğŸ‰ SesiÃ³n creada exitosamente, recargando la lista y mÃ©tricas...')
  cargarSesiones()
  cargarMetricasSesiones()
}

const verDetalleSesion = (id: number) => { console.log(`ğŸ‘ï¸ Ver detalle sesiÃ³n ${id}`) }
const editarSesion = (id: number) => { console.log(`âœï¸ Editar sesiÃ³n ${id}`) }
const cargarHitosDesarrollo = () => { console.log('ğŸ“ˆ Cargar hitos de desarrollo') }
const cargarProgresosComunicacion = () => { console.log('ğŸ’¬ Cargar progresos de comunicaciÃ³n') }
const cargarHabilidadesSociales = () => { console.log('ğŸ‘¥ Cargar habilidades sociales') }
const subirDocumento = () => { console.log('ğŸ“¤ Subir documento') }
const descargarDocumento = (id: number) => { console.log(`ğŸ’¾ Descargar documento ${id}`) }
const verDocumento = (id: number) => { console.log(`ğŸ‘ï¸ Ver documento ${id}`) }
const eliminarDocumento = (id: number) => { console.log(`ğŸ—‘ï¸ Eliminar documento ${id}`) }
const exportarDatos = () => { console.log('ğŸ“Š Exportar datos') }
const verDashboard = () => { console.log('ğŸ“Š Ver dashboard') }
const generarReporteCompleto = () => { console.log('ğŸ“„ Generar reporte completo') }
const compararProgreso = () => { console.log('ğŸ“Š Comparar progreso') }
const generarReporteSesiones = () => { console.log('ğŸ“„ Generar reporte de sesiones') }
const generarReporteProgreso = () => { console.log('ğŸ“„ Generar reporte de progreso') }
const generarReporteComportamiento = () => { console.log('ğŸ“„ Generar reporte de comportamiento') }
const generarReporteMedico = () => { console.log('ğŸ“„ Generar reporte mÃ©dico') }
</script>

<style scoped>
.perfil-seguimiento {
  min-height: 100vh;
  background: #f8fafc;
}

.tabs-container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 2rem;
}

.tabs-nav {
  display: flex;
  border-bottom: 1px solid #e2e8f0;
  margin-bottom: 2rem;
  overflow-x: auto;
}

.tab-button {
  padding: 1rem 1.5rem;
  background: none;
  border: none;
  border-bottom: 2px solid transparent;
  cursor: pointer;
  white-space: nowrap;
  font-size: 0.875rem;
  font-weight: 500;
  color: #6b7280;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.tab-button:hover {
  color: #374151;
}

.tab-button.active {
  color: #3b82f6;
  border-bottom-color: #3b82f6;
}

@media (max-width: 768px) {
  .tabs-container {
    padding: 1rem;
  }

  .tabs-nav {
    flex-wrap: wrap;
  }

  .tab-button {
    flex: 1;
    min-width: 120px;
    text-align: center;
    justify-content: center;
  }
}
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\views\dashboard\perfil_nino\AutonomiaView.vue
============================================================
<template>
  <div class="autonomia-view">

    <div v-if="isLoading" class="flex justify-center items-center py-20">
      <svg class="animate-spin h-8 w-8 text-blue-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
      </svg>
      <p class="text-gray-600 ml-4">Cargando datos de autonomÃ­a...</p>
    </div>

    <form v-else @submit.prevent="handleSubmit">
      <h2 class="text-2xl font-semibold text-gray-800 mb-6">
        Seguimiento de Habilidades de AutonomÃ­a
      </h2>
      
      <div class="space-y-6">
        
        <div 
          v-for="skill in skillsData" 
          :key="skill.id" 
          class="bg-white p-6 rounded-lg shadow-sm border border-gray-200"
        >
          <h3 class="text-lg font-medium text-gray-900 mb-4">{{ skill.name }}</h3>

          <fieldset>
            <legend class="sr-only">Nivel de Apoyo para {{ skill.name }}</legend>
            <div class="flex flex-wrap gap-3">
              <label 
                v-for="level in supportLevels" 
                :key="level.value"
                :for="`skill-${skill.id}-${level.value}`"
                class="relative flex items-center justify-center rounded-md border py-3 px-4 text-sm font-medium cursor-pointer focus:outline-none transition-all duration-150 ease-in-out"
                :class="{
                  'bg-blue-600 border-blue-600 text-white shadow-md': skill.currentLevel === level.value,
                  'bg-white border-gray-300 text-gray-900 hover:bg-gray-50': skill.currentLevel !== level.value
                }"
              >
                <input 
                  type="radio"
                  :id="`skill-${skill.id}-${level.value}`"
                  :name="`skill-level-${skill.id}`"
                  :value="level.value"
                  v-model="skill.currentLevel"
                  class="sr-only"
                  :aria-labelledby="`skill-label-${skill.id}-${level.value}`"
                >
                <span :id="`skill-label-${skill.id}-${level.value}`">{{ level.label }}</span>
              </label>
            </div>
          </fieldset>

          <div class="mt-5">
            <label :for="`notes-${skill.id}`" class="block text-sm font-medium text-gray-700 mb-2">
              Notas RÃ¡pidas (Opcional)
            </label>
            <textarea
              :id="`notes-${skill.id}`"
              v-model="skill.notes"
              rows="2"
              class="w-full max-w-lg px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
              placeholder="Ej: LogrÃ³ ponerse los calcetines solo, pero necesitÃ³ apoyo verbal para la cremallera."
            ></textarea>
          </div>
        </div>
        
      </div>

      <div class="mt-8 pt-6 border-t border-gray-200 text-right">
        <button
          type="submit"
          :disabled="isSubmitting"
          class="inline-flex items-center justify-center px-6 py-3 border border-transparent rounded-md shadow-sm text-base font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed"
        >
          <svg v-if="isSubmitting" class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
          {{ isSubmitting ? 'Guardando...' : 'Guardar Progreso de AutonomÃ­a' }}
        </button>
      </div>
    </form>

  </div>
</template>

<script setup lang="ts">
import { ref, onMounted } from 'vue'
import { useNinoActivoStore } from '@/store/ninoActivoStore'
import { useAlertModalStore } from '@/store/alertModalStore' // Para notificaciones

// --- TIPOS Y ESTRUCTURAS DE DATOS ---

// DefiniciÃ³n de la escala de apoyo (ideal para ML)
interface SupportLevel {
  value: number;
  label: string;
}

// DefiniciÃ³n de la habilidad de autonomÃ­a
interface AutonomySkill {
  id: string; // ID Ãºnico de la habilidad (ej: 'higiene_manos')
  name: string; // Nombre legible (ej: 'Higiene: Lavado de Manos')
  currentLevel: number | null; // Valor actual de la escala (ej: 3)
  notes: string; // Contexto cualitativo
}

// --- CONSTANTES ---

// Define la escala de mediciÃ³n.
// Esta escala es la clave para la ciencia de datos.
const supportLevels: SupportLevel[] = [
  { value: 1, label: 'Apoyo FÃ­sico Total' },
  { value: 2, label: 'Apoyo FÃ­sico Parcial' },
  { value: 3, label: 'Apoyo Verbal / Gestual' },
  { value: 4, label: 'SupervisiÃ³n' },
  { value: 5, label: 'Independiente' },
]

// --- ESTADO ---

const isLoading = ref(true)
const isSubmitting = ref(false)
const skillsData = ref<AutonomySkill[]>([])

// Stores
const ninoStore = useNinoActivoStore()
const alertModal = useAlertModalStore()

// --- CICLO DE VIDA ---

onMounted(() => {
  fetchAutonomyData()
})

// --- MÃ‰TODOS ---

/**
 * Simula la carga de datos de autonomÃ­a del niÃ±o desde el backend.
 */
async function fetchAutonomyData() {
  isLoading.value = true
  const childId = ninoStore.ninoId
  
  if (!childId) {
    alertModal.error('Error', 'No se pudo identificar al niÃ±o activo.')
    isLoading.value = false
    return
  }

  console.log(`Buscando datos de autonomÃ­a para el niÃ±o ID: ${childId}...`)
  
  // --- INICIO DE SIMULACIÃ“N DE API ---
  // Reemplaza esto con tu llamada real:
  // const response = await api.get(`/ninos/${childId}/autonomia`)
  // skillsData.value = response.data
  
  await new Promise(resolve => setTimeout(resolve, 800)) // Simula espera
  
  // Datos de ejemplo (el backend deberÃ­a devolver esto)
  const mockData: AutonomySkill[] = [
    {
      id: 'autonomia_1',
      name: 'AlimentaciÃ³n: Uso de Cubiertos (cuchara/tenedor)',
      currentLevel: 2, // Apoyo FÃ­sico Parcial
      notes: 'Requiere guÃ­a en la mano para pinchar la comida.',
    },
    {
      id: 'autonomia_2',
      name: 'Vestimenta: Ponerse y quitarse la chaqueta',
      currentLevel: 3, // Apoyo Verbal
      notes: 'Necesita recordatorio verbal para iniciar y ayuda con la cremallera.',
    },
    {
      id: 'autonomia_3',
      name: 'Higiene: Lavado de Manos',
      currentLevel: 4, // SupervisiÃ³n
      notes: 'Lo hace solo, pero hay que supervisar que use jabÃ³n.',
    },
    {
      id: 'autonomia_4',
      name: 'Control de EsfÃ­nteres: Avisar para ir al baÃ±o',
      currentLevel: 5, // Independiente
      notes: 'Avisa consistentemente sin accidentes.',
    },
  ]
  
  skillsData.value = mockData
  // --- FIN DE SIMULACIÃ“N DE API ---
  
  isLoading.value = false
}

/**
 * Simula el envÃ­o de los datos actualizados al backend.
 */
async function handleSubmit() {
  isSubmitting.value = true
  const childId = ninoStore.ninoId
  
  console.log(`Guardando datos de autonomÃ­a para el niÃ±o ID: ${childId}:`, skillsData.value)

  // --- INICIO DE SIMULACIÃ“N DE API ---
  // Reemplaza esto con tu llamada real:
  // try {
  //   await api.post(`/ninos/${childId}/autonomia`, { skills: skillsData.value })
  //   alertModal.success('Ã‰xito', 'El progreso de autonomÃ­a ha sido guardado.')
  // } catch (error) {
  //   alertModal.error('Error', 'No se pudo guardar el progreso.')
  // }
  
  await new Promise(resolve => setTimeout(resolve, 1000)) // Simula espera
  
  alertModal.success('Progreso Guardado', 'Los datos de autonomÃ­a se actualizaron correctamente.')
  // --- FIN DE SIMULACIÃ“N DE API ---

  isSubmitting.value = false
}
</script>

<style scoped>
/* PequeÃ±o truco para asegurar que el label estilizado
  muestre el anillo de foco cuando el input (sr-only) lo reciba.
*/
input[type="radio"]:focus-visible + label {
  outline: 2px solid theme('colors.blue.500');
  outline-offset: 2px;
}
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\views\dashboard\perfil_nino\CognitivoView.vue
============================================================
<template>
  <div class="space-y-6 animate-fade-in">
    <!-- ğŸ“Œ HEADER DE LA VISTA -->
    <div class="bg-white rounded-2xl shadow-soft border border-gray-100 p-6">
      <div class="flex items-center gap-4">
        <div class="w-12 h-12 bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl flex items-center justify-center shadow-md">
          <AcademicCapIcon class="w-7 h-7 text-white" />
        </div>
        <div>
          <h2 class="text-2xl font-bold text-gray-900">
            Dominio Cognitivo
          </h2>
          <p class="text-sm text-gray-500 mt-1">
            Seguimiento de hitos, logros y desafÃ­os en el Ã¡rea cognitiva de {{ childName }}
          </p>
        </div>
      </div>
    </div>

    <!-- ğŸ“Š SECCIÃ“N: HITOS COGNITIVOS -->
    <section>
      <!-- Header con acciones -->
      <div class="flex items-center justify-between mb-4">
        <div class="flex items-center gap-3">
          <h3 class="text-xl font-semibold text-gray-800">Hitos Cognitivos Registrados</h3>
          <span 
            v-if="!isLoading && cognitiveMilestones.length > 0"
            class="px-3 py-1 text-xs font-semibold bg-purple-100 text-purple-800 rounded-full"
          >
            {{ cognitiveMilestones.length }}
          </span>
        </div>

        <!-- BotÃ³n para agregar nuevo hito (futuro) -->
        <button
          v-if="!isLoading && cognitiveMilestones.length > 0"
          class="btn-secondary-sm"
          @click="handleAddMilestone"
          title="Agregar nuevo hito"
        >
          <PlusIcon class="w-4 h-4 mr-1.5" />
          Agregar Hito
        </button>
      </div>

      <!-- ğŸ”„ LOADING STATE -->
      <div v-if="isLoading" class="bg-white rounded-2xl shadow-soft p-12">
        <LoadingState message="Cargando hitos cognitivos..." />
      </div>
      
      <!-- ğŸ“­ EMPTY STATE -->
      <EmptyState
        v-else-if="!isLoading && cognitiveMilestones.length === 0"
        icon="AcademicCapIcon"
        title="Sin Hitos Cognitivos"
        message="AÃºn no se han registrado hitos en la categorÃ­a 'Cognitivo' para este niÃ±o."
      >
        <template #actions>
          <button 
            @click="handleAddMilestone"
            class="btn-primary mt-4"
          >
            <PlusIcon class="w-5 h-5 mr-2" />
            Registrar Primer Hito
          </button>
        </template>
      </EmptyState>

      <!-- ğŸ“‹ GRID DE HITOS -->
      <div v-else class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div 
          v-for="hito in cognitiveMilestones" 
          :key="hito.id"
          class="bg-white rounded-2xl shadow-soft border border-gray-100 p-5 transition-all duration-300 hover:shadow-medium hover:border-purple-200 group"
        >
          <!-- Header del hito con edad -->
          <div class="flex items-start justify-between mb-3">
            <div class="flex-1">
              <p class="font-semibold text-gray-900 leading-snug group-hover:text-purple-700 transition-colors">
                {{ hito.description }}
              </p>
              
              <!-- Badge de edad al logro -->
              <div 
                v-if="hito.age_at_milestone" 
                class="inline-block mt-2 px-2 py-1 bg-purple-50 text-purple-700 text-xs font-medium rounded-md"
              >
                <svg class="w-3 h-3 inline-block mr-1 -mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                {{ hito.age_at_milestone }}
              </div>
            </div>

            <!-- MenÃº de acciones (futuro) -->
            <button 
              class="text-gray-400 hover:text-gray-600 p-1 rounded-lg hover:bg-gray-100 transition-colors"
              @click="handleEditMilestone(hito)"
              title="Editar hito"
            >
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z" />
              </svg>
            </button>
          </div>
          
          <!-- Fecha del hito -->
          <p class="text-sm text-purple-600 font-medium my-3 flex items-center">
            <CalendarDaysIcon class="w-4 h-4 mr-1.5" />
            {{ formatHitoDate(hito.date) }}
          </p>
          
          <!-- Detalles del hito -->
          <div class="space-y-2.5">
            <!-- Nivel de dominio -->
            <div class="flex items-center text-sm text-gray-700">
              <div class="flex-shrink-0 w-8 h-8 rounded-lg bg-success-100 flex items-center justify-center mr-3">
                <CheckBadgeIcon class="w-5 h-5 text-success-600" />
              </div>
              <div>
                <span class="font-medium text-gray-500">Nivel:</span>
                <span class="ml-1.5 text-gray-900">{{ hito.proficiency_level_display }}</span>
              </div>
            </div>

            <!-- Contexto -->
            <div class="flex items-center text-sm text-gray-700">
              <div class="flex-shrink-0 w-8 h-8 rounded-lg bg-blue-100 flex items-center justify-center mr-3">
                <MapPinIcon class="w-5 h-5 text-blue-600" />
              </div>
              <div>
                <span class="font-medium text-gray-500">Contexto:</span>
                <span class="ml-1.5 text-gray-900">{{ hito.context_display }}</span>
              </div>
            </div>

            <!-- Apoyo requerido -->
            <div class="flex items-center text-sm text-gray-700">
              <div class="flex-shrink-0 w-8 h-8 rounded-lg bg-yellow-100 flex items-center justify-center mr-3">
                <UserGroupIcon class="w-5 h-5 text-yellow-600" />
              </div>
              <div>
                <span class="font-medium text-gray-500">Apoyo:</span>
                <span class="ml-1.5 text-gray-900">{{ hito.support_level_display }}</span>
              </div>
            </div>

            <!-- Impacto funcional (si existe) -->
            <div 
              v-if="hito.functional_impact"
              class="flex items-center text-sm text-gray-700"
            >
              <div class="flex-shrink-0 w-8 h-8 rounded-lg bg-indigo-100 flex items-center justify-center mr-3">
                <svg class="w-5 h-5 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                </svg>
              </div>
              <div>
                <span class="font-medium text-gray-500">Impacto:</span>
                <span class="ml-1.5 text-gray-900">{{ hito.functional_impact }}</span>
              </div>
            </div>
          </div>
          
          <!-- Observaciones adicionales -->
          <div v-if="hito.observations" class="mt-4 pt-4 border-t border-gray-200">
            <div class="flex items-start gap-2">
              <svg class="w-4 h-4 text-gray-400 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z" />
              </svg>
              <p class="text-xs text-gray-600 italic leading-relaxed">{{ hito.observations }}</p>
            </div>
          </div>

          <!-- Footer con metadata -->
          <div 
            v-if="hito.registered_by_name || hito.previous_records_count > 0"
            class="mt-4 pt-3 border-t border-gray-100 flex items-center justify-between text-xs text-gray-500"
          >
            <span v-if="hito.registered_by_name" class="flex items-center gap-1">
              <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
              </svg>
              {{ hito.registered_by_name }}
            </span>
            
            <span 
              v-if="hito.previous_records_count > 0"
              class="px-2 py-0.5 bg-gray-100 text-gray-600 rounded-full"
              :title="`Este hito tiene ${hito.previous_records_count} registros previos`"
            >
              {{ hito.previous_records_count }} registro{{ hito.previous_records_count === 1 ? '' : 's' }} previo{{ hito.previous_records_count === 1 ? '' : 's' }}
            </span>
          </div>
        </div>
      </div>
    </section>

    <!-- ğŸ“Š INFO CARD (Opcional - EstadÃ­sticas rÃ¡pidas) -->
    <div 
      v-if="!isLoading && cognitiveMilestones.length > 0"
      class="bg-gradient-to-br from-purple-50 to-blue-50 border border-purple-200 rounded-xl p-4 flex gap-3"
    >
      <svg class="w-5 h-5 text-purple-600 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
      </svg>
      <div class="flex-1">
        <h4 class="text-sm font-semibold text-purple-900 mb-1">Progreso Cognitivo</h4>
        <p class="text-sm text-purple-800">
          Se han registrado <strong>{{ cognitiveMilestones.length }}</strong> hito{{ cognitiveMilestones.length === 1 ? '' : 's' }} 
          en el desarrollo cognitivo. ContinÃºa monitoreando el progreso para identificar fortalezas y Ã¡reas de mejora.
        </p>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
/**
 * CognitivoView.vue
 * 
 * PropÃ³sito:
 * Panel de visualizaciÃ³n centralizado para toda la informaciÃ³n relacionada 
 * con el desarrollo cognitivo de un niÃ±o especÃ­fico.
 * 
 * CaracterÃ­sticas:
 * - Carga hitos de desarrollo de categorÃ­a 'cognitive' desde el backend
 * - Usa componentes compartidos (LoadingState, EmptyState)
 * - Integrado con notificationStore para feedback
 * - DiseÃ±o responsivo con Tailwind CSS
 * - Animaciones suaves con las clases personalizadas del proyecto
 */

// === IMPORTS ===
import { ref, onMounted, watch, computed } from 'vue'
import { format, parseISO } from 'date-fns'
import { es } from 'date-fns/locale'

// Componentes compartidos
import LoadingState from '@/components/gestion/rutinas/shared/LoadingState.vue'
import EmptyState from '@/components/gestion/rutinas/shared/EmptyState.vue'

// Iconos
import { 
  CheckBadgeIcon, 
  MapPinIcon, 
  UserGroupIcon, 
  CalendarDaysIcon, 
  AcademicCapIcon,
  PlusIcon
} from '@heroicons/vue/24/outline'

// Services y Stores
import http from '@/services/http'
import { parseApiError } from '@/exceptions/apiError'
import { useNotificationStore } from '@/store/notificationStore'
import { useNinoActivoStore } from '@/store/ninoActivoStore'

// === INTERFACES ===
interface DevelopmentMilestone {
  id: number
  child: number
  date: string
  age_at_milestone?: string
  category: string
  category_display: string
  description: string
  observations?: string
  proficiency_level: string
  proficiency_level_display: string
  context: string
  context_display: string
  support_level: string
  support_level_display: string
  functional_impact?: string
  previous_records_count: number
  registered_by: number
  registered_by_name?: string
  created_at: string
}

// === PROPS ===
const props = defineProps<{
  id: string // ID del niÃ±o desde la ruta
}>()

// === STORES ===
const ninoStore = useNinoActivoStore()
const notificationStore = useNotificationStore()

// === STATE ===
const cognitiveMilestones = ref<DevelopmentMilestone[]>([])
const isLoading = ref(true)

// === COMPUTED ===
const childId = computed(() => Number(props.id))
const childName = computed(() => ninoStore.nombreNino || 'el niÃ±o')

// === METHODS ===

/**
 * Carga los hitos de desarrollo cognitivo desde el backend
 */
async function fetchCognitiveMilestones() {
  if (!childId.value) return

  isLoading.value = true
  try {
    const response = await http.get(`/seguimiento/ninos/${childId.value}/hitos-desarrollo/`, {
      params: {
        category: 'cognitive' // Filtro por categorÃ­a cognitiva
      }
    })
    
    cognitiveMilestones.value = response.data
    
    console.log(`âœ… ${cognitiveMilestones.value.length} hitos cognitivos cargados`)
    
  } catch (error: any) {
    const apiError = parseApiError(error)
    
    notificationStore.error(
      apiError.message,
      'âŒ Error al Cargar Hitos'
    )
    
    console.error('Error fetching cognitive milestones:', apiError)
  } finally {
    isLoading.value = false
  }
}

/**
 * Formatea la fecha del hito en espaÃ±ol
 */
function formatHitoDate(dateStr: string): string {
  try {
    return format(parseISO(dateStr), "d 'de' MMMM 'de' yyyy", { locale: es })
  } catch {
    return dateStr
  }
}

/**
 * Handler para agregar nuevo hito (placeholder)
 */
function handleAddMilestone() {
  notificationStore.info(
    'Esta funcionalidad estarÃ¡ disponible prÃ³ximamente',
    'â„¹ï¸ PrÃ³ximamente',
    3000
  )
}

/**
 * Handler para editar hito existente (placeholder)
 */
function handleEditMilestone(hito: DevelopmentMilestone) {
  notificationStore.info(
    `EdiciÃ³n de "${hito.description}" prÃ³ximamente`,
    'â„¹ï¸ PrÃ³ximamente',
    3000
  )
}

// === LIFECYCLE HOOKS ===

onMounted(() => {
  fetchCognitiveMilestones()
})

watch(childId, (newId) => {
  if (newId) {
    fetchCognitiveMilestones()
  }
})
</script>

<style scoped>
/* Botones personalizados */
.btn-primary {
  @apply inline-flex items-center px-4 py-2 bg-purple-600 text-white font-semibold rounded-lg shadow-sm hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 transition-all duration-200 transform hover:scale-105 active:scale-95;
}

.btn-secondary-sm {
  @apply inline-flex items-center px-3 py-1.5 border border-gray-300 rounded-md shadow-sm text-xs font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 transition-all duration-200;
}

/* Animaciones personalizadas ya definidas en tailwind.config.js */
/* .animate-fade-in estÃ¡ disponible globalmente */
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\views\dashboard\perfil_nino\ComunicacionView.vue
============================================================

============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\views\dashboard\perfil_nino\DetonantesCrisisView.vue
============================================================

============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\views\dashboard\perfil_nino\HabilidadesSocialesView.vue
============================================================

============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\views\dashboard\perfil_nino\HitosLogrosView.vue
============================================================
<template>
  <div class="hitos-logros-view max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="mb-8">
      <h2 class="text-3xl font-bold text-gray-900">Registro de Hitos del Desarrollo</h2>
      <p class="mt-2 text-sm text-gray-600">
        Documenta los logros y avances del desarrollo del niÃ±o
      </p>
    </div>

    <div v-if="isLoading" class="flex justify-center items-center py-20">
      <svg
        class="animate-spin h-8 w-8 text-primary-500 mr-3"
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
      >
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" />
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" />
      </svg>
      <p class="text-gray-600 font-medium">Cargando...</p>
    </div>

    <FormKit
      v-else
      type="form"
      id="hitoForm"
      :actions="false"
      @submit="handleSubmit"
      v-model="formData" :incomplete-message="false"
      #default="{ state: { valid } }"
    >
      <div class="bg-white rounded-xl shadow-soft border border-gray-200 overflow-hidden">
        <section>
          <div class="px-6 py-5 border-b border-gray-200 bg-gray-50">
            <h3 class="text-lg font-semibold text-gray-900 flex items-center">
              <svg class="w-5 h-5 mr-2 text-primary-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
              {{ editingMilestoneId ? 'Editar Hito' : 'Nuevo Hito: InformaciÃ³n BÃ¡sica' }}
            </h3>
          </div>

          <div class="px-6 py-6 space-y-6">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
              <FormKit
                type="date"
                name="date"
                label="Fecha de ObservaciÃ³n"
                validation="required"
                :validation-messages="{ required: 'La fecha es requerida' }"
              />
              <FormKit
                type="select"
                name="category"
                label="CategorÃ­a"
                placeholder="Seleccione una categorÃ­a..."
                validation="required"
                :validation-messages="{ required: 'La categorÃ­a es requerida' }"
                :options="categoryOptions"
              />
            </div>

            <FormKit
              type="textarea"
              name="description"
              label="DescripciÃ³n del Hito/Habilidad"
              validation="required|length:10"
              :validation-messages="{
                required: 'La descripciÃ³n es requerida',
                length: 'Debe tener al menos 10 caracteres'
              }"
              placeholder="Describe especÃ­ficamente quÃ© logrÃ³ el niÃ±o..."
              :rows="4"
            />

            <FormKit
              type="textarea"
              name="observations"
              label="Observaciones Adicionales"
              placeholder="Notas sobre el contexto, facilitadores, dificultades..."
              :rows="3"
            />
          </div>
        </section>

        <section>
          <div class="px-6 py-5 border-t border-b border-gray-200 bg-gray-50">
            <h3 class="text-lg font-semibold text-gray-900 flex items-center">
              <svg class="w-5 h-5 mr-2 text-primary-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                   <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
              EvaluaciÃ³n del Hito
            </h3>
          </div>

          <div class="px-6 py-6 space-y-6">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
              <FormKit
                type="select"
                name="proficiency_level"
                label="Nivel de Dominio"
                validation="required"
                :validation-messages="{ required: 'Campo requerido' }"
                :options="proficiencyOptions"
              />
              <FormKit
                type="select"
                name="context"
                label="Contexto Observado"
                validation="required"
                :validation-messages="{ required: 'Campo requerido' }"
                :options="contextOptions"
              />
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
              <FormKit
                type="select"
                name="support_level"
                label="Nivel de Apoyo Necesario"
                validation="required"
                 :validation-messages="{ required: 'Campo requerido' }"
                :options="supportOptions"
              />
              <FormKit
                type="text"
                name="functional_impact"
                label="Impacto Funcional"
                placeholder="Ej: Le permite comer solo, participar en juegos..."
              />
            </div>
          </div>
        </section>

        <div class="px-6 py-5 bg-gray-50 border-t border-gray-200 flex justify-between items-center">
          <p class="text-sm text-gray-500">
            <span class="text-red-500 font-medium">*</span> Campos requeridos
          </p>
          <div class="flex items-center space-x-3">
            <button
              v-if="editingMilestoneId"
              type="button"
              @click="cancelEdit"
              class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors"
            >
              Cancelar EdiciÃ³n
            </button>
            <button
              type="submit"
              :disabled="isSubmitting || !valid"
              class="inline-flex items-center justify-center px-6 py-3 border border-transparent rounded-lg shadow-sm text-base font-semibold text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200"
            >
              <svg v-if="isSubmitting" class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" />
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" />
              </svg>
              <svg v-else class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                 <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
              </svg>
              {{ buttonText }}
            </button>
          </div>
        </div>
      </div>
    </FormKit>

    <section class="mt-12">
      <div class="flex justify-between items-center mb-6">
         <div>
            <h3 class="text-2xl font-bold text-gray-900">Historial de Hitos</h3>
            <p class="mt-1 text-sm text-gray-600">
                Registro cronolÃ³gico de logros y avances
            </p>
         </div>
         <button @click="loadMilestones()" :disabled="isLoadingHistory" class="inline-flex items-center px-4 py-2 text-sm font-medium text-primary-700 bg-primary-50 hover:bg-primary-100 border border-primary-200 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
            <svg :class="['w-4 h-4 mr-2', { 'animate-spin': isLoadingHistory }]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
            </svg>
           {{ isLoadingHistory ? 'Cargando...' : 'Refrescar' }}
         </button>
      </div>

      <MilestoneHistoryList
        :milestones="milestones"
        :is-loading="isLoadingHistory"
        @edit="handleEdit"
        @delete="handleDeleteRequest"
      />
    </section>

     <ConfirmModal
        v-if="showConfirmDeleteModal"
        :show="showConfirmDeleteModal"
        @update:show="(value) => { if (!value) cancelDelete() }"
        title="Confirmar EliminaciÃ³n"
        message="Â¿EstÃ¡s seguro de que deseas eliminar este hito? Esta acciÃ³n no se puede deshacer."
        confirm-text="SÃ­, Eliminar"
        cancel-text="Cancelar"
        type="warning"
        @confirm="confirmDelete"
        @close="cancelDelete"
      />

  </div>
</template>

<script setup lang="ts">
import { ref, reactive, onMounted, computed, watch } from 'vue';
import { useNinoActivoStore } from '@/store/ninoActivoStore';
import { useAlertModalStore } from '@/store/alertModalStore'; // Store para notificaciones (Ã©xito/error)
import MilestoneHistoryList from '@/components/gestion/hitosLogros/MilestoneHistoryList.vue';
import ConfirmModal from '@/components/ui/ConfirmModal.vue'; // âœ… IMPORTAR ConfirmModal
import { reset } from '@formkit/core'; // Importar funciÃ³n reset de FormKit

// --- Importar Servicio e Interfaces ---
import { hitosService } from '@/services/hitosService'; // âœ… Servicio API
import type { Milestone, MilestoneFormData } from '@/type/hitoServiceInterface'; // âœ… Tipos

// --- Stores ---
const ninoStore = useNinoActivoStore();
const alertModal = useAlertModalStore(); // Para mensajes de Ã©xito/error post-acciÃ³n

// --- Estado del Componente ---
const isLoading = ref(true); // Carga inicial
const isSubmitting = ref(false); // EnvÃ­o de formulario
const isLoadingHistory = ref(false); // Carga de historial
const milestones = ref<Milestone[]>([]); // Lista de hitos
const editingMilestoneId = ref<number | string | null>(null); // ID del hito en ediciÃ³n
// --- âœ… Estado para ConfirmModal ---
const showConfirmDeleteModal = ref(false); // Controla visibilidad del modal ConfirmModal
const milestoneToDeleteId = ref<number | string | null>(null); // Guarda ID a eliminar

// --- Datos del Formulario ---
const initialFormData: MilestoneFormData = {
  date: new Date().toISOString().split('T')[0],
  category: '',
  description: '',
  observations: '',
  proficiency_level: 'emerging',
  context: 'therapy',
  support_level: 'verbal_cue',
  functional_impact: '',
};
// âœ… *** CAMBIO: formData ahora es un ref() para que v-model funcione correctamente ***
// v-model en un <FormKit type="form"> funciona mejor con ref() para actualizaciones programÃ¡ticas
const formData = ref<MilestoneFormData>({ ...initialFormData });

// --- Opciones para los Selects ---
const categoryOptions = [
  { label: 'ğŸ“¢ ComunicaciÃ³n', value: 'communication' },
  { label: 'ğŸ‘¥ Social', value: 'social' },
  { label: 'ğŸ“š AcadÃ©mico', value: 'academic' },
  { label: 'ğŸƒ Motor', value: 'motor' },
  { label: 'ğŸ§  Cognitivo', value: 'cognitive' },
  { label: 'ğŸ’ Emocional', value: 'emotional' },
  { label: 'âš•ï¸ TerapÃ©utico', value: 'therapeutic' }
];
const proficiencyOptions = [
  { label: 'ğŸŒ± Emergente - Con mucho apoyo', value: 'emerging' },
  { label: 'ğŸŒ¿ En desarrollo - Con apoyo moderado', value: 'developing' },
  { label: 'ğŸŒ³ Competente - MÃ­nimo apoyo', value: 'proficient' },
  { label: 'â­ Dominado - Independiente', value: 'mastered' }
];
const contextOptions = [
  { label: 'ğŸ¥ En terapia', value: 'therapy' },
  { label: 'ğŸ  En casa', value: 'home' },
  { label: 'ğŸ« En escuela', value: 'school' },
  { label: 'ğŸŒ En comunidad', value: 'community' },
  { label: 'ğŸ”„ MÃºltiples contextos', value: 'multiple' }
];
const supportOptions = [
  { label: 'âœ… Independiente', value: 'independent' },
  { label: 'ğŸ’¬ IndicaciÃ³n verbal', value: 'verbal_cue' },
  { label: 'ğŸ‘ï¸ Apoyo visual', value: 'visual_cue' },
  { label: 'ğŸ¤ Ayuda fÃ­sica', value: 'physical_prompt' },
  { label: 'ğŸ†˜ Asistencia total', value: 'full_assistance' }
];

// --- Propiedades Computadas ---
const buttonText = computed(() => {
  if (isSubmitting.value) {
    return editingMilestoneId.value ? 'Actualizando...' : 'Guardando...';
  }
  return editingMilestoneId.value ? 'Actualizar Hito' : 'Guardar Hito';
});

// --- Ciclo de Vida ---
onMounted(async () => {
  if (!ninoStore.ninoId) {
      const unwatch = watch(() => ninoStore.ninoId, async (newId) => {
          if (newId) {
              await initializeComponent(newId);
              unwatch();
          }
      }, { immediate: true });
  } else {
      await initializeComponent(ninoStore.ninoId);
  }
});

async function initializeComponent(childId: string | number) {
    isLoading.value = true;
    await loadMilestones(childId);
    isLoading.value = false;
}

// --- Funciones de InteracciÃ³n con API ---

async function loadMilestones(childId: string | number | null = ninoStore.ninoId) {
  if (!childId) {
    console.warn("loadMilestones: No se proporcionÃ³ ID de niÃ±o.");
    milestones.value = [];
    return;
  }
  isLoadingHistory.value = true;
  console.log(`ğŸ”„ Cargando hitos para niÃ±o ${childId}...`);
  try {
    milestones.value = await hitosService.getMilestones(childId);
    console.log(`âœ… ${milestones.value.length} hitos cargados.`);
  } catch (error) {
    console.error("Error cargando historial:", error);
    alertModal.error('Error de Carga', 'No se pudo cargar el historial de hitos.');
    milestones.value = [];
  } finally {
    isLoadingHistory.value = false;
  }
}

// Maneja el evento @submit del formulario FormKit
async function handleSubmit(submittedData: MilestoneFormData) {
  // `submittedData` es el valor actual del formulario, que es el mismo que `formData.value`
  if (!ninoStore.ninoId) {
    alertModal.warning('Error', 'ID de niÃ±o no encontrado.');
    return;
  }

  isSubmitting.value = true;
  const childId = ninoStore.ninoId;

  const payload: MilestoneFormData = {
      ...submittedData,
      observations: submittedData.observations?.trim() || null,
      functional_impact: submittedData.functional_impact?.trim() || null,
  };
  console.log(`ğŸ’¾ Enviando hito (Editando ID: ${editingMilestoneId.value}):`, payload);

  try {
    let savedMilestone: Milestone;
    if (editingMilestoneId.value) { // --- ACTUALIZAR ---
      console.log(`â¬†ï¸ Actualizando hito ID ${editingMilestoneId.value}`);
      savedMilestone = await hitosService.updateMilestone(childId, editingMilestoneId.value, payload);
      alertModal.success('Hito Actualizado', 'Cambios guardados correctamente.');
      const index = milestones.value.findIndex(m => m.id === editingMilestoneId.value);
      if (index !== -1) milestones.value[index] = savedMilestone;
      else await loadMilestones(childId);
      milestones.value.sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());
      console.log(`âœ… Hito ${savedMilestone.id} actualizado.`);
    } else { // --- CREAR ---
      console.log(`â• Creando nuevo hito...`);
      savedMilestone = await hitosService.createMilestone(childId, payload);
      alertModal.success('Hito Guardado', 'Nuevo hito registrado.');
      milestones.value.unshift(savedMilestone);
      milestones.value.sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());
      console.log(`âœ… Nuevo hito ${savedMilestone.id} creado.`);
    }
    resetForm();

  } catch (error: any) { // --- MANEJO DE ERRORES ---
    console.error("Error guardando hito:", error);
    let errorMessage = editingMilestoneId.value ? 'Error al actualizar.' : 'Error al guardar.';
    if (error.response?.data) {
        const errors = error.response.data;
        const fieldErrors = Object.entries(errors)
            .map(([field, messages]) => `${field}: ${(Array.isArray(messages) ? messages.join(', ') : messages)}`)
            .join('; ');
        if (fieldErrors) errorMessage = `Error de validaciÃ³n: ${fieldErrors}`;
        else if (typeof errors === 'string') errorMessage = errors;
        else if (errors.detail) errorMessage = errors.detail;
    }
    alertModal.error('Error', errorMessage);
  } finally {
    isSubmitting.value = false;
  }
}

// --- Funciones para Borrado (usando ConfirmModal.vue) ---

function handleDeleteRequest(milestoneId: number | string) {
  console.log(`â“ Solicitud de borrado para hito ID: ${milestoneId}. Mostrando ConfirmModal.`);
  milestoneToDeleteId.value = milestoneId;
  showConfirmDeleteModal.value = true; // âœ… Activa el modal
}

async function confirmDelete() {
  if (!ninoStore.ninoId || milestoneToDeleteId.value === null) {
      console.warn("confirmDelete: Faltan IDs necesarios.");
      showConfirmDeleteModal.value = false;
      milestoneToDeleteId.value = null;
      return;
  }
  const childId = ninoStore.ninoId;
  const idToDelete = milestoneToDeleteId.value;

  showConfirmDeleteModal.value = false;
  console.log(`ğŸ—‘ï¸ Ejecutando borrado para hito ${idToDelete} del niÃ±o ${childId}...`);

  try {
    await hitosService.deleteMilestone(childId, idToDelete);
    alertModal.success('Hito Eliminado', 'El hito se eliminÃ³ correctamente.');
    milestones.value = milestones.value.filter(m => m.id !== idToDelete);
     console.log(`âœ… Hito ${idToDelete} eliminado localmente.`);
  } catch (error) {
    console.error("Error durante eliminaciÃ³n de hito:", error);
    alertModal.error('Error al Eliminar', 'No se pudo eliminar el hito.');
  } finally {
    milestoneToDeleteId.value = null;
  }
}

function cancelDelete() {
  console.log("Borrado cancelado por el usuario.");
  showConfirmDeleteModal.value = false;
  milestoneToDeleteId.value = null;
}


// --- Funciones de UI y Formulario ---

function handleEdit(milestoneToEdit: Milestone) {
  console.log(`âœï¸ Solicitud de ediciÃ³n para hito ID: ${milestoneToEdit.id}`);
  const dataToEdit = milestones.value.find(m => m.id === milestoneToEdit.id);
  if (dataToEdit) {
    console.log("Hito encontrado para editar:", dataToEdit);
    
    // âœ… *** CAMBIO: Poblar el ref() formData.value ***
    // Esto actualizarÃ¡ los campos enlazados con v-model
    formData.value = {
        date: dataToEdit.date.includes('T') ? dataToEdit.date.split('T')[0] : dataToEdit.date, // Asegurar YYYY-MM-DD
        category: dataToEdit.category,
        description: dataToEdit.description,
        observations: dataToEdit.observations ?? '', // Convertir null a ''
        proficiency_level: dataToEdit.proficiency_level,
        context: dataToEdit.context,
        support_level: dataToEdit.support_level,
        functional_impact: dataToEdit.functional_impact ?? '' // Convertir null a ''
    };

    editingMilestoneId.value = dataToEdit.id;
    console.log("Formulario poblado para ediciÃ³n:", { ...formData.value });
    window.scrollTo({ top: 0, behavior: 'smooth' });
    alertModal.info('Modo EdiciÃ³n', 'Modifica los campos necesarios y presione "Actualizar Hito".');
  } else {
    console.error(`Hito con ID ${milestoneToEdit.id} no encontrado localmente.`);
    alertModal.error('Error', 'No se encontrÃ³ el hito para editar.');
  }
}

// Resetea el formulario y sale del modo ediciÃ³n
function resetForm() {
  editingMilestoneId.value = null; // Salir modo ediciÃ³n
  // âœ… *** CAMBIO: Usar reset() de FormKit para limpiar Y reasignar el ref() ***
  // Reasignar el ref es crucial para que v-model funcione al resetear
  formData.value = { ...initialFormData };
  // reset('hitoForm') limpia el estado *interno* de FormKit (errores, touched, etc.)
  reset('hitoForm'); 
  console.log("Formulario reseteado.");
}

// Se llama al presionar "Cancelar EdiciÃ³n"
function cancelEdit() {
    console.log("EdiciÃ³n cancelada.");
    resetForm();
}

// --- Funciones Auxiliares (Helpers) ---

function getProficiencyColor(level: string): string {
  const colors: Record<string, string> = {
    emerging: 'bg-yellow-100 text-yellow-800',
    developing: 'bg-blue-100 text-blue-800',
    proficient: 'bg-green-100 text-green-800',
    mastered: 'bg-purple-100 text-purple-800'
  };
  return colors[level] || 'bg-gray-100 text-gray-800';
}

function formatDate(dateString: string | null | undefined): string {
    if (!dateString) return 'Fecha desconocida';
    try {
        return new Date(dateString).toLocaleString('es-CL', {
            year: 'numeric', month: 'short', day: 'numeric',
            hour: '2-digit', minute: '2-digit'
        });
    } catch (e) {
        console.error("Error formateando fecha:", dateString, e);
        return dateString;
    }
}

</script>

<style scoped>
/* Estilos especÃ­ficos del componente */
.input-style, .select-style, .textarea-style {
  @apply block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm;
}
.select-style {
  @apply bg-white;
}
.btn-primary {
  @apply inline-flex items-center justify-center px-6 py-3 border border-transparent rounded-lg shadow-sm text-base font-semibold text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200;
}
.btn-secondary {
   @apply px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors;
}
.shadow-soft {
  box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.05), 0 2px 4px -2px rgb(0 0 0 / 0.05);
}
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\views\dashboard\perfil_nino\PerfilNinoLayout.vue
============================================================
<template>
  <div class="perfil-nino-layout">

    <div v-if="ninoStore.isLoading" class="flex justify-center items-center py-20">
      <svg class="animate-spin h-8 w-8 text-blue-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
      </svg>
      <p class="text-gray-600 ml-4">Cargando perfil del niÃ±o...</p>
    </div>

    <div v-else-if="ninoStore.error" class="bg-red-50 border-l-4 border-red-400 p-4">
      <div class="flex">
        <div class="flex-shrink-0">
          <svg class="h-5 w-5 text-red-400" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v4a1 1 0 102 0V7zm-1 8a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" />
          </svg>
        </div>
        <div class="ml-3">
          <h3 class="text-sm font-medium text-red-800">Error al cargar</h3>
          <p class="text-sm text-red-700 mt-1">{{ ninoStore.error }}</p>
        </div>
      </div>
    </div>

    <div v-else-if="ninoStore.hasData">
      
      <h1 class="text-3xl font-bold text-gray-900 mb-4">
        {{ ninoStore.nombreNino }}
      </h1>

      <nav class="flex flex-wrap space-x-2 sm:space-x-4 border-b border-gray-200 mb-6">
        <router-link
          v-for="tab in tabs"
          :key="tab.name"
          :to="{ name: tab.name, params: { id: props.id } }"
          class="py-3 px-1 text-sm font-medium text-gray-500 hover:text-gray-700 whitespace-nowrap"
          active-class="border-b-2 border-blue-500 text-blue-600"
          exact-active-class="border-b-2 border-blue-500 text-blue-600"
        >
          {{ tab.label }}
        </router-link>
      </nav>

      <router-view />

    </div>
  </div>
</template>

<script setup lang="ts">
import { onMounted, onUnmounted } from 'vue'
import { RouterView, RouterLink } from 'vue-router'
import { useNinoActivoStore } from '@/store/ninoActivoStore'

// 1. Definimos las props que recibe este componente (el :id de la URL)
const props = defineProps<{
  id: string 
}>()

// 2. Inicializamos el store del niÃ±o activo
const ninoStore = useNinoActivoStore()

// 3. Definimos la lista de pestaÃ±as que se mostrarÃ¡n
// Los 'name' deben coincidir EXACTAMENTE con los nombres de las rutas en router/index.ts
const tabs = [
  { name: 'perfil-nino-resumen', label: 'Resumen' }, // Esta es la ruta 'path: ""'
  { name: 'perfil-nino-hitos', label: 'Hitos y Logros' },
  { name: 'perfil-nino-rutinas', label: 'Rutinas' },
  { name: 'perfil-nino-cognitivo', label: 'P. Cognitivo' },
  { name: 'perfil-nino-habilidades', label: 'H. Sociales' }, // AsegÃºrate de que este 'name' coincida con tu router
  { name: 'perfil-nino-sensorial', label: 'Sensorial' },
  { name: 'perfil-nino-comunicacion', label: 'ComunicaciÃ³n' },
  { name: 'perfil-nino-autonomia', label: 'AutonomÃ­a' },
  { name: 'perfil-nino-regulacion', label: 'RegulaciÃ³n' },
  { name: 'perfil-nino-detonantes', label: 'Detonantes' },
  { name: 'perfil-nino-tareas', label: 'Tareas' },
  { name: 'perfil-nino-sesiones', label: 'Sesiones' },
]

// 4. Ciclo de vida: Al montar el componente
onMounted(async () => {
  // Le pedimos al store que cargue los datos usando el ID de la prop
  await ninoStore.fetchNinoActivo(props.id)
})

// 5. Ciclo de vida: Al desmontar el componente (cuando el usuario sale del perfil)
onUnmounted(() => {
  // Limpiamos el store para que no se muestren datos incorrectos
  // la prÃ³xima vez que se entre al perfil de otro niÃ±o.
  ninoStore.limpiarNinoActivo()
})
</script>

<style scoped>
/* Estilo de fallback para active-class.
  'active-class' a veces es quisquilloso con las rutas anidadas,
  este 'router-link-active' es mÃ¡s robusto.
*/
.router-link-active {
  color: #2563eb; /* text-blue-600 */
  border-bottom-width: 2px;
  border-color: #3b82f6; /* border-blue-500 */
}
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\views\dashboard\perfil_nino\RegulacionView.vue
============================================================

============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\views\dashboard\perfil_nino\rutinas\RoutineDetailView.vue
============================================================

============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\views\dashboard\perfil_nino\rutinas\RutinasAgendaView.vue
============================================================
<template>
  <div class="space-y-6 animate-fade-in">

    <div class="flex flex-col sm:flex-row justify-between sm:items-center gap-4">
      <div>
        <h2 class="text-2xl font-bold text-gray-900">
          Agenda de Hoy <span class="text-primary-600">({{ formattedToday }})</span>
        </h2>
        <p class="text-sm text-gray-500 mt-1">
          Rutinas programadas para {{ childName }} hoy.
        </p>
      </div>
      
      <!-- BotÃ³n de recarga manual para debug -->
      <button
        @click="fetchAgenda"
        class="px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors"
      >
        ğŸ”„ Recargar Agenda
      </button>
    </div>

    <!-- Estado de Carga -->
    <div v-if="isLoading" class="flex items-center justify-center py-20 bg-white rounded-2xl shadow-soft">
      <div class="text-center">
        <div class="inline-block animate-spin rounded-full h-12 w-12 border-4 border-primary-500 border-t-transparent"></div>
        <p class="mt-4 text-gray-600">Cargando agenda...</p>
      </div>
    </div>

    <!-- Estado de Error -->
    <div v-else-if="error" class="bg-red-50 p-6 rounded-2xl border border-red-200">
      <div class="flex items-center gap-3 mb-2">
        <svg class="w-6 h-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        <h3 class="text-lg font-semibold text-red-900">Error al cargar la agenda</h3>
      </div>
      <p class="text-red-700">{{ error }}</p>
      <button
        @click="fetchAgenda"
        class="mt-4 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors"
      >
        Reintentar
      </button>
    </div>
    
    <!-- Estado VacÃ­o -->
    <div v-else-if="todaysRoutines.length === 0" class="text-center py-20 bg-white rounded-2xl shadow-soft">
      <div class="flex flex-col items-center">
        <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4">
          <svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
          </svg>
        </div>
        <h3 class="text-lg font-semibold text-gray-900 mb-2">Sin rutinas programadas</h3>
        <p class="text-sm text-gray-500">No hay rutinas activas programadas para hoy.</p>
        
        <!-- Info de Debug -->
        <div class="mt-6 p-4 bg-blue-50 rounded-lg text-left text-xs text-gray-600 max-w-md">
          <p class="font-semibold mb-2">â„¹ï¸ InformaciÃ³n de Debug:</p>
          <ul class="space-y-1">
            <li>â€¢ Child ID: <code class="bg-white px-1 rounded">{{ childId }}</code></li>
            <li>â€¢ Endpoint: <code class="bg-white px-1 rounded break-all">/api/seguimiento/ninos/{{ childId }}/rutinas-diarias/agenda-hoy/</code></li>
            <li>â€¢ Rutinas recibidas: <code class="bg-white px-1 rounded">{{ todaysRoutines.length }}</code></li>
            <li>â€¢ Hora de carga: <code class="bg-white px-1 rounded">{{ loadTime }}</code></li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Lista de Rutinas -->
    <div v-else class="space-y-4">
      <!-- Info Header -->
      <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
        <p class="text-sm text-blue-800">
          ğŸ“‹ Mostrando <strong>{{ todaysRoutines.length }}</strong> rutina(s) programada(s) para hoy
        </p>
      </div>

      <!-- Tarjetas de Rutinas -->
      <RoutineCard 
        v-for="routine in todaysRoutines" 
        :key="routine.id" 
        :routine="routine"
        @view-detail="handleAction('view-detail', $event)"
        @edit="handleAction('edit', $event)"
        @clone="handleAction('clone', $event)"
        @toggle-status="handleAction('toggle-status', $event)"
        @archive="handleAction('archive', $event)"
      />
    </div>

    <!-- Debug Panel (Solo en desarrollo) -->
    <div v-if="isDevelopment" class="mt-8 p-6 bg-gray-100 rounded-lg">
      <details class="cursor-pointer">
        <summary class="font-semibold text-gray-700 mb-2">ğŸ”§ Panel de Debug</summary>
        <div class="mt-4 space-y-2 text-xs text-gray-600">
          <div><strong>Props recibidas:</strong></div>
          <pre class="bg-white p-3 rounded overflow-auto">{{ debugInfo }}</pre>
          
          <div class="mt-4"><strong>Datos cargados:</strong></div>
          <pre class="bg-white p-3 rounded overflow-auto max-h-64">{{ todaysRoutines }}</pre>
        </div>
      </details>
    </div>

  </div>
</template>

<script setup lang="ts">
import { ref, onMounted, computed, watch } from 'vue'
import { format } from 'date-fns'
import { es } from 'date-fns/locale'

// Importar tipos y API
import type { DailyRoutineList } from '@/type/rutinas/rutinas'
import { routinesApi } from '@/services/rutinas/routinesApi'

// Importar componente
import RoutineCard from '@/components/gestion/rutinas/core/RoutineCard.vue'

// === PROPS ===
const props = defineProps<{
  childId: number
  childName: string
}>()

// === EMITS ===
const emit = defineEmits<{
  (e: 'view-detail', id: number): void
  (e: 'edit', id: number): void
  (e: 'clone', id: number): void
  (e: 'toggle-status', id: number): void
  (e: 'archive', id: number): void
}>()

// === ESTADO ===
const todaysRoutines = ref<DailyRoutineList[]>([])
const isLoading = ref(true)
const error = ref<string | null>(null)
const loadTime = ref<string>('')

// Detectar si estamos en desarrollo
const isDevelopment = computed(() => import.meta.env.DEV)

// === COMPUTED ===
const formattedToday = computed(() => {
  try {
    return format(new Date(), 'EEEE, d \'de\' MMMM', { locale: es })
  } catch {
    return 'Hoy'
  }
})

const debugInfo = computed(() => ({
  childId: props.childId,
  childName: props.childName,
  routinesCount: todaysRoutines.value.length,
  isLoading: isLoading.value,
  hasError: !!error.value,
  loadTime: loadTime.value
}))

// === MÃ‰TODOS ===
async function fetchAgenda() {
  console.group('ğŸ”„ FETCH AGENDA - INICIO')
  console.log('ğŸ“‹ Child ID:', props.childId)
  console.log('ğŸ‘¤ Child Name:', props.childName)
  console.log('ğŸ• Timestamp:', new Date().toLocaleString())
  
  isLoading.value = true
  error.value = null
  
  try {
    console.log('ğŸš€ Llamando a routinesApi.getDailyAgenda()...')
    const response = await routinesApi.getDailyAgenda(props.childId)
    
    console.log('âœ… Respuesta recibida:', response)
    console.log('ğŸ“¦ response.data:', response.data)
    console.log('ğŸ“Š Tipo de response.data:', Array.isArray(response.data) ? 'Array' : typeof response.data)
    console.log('ğŸ“ Longitud:', Array.isArray(response.data) ? response.data.length : 'N/A')
    
    todaysRoutines.value = response.data
    loadTime.value = new Date().toLocaleTimeString()
    
    if (todaysRoutines.value.length === 0) {
      console.warn('âš ï¸ El servidor devolviÃ³ un array vacÃ­o')
    } else {
      console.log(`âœ… ${todaysRoutines.value.length} rutina(s) cargada(s)`)
    }
    
  } catch (err: any) {
    console.error('âŒ ERROR al cargar agenda:', err)
    console.error('âŒ Error completo:', {
      message: err.message,
      response: err.response,
      status: err.response?.status,
      data: err.response?.data
    })
    
    error.value = err.response?.data?.error 
      || err.response?.data?.detail
      || err.message 
      || "No se pudo cargar la agenda."
      
  } finally {
    isLoading.value = false
    console.groupEnd()
  }
}

// âœ… SOLUCIÃ“N: Usar switch case para type-safety
function handleAction(
  actionName: 'view-detail' | 'edit' | 'clone' | 'toggle-status' | 'archive', 
  id: number
) {
  console.log(`ğŸ¯ AcciÃ³n solicitada: ${actionName} para rutina ID: ${id}`)
  
  switch (actionName) {
    case 'view-detail':
      emit('view-detail', id)
      break
    case 'edit':
      emit('edit', id)
      break
    case 'clone':
      emit('clone', id)
      break
    case 'toggle-status':
      emit('toggle-status', id)
      break
    case 'archive':
      emit('archive', id)
      break
  }
}

// === LIFECYCLE ===
onMounted(() => {
  console.log('ğŸ¬ RutinasAgendaView montado')
  fetchAgenda()
})

watch(() => props.childId, (newId, oldId) => {
  console.log(`ğŸ‘€ Child ID cambiÃ³ de ${oldId} a ${newId}`)
  fetchAgenda()
})
</script>

<style scoped>
.animate-fade-in {
  animation: fadeIn 0.3s ease-in;
}

@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.shadow-soft {
  box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
}

code {
  font-family: 'Courier New', monospace;
  font-size: 0.875em;
}
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\views\dashboard\perfil_nino\rutinas\RutinasAnalyticsView.vue
============================================================
<template>
  <div class="space-y-6 animate-fade-in">
    
    <div class="flex flex-col sm:flex-row justify-between sm:items-center gap-4">
      <div>
        <h2 class="text-2xl font-bold text-gray-900">
          AnÃ¡lisis de Progreso
        </h2>
        <p class="text-sm text-gray-500 mt-1">
          MÃ©tricas de efectividad, independencia y estado emocional.
        </p>
      </div>
      
      <div class="flex-shrink-0">
        <span class="relative z-0 inline-flex shadow-sm rounded-lg">
          <button
            v-for="p in periods"
            :key="p.id"
            @click="activePeriod = p.id"
            type="button"
            :class="[
              'relative inline-flex items-center px-4 py-2 text-sm font-medium focus:z-10 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 transition-all duration-150',
              p.id === activePeriod
                ? 'bg-primary-600 text-white hover:bg-primary-700'
                : 'bg-white text-gray-700 hover:bg-gray-50',
              p.position === 'first' ? 'rounded-l-lg' : '',
              p.position === 'last' ? 'rounded-r-lg' : '-ml-px'
            ]"
          >
            {{ p.label }}
          </button>
        </span>
      </div>
    </div>

    <div v-if="isLoading" class="flex items-center justify-center py-20 bg-white rounded-2xl shadow-soft">
      <div class="text-center">
        <div class="inline-block animate-spin rounded-full h-12 w-12 border-4 border-primary-500 border-t-transparent"></div>
        <p class="mt-4 text-gray-600">Calculando mÃ©tricas...</p>
      </div>
    </div>

    <div v-else-if="error" class="bg-error-50 p-6 rounded-2xl border border-error-200">
      <div class="flex items-center space-x-3">
        <ExclamationTriangleIcon class="h-10 w-10 text-error-500" />
        <div>
          <h3 class="text-lg font-semibold text-error-800">No se pudieron cargar las analÃ­ticas</h3>
          <p class="text-error-700 mt-1">{{ error }}</p>
        </div>
      </div>
    </div>

    <div v-else class="space-y-6">
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        
        <div class="lg:col-span-2">
          <ProgressAnalysisPanel 
            :data="analyticsData.progressAnalysis" 
            :child-name="childName" 
          />
        </div>
        
        <div class="lg:col-span-1">
          <RecommendationsPanel 
            :recommendations="analyticsData.recommendations" 
          />
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        
        <CompletionRateChart 
          :data="analyticsData.completionRate" 
        />
        
        <IndependenceTrendChart 
          :data="analyticsData.independenceTrend" 
        />
        
        <EmotionalStateChart 
          :data="analyticsData.emotionalState" 
        />
        
        </div>
    </div>
  </div>
</template>

<script setup>
import { ref, watch, onMounted } from 'vue'
import { ExclamationTriangleIcon } from '@heroicons/vue/24/outline'

// Importar los componentes de analÃ­tica (se crearÃ¡n a continuaciÃ³n)
import ProgressAnalysisPanel from '@/components/gestion/rutinas/analytics/ProgressAnalysisPanel.vue'
import RecommendationsPanel from '@/components/gestion/rutinas/analytics/RecommendationsPanel.vue'
import CompletionRateChart from '@/components/gestion/rutinas/analytics/CompletionRateChart.vue'
import IndependenceTrendChart from '@/components/gestion/rutinas/analytics/IndependenceTrendChart.vue'
import EmotionalStateChart from '@/components/gestion/rutinas/analytics/EmotionalStateChart.vue'

// (Descomentar cuando los stores estÃ©n listos)
// import { useAnalyticsStore } from '@/stores/analyticsStore'
// import { storeToRefs } from 'pinia'

// Props (recibidos desde RutinasView.vue)
const props = defineProps({
  childId: {
    type: Number,
    required: true,
  },
  childName: {
    type: String,
    required: true,
  },
})

// SimulaciÃ³n del store de Pinia
// const analyticsStore = useAnalyticsStore()
// const { isLoading, error, analyticsData } = storeToRefs(analyticsStore)

// === INICIO: SIMULACIÃ“N DE DATOS (Reemplazar con store) ===
const isLoading = ref(true)
const error = ref(null)
const analyticsData = ref({})

// Datos simulados que coinciden con la API y los componentes
const MOCK_DATA = {
  progressAnalysis: {
    metrics: {
      completion_rate: 82,
      avg_independence: 3.8,
      crisis_rate: 15,
      total_logs: 45,
    },
    trend: [
      { date: '2025-10-01', completion: 70, independence: 3.2 },
      { date: '2025-10-08', completion: 75, independence: 3.5 },
      { date: '2025-10-15', completion: 80, independence: 3.7 },
      { date: '2025-10-22', completion: 82, independence: 3.8 },
    ],
    problematicSteps: [
      { step: '1. Lavarse los dientes', difficulty_count: 12 },
      { step: '3. Ponerse los zapatos', difficulty_count: 8 },
    ],
  },
  recommendations: [
    "El paso 'Lavarse los dientes' presenta dificultades recurrentes. Considera dividirlo en sub-pasos.",
    "La independencia estÃ¡ mejorando (3.8/5). Intenta reducir el nivel de apoyo verbal en 'Vestirse'.",
    "Se observa una alta tasa de crisis (15%) en rutinas matutinas. Revisa las estrategias de calma previas.",
  ],
  completionRate: {
    completed: 82,
    partial: 10,
    skipped: 8,
  },
  independenceTrend: [
    { date: 'Sem 1', level: 3.1 },
    { date: 'Sem 2', level: 3.4 },
    { date: 'Sem 3', level: 3.5 },
    { date: 'Sem 4', level: 3.8 },
  ],
  emotionalState: {
    happy: 55,
    neutral: 25,
    anxious: 15,
    sad: 5,
  },
}

const fetchData = async (period) => {
  isLoading.value = true
  error.value = null
  console.log(`Cargando analÃ­ticas para ${props.childId} (PerÃ­odo: ${period})`)
  
  try {
    // (Llamada real al store)
    // await analyticsStore.fetchAnalytics(props.childId, period)
    
    // (SimulaciÃ³n)
    await new Promise(res => setTimeout(res, 1000))
    // if (Math.random() > 0.9) throw new Error('Error simulado de red')
    analyticsData.value = MOCK_DATA
    
  } catch (e) {
    error.value = e.message || 'OcurriÃ³ un error desconocido.'
  } finally {
    isLoading.value = false
  }
}
// === FIN: SIMULACIÃ“N DE DATOS ===


// Estado del componente
const activePeriod = ref('30d')
const periods = ref([
  { id: '7d', label: '7 DÃ­as', position: 'first' },
  { id: '30d', label: '30 DÃ­as', position: 'middle' },
  { id: '90d', label: '90 DÃ­as', position: 'last' },
])

// Carga inicial
onMounted(() => {
  fetchData(activePeriod.value)
})

// Recargar datos cuando el perÃ­odo cambia
watch(activePeriod, (newPeriod) => {
  fetchData(newPeriod)
})
</script>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\views\dashboard\perfil_nino\rutinas\RutinasComparisonView.vue
============================================================
<template>
  <div class="animate-fade-in space-y-6">
    
    <div class="bg-white p-6 rounded-2xl shadow-soft">
      <div class="flex flex-col md:flex-row justify-between md:items-center gap-4">
        <div>
          <h2 class="text-2xl font-bold text-gray-900">
            Comparar Rutinas
          </h2>
          <p class="text-sm text-gray-500 mt-1">
            Selecciona dos rutinas y un perÃ­odo para analizar su efectividad.
          </p>
        </div>
        
        <button
          @click="fetchComparisonData"
          :disabled="!canCompare || isLoading"
          class="inline-flex items-center justify-center px-6 py-3 bg-gradient-to-r from-primary-600 to-primary-700 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl hover:from-primary-700 hover:to-primary-800 transform hover:-translate-y-0.5 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none disabled:shadow-lg"
        >
          <ChartBarIcon v-if="!isLoading" class="w-5 h-5 mr-2" />
          <div v-else class="w-5 h-5 mr-2 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
          {{ isLoading ? 'Analizando...' : 'Comparar' }}
        </button>
      </div>

      <hr class="my-6 border-gray-200" />

      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        
        <RoutineSelector
          v-model="selectedRoutineA"
          :routines="routineOptions"
          :exclude-id="selectedRoutineB"
          label="Rutina A (Principal)"
          placeholder="Selecciona la primera rutina"
          :disabled="isLoading"
        />

        <RoutineSelector
          v-model="selectedRoutineB"
          :routines="routineOptions"
          :exclude-id="selectedRoutineA"
          label="Rutina B (A comparar)"
          placeholder="Selecciona la segunda rutina"
          :disabled="isLoading"
        />

        <FormKit
          type="select"
          label="PerÃ­odo de AnÃ¡lisis"
          v-model="activePeriod"
          :options="periodOptions"
          :disabled="isLoading"
        />
      </div>
    </div>

    <div v-if="isLoading" class="flex items-center justify-center py-20 bg-white rounded-2xl shadow-soft">
      <div class="text-center">
        <div class="inline-block animate-spin rounded-full h-12 w-12 border-4 border-primary-500 border-t-transparent"></div>
        <p class="mt-4 text-gray-600">Calculando mÃ©tricas...</p>
      </div>
    </div>

    <div v-if="error" class="bg-error-50 p-6 rounded-2xl border border-error-200">
      <div class="flex items-center space-x-3">
        <ExclamationTriangleIcon class="h-10 w-10 text-error-500" />
        <div>
          <h3 class="text-lg font-semibold text-error-800">No se pudo comparar</h3>
          <p class="text-error-700 mt-1">{{ error }}</p>
        </div>
      </div>
    </div>

    <div 
      v-if="!comparisonData && !isLoading && !error"
      class="text-center py-20 bg-white rounded-2xl shadow-soft"
    >
      <div class="inline-block p-4 bg-gray-100 rounded-full">
        <ChartBarIcon class="h-12 w-12 text-primary-600" />
      </div>
      <h3 class="mt-4 text-xl font-semibold text-gray-800">Compara para mejorar</h3>
      <p class="mt-1 text-gray-500">
        Selecciona dos rutinas y haz clic en "Comparar" para ver los resultados.
      </p>
    </div>

    <div v-if="comparisonData && !isLoading && !error" class="space-y-6">
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        
        <div class="lg:col-span-2">
          <ComparisonMetricsGrid 
            :data-a="comparisonData.routine_a"
            :data-b="comparisonData.routine_b"
            :winner="comparisonData.winner"
          />
        </div>
        
        <div class="lg:col-span-1">
          <RecommendationCard 
            :recommendation-text="comparisonData.recommendation"
            :winner="comparisonData.winner"
          />
        </div>
      </div>
      
      <div class="bg-white p-6 rounded-2xl shadow-soft">
        <h3 class="text-lg font-semibold text-gray-900 mb-4">
          ComparaciÃ³n de MÃ©tricas (%)
        </h3>
        <ComparisonChart 
          :data-a="comparisonData.routine_a"
          :data-b="comparisonData.routine_b"
        />
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, computed, onMounted } from 'vue'
import { ChartBarIcon, ExclamationTriangleIcon } from '@heroicons/vue/24/outline'
import { useRoutinesStore } from '@/store/rutinas/routinesStore'
import { storeToRefs } from 'pinia'
// (Asumiendo que tienes un servicio de API para analÃ­ticas)
// import { analyticsApi } from '@/services/api/analyticsApi'

// Importar componentes hijos (se crearÃ¡n a continuaciÃ³n)
import RoutineSelector from '@/components/gestion/rutinas/comparison/RoutineSelector.vue'
import ComparisonMetricsGrid from '@/components/gestion/rutinas/comparison/ComparisonMetricsGrid.vue'
import RecommendationCard from '@/components/gestion/rutinas/comparison/RecommendationCard.vue'
import ComparisonChart from '@/components/gestion/rutinas/comparison/ComparisonChart.vue'

const props = defineProps({
  childId: {
    type: Number,
    required: true,
  },
})

// === ESTADO ===
const routinesStore = useRoutinesStore()
const { activeRoutines } = storeToRefs(routinesStore)

const selectedRoutineA = ref(null)
const selectedRoutineB = ref(null)
const activePeriod = ref(30) // Default 30 dÃ­as

const comparisonData = ref(null)
const isLoading = ref(false)
const error = ref(null)

const periodOptions = [
  { label: 'Ãšltimos 7 dÃ­as', value: 7 },
  { label: 'Ãšltimos 30 dÃ­as', value: 30 },
  { label: 'Ãšltimos 90 dÃ­as', value: 90 },
]

// === LÃ“GICA ===

// Formatear rutinas para el selector de FormKit
const routineOptions = computed(() => 
  activeRoutines.value.map(r => ({
    label: r.name,
    value: r.id,
  }))
)

// Habilitar el botÃ³n de comparar
const canCompare = computed(() => 
  selectedRoutineA.value && selectedRoutineB.value
)

// Llamada a la API (simulada)
const fetchComparisonData = async () => {
  // Resetear estados
  isLoading.value = true
  error.value = null
  comparisonData.value = null

  // ValidaciÃ³n
  if (!canCompare.value) {
    error.value = "Debes seleccionar dos rutinas."
    isLoading.value = false
    return
  }
  if (selectedRoutineA.value === selectedRoutineB.value) {
    error.value = "Por favor, selecciona dos rutinas diferentes."
    isLoading.value = false
    return
  }
  
  try {
    // --- LLAMADA REAL A LA API ---
    // const response = await analyticsApi.getComparison(
    //   props.childId, 
    //   selectedRoutineA.value, 
    //   selectedRoutineB.value, 
    //   activePeriod.value
    // )
    // comparisonData.value = response.data

    // --- SIMULACIÃ“N DE API ---
    await new Promise(res => setTimeout(res, 1500))
    // Simular error de "datos insuficientes"
    if (Math.random() > 0.8) {
       throw new Error("Datos insuficientes para comparar")
    }
    // Simular Ã©xito
    comparisonData.value = {
      period_days: activePeriod.value,
      routine_a: {
        name: routineOptions.value.find(r => r.value === selectedRoutineA.value).label,
        metrics: {
          total_logs: 28,
          completion_rate: 85.7,
          crisis_rate: 7.1,
          avg_independence: 4.1
        }
      },
      routine_b: {
        name: routineOptions.value.find(r => r.value === selectedRoutineB.value).label,
        metrics: {
          total_logs: 25,
          completion_rate: 72.0,
          crisis_rate: 16.0,
          avg_independence: 3.5
        }
      },
      winner: 'routine_a',
      recommendation: `'${routineOptions.value.find(r => r.value === selectedRoutineA.value).label}' muestra mejor desempeÃ±o`
    }
    // --- FIN SIMULACIÃ“N ---

  } catch (err) {
    error.value = err.response?.data?.error || err.message || "OcurriÃ³ un error desconocido."
  } finally {
    isLoading.value = false
  }
}
</script>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\views\dashboard\perfil_nino\rutinas\RutinasListView.vue
============================================================
<template>
  <div class="rutinas-list-view">
    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-6">
      <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
        <div class="flex-1 max-w-md">
          <div class="relative">
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
              <MagnifyingGlassIcon class="h-5 w-5 text-gray-400" />
            </div>
            <input
              v-model="search"
              type="text"
              placeholder="Buscar rutina por nombre..."
              class="block w-full pl-10 pr-3 py-2.5 border border-gray-300 rounded-lg leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-2 focus:ring-primary-500 focus:border-primary-500 sm:text-sm transition-colors"
            />
            <button
              v-if="search"
              @click="search = ''"
              class="absolute inset-y-0 right-0 pr-3 flex items-center"
            >
              <XMarkIcon class="h-5 w-5 text-gray-400 hover:text-gray-600" />
            </button>
          </div>
        </div>

        <div class="flex items-center gap-3">
          <Menu as="div" class="relative inline-block text-left">
            <MenuButton class="inline-flex items-center justify-center px-4 py-2.5 border border-gray-300 rounded-lg shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-all">
              <FunnelIcon class="h-4 w-4 mr-2 text-gray-500" />
              {{ getFilterLabel(filterStatus) }}
              <ChevronDownIcon class="ml-2 h-4 w-4 text-gray-500" />
            </MenuButton>

            <transition
              enter-active-class="transition ease-out duration-100"
              enter-from-class="transform opacity-0 scale-95"
              enter-to-class="transform opacity-100 scale-100"
              leave-active-class="transition ease-in duration-75"
              leave-from-class="transform opacity-100 scale-100"
              leave-to-class="transform opacity-0 scale-95"
            >
              <MenuItems class="absolute right-0 z-10 mt-2 w-56 origin-top-right rounded-lg bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none">
                <div class="py-1">
                  <MenuItem v-slot="{ active }">
                    <button
                      @click="filterStatus = 'all'"
                      :class="[
                        active ? 'bg-gray-100 text-gray-900' : 'text-gray-700',
                        filterStatus === 'all' ? 'bg-primary-50 text-primary-700 font-medium' : '',
                        'group flex items-center w-full px-4 py-2 text-sm'
                      ]"
                    >
                      <CheckCircleIcon v-if="filterStatus === 'all'" class="mr-3 h-5 w-5 text-primary-600" />
                      <span class="ml-8" v-else></span>
                      Todas las rutinas
                    </button>
                  </MenuItem>
                  <MenuItem v-slot="{ active }">
                    <button
                      @click="filterStatus = 'active'"
                      :class="[
                        active ? 'bg-gray-100 text-gray-900' : 'text-gray-700',
                        filterStatus === 'active' ? 'bg-primary-50 text-primary-700 font-medium' : '',
                        'group flex items-center w-full px-4 py-2 text-sm'
                      ]"
                    >
                      <CheckCircleIcon v-if="filterStatus === 'active'" class="mr-3 h-5 w-5 text-primary-600" />
                      <span class="ml-8" v-else></span>
                      Activas
                    </button>
                  </MenuItem>
                  <MenuItem v-slot="{ active }">
                    <button
                      @click="filterStatus = 'paused'"
                      :class="[
                        active ? 'bg-gray-100 text-gray-900' : 'text-gray-700',
                        filterStatus === 'paused' ? 'bg-primary-50 text-primary-700 font-medium' : '',
                        'group flex items-center w-full px-4 py-2 text-sm'
                      ]"
                    >
                      <CheckCircleIcon v-if="filterStatus === 'paused'" class="mr-3 h-5 w-5 text-primary-600" />
                      <span class="ml-8" v-else></span>
                      Pausadas
                    </button>
                  </MenuItem>
                  <MenuItem v-slot="{ active }">
                    <button
                      @click="filterStatus = 'archived'"
                      :class="[
                        active ? 'bg-gray-100 text-gray-900' : 'text-gray-700',
                        filterStatus === 'archived' ? 'bg-primary-50 text-primary-700 font-medium' : '',
                        'group flex items-center w-full px-4 py-2 text-sm'
                      ]"
                    >
                      <CheckCircleIcon v-if="filterStatus === 'archived'" class="mr-3 h-5 w-5 text-primary-600" />
                      <span class="ml-8" v-else></span>
                      Archivadas
                    </button>
                  </MenuItem>
                </div>
              </MenuItems>
            </transition>
          </Menu>

          <Menu as="div" class="relative inline-block text-left">
            <MenuButton class="inline-flex items-center justify-center px-4 py-2.5 border border-gray-300 rounded-lg shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-all">
              <AdjustmentsHorizontalIcon class="h-4 w-4 mr-2 text-gray-500" />
              Tipo
              <ChevronDownIcon class="ml-2 h-4 w-4 text-gray-500" />
            </MenuButton>

            <transition
              enter-active-class="transition ease-out duration-100"
              enter-from-class="transform opacity-0 scale-95"
              enter-to-class="transform opacity-100 scale-100"
              leave-active-class="transition ease-in duration-75"
              leave-from-class="transform opacity-100 scale-100"
              leave-to-class="transform opacity-0 scale-95"
            >
              <MenuItems class="absolute right-0 z-10 mt-2 w-56 origin-top-right rounded-lg bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none">
                <div class="py-1">
                  <MenuItem v-slot="{ active }">
                    <button
                      @click="filterType = null"
                      :class="[
                        active ? 'bg-gray-100 text-gray-900' : 'text-gray-700',
                        filterType === null ? 'bg-primary-50 text-primary-700 font-medium' : '',
                        'group flex items-center w-full px-4 py-2 text-sm'
                      ]"
                    >
                      <CheckCircleIcon v-if="filterType === null" class="mr-3 h-5 w-5 text-primary-600" />
                      <span class="ml-8" v-else></span>
                      Todos los tipos
                    </button>
                  </MenuItem>
                  <MenuItem v-for="type in routineTypes" :key="type.value" v-slot="{ active }">
                    <button
                      @click="filterType = type.value"
                      :class="[
                        active ? 'bg-gray-100 text-gray-900' : 'text-gray-700',
                        filterType === type.value ? 'bg-primary-50 text-primary-700 font-medium' : '',
                        'group flex items-center w-full px-4 py-2 text-sm'
                      ]"
                    >
                      <CheckCircleIcon v-if="filterType === type.value" class="mr-3 h-5 w-5 text-primary-600" />
                      <span class="ml-8" v-else></span>
                      {{ type.icon }} {{ type.label }}
                    </button>
                  </MenuItem>
                </div>
              </MenuItems>
            </transition>
          </Menu>

          <div class="flex items-center border border-gray-300 rounded-lg overflow-hidden">
            <button
              @click="viewMode = 'grid'"
              :class="[
                'px-3 py-2 text-sm font-medium transition-colors',
                viewMode === 'grid'
                  ? 'bg-primary-100 text-primary-700'
                  : 'bg-white text-gray-700 hover:bg-gray-50'
              ]"
            >
              <Squares2X2Icon class="h-4 w-4" />
            </button>
            <button
              @click="viewMode = 'list'"
              :class="[
                'px-3 py-2 text-sm font-medium transition-colors border-l border-gray-300',
                viewMode === 'list'
                  ? 'bg-primary-100 text-primary-700'
                  : 'bg-white text-gray-700 hover:bg-gray-50'
              ]"
            >
              <ListBulletIcon class="h-4 w-4" />
            </button>
          </div>
        </div>
      </div>

      <div v-if="hasActiveFilters" class="mt-4 flex items-center gap-2">
        <span class="text-sm text-gray-600">Filtros activos:</span>
        <span
          v-if="search"
          class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-primary-100 text-primary-800"
        >
          BÃºsqueda: "{{ search }}"
          <button @click="search = ''" class="ml-2">
            <XMarkIcon class="h-3 w-3" />
          </button>
        </span>
        <span
          v-if="filterStatus !== 'all'"
          class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-primary-100 text-primary-800"
        >
          Estado: {{ getFilterLabel(filterStatus) }}
          <button @click="filterStatus = 'all'" class="ml-2">
            <XMarkIcon class="h-3 w-3" />
          </button>
        </span>
        <span
          v-if="filterType"
          class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-primary-100 text-primary-800"
        >
          Tipo: {{ getTypeLabel(filterType) }}
          <button @click="filterType = null" class="ml-2">
            <XMarkIcon class="h-3 w-3" />
          </button>
        </span>
        <button
          @click="clearFilters"
          class="text-sm text-primary-600 hover:text-primary-700 font-medium"
        >
          Limpiar todos
        </button>
      </div>
    </div>

    <div class="flex items-center justify-between mb-6">
      <div class="text-sm text-gray-600">
        <span class="font-medium text-gray-900">{{ filteredRoutines.length }}</span>
        {{ filteredRoutines.length === 1 ? 'rutina encontrada' : 'rutinas encontradas' }}
      </div>

      <div class="flex items-center gap-2">
        <span class="text-sm text-gray-600">Ordenar por:</span>
        <Menu as="div" class="relative inline-block text-left">
          <MenuButton class="inline-flex items-center px-3 py-2 border border-gray-300 rounded-lg shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500">
            {{ getSortLabel(sortBy) }}
            <ChevronDownIcon class="ml-2 h-4 w-4 text-gray-500" />
          </MenuButton>

          <transition
            enter-active-class="transition ease-out duration-100"
            enter-from-class="transform opacity-0 scale-95"
            enter-to-class="transform opacity-100 scale-100"
            leave-active-class="transition ease-in duration-75"
            leave-from-class="transform opacity-100 scale-100"
            leave-to-class="transform opacity-0 scale-95"
          >
            <MenuItems class="absolute right-0 z-10 mt-2 w-48 origin-top-right rounded-lg bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none">
              <div class="py-1">
                <MenuItem v-for="option in sortOptions" :key="option.value" v-slot="{ active }">
                  <button
                    @click="sortBy = option.value"
                    :class="[
                      active ? 'bg-gray-100 text-gray-900' : 'text-gray-700',
                      sortBy === option.value ? 'bg-primary-50 text-primary-700 font-medium' : '',
                      'group flex items-center w-full px-4 py-2 text-sm'
                    ]"
                  >
                    {{ option.label }}
                  </button>
                </MenuItem>
              </div>
            </MenuItems>
          </transition>
        </Menu>
      </div>
    </div>

    <div v-if="loading" class="flex items-center justify-center py-20">
      <div class="text-center">
        <div class="inline-block animate-spin rounded-full h-12 w-12 border-4 border-primary-500 border-t-transparent"></div>
        <p class="mt-4 text-gray-600">Cargando rutinas...</p>
      </div>
    </div>

    <TransitionGroup
      v-else-if="viewMode === 'grid' && sortedRoutines.length > 0"
      name="list"
      tag="div"
      class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"
    >
      <RoutineCard
        v-for="routine in sortedRoutines"
        :key="routine.id"
        :routine="routine"
        @view="openDetailDrawer(routine)"
        @edit="openEditModal(routine)"
        @duplicate="openCopyDialog(routine)"
        @toggle-status="handleToggleStatus(routine)"
        @delete="handleDelete(routine.id)"
      />
    </TransitionGroup>

    <div
      v-else-if="viewMode === 'list' && sortedRoutines.length > 0"
      class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden"
    >
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              Rutina
            </th>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              Tipo
            </th>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              Estado
            </th>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              Pasos
            </th>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              Ãšltima vez
            </th>
            <th scope="col" class="relative px-6 py-3">
              <span class="sr-only">Acciones</span>
            </th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          <tr
            v-for="routine in sortedRoutines"
            :key="routine.id"
            class="hover:bg-gray-50 transition-colors"
          >
            <td class="px-6 py-4 whitespace-nowrap">
              <div class="flex items-center">
                <div class="flex-shrink-0 h-10 w-10 bg-gradient-to-br from-primary-500 to-primary-600 rounded-lg flex items-center justify-center">
                  <span class="text-white text-lg">{{ getRoutineIcon(routine.routine_type) }}</span>
                </div>
                <div class="ml-4">
                  <div class="text-sm font-medium text-gray-900">
                    {{ routine.name }}
                  </div>
                  <div class="text-sm text-gray-500">
                    {{ routine.description || 'Sin descripciÃ³n' }}
                  </div>
                </div>
              </div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-primary-100 text-primary-800">
                {{ getTypeLabel(routine.routine_type) }}
              </span>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <RoutineStatusBadge :status="routine.status" />
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
              {{ routine.total_steps || 0 }} pasos
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
              {{ formatDate(routine.updated_at) }}
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
              <Menu as="div" class="relative inline-block text-left">
                <MenuButton class="inline-flex items-center p-2 border border-transparent rounded-full hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500">
                  <EllipsisVerticalIcon class="h-5 w-5 text-gray-400" />
                </MenuButton>

                <transition
                  enter-active-class="transition ease-out duration-100"
                  enter-from-class="transform opacity-0 scale-95"
                  enter-to-class="transform opacity-100 scale-100"
                  leave-active-class="transition ease-in duration-75"
                  leave-from-class="transform opacity-100 scale-100"
                  leave-to-class="transform opacity-0 scale-95"
                >
                  <MenuItems class="absolute right-0 z-10 mt-2 w-48 origin-top-right rounded-lg bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none">
                    <div class="py-1">
                      <MenuItem v-slot="{ active }">
                        <button
                          @click="openDetailDrawer(routine)"
                          :class="[
                            active ? 'bg-gray-100 text-gray-900' : 'text-gray-700',
                            'group flex items-center w-full px-4 py-2 text-sm'
                          ]"
                        >
                          <EyeIcon class="mr-3 h-5 w-5 text-gray-400" />
                          Ver detalles
                        </button>
                      </MenuItem>
                      <MenuItem v-slot="{ active }">
                        <button
                          @click="openEditModal(routine)"
                          :class="[
                            active ? 'bg-gray-100 text-gray-900' : 'text-gray-700',
                            'group flex items-center w-full px-4 py-2 text-sm'
                          ]"
                        >
                          <PencilIcon class="mr-3 h-5 w-5 text-gray-400" />
                          Editar
                        </button>
                      </MenuItem>
                      <MenuItem v-slot="{ active }">
                        <button
                          @click="openCopyDialog(routine)"
                          :class="[
                            active ? 'bg-gray-100 text-gray-900' : 'text-gray-700',
                            'group flex items-center w-full px-4 py-2 text-sm'
                          ]"
                        >
                          <DocumentDuplicateIcon class="mr-3 h-5 w-5 text-gray-400" />
                          Duplicar
                        </button>
                      </MenuItem>
                      <MenuItem v-slot="{ active }">
                        <button
                          @click="handleToggleStatus(routine)"
                          :class="[
                            active ? 'bg-gray-100 text-gray-900' : 'text-gray-700',
                            'group flex items-center w-full px-4 py-2 text-sm'
                          ]"
                        >
                          <ArrowPathIcon class="mr-3 h-5 w-5 text-gray-400" />
                          {{ routine.status === 'active' ? 'Pausar' : 'Activar' }}
                        </button>
                      </MenuItem>
                      <MenuItem v-slot="{ active }">
                        <button
                          @click="handleDelete(routine.id)"
                          :class="[
                            active ? 'bg-red-100 text-red-900' : 'text-red-700',
                            'group flex items-center w-full px-4 py-2 text-sm'
                          ]"
                        >
                          <TrashIcon class="mr-3 h-5 w-5 text-red-400" />
                          Archivar
                        </button>
                      </MenuItem>
                    </div>
                  </MenuItems>
                </transition>
              </Menu>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <EmptyState
      v-else-if="!loading && (routines.length > 0 && filteredRoutines.length === 0)"
      :has-filters="hasActiveFilters"
      @clear-filters="clearFilters"
      @create="$emit('create-routine')"
      title="No se encontraron rutinas"
      message="No hay rutinas que coincidan con tus filtros. Intenta ajustar la bÃºsqueda."
    />
    
    <EmptyState
      v-else-if="!loading && routines.length === 0"
      :has-filters="false"
      @clear-filters="clearFilters"
      @create="$emit('create-routine')"
      title="AÃºn no hay rutinas"
      message="Comienza creando la primera plantilla de rutina para este niÃ±o."
    />

    <Teleport to="body">
      <TransitionRoot as="template" :show="selectedRoutineId !== null">
        <Dialog as="div" class="relative z-50" @close="selectedRoutineId = null">
          <TransitionChild
            as="template"
            enter="ease-in-out duration-500"
            enter-from="opacity-0"
            enter-to="opacity-100"
            leave="ease-in-out duration-500"
            leave-from="opacity-100"
            leave-to="opacity-0"
          >
            <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" />
          </TransitionChild>

          <div class="fixed inset-0 overflow-hidden">
            <div class="absolute inset-0 overflow-hidden">
              <div class="pointer-events-none fixed inset-y-0 right-0 flex max-w-full pl-10 sm:pl-16">
                <TransitionChild
                  as="template"
                  enter="transform transition ease-in-out duration-500 sm:duration-700"
                  enter-from="translate-x-full"
                  enter-to="translate-x-0"
                  leave="transform transition ease-in-out duration-500 sm:duration-700"
                  leave-from="translate-x-0"
                  leave-to="translate-x-full"
                >
                  <DialogPanel class="pointer-events-auto w-screen max-w-2xl">
                    <RoutineDetailView
                      v-if="selectedRoutineId"
                      :routine-id="selectedRoutineId"
                      :child-id="childId"
                      @close="selectedRoutineId = null"
                      @updated="handleRoutineUpdated"
                      @edit="openEditModalFromDetail"
                    />
                  </DialogPanel>
                </TransitionChild>
              </div>
            </div>
          </div>
        </Dialog>
      </TransitionRoot>
    </Teleport>

    <RoutineCopyDialog
      v-if="copyingRoutineId"
      :routine-id="copyingRoutineId"
      :child-id="childId"
      @close="copyingRoutineId = null"
      @copied="handleRoutineCopied"
    />
  </div>
</template>

<script setup lang="ts">
interface DailyRoutine {
  id: number | string;
  name: string;
  description?: string;
  routine_type: string;
  status: string;
  created_at: string;
  updated_at: string;
  total_steps?: number;
}

import { ref, computed, onMounted, watch } from 'vue'
// (El 'store' no se usa aquÃ­, los datos vienen por props)
// import { useRoutinesStore } from '@/stores/routinesStore'
import { format, formatDistanceToNow, parseISO } from 'date-fns'
import { es } from 'date-fns/locale'

// Headless UI
import {
  Menu,
  MenuButton,
  MenuItem,
  MenuItems,
  Dialog,
  DialogPanel,
  TransitionRoot,
  TransitionChild
} from '@headlessui/vue'

// Heroicons
import {
  MagnifyingGlassIcon,
  FunnelIcon,
  AdjustmentsHorizontalIcon,
  ChevronDownIcon,
  Squares2X2Icon,
  ListBulletIcon,
  CheckCircleIcon,
  XMarkIcon,
  EyeIcon,
  PencilIcon,
  DocumentDuplicateIcon,
  ArrowPathIcon,
  TrashIcon,
  EllipsisVerticalIcon
} from '@heroicons/vue/24/outline'

// Componentes
import RoutineCard from '../../../../components/gestion/rutinas/core/RoutineCard.vue'
import RoutineStatusBadge from '@/components/gestion/rutinas/core/RoutineStatusBadge.vue'
// Asumimos que RoutineDetailView es una sub-vista de la pestaÃ±a
import RoutineDetailView from '@/views/dashboard/perfil_nino/rutinas/RoutineDetailView.vue' 
import RoutineCopyDialog from '@/components/gestion/rutinas/core/RoutineCopyDialog.vue'
import EmptyState from '@/components/gestion/rutinas/shared/EmptyState.vue'



// ========================================
// PROPS & EMITS
// ========================================

// Este componente recibe la lista de rutinas desde su padre (RutinasView.vue)
const props = defineProps<{
  routines: DailyRoutine[]
  loading: boolean
  childId: number | string
  listRefreshKey: number // Prop para forzar recarga
}>()

// Emite eventos al padre (RutinasView.vue) para que este maneje la lÃ³gica
const emit = defineEmits<{
  (e: 'select-routine', routine: DailyRoutine): void
  (e: 'edit-routine', routine: DailyRoutine): void
  (e: 'delete-routine', id: number | string): void
  (e: 'toggle-status', routine: DailyRoutine): void
  (e: 'create-routine'): void
  (e: 'refresh-list'): void
}>()

// ========================================
// STORE
// ========================================
// No se usa un store local, se depende de las props para los datos

// ========================================
// STATE (Estado Local)
// ========================================
const search = ref('')
const filterStatus = ref('all') // 'all', 'active', 'paused', 'archived'
const filterType = ref<string | null>(null)
const viewMode = ref('grid') // 'grid' | 'list'
const sortBy = ref('updated_at') // 'name', 'created_at', 'updated_at', 'routine_type'
const selectedRoutineId = ref<number | string | null>(null) // Para el drawer de detalle
const copyingRoutineId = ref<number | null>(null) // Para el modal de clonar

// ========================================
// DATOS ESTÃTICOS (Opciones de Filtros)
// ========================================
const routineTypes = [
  { value: 'morning', label: 'MaÃ±ana', icon: 'ğŸŒ…' },
  { value: 'bedtime', label: 'Noche', icon: 'ğŸŒ™' },
  { value: 'mealtime', label: 'Comida', icon: 'ğŸ½ï¸' },
  { value: 'homework', label: 'Tareas', icon: 'âœï¸' },
  { value: 'school_prep', label: 'PreparaciÃ³n escuela', icon: 'ğŸ’' },
  { value: 'therapy_session', label: 'Terapia', icon: 'ğŸ§ ' },
  { value: 'other', label: 'Otra', icon: 'ğŸ“‹' }
  // (AÃ±adir mÃ¡s si es necesario)
]

const sortOptions = [
  { value: 'name', label: 'Nombre (A-Z)' },
  { value: 'updated_at', label: 'ReciÃ©n actualizada' },
  { value: 'created_at', label: 'ReciÃ©n creada' },
  { value: 'routine_type', label: 'Tipo de rutina' }
]

// ========================================
// COMPUTED (Propiedades Calculadas)
// ========================================

// Devuelve 'true' si algÃºn filtro (bÃºsqueda, estado, tipo) estÃ¡ activo
const hasActiveFilters = computed(() => {
  return search.value !== '' || filterStatus.value !== 'all' || filterType.value !== null
})

// 1. Filtra las rutinas basado en el estado local (search, filterStatus, filterType)
const filteredRoutines = computed(() => {
  if (!props.routines) return []
  
  return props.routines.filter(routine => {
    // Filtro por estado
    if (filterStatus.value !== 'all' && routine.status !== filterStatus.value) {
      return false
    }

    // Filtro por tipo
    if (filterType.value && routine.routine_type !== filterType.value) {
      return false
    }

    // Filtro por bÃºsqueda
    if (search.value) {
      const searchTerm = search.value.toLowerCase()
      const nameMatch = routine.name?.toLowerCase().includes(searchTerm)
      const typeMatch = routine.routine_type.toLowerCase().includes(searchTerm)
      const descMatch = routine.description?.toLowerCase().includes(searchTerm)
      return nameMatch || typeMatch || descMatch
    }

    // Si pasa todos los filtros, se incluye
    return true
  })
})

// 2. Ordena las rutinas ya filtradas
const sortedRoutines = computed(() => {
  const routines = [...filteredRoutines.value] // Copia para no mutar la computada anterior
  
  switch (sortBy.value) {
    case 'name':
      return routines.sort((a, b) => a.name.localeCompare(b.name))
    case 'created_at':
      return routines.sort((a, b) => new Date(b.created_at).getTime() - new Date(a.created_at).getTime())
    case 'routine_type':
      return routines.sort((a, b) => a.routine_type.localeCompare(b.routine_type))
    case 'updated_at': // Por defecto
    default:
      return routines.sort((a, b) => new Date(b.updated_at).getTime() - new Date(a.updated_at).getTime())
  }
})

// ========================================
// WATCHERS (Observadores)
// ========================================
// Observa la prop 'listRefreshKey'. Si el padre la incrementa,
// significa que se creÃ³/editÃ³ algo y debemos recargar.
watch(() => props.listRefreshKey, () => {
  console.log("RutinaList: 'listRefreshKey' cambiÃ³, emitiendo 'refresh-list'");
  // Emite el evento refresh-list que el padre (RutinasView) debe escuchar
  // para llamar a su propia funciÃ³n `loadRoutines`
  emit('refresh-list'); 
})

// ========================================
// MÃ‰TODOS (Manejadores de Eventos)
// ========================================

// --- Acciones del Template ---
function openDetailDrawer(routine: DailyRoutine) {
  console.log('Abriendo detalle para:', routine.id);
  selectedRoutineId.value = routine.id
  // â›”ï¸ NO emitimos, este componente maneja su propio drawer de detalle
}

function openEditModal(routine: DailyRoutine) {
  console.log('Solicitando ediciÃ³n para:', routine.id);
  // âœ… EMITIMOS al padre (RutinasView) para que Ã©l abra el Wizard/Editor
  emit('edit-routine', routine) 
}

function openCopyDialog(routine: DailyRoutine) {
  console.log('Abriendo diÃ¡logo de clonar para:', routine.id);
  copyingRoutineId.value = typeof routine.id === 'string' ? parseInt(routine.id, 10) : routine.id
  // â›”ï¸ NO emitimos, este componente maneja su propio modal de clonar
}

function handleToggleStatus(routine: DailyRoutine) {
  console.log('Solicitando cambio de estado para:', routine.id);
  // âœ… EMITIMOS al padre para que maneje la lÃ³gica API
  emit('toggle-status', routine)
}

function handleDelete(routineId: number | string) {
  console.log('Solicitando borrado para:', routineId);
  // âœ… EMITIMOS al padre para que muestre ConfirmModal
  emit('delete-routine', routineId)
}

function clearFilters() {
  search.value = ''
  filterStatus.value = 'all'
  filterType.value = null
}

// --- Callbacks de Modales Locales ---
function handleRoutineUpdated() {
  console.log('Rutina actualizada (recibido desde DetailView)');
  selectedRoutineId.value = null // Cierra el drawer
  emit('refresh-list') // Emite al padre para recargar la lista
}

function handleRoutineCopied() {
  console.log('Rutina clonada exitosamente');
  copyingRoutineId.value = null // Cierra el modal
  emit('refresh-list') // Emite al padre para recargar la lista
}

function openEditModalFromDetail(routine: DailyRoutine) {
    selectedRoutineId.value = null // Cierra el drawer de detalle
    // Espera un poco para que la animaciÃ³n del drawer termine
    setTimeout(() => {
        emit('edit-routine', routine) // Emite al padre para abrir el editor
    }, 300)
}


// --- Helpers de Template ---
function getFilterLabel(status: string) {
  const labels: Record<string, string> = {
    all: 'Estado: Todos',
    active: 'Estado: Activas',
    paused: 'Estado: Pausadas',
    archived: 'Estado: Archivadas'
  }
  return labels[status] || 'Estado'
}

function getTypeLabel(type: string | null) {
  if (!type) return 'Todos los tipos'
  return routineTypes.find(t => t.value === type)?.label || type
}

function getSortLabel(sortKey: string) {
  return sortOptions.find(o => o.value === sortKey)?.label || 'Ordenar por'
}

function getRoutineIcon(type: string) {
  return routineTypes.find(t => t.value === type)?.icon || 'ğŸ“‹'
}

function formatDate(dateString: string | null | undefined): string {
  if (!dateString) return 'Nunca';
  try {
    // Muestra "hace X tiempo" para fechas recientes, o fecha normal para antiguas
    const date = parseISO(dateString);
    const now = new Date();
    if (now.getTime() - date.getTime() < 7 * 24 * 60 * 60 * 1000) { // 7 dÃ­as
      return formatDistanceToNow(date, { addSuffix: true, locale: es });
    }
    return format(date, 'dd MMM yyyy', { locale: es });
  } catch (e) {
    console.error("Error formateando fecha:", dateString, e);
    return 'Fecha invÃ¡lida';
  }
}

function formatDateShort(dateString: string | null | undefined): string {
  if (!dateString) return 'N/A';
   try {
        return new Date(dateString).toLocaleDateString('es-CL', {
            year: 'numeric', month: 'long', day: 'numeric'
        });
    } catch (e) {
        return dateString;
    }
}
</script>

<style scoped>
/* Estilos para la animaciÃ³n de la lista */
.list-move,
.list-enter-active,
.list-leave-active {
  transition: all 0.5s ease;
}
.list-enter-from,
.list-leave-to {
  opacity: 0;
  transform: translateY(30px);
}
/* Asegura que los elementos que se van no rompan el layout */
.list-leave-active {
  position: absolute;
}

/* Estilos de botones */
.btn-primary {
  @apply inline-flex items-center justify-center px-6 py-3 border border-transparent rounded-lg shadow-sm text-base font-semibold text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200;
}
.btn-secondary {
   @apply px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors;
}

/* Estilos de Card y Tabla (ya presentes en tus otros archivos) */
.shadow-soft {
  box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.05), 0 2px 4px -2px rgb(0 0 0 / 0.05);
}
.shadow-medium {
   box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.07), 0 4px 6px -4px rgb(0 0 0 / 0.07);
}
.text-error-600 { color: #DC2626; } /* Tailwind red-600 */
.hover\:bg-error-50:hover { background-color: #FEF2F2; } /* Tailwind red-50 */
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\views\dashboard\perfil_nino\RutinasView.vue
============================================================
<!-- src/views/dashboard/perfil_nino/RutinasView.vue -->
<template>
  <div class="rutinas-container min-h-screen bg-gray-50">
    <!-- HEADER CON ACCIONES -->
    <div class="bg-white border-b border-gray-200 sticky top-0 z-40 shadow-sm">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex items-center justify-between py-6">
          <div class="flex items-center space-x-4">
            <div class="w-14 h-14 bg-gradient-to-br from-primary-500 to-primary-600 rounded-2xl flex items-center justify-center shadow-lg">
              <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path>
              </svg>
            </div>
            
            <div>
              <h1 class="text-3xl font-bold text-gray-900">
                Rutinas Diarias
              </h1>
              <p class="text-sm text-gray-500 mt-1">
                Gestiona y monitorea las rutinas de {{ childName }}
              </p>
            </div>
          </div>

          <button
            @click="openCreateWizard"
            class="inline-flex items-center px-6 py-3 bg-gradient-to-r from-primary-600 to-primary-700 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl hover:from-primary-700 hover:to-primary-800 transform hover:-translate-y-0.5 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2"
          >
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
            </svg>
            Nueva Rutina
          </button>
        </div>
      </div>
    </div>

    <!-- TABS DE NAVEGACIÃ“N -->
    <div class="bg-white border-b border-gray-200 shadow-sm">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <nav class="flex space-x-1" aria-label="Tabs">
          <button
            v-for="tab in tabs"
            :key="tab.name"
            @click="activeTab = tab.name"
            :class="[
              'relative px-6 py-4 font-medium text-sm rounded-t-lg transition-all duration-200',
              activeTab === tab.name
                ? 'text-primary-700 bg-gray-50'
                : 'text-gray-600 hover:text-gray-900 hover:bg-gray-50'
            ]"
          >
            <span class="text-xl mr-2">{{ tab.icon }}</span>
            <span>{{ tab.label }}</span>
            
            <span
              v-if="tab.count !== undefined"
              :class="[
                'ml-2 inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium',
                activeTab === tab.name
                  ? 'bg-primary-100 text-primary-800'
                  : 'bg-gray-100 text-gray-600'
              ]"
            >
              {{ tab.count }}
            </span>
            
            <span
              v-if="activeTab === tab.name"
              class="absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-primary-600 to-primary-500 rounded-t-full"
            ></span>
          </button>
        </nav>
      </div>
    </div>

    <!-- CONTENIDO DEL TAB ACTIVO -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
      <!-- Loading State -->
      <div v-if="isLoading" class="flex items-center justify-center py-20">
        <div class="text-center">
          <div class="inline-block animate-spin rounded-full h-12 w-12 border-4 border-primary-500 border-t-transparent"></div>
          <p class="mt-4 text-gray-600">Cargando rutinas...</p>
        </div>
      </div>

      <!-- Contenido -->
      <KeepAlive v-else>
        <Transition name="fade" mode="out-in">
          <component
            :is="currentTabComponent"
            :child-id="childId"
            :child-name="childName"
            @refresh="handleRefresh"
            @routine-created="handleRoutineCreated"
            @routine-updated="handleRoutineUpdated"
            @update-count="handleUpdateCount"
          />
        </Transition>
      </KeepAlive>
    </div>

    <!-- âœ… MODAL: WIZARD DE CREACIÃ“N (SIN TRANSITION REDUNDANTE) -->
    <Suspense v-if="showWizard">
      <template #default>
        <component
          :is="RoutineCreationWizard"
          :child-id="childId"
          :child-name="childName"
          @close="closeWizard"
          @created="handleRoutineCreated"
        />
      </template>
      <template #fallback>
        <Teleport to="body">
          <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-lg p-8">
              <div class="animate-spin rounded-full h-12 w-12 border-4 border-primary-500 border-t-transparent mx-auto"></div>
              <p class="mt-4 text-gray-600">Cargando wizard...</p>
            </div>
          </div>
        </Teleport>
      </template>
    </Suspense>

    <!-- TOAST NOTIFICATIONS (se mantiene igual) -->
    <Teleport to="body">
      <div class="fixed bottom-4 right-4 z-50 space-y-2">
        <TransitionGroup
          enter-active-class="transition ease-out duration-300"
          enter-from-class="transform translate-x-full opacity-0"
          enter-to-class="transform translate-x-0 opacity-100"
          leave-active-class="transition ease-in duration-200"
          leave-from-class="transform translate-x-0 opacity-100"
          leave-to-class="transform translate-x-full opacity-0"
        >
          <div
            v-for="notification in notifications"
            :key="notification.id"
            :class="[
              'max-w-sm w-full bg-white shadow-lg rounded-lg pointer-events-auto ring-1 ring-black ring-opacity-5 overflow-hidden',
              getNotificationStyles(notification.type)
            ]"
          >
            <div class="p-4">
              <div class="flex items-start">
                <div class="flex-shrink-0">
                  <svg 
                    v-if="notification.type === 'success'" 
                    class="h-6 w-6 text-green-400" 
                    fill="none" 
                    viewBox="0 0 24 24" 
                    stroke="currentColor"
                  >
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                  </svg>
                  <svg 
                    v-else-if="notification.type === 'error'" 
                    class="h-6 w-6 text-red-400" 
                    fill="none" 
                    viewBox="0 0 24 24" 
                    stroke="currentColor"
                  >
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
                  </svg>
                  <svg 
                    v-else 
                    class="h-6 w-6 text-blue-400" 
                    fill="none" 
                    viewBox="0 0 24 24" 
                    stroke="currentColor"
                  >
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                  </svg>
                </div>
                <div class="ml-3 w-0 flex-1">
                  <p class="text-sm font-medium text-gray-900">
                    {{ notification.title }}
                  </p>
                  <p v-if="notification.message" class="mt-1 text-sm text-gray-500">
                    {{ notification.message }}
                  </p>
                </div>
                <div class="ml-4 flex-shrink-0 flex">
                  <button
                    @click="removeNotification(notification.id)"
                    class="rounded-md inline-flex text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"
                  >
                    <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                      <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                    </svg>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </TransitionGroup>
      </div>
    </Teleport>
  </div>
</template>

<script setup>
import { ref, computed, onMounted, defineAsyncComponent, watch } from 'vue'
import { useRoute } from 'vue-router'
import { useNinoActivoStore } from '@/store/ninoActivoStore'

// LAZY LOADING DE SUB-VISTAS con loading component
const createAsyncComponent = (loader) => {
  return defineAsyncComponent({
    loader,
    loadingComponent: {
      template: `
        <div class="flex items-center justify-center py-20">
          <div class="text-center">
            <div class="inline-block animate-spin rounded-full h-12 w-12 border-4 border-primary-500 border-t-transparent"></div>
            <p class="mt-4 text-gray-600">Cargando vista...</p>
          </div>
        </div>
      `
    },
    errorComponent: {
      template: `
        <div class="bg-red-50 border border-red-200 rounded-lg p-6 text-center">
          <p class="text-red-600 font-medium">Error al cargar la vista</p>
          <p class="text-red-500 text-sm mt-2">Por favor, recarga la pÃ¡gina</p>
        </div>
      `
    },
    delay: 200,
    timeout: 10000
  })
}

const RutinasAgendaView = createAsyncComponent(() =>
  import('./rutinas/RutinasAgendaView.vue')
)
const RutinasListView = createAsyncComponent(() =>
  import('./rutinas/RutinasListView.vue')
)
const RutinasAnalyticsView = createAsyncComponent(() =>
  import('./rutinas/RutinasAnalyticsView.vue')
)
const RutinasComparisonView = createAsyncComponent(() =>
  import('./rutinas/RutinasComparisonView.vue')
)

const RoutineCreationWizard = defineAsyncComponent({
  loader: () => import('@/components/gestion/rutinas/wizard/RoutineCreationWizard.vue'),
  errorComponent: {
    template: '<div class="p-4 bg-red-50 text-red-600 rounded">Error al cargar wizard</div>'
  }
})

// PROPS Y ROUTER
const route = useRoute()
const childId = computed(() => parseInt(route.params.id))
const ninoStore = useNinoActivoStore()
const childName = computed(() => ninoStore.nombreNino || 'Cargando...')

// STORE DE RUTINAS - Intento de carga opcional
let routinesStore = null
try {
  // Descomenta cuando el store exista:
  // const { useRoutinesStore } = await import('@/store/rutinas/routinesStore')
  // routinesStore = useRoutinesStore()
} catch (error) {
  console.info('Store de rutinas no disponible, usando modo local')
}

// STATE
const activeTab = ref('agenda')
const showWizard = ref(false)
const isLoading = ref(false)
const notifications = ref([])
const routineCount = ref(0) // Contador local

// CONFIGURACIÃ“N DE TABS
const tabs = computed(() => [
  {
    name: 'agenda',
    label: 'Agenda Hoy',
    icon: 'ğŸ“…',
    count: undefined
  },
  {
    name: 'list',
    label: 'Mis Rutinas',
    icon: 'ğŸ“‹',
    count: routinesStore?.activeRoutines?.length ?? routineCount.value
  },
  {
    name: 'analytics',
    label: 'AnÃ¡lisis',
    icon: 'ğŸ“Š',
    count: undefined
  },
  {
    name: 'comparison',
    label: 'Comparar',
    icon: 'âš–ï¸',
    count: undefined
  }
])

// COMPONENTE DINÃMICO SEGÃšN TAB
const currentTabComponent = computed(() => {
  const componentMap = {
    agenda: RutinasAgendaView,
    list: RutinasListView,
    analytics: RutinasAnalyticsView,
    comparison: RutinasComparisonView
  }
  return componentMap[activeTab.value]
})

// MÃ‰TODOS
const openCreateWizard = () => {
  showWizard.value = true
}

const closeWizard = () => {
  showWizard.value = false
}

const handleRoutineCreated = (routine) => {
  showWizard.value = false
  
  addNotification({
    type: 'success',
    title: 'Rutina creada',
    message: `"${routine?.name || 'La rutina'}" se creÃ³ exitosamente`
  })
  
  activeTab.value = 'list'
  loadRoutines()
}

const handleRoutineUpdated = () => {
  addNotification({
    type: 'success',
    title: 'Rutina actualizada',
    message: 'Los cambios se guardaron correctamente'
  })
  
  loadRoutines()
}

const handleRefresh = () => {
  loadRoutines()
}

// Nuevo: handler para actualizar contador desde sub-vistas
const handleUpdateCount = (count) => {
  routineCount.value = count
}

const loadRoutines = async () => {
  // Si hay store, Ãºsalo
  if (routinesStore?.fetchRoutines) {
    isLoading.value = true
    try {
      await routinesStore.fetchRoutines(childId.value)
      routineCount.value = routinesStore.activeRoutines?.length || 0
    } catch (error) {
      console.error('Error cargando rutinas:', error)
      addNotification({
        type: 'error',
        title: 'Error',
        message: 'No se pudieron cargar las rutinas'
      })
    } finally {
      isLoading.value = false
    }
  } else {
    // Si no hay store, las sub-vistas manejan sus propios datos
    console.info('Usando datos locales de sub-vistas')
  }
}

// SISTEMA DE NOTIFICACIONES
let notificationId = 0

const addNotification = ({ type, title, message }) => {
  const id = ++notificationId
  notifications.value.push({ id, type, title, message })
  
  setTimeout(() => {
    removeNotification(id)
  }, 5000)
}

const removeNotification = (id) => {
  const index = notifications.value.findIndex(n => n.id === id)
  if (index !== -1) {
    notifications.value.splice(index, 1)
  }
}

const getNotificationStyles = (type) => {
  const styles = {
    success: 'border-l-4 border-green-500',
    error: 'border-l-4 border-red-500',
    warning: 'border-l-4 border-yellow-500',
    info: 'border-l-4 border-blue-500'
  }
  return styles[type] || styles.info
}

// LIFECYCLE HOOKS
onMounted(async () => {
  await loadRoutines()
})

watch(() => childId.value, async (newId) => {
  if (newId) {
    await loadRoutines()
  }
})
</script>

<style scoped>
.fade-enter-active,
.fade-leave-active {
  transition: opacity 0.3s ease, transform 0.3s ease;
}

.fade-enter-from {
  opacity: 0;
  transform: translateY(10px);
}

.fade-leave-to {
  opacity: 0;
  transform: translateY(-10px);
}

.rutinas-container ::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

.rutinas-container ::-webkit-scrollbar-track {
  @apply bg-gray-100 rounded;
}

.rutinas-container ::-webkit-scrollbar-thumb {
  @apply bg-gray-300 rounded hover:bg-gray-400;
}
</style>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\views\dashboard\perfil_nino\SensorialView.vue
============================================================

============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\views\dashboard\perfil_nino\SesionesNinoView.vue
============================================================

============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\views\dashboard\perfil_nino\TareasView.vue
============================================================

============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\views\dashboard\ReportesView.vue
============================================================
<template>
    <div>
        <h2 class="font-bold text-center">contenido dashboard</h2>
    </div>
</template>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\views\dashboard\SessionesView.vue
============================================================
<template>
  <div class="sesiones-vista bg-gray-50 min-h-screen">
    <!-- Header -->
    <div class="bg-white shadow-sm border-b border-gray-200 mb-6">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
        <div class="flex items-center justify-between">
          <div>
            <h1 class="text-3xl font-bold text-gray-900">GestiÃ³n de Sesiones</h1>
            <p class="mt-1 text-sm text-gray-600">
              Administra y documenta las sesiones terapÃ©uticas de todos los niÃ±os.
            </p>
          </div>
          <button
            @click="crearNuevaSesion"
            class="inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
          >
            <svg class="h-5 w-5 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
            </svg>
            Nueva SesiÃ³n
          </button>
        </div>
      </div>
    </div>

    <!-- Estado de Carga -->
    <div v-if="isLoading" class="flex justify-center items-center py-12">
      <svg class="animate-spin h-8 w-8 text-blue-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
      </svg>
      <p class="text-gray-600 ml-4">Cargando sesiones...</p>
    </div>

    <!-- Contenido Principal -->
    <main v-if="!isLoading" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-12">
      
      <!-- Filtros y BÃºsqueda -->
      <div class="bg-white rounded-lg shadow-sm p-4 mb-6">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Buscar por NiÃ±o</label>
            <input
              v-model="searchQuery"
              type="text"
              placeholder="Nombre o RUT del niÃ±o..."
              class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
            />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Estado</label>
            <select
              v-model="filterStatus"
              class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
            >
              <option value="">Todos</option>
              <option value="asistio">AsistiÃ³</option>
              <option value="pendiente">Pendiente</option>
              <option value="cancelado_familia">Cancelada</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Fecha</label>
            <input
              v-model="filterDate"
              type="date"
              class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
            />
          </div>
        </div>
      </div>

      <!-- Lista de Sesiones -->
      <div v-if="filteredSessions.length > 0" class="space-y-4">
        <div
          v-for="session in filteredSessions"
          :key="session.id"
          class="bg-white rounded-lg shadow-sm hover:shadow-md transition-shadow duration-200 overflow-hidden"
        >
          <div class="p-6">
            <div class="flex items-start justify-between">
              <div class="flex-1">
                <div class="flex items-center">
                  <h3 class="text-lg font-semibold text-gray-900">
                    SesiÃ³n #{{ session.session_number }}
                  </h3>
                  <span
                    class="ml-3 px-3 py-1 text-xs font-medium rounded-full"
                    :class="getStatusClass(session.attendance_status)"
                  >
                    {{ getStatusLabel(session.attendance_status) }}
                  </span>
                </div>
                <p class="mt-1 text-sm text-gray-600">
                  <span class="font-medium">NiÃ±o:</span> {{ session.child_name || 'No especificado' }}
                </p>
                <div class="mt-2 flex items-center text-sm text-gray-500 space-x-4">
                  <span class="flex items-center">
                    <svg class="h-4 w-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>
                    {{ formatDate(session.scheduled_date) }}
                  </span>
                  <span v-if="session.duration_minutes" class="flex items-center">
                    <svg class="h-4 w-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                    {{ session.duration_minutes }} min
                  </span>
                </div>
              </div>
              <div class="flex items-center space-x-2">
                <button
                  @click="verDetalleSesion(session)"
                  class="px-4 py-2 text-sm font-medium text-blue-600 hover:text-blue-700 hover:bg-blue-50 rounded-md transition-colors duration-150"
                >
                  Ver Detalles
                </button>
                <button
                  @click="documentarSesion(session)"
                  class="px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-md transition-colors duration-150"
                >
                  Documentar
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Estado VacÃ­o -->
      <div v-else class="text-center py-12">
        <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>
        <h3 class="mt-2 text-sm font-medium text-gray-900">No hay sesiones</h3>
        <p class="mt-1 text-sm text-gray-500">
          No se encontraron sesiones con los filtros aplicados.
        </p>
      </div>
    </main>

    <!-- Modal para ver Detalles (se renderiza cuando es necesario) -->
    <VerDetalleSesion
      v-if="sesionParaVer"
      v-model:show="isDetalleModalOpen"
      :session-data="sesionParaVer"
    />
  </div>
</template>

<script setup lang="ts">
import { ref, computed, onMounted } from 'vue';
import { useRouter } from 'vue-router';
import { useAlertModalStore } from '@/store/alertModalStore';
import { getAllTherapySessions, type TherapySession } from '@/services/sessionService'; 
import VerDetalleSesion from '@/components/sesiones/VerDetalleSesion.vue';

const router = useRouter();
const alertModal = useAlertModalStore();

// --- ESTADO ---
const isLoading = ref(true);
const sessions = ref<TherapySession[]>([]);
const searchQuery = ref('');
const filterStatus = ref('');
const filterDate = ref('');

// --- ESTADO PARA EL MODAL DE DETALLES ---
const isDetalleModalOpen = ref(false);
const sesionParaVer = ref<TherapySession | null>(null);


// --- LIFECYCLE ---
onMounted(async () => {
  await loadSessions();
});

// --- CARGA DE DATOS ---
async function loadSessions() {
  isLoading.value = true;
  try {
    // âœ… REEMPLAZADO: Ahora llama a la funciÃ³n del servicio que obtiene todas las sesiones.
    sessions.value = await getAllTherapySessions();
  } catch (error) {
    console.error('Error al cargar sesiones:', error);
    alertModal.error('Error', 'No se pudieron cargar las sesiones. AsegÃºrate de que el endpoint /api/seguimiento/sesiones-terapia/all/ exista en el backend.');
  } finally {
    isLoading.value = false;
  }
}

// --- COMPUTED ---
const filteredSessions = computed(() => {
  return sessions.value.filter(session => {
    const matchesSearch = !searchQuery.value || 
      (session.child_name && session.child_name.toLowerCase().includes(searchQuery.value.toLowerCase()));
    const matchesStatus = !filterStatus.value || session.attendance_status === filterStatus.value;
    const matchesDate = !filterDate.value || (session.scheduled_date && session.scheduled_date.startsWith(filterDate.value));
    
    return matchesSearch && matchesStatus && matchesDate;
  });
});

// --- UTILIDADES ---
function getStatusClass(status: string | null) {
  const classes: { [key: string]: string } = {
    asistio: 'bg-green-100 text-green-800',
    pendiente: 'bg-yellow-100 text-yellow-800',
    cancelado_familia: 'bg-red-100 text-red-800',
    // AÃ±ade mÃ¡s estados si los tienes en tu modelo
  };
  return classes[status || 'pendiente'] || 'bg-gray-100 text-gray-800';
}

function getStatusLabel(status: string | null) {
  const labels: { [key: string]: string } = {
    asistio: 'AsistiÃ³',
    pendiente: 'Pendiente',
    cancelado_familia: 'Cancelada',
    // AÃ±ade mÃ¡s etiquetas si las tienes
  };
  return labels[status || 'pendiente'] || status || 'No definido';
}

function formatDate(date: string) {
  if (!date) return 'Sin fecha';
  return new Date(date).toLocaleDateString('es-CL', { year: 'numeric', month: 'long', day: 'numeric' });
}

// --- ACCIONES ---
function documentarSesion(session: TherapySession) {
  // âœ… CORREGIDO: Se pasan ambos IDs dinÃ¡micamente a la ruta de documentaciÃ³n.
  router.push({ 
    name: 'documentar-sesion',
    params: { 
      // La API anidada necesita tanto el ID del niÃ±o como el de la sesiÃ³n.
      childId: session.child, 
      sessionId: session.id 
    } 
  });
}

function verDetalleSesion(session: TherapySession) {
  sesionParaVer.value = session;
  isDetalleModalOpen.value = true;
}

function crearNuevaSesion() {
  // TODO: Implementar un modal que primero pregunte para quÃ© niÃ±o es la sesiÃ³n
  alertModal.info('PrÃ³ximamente', 'La funcionalidad para crear una nueva sesiÃ³n desde esta vista estarÃ¡ disponible pronto.');
}
</script>

============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\src\views\errors\NotFoundView.vue
============================================================
<template>
  <div class="min-h-screen flex items-center justify-center bg-gray-100">
    <div class="text-center">
      <h1 class="text-6xl font-bold text-gray-900">404</h1>
      <p class="text-2xl font-medium text-gray-600 mt-4">PÃ¡gina no encontrada</p>
      <p class="text-gray-500 mt-2">Lo sentimos, no pudimos encontrar la pÃ¡gina que estÃ¡s buscando.</p>
      <router-link 
        to="/" 
        class="mt-6 inline-block px-4 py-2 bg-[#132441] text-white rounded-md hover:bg-[#3c5690] transition-colors"
      >
        Volver al inicio
      </router-link>
    </div>
  </div>
</template>

<script setup lang="ts">
</script>
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\tailwind.config.js
============================================================
/* tailwind.config.js */
import formkitTheme from '@formkit/themes/tailwindcss'
import forms from '@tailwindcss/forms'

/** @type {import('tailwindcss').Config} */
export default {
  content: [
    './index.html',
    './src/**/*.{vue,ts,js,jsx,tsx}',
    './tailwind-formkit-theme.js'
  ],
  safelist: [
    'priority-alta',
    'priority-media',
    'priority-baja',
    'bg-red-100',
    'text-red-800',
    'bg-yellow-100',
    'text-yellow-800',
    'bg-green-100',
    'text-green-800',
    // ğŸ”¥ Safelist para clases dinÃ¡micas por rol
    'from-parent-600',
    'to-parent-800',
    'from-therapist-600',
    'to-therapist-800',
    'from-admin-600',
    'to-admin-800',
    'bg-parent-500',
    'bg-therapist-500',
    'bg-admin-500',
    'text-parent-600',
    'text-therapist-600',
    'text-admin-600',
  ],
  theme: {
    extend: {
      // ====================
      // ğŸ”¥ COLORES POR ROL
      // ====================
      colors: {
        // Colores legacy (mantener compatibilidad)
        'sidebar': '#132441',
        'color3': '#3c5690',
        'color4': '#708fea',
        'color5': '#adceff',

        // ğŸ”¥ NUEVO: Colores para PADRES
            parent: {
          50: '#f0f9ff',   // Azul muy claro (casi blanco)
          100: '#e0f2fe',  // Azul cielo claro
          200: '#bae6fd',  // Azul cielo
          300: '#7dd3fc',  // Azul claro
          400: '#38bdf8',  // Azul medio-claro
          500: '#0ea5e9',  // Azul principal
          600: '#0284c7',  // Azul medio
          700: '#0369a1',  // Azul medio-oscuro
          800: '#075985',  // Azul oscuro
          900: '#0c4a6e',  // Azul muy oscuro
        },

        // ğŸ”¥ COLORES PARA TERAPEUTAS (profesional)
        therapist: {
          50: '#eff6ff',   // Azul muy claro
          100: '#dbeafe',  // Azul claro
          200: '#bfdbfe',  // Azul suave
          300: '#93c5fd',  // Azul medio
          400: '#60a5fa',  // Azul vibrante
          500: '#3b82f6',  // Azul principal
          600: '#2563eb',  // Azul oscuro
          700: '#1d4ed8',  // Azul muy oscuro
          800: '#1e40af',  // Azul marino
          900: '#1e3a8a',  // Azul profundo
        },

        // ğŸ”¥ NUEVO: Colores para ADMIN (autoridad)
        admin: {
          50: '#faf5ff',   // PÃºrpura muy claro
          100: '#f3e8ff',  // PÃºrpura claro
          200: '#e9d5ff',  // PÃºrpura suave
          300: '#d8b4fe',  // PÃºrpura medio
          400: '#c084fc',  // PÃºrpura vibrante
          500: '#a855f7',  // PÃºrpura principal
          600: '#9333ea',  // PÃºrpura oscuro
          700: '#7e22ce',  // PÃºrpura muy oscuro
          800: '#6b21a8',  // Violeta oscuro
          900: '#581c87',  // Violeta profundo
        },

        // Colores principales (alias para therapist - compatibilidad)
        primary: {
          50: '#eff6ff',
          100: '#dbeafe',
          200: '#bfdbfe',
          300: '#93c5fd',
          400: '#60a5fa',
          500: '#3b82f6',
          600: '#2563eb',
          700: '#1d4ed8',
          800: '#1e40af',
          900: '#1e3a8a',
        },
        
        // Colores semÃ¡nticos (sin cambios)
        success: {
          50: '#f0fdf4',
          100: '#dcfce7',
          200: '#bbf7d0',
          300: '#86efac',
          400: '#4ade80',
          500: '#22c55e',
          600: '#16a34a',
          700: '#15803d',
          800: '#166534',
          900: '#14532d',
        },
        
        warning: {
          50: '#fffbeb',
          100: '#fef3c7',
          200: '#fde68a',
          300: '#fcd34d',
          400: '#fbbf24',
          500: '#f59e0b',
          600: '#d97706',
          700: '#b45309',
          800: '#92400e',
          900: '#78350f',
        },
        
        error: {
          50: '#fef2f2',
          100: '#fee2e2',
          200: '#fecaca',
          300: '#fca5a5',
          400: '#f87171',
          500: '#ef4444',
          600: '#dc2626',
          700: '#b91c1c',
          800: '#991b1b',
          900: '#7f1d1d',
        },
        
        gray: {
          50: '#f8fafc',
          100: '#f1f5f9',
          200: '#e2e8f0',
          300: '#cbd5e1',
          400: '#94a3b8',
          500: '#64748b',
          600: '#475569',
          700: '#334155',
          800: '#1e293b',
          900: '#0f172a',
        }
      },

      // ====================
      // ğŸ”¥ GRADIENTES POR ROL
      // ====================
      backgroundImage: {
        // Gradientes para padres
        'gradient-parent': 'linear-gradient(135deg, #0891b2 0%, #164e63 100%)',
        'gradient-parent-soft': 'linear-gradient(135deg, #06b6d4 0%, #0e7490 100%)',
        
        // Gradientes para terapeutas
        'gradient-therapist': 'linear-gradient(135deg, #2563eb 0%, #1e3a8a 100%)',
        'gradient-therapist-soft': 'linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)',
        
        // Gradientes para admin
        'gradient-admin': 'linear-gradient(135deg, #9333ea 0%, #581c87 100%)',
        'gradient-admin-soft': 'linear-gradient(135deg, #a855f7 0%, #7e22ce 100%)',
      },

      // ====================
      // TIPOGRAFÃA
      // ====================
      fontFamily: {
        sans: ['Inter', 'system-ui', 'sans-serif'],
        display: ['Inter', 'system-ui', 'sans-serif'],
      },

      // ====================
      // ESPACIADO
      // ====================
      spacing: {
        '18': '4.5rem',
        '88': '22rem',
        '128': '32rem',
      },

      // ====================
      // BORDES Y SOMBRAS
      // ====================
      borderRadius: {
        '4xl': '2rem',
      },
      
      boxShadow: {
        'soft': '0 2px 15px -3px rgba(0, 0, 0, 0.07), 0 10px 20px -2px rgba(0, 0, 0, 0.04)',
        'medium': '0 4px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)',
        'parent': '0 4px 25px -5px rgba(8, 145, 178, 0.2), 0 10px 10px -5px rgba(8, 145, 178, 0.1)',
        'admin': '0 4px 25px -5px rgba(147, 51, 234, 0.2), 0 10px 10px -5px rgba(147, 51, 234, 0.1)',
      },

      // ====================
      // ğŸ”¥ ANIMACIONES Y TRANSICIONES MEJORADAS
      // ====================
      animation: {
        'fade-in': 'fadeIn 0.5s ease-in-out',
        'fade-in-fast': 'fadeIn 0.3s ease-in-out',
        'slide-in': 'slideIn 0.3s ease-out',
        'slide-in-right': 'slideInRight 0.4s ease-out',
        'slide-in-left': 'slideInLeft 0.4s ease-out',
        'slide-up': 'slideUp 0.4s ease-out',
        'bounce-soft': 'bounceSoft 2s infinite',
        'pulse-soft': 'pulseSoft 2s cubic-bezier(0.4, 0, 0.6, 1) infinite',
        'scale-in': 'scaleIn 0.3s ease-out',
      },
      
      keyframes: {
        fadeIn: {
          '0%': { opacity: '0' },
          '100%': { opacity: '1' },
        },
        slideIn: {
          '0%': { transform: 'translateY(-10px)', opacity: '0' },
          '100%': { transform: 'translateY(0)', opacity: '1' },
        },
        slideInRight: {
          '0%': { transform: 'translateX(20px)', opacity: '0' },
          '100%': { transform: 'translateX(0)', opacity: '1' },
        },
        slideInLeft: {
          '0%': { transform: 'translateX(-20px)', opacity: '0' },
          '100%': { transform: 'translateX(0)', opacity: '1' },
        },
        slideUp: {
          '0%': { transform: 'translateY(20px)', opacity: '0' },
          '100%': { transform: 'translateY(0)', opacity: '1' },
        },
        bounceSoft: {
          '0%, 100%': { transform: 'translateY(-5%)' },
          '50%': { transform: 'translateY(0)' },
        },
        pulseSoft: {
          '0%, 100%': { opacity: '1' },
          '50%': { opacity: '.8' },
        },
        scaleIn: {
          '0%': { transform: 'scale(0.95)', opacity: '0' },
          '100%': { transform: 'scale(1)', opacity: '1' },
        },
      },

      // ====================
      // TRANSICIONES SUAVES
      // ====================
      transitionDuration: {
        '400': '400ms',
        '600': '600ms',
      },
      
      transitionTimingFunction: {
        'bounce-in': 'cubic-bezier(0.68, -0.55, 0.265, 1.55)',
        'smooth': 'cubic-bezier(0.4, 0, 0.2, 1)',
      },
    },
  },
  plugins: [
    forms,
    formkitTheme
  ],
}
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\tests\pasos\Paso1StepPersonal.spec.js
============================================================
"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g = Object.create((typeof Iterator === "function" ? Iterator : Object).prototype);
    return g.next = verb(0), g["throw"] = verb(1), g["return"] = verb(2), typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (g && (g = 0, op[0] && (_ = 0)), _) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
Object.defineProperty(exports, "__esModule", { value: true });
var vitest_1 = require("vitest");
var test_utils_1 = require("@vue/test-utils");
var vue_1 = require("vue");
var Paso1StepPersonal_vue_1 = require("../../src/components/forms/multi-step/pasos/Paso1StepPersonal.vue");
(0, vitest_1.describe)('Paso1StepPersonal.vue', function () {
    var wrapper;
    var defaultProps = {
        formData: {
            first_name: '',
            last_name: '',
            rut: '',
            birth_date: '',
            gender: 'unspecified'
        }
    };
    var createWrapper = function (props) {
        if (props === void 0) { props = defaultProps; }
        return (0, test_utils_1.mount)(Paso1StepPersonal_vue_1.default, {
            props: props,
            global: {
                stubs: {
                    FormKit: {
                        template: "\n              <div class=\"formkit-wrapper\">\n                <slot></slot>\n              </div>\n            ",
                        props: ['name', 'modelValue', 'type', 'label', 'validation', 'placeholder', 'options', 'validationMessages', 'classes']
                    },
                    CheckCircleIcon: {
                        template: '<svg class="check-icon" data-testid="check-icon"></svg>'
                    },
                    ExclamationCircleIcon: {
                        template: '<svg class="exclamation-icon" data-testid="exclamation-icon"></svg>'
                    }
                }
            }
        });
    };
    (0, vitest_1.beforeEach)(function () {
        wrapper = createWrapper();
    });
    (0, vitest_1.describe)('Renderizado', function () {
        (0, vitest_1.it)('debe renderizar el componente correctamente', function () {
            (0, vitest_1.expect)(wrapper.exists()).toBe(true);
        });
        (0, vitest_1.it)('debe mostrar el tÃ­tulo "Datos Personales"', function () {
            (0, vitest_1.expect)(wrapper.find('h2').text()).toBe('Datos Personales');
        });
        (0, vitest_1.it)('debe mostrar el nÃºmero de paso "1"', function () {
            (0, vitest_1.expect)(wrapper.find('.step-number').text()).toBe('1');
        });
        (0, vitest_1.it)('debe mostrar la descripciÃ³n del paso', function () {
            var description = wrapper.find('.step-title p');
            (0, vitest_1.expect)(description.exists()).toBe(true);
            (0, vitest_1.expect)(description.text()).toContain('InformaciÃ³n bÃ¡sica');
        });
        (0, vitest_1.it)('debe renderizar el header del paso con las clases correctas', function () {
            var header = wrapper.find('.step-header');
            (0, vitest_1.expect)(header.exists()).toBe(true);
            (0, vitest_1.expect)(header.classes()).toContain('step-header');
        });
    });
    (0, vitest_1.describe)('Estructura del componente', function () {
        (0, vitest_1.it)('debe tener el contenedor principal con clase step-personal', function () {
            (0, vitest_1.expect)(wrapper.find('.step-personal').exists()).toBe(true);
        });
        (0, vitest_1.it)('debe renderizar el formulario principal', function () {
            var form = wrapper.find('[id="personal-form"]');
            (0, vitest_1.expect)(form.exists()).toBe(true);
        });
        (0, vitest_1.it)('debe tener el contenedor form-grid', function () {
            var html = wrapper.html();
            (0, vitest_1.expect)(html).toContain('form-grid');
        });
    });
    (0, vitest_1.describe)('Campos del Formulario', function () {
        (0, vitest_1.it)('debe inicializar los campos vacÃ­os por defecto', function () {
            var vm = wrapper.vm;
            (0, vitest_1.expect)(vm.localData.first_name).toBe('');
            (0, vitest_1.expect)(vm.localData.last_name).toBe('');
            (0, vitest_1.expect)(vm.localData.rut).toBe('');
            (0, vitest_1.expect)(vm.localData.birth_date).toBe('');
        });
        (0, vitest_1.it)('debe inicializar el gÃ©nero como "unspecified"', function () {
            var vm = wrapper.vm;
            (0, vitest_1.expect)(vm.localData.gender).toBe('unspecified');
        });
        (0, vitest_1.it)('debe tener la estructura del formulario en el HTML', function () {
            var html = wrapper.html();
            (0, vitest_1.expect)(html).toContain('step-personal');
            (0, vitest_1.expect)(html).toContain('personal-form');
        });
    });
    (0, vitest_1.describe)('ValidaciÃ³n del Formulario', function () {
        (0, vitest_1.it)('debe marcar el paso como invÃ¡lido cuando los campos estÃ¡n vacÃ­os', function () {
            var vm = wrapper.vm;
            (0, vitest_1.expect)(vm.isStepValid).toBe(false);
        });
        (0, vitest_1.it)('debe marcar el paso como vÃ¡lido cuando se completan los campos requeridos', function () { return __awaiter(void 0, void 0, void 0, function () {
            var vm;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        vm = wrapper.vm;
                        vm.localData.first_name = 'Juan';
                        vm.localData.last_name = 'PÃ©rez';
                        vm.localData.birth_date = '2015-01-01';
                        return [4 /*yield*/, (0, vue_1.nextTick)()];
                    case 1:
                        _a.sent();
                        (0, vitest_1.expect)(vm.isStepValid).toBe(true);
                        return [2 /*return*/];
                }
            });
        }); });
        (0, vitest_1.it)('debe validar que los nombres tengan al menos 2 caracteres', function () { return __awaiter(void 0, void 0, void 0, function () {
            var vm;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        vm = wrapper.vm;
                        vm.localData.first_name = 'J';
                        vm.localData.last_name = 'PÃ©rez';
                        vm.localData.birth_date = '2015-01-01';
                        return [4 /*yield*/, (0, vue_1.nextTick)()];
                    case 1:
                        _a.sent();
                        (0, vitest_1.expect)(vm.isStepValid).toBe(false);
                        return [2 /*return*/];
                }
            });
        }); });
        (0, vitest_1.it)('debe validar que los apellidos tengan al menos 2 caracteres', function () { return __awaiter(void 0, void 0, void 0, function () {
            var vm;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        vm = wrapper.vm;
                        vm.localData.first_name = 'Juan';
                        vm.localData.last_name = 'P';
                        vm.localData.birth_date = '2015-01-01';
                        return [4 /*yield*/, (0, vue_1.nextTick)()];
                    case 1:
                        _a.sent();
                        (0, vitest_1.expect)(vm.isStepValid).toBe(false);
                        return [2 /*return*/];
                }
            });
        }); });
        (0, vitest_1.it)('debe requerir fecha de nacimiento', function () { return __awaiter(void 0, void 0, void 0, function () {
            var vm;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        vm = wrapper.vm;
                        vm.localData.first_name = 'Juan';
                        vm.localData.last_name = 'PÃ©rez';
                        vm.localData.birth_date = '';
                        return [4 /*yield*/, (0, vue_1.nextTick)()];
                    case 1:
                        _a.sent();
                        (0, vitest_1.expect)(vm.isStepValid).toBe(false);
                        return [2 /*return*/];
                }
            });
        }); });
        (0, vitest_1.it)('debe permitir nombres con exactamente 2 caracteres', function () { return __awaiter(void 0, void 0, void 0, function () {
            var vm;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        vm = wrapper.vm;
                        vm.localData.first_name = 'Jo';
                        vm.localData.last_name = 'PÃ©rez';
                        vm.localData.birth_date = '2015-01-01';
                        return [4 /*yield*/, (0, vue_1.nextTick)()];
                    case 1:
                        _a.sent();
                        (0, vitest_1.expect)(vm.isStepValid).toBe(true);
                        return [2 /*return*/];
                }
            });
        }); });
        (0, vitest_1.it)('debe permitir nombres largos', function () { return __awaiter(void 0, void 0, void 0, function () {
            var vm;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        vm = wrapper.vm;
                        vm.localData.first_name = 'Juan Carlos Alberto';
                        vm.localData.last_name = 'PÃ©rez GonzÃ¡lez';
                        vm.localData.birth_date = '2015-01-01';
                        return [4 /*yield*/, (0, vue_1.nextTick)()];
                    case 1:
                        _a.sent();
                        (0, vitest_1.expect)(vm.isStepValid).toBe(true);
                        return [2 /*return*/];
                }
            });
        }); });
        (0, vitest_1.it)('debe validar correctamente con todos los campos completos', function () { return __awaiter(void 0, void 0, void 0, function () {
            var vm;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        vm = wrapper.vm;
                        vm.localData.first_name = 'MarÃ­a';
                        vm.localData.last_name = 'GonzÃ¡lez';
                        vm.localData.rut = '12.345.678-9';
                        vm.localData.birth_date = '2015-03-15';
                        vm.localData.gender = 'female';
                        return [4 /*yield*/, (0, vue_1.nextTick)()];
                    case 1:
                        _a.sent();
                        (0, vitest_1.expect)(vm.isStepValid).toBe(true);
                        return [2 /*return*/];
                }
            });
        }); });
    });
    (0, vitest_1.describe)('CÃ¡lculo de Edad', function () {
        (0, vitest_1.it)('debe calcular la edad correctamente para 10 aÃ±os', function () { return __awaiter(void 0, void 0, void 0, function () {
            var vm, birthDate;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        vm = wrapper.vm;
                        birthDate = new Date();
                        birthDate.setFullYear(birthDate.getFullYear() - 10);
                        vm.localData.birth_date = birthDate.toISOString().split('T')[0];
                        return [4 /*yield*/, (0, vue_1.nextTick)()];
                    case 1:
                        _a.sent();
                        (0, vitest_1.expect)(vm.calculatedAge).toBe(10);
                        return [2 /*return*/];
                }
            });
        }); });
        (0, vitest_1.it)('debe calcular la edad correctamente para 5 aÃ±os', function () { return __awaiter(void 0, void 0, void 0, function () {
            var vm, birthDate;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        vm = wrapper.vm;
                        birthDate = new Date();
                        birthDate.setFullYear(birthDate.getFullYear() - 5);
                        vm.localData.birth_date = birthDate.toISOString().split('T')[0];
                        return [4 /*yield*/, (0, vue_1.nextTick)()];
                    case 1:
                        _a.sent();
                        (0, vitest_1.expect)(vm.calculatedAge).toBe(5);
                        return [2 /*return*/];
                }
            });
        }); });
        (0, vitest_1.it)('debe retornar null cuando no hay fecha de nacimiento', function () {
            var vm = wrapper.vm;
            vm.localData.birth_date = '';
            (0, vitest_1.expect)(vm.calculatedAge).toBe(null);
        });
        (0, vitest_1.it)('debe renderizar la informaciÃ³n de edad cuando hay fecha vÃ¡lida', function () { return __awaiter(void 0, void 0, void 0, function () {
            var vm, birthDate, html;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        vm = wrapper.vm;
                        birthDate = new Date();
                        birthDate.setFullYear(birthDate.getFullYear() - 8);
                        vm.localData.birth_date = birthDate.toISOString().split('T')[0];
                        return [4 /*yield*/, (0, vue_1.nextTick)()
                            // Verificar que el campo calculatedAge existe y es correcto
                        ];
                    case 1:
                        _a.sent();
                        // Verificar que el campo calculatedAge existe y es correcto
                        (0, vitest_1.expect)(vm.calculatedAge).toBe(8);
                        html = wrapper.html();
                        (0, vitest_1.expect)(html).toContain('8 aÃ±os');
                        return [2 /*return*/];
                }
            });
        }); });
        (0, vitest_1.it)('debe mostrar texto de edad basado en fecha de nacimiento', function () { return __awaiter(void 0, void 0, void 0, function () {
            var vm, birthDate, html;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        vm = wrapper.vm;
                        birthDate = new Date();
                        birthDate.setFullYear(birthDate.getFullYear() - 7);
                        vm.localData.birth_date = birthDate.toISOString().split('T')[0];
                        return [4 /*yield*/, (0, vue_1.nextTick)()];
                    case 1:
                        _a.sent();
                        html = wrapper.html();
                        (0, vitest_1.expect)(html).toContain('Basado en la fecha de nacimiento');
                        return [2 /*return*/];
                }
            });
        }); });
        (0, vitest_1.it)('no debe mostrar informaciÃ³n de edad cuando no hay fecha', function () { return __awaiter(void 0, void 0, void 0, function () {
            var vm, html;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        vm = wrapper.vm;
                        vm.localData.birth_date = '';
                        return [4 /*yield*/, (0, vue_1.nextTick)()];
                    case 1:
                        _a.sent();
                        (0, vitest_1.expect)(vm.calculatedAge).toBe(null);
                        html = wrapper.html();
                        (0, vitest_1.expect)(html).not.toContain('aÃ±os');
                        return [2 /*return*/];
                }
            });
        }); });
        (0, vitest_1.it)('debe calcular correctamente cuando el cumpleaÃ±os no ha ocurrido este aÃ±o', function () { return __awaiter(void 0, void 0, void 0, function () {
            var vm, today, birthDate;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        vm = wrapper.vm;
                        today = new Date();
                        birthDate = new Date(today.getFullYear() - 10, today.getMonth() + 1, today.getDate());
                        vm.localData.birth_date = birthDate.toISOString().split('T')[0];
                        return [4 /*yield*/, (0, vue_1.nextTick)()
                            // DeberÃ­a ser 9 aÃ±os porque el cumpleaÃ±os aÃºn no ocurre
                        ];
                    case 1:
                        _a.sent();
                        // DeberÃ­a ser 9 aÃ±os porque el cumpleaÃ±os aÃºn no ocurre
                        (0, vitest_1.expect)(vm.calculatedAge).toBe(9);
                        return [2 /*return*/];
                }
            });
        }); });
    });
    (0, vitest_1.describe)('Eventos Emitidos', function () {
        (0, vitest_1.it)('debe emitir update:formData cuando cambian los datos', function () { return __awaiter(void 0, void 0, void 0, function () {
            var vm;
            var _a;
            return __generator(this, function (_b) {
                switch (_b.label) {
                    case 0:
                        vm = wrapper.vm;
                        vm.localData.first_name = 'Juan';
                        vm.handleFormChange();
                        return [4 /*yield*/, (0, vue_1.nextTick)()];
                    case 1:
                        _b.sent();
                        (0, vitest_1.expect)(wrapper.emitted('update:formData')).toBeTruthy();
                        (0, vitest_1.expect)((_a = wrapper.emitted('update:formData')) === null || _a === void 0 ? void 0 : _a.length).toBeGreaterThan(0);
                        return [2 /*return*/];
                }
            });
        }); });
        (0, vitest_1.it)('debe emitir los datos correctos en update:formData', function () { return __awaiter(void 0, void 0, void 0, function () {
            var vm, emitted;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        vm = wrapper.vm;
                        vm.localData.first_name = 'MarÃ­a';
                        vm.localData.last_name = 'LÃ³pez';
                        vm.handleFormChange();
                        return [4 /*yield*/, (0, vue_1.nextTick)()];
                    case 1:
                        _a.sent();
                        emitted = wrapper.emitted('update:formData');
                        (0, vitest_1.expect)(emitted).toBeTruthy();
                        (0, vitest_1.expect)(emitted[0][0]).toMatchObject({
                            first_name: 'MarÃ­a',
                            last_name: 'LÃ³pez'
                        });
                        return [2 /*return*/];
                }
            });
        }); });
        (0, vitest_1.it)('debe emitir validate con el estado correcto (vÃ¡lido)', function () { return __awaiter(void 0, void 0, void 0, function () {
            var vm, validateEvents;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        vm = wrapper.vm;
                        vm.localData.first_name = 'Juan';
                        vm.localData.last_name = 'PÃ©rez';
                        vm.localData.birth_date = '2015-01-01';
                        vm.handleFormChange();
                        return [4 /*yield*/, (0, vue_1.nextTick)()];
                    case 1:
                        _a.sent();
                        validateEvents = wrapper.emitted('validate');
                        (0, vitest_1.expect)(validateEvents).toBeTruthy();
                        (0, vitest_1.expect)(validateEvents[validateEvents.length - 1]).toEqual([true]);
                        return [2 /*return*/];
                }
            });
        }); });
        (0, vitest_1.it)('debe emitir validate con false cuando el formulario es invÃ¡lido', function () { return __awaiter(void 0, void 0, void 0, function () {
            var vm, validateEvents;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        vm = wrapper.vm;
                        vm.localData.first_name = 'J';
                        vm.handleFormChange();
                        return [4 /*yield*/, (0, vue_1.nextTick)()];
                    case 1:
                        _a.sent();
                        validateEvents = wrapper.emitted('validate');
                        (0, vitest_1.expect)(validateEvents).toBeTruthy();
                        (0, vitest_1.expect)(validateEvents[validateEvents.length - 1]).toEqual([false]);
                        return [2 /*return*/];
                }
            });
        }); });
        (0, vitest_1.it)('debe emitir ambos eventos al cambiar el formulario', function () { return __awaiter(void 0, void 0, void 0, function () {
            var vm;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        vm = wrapper.vm;
                        vm.localData.first_name = 'Test';
                        vm.handleFormChange();
                        return [4 /*yield*/, (0, vue_1.nextTick)()];
                    case 1:
                        _a.sent();
                        (0, vitest_1.expect)(wrapper.emitted('update:formData')).toBeTruthy();
                        (0, vitest_1.expect)(wrapper.emitted('validate')).toBeTruthy();
                        return [2 /*return*/];
                }
            });
        }); });
    });
    (0, vitest_1.describe)('MÃ©todo validate expuesto', function () {
        (0, vitest_1.it)('debe exponer el mÃ©todo validate', function () {
            var vm = wrapper.vm;
            (0, vitest_1.expect)(typeof vm.validate).toBe('function');
        });
        (0, vitest_1.it)('el mÃ©todo validate debe retornar true cuando es vÃ¡lido', function () { return __awaiter(void 0, void 0, void 0, function () {
            var vm, result;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        vm = wrapper.vm;
                        vm.localData.first_name = 'Juan';
                        vm.localData.last_name = 'PÃ©rez';
                        vm.localData.birth_date = '2015-01-01';
                        return [4 /*yield*/, (0, vue_1.nextTick)()];
                    case 1:
                        _a.sent();
                        result = vm.validate();
                        (0, vitest_1.expect)(result).toBe(true);
                        return [2 /*return*/];
                }
            });
        }); });
        (0, vitest_1.it)('el mÃ©todo validate debe retornar false cuando es invÃ¡lido', function () { return __awaiter(void 0, void 0, void 0, function () {
            var vm, result;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        vm = wrapper.vm;
                        vm.localData.first_name = '';
                        vm.localData.last_name = '';
                        vm.localData.birth_date = '';
                        return [4 /*yield*/, (0, vue_1.nextTick)()];
                    case 1:
                        _a.sent();
                        result = vm.validate();
                        (0, vitest_1.expect)(result).toBe(false);
                        return [2 /*return*/];
                }
            });
        }); });
        (0, vitest_1.it)('el mÃ©todo validate debe emitir el evento validate', function () {
            var vm = wrapper.vm;
            vm.validate();
            (0, vitest_1.expect)(wrapper.emitted('validate')).toBeTruthy();
        });
    });
    (0, vitest_1.describe)('InicializaciÃ³n con datos previos', function () {
        (0, vitest_1.it)('debe cargar datos completos desde props', function () { return __awaiter(void 0, void 0, void 0, function () {
            var propsWithData, wrapperWithData, vm;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        propsWithData = {
                            formData: {
                                first_name: 'MarÃ­a',
                                last_name: 'GonzÃ¡lez',
                                rut: '12.345.678-9',
                                birth_date: '2016-05-15',
                                gender: 'female'
                            }
                        };
                        wrapperWithData = createWrapper(propsWithData);
                        return [4 /*yield*/, (0, vue_1.nextTick)()];
                    case 1:
                        _a.sent();
                        vm = wrapperWithData.vm;
                        (0, vitest_1.expect)(vm.localData.first_name).toBe('MarÃ­a');
                        (0, vitest_1.expect)(vm.localData.last_name).toBe('GonzÃ¡lez');
                        (0, vitest_1.expect)(vm.localData.rut).toBe('12.345.678-9');
                        (0, vitest_1.expect)(vm.localData.birth_date).toBe('2016-05-15');
                        (0, vitest_1.expect)(vm.localData.gender).toBe('female');
                        return [2 /*return*/];
                }
            });
        }); });
        (0, vitest_1.it)('debe mantener el gÃ©nero unspecified por defecto', function () {
            var vm = wrapper.vm;
            (0, vitest_1.expect)(vm.localData.gender).toBe('unspecified');
        });
        (0, vitest_1.it)('debe cargar datos parciales correctamente', function () { return __awaiter(void 0, void 0, void 0, function () {
            var partialProps, wrapperPartial, vm;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        partialProps = {
                            formData: {
                                first_name: 'Pedro',
                                last_name: '',
                                rut: '',
                                birth_date: '',
                                gender: 'male'
                            }
                        };
                        wrapperPartial = createWrapper(partialProps);
                        return [4 /*yield*/, (0, vue_1.nextTick)()];
                    case 1:
                        _a.sent();
                        vm = wrapperPartial.vm;
                        (0, vitest_1.expect)(vm.localData.first_name).toBe('Pedro');
                        (0, vitest_1.expect)(vm.localData.gender).toBe('male');
                        return [2 /*return*/];
                }
            });
        }); });
    });
    (0, vitest_1.describe)('Indicador de validaciÃ³n', function () {
        (0, vitest_1.it)('debe tener informaciÃ³n de validaciÃ³n en el HTML', function () {
            var html = wrapper.html();
            (0, vitest_1.expect)(html).toContain('validation-info');
        });
        (0, vitest_1.it)('debe mostrar mensaje segÃºn estado de validaciÃ³n en HTML', function () { return __awaiter(void 0, void 0, void 0, function () {
            var html;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, (0, vue_1.nextTick)()];
                    case 1:
                        _a.sent();
                        html = wrapper.html();
                        (0, vitest_1.expect)(html).toContain('Complete los campos obligatorios');
                        return [2 /*return*/];
                }
            });
        }); });
        (0, vitest_1.it)('debe cambiar mensaje cuando el formulario es vÃ¡lido', function () { return __awaiter(void 0, void 0, void 0, function () {
            var vm, html;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        vm = wrapper.vm;
                        vm.localData.first_name = 'Juan';
                        vm.localData.last_name = 'PÃ©rez';
                        vm.localData.birth_date = '2015-01-01';
                        return [4 /*yield*/, (0, vue_1.nextTick)()];
                    case 1:
                        _a.sent();
                        html = wrapper.html();
                        (0, vitest_1.expect)(html).toContain('Todos los campos requeridos estÃ¡n completos');
                        return [2 /*return*/];
                }
            });
        }); });
        (0, vitest_1.it)('debe aplicar clase is-valid cuando el formulario es vÃ¡lido', function () { return __awaiter(void 0, void 0, void 0, function () {
            var vm, html;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        vm = wrapper.vm;
                        vm.localData.first_name = 'Juan';
                        vm.localData.last_name = 'PÃ©rez';
                        vm.localData.birth_date = '2015-01-01';
                        return [4 /*yield*/, (0, vue_1.nextTick)()];
                    case 1:
                        _a.sent();
                        html = wrapper.html();
                        (0, vitest_1.expect)(html).toContain('is-valid');
                        return [2 /*return*/];
                }
            });
        }); });
        (0, vitest_1.it)('debe mostrar el icono de error cuando es invÃ¡lido', function () { return __awaiter(void 0, void 0, void 0, function () {
            var vm, validationIcon, svg;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        vm = wrapper.vm;
                        return [4 /*yield*/, (0, vue_1.nextTick)()
                            // Verificar que el estado es invÃ¡lido
                        ];
                    case 1:
                        _a.sent();
                        // Verificar que el estado es invÃ¡lido
                        (0, vitest_1.expect)(vm.isStepValid).toBe(false);
                        validationIcon = wrapper.find('.validation-icon');
                        (0, vitest_1.expect)(validationIcon.exists()).toBe(true);
                        svg = validationIcon.find('svg');
                        (0, vitest_1.expect)(svg.exists()).toBe(true);
                        return [2 /*return*/];
                }
            });
        }); });
        (0, vitest_1.it)('debe mostrar el icono de Ã©xito cuando es vÃ¡lido', function () { return __awaiter(void 0, void 0, void 0, function () {
            var vm, validationIcon, svg, validationInfo;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        vm = wrapper.vm;
                        vm.localData.first_name = 'Juan';
                        vm.localData.last_name = 'PÃ©rez';
                        vm.localData.birth_date = '2015-01-01';
                        return [4 /*yield*/, (0, vue_1.nextTick)()
                            // Verificar que el estado es vÃ¡lido
                        ];
                    case 1:
                        _a.sent();
                        // Verificar que el estado es vÃ¡lido
                        (0, vitest_1.expect)(vm.isStepValid).toBe(true);
                        validationIcon = wrapper.find('.validation-icon');
                        (0, vitest_1.expect)(validationIcon.exists()).toBe(true);
                        svg = validationIcon.find('svg');
                        (0, vitest_1.expect)(svg.exists()).toBe(true);
                        validationInfo = wrapper.find('.validation-info');
                        (0, vitest_1.expect)(validationInfo.classes()).toContain('is-valid');
                        return [2 /*return*/];
                }
            });
        }); });
    });
    (0, vitest_1.describe)('Opciones de gÃ©nero', function () {
        (0, vitest_1.it)('debe tener las opciones de gÃ©nero definidas', function () {
            var vm = wrapper.vm;
            (0, vitest_1.expect)(vm.genderOptions).toEqual({
                unspecified: 'No especifica',
                male: 'Masculino',
                female: 'Femenino',
                other: 'Otro'
            });
        });
        (0, vitest_1.it)('debe tener 4 opciones de gÃ©nero', function () {
            var vm = wrapper.vm;
            var options = Object.keys(vm.genderOptions);
            (0, vitest_1.expect)(options.length).toBe(4);
        });
        (0, vitest_1.it)('debe incluir la opciÃ³n "No especifica"', function () {
            var vm = wrapper.vm;
            (0, vitest_1.expect)(vm.genderOptions.unspecified).toBe('No especifica');
        });
        (0, vitest_1.it)('debe incluir las opciones binarias', function () {
            var vm = wrapper.vm;
            (0, vitest_1.expect)(vm.genderOptions.male).toBe('Masculino');
            (0, vitest_1.expect)(vm.genderOptions.female).toBe('Femenino');
        });
        (0, vitest_1.it)('debe incluir la opciÃ³n "Otro"', function () {
            var vm = wrapper.vm;
            (0, vitest_1.expect)(vm.genderOptions.other).toBe('Otro');
        });
    });
    (0, vitest_1.describe)('Campo RUT (opcional)', function () {
        (0, vitest_1.it)('debe permitir RUT vacÃ­o sin afectar validaciÃ³n', function () { return __awaiter(void 0, void 0, void 0, function () {
            var vm;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        vm = wrapper.vm;
                        vm.localData.first_name = 'Juan';
                        vm.localData.last_name = 'PÃ©rez';
                        vm.localData.birth_date = '2015-01-01';
                        vm.localData.rut = '';
                        return [4 /*yield*/, (0, vue_1.nextTick)()];
                    case 1:
                        _a.sent();
                        (0, vitest_1.expect)(vm.isStepValid).toBe(true);
                        return [2 /*return*/];
                }
            });
        }); });
        (0, vitest_1.it)('debe permitir RUT con formato vÃ¡lido', function () { return __awaiter(void 0, void 0, void 0, function () {
            var vm;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        vm = wrapper.vm;
                        vm.localData.first_name = 'Juan';
                        vm.localData.last_name = 'PÃ©rez';
                        vm.localData.birth_date = '2015-01-01';
                        vm.localData.rut = '12.345.678-9';
                        return [4 /*yield*/, (0, vue_1.nextTick)()];
                    case 1:
                        _a.sent();
                        (0, vitest_1.expect)(vm.isStepValid).toBe(true);
                        return [2 /*return*/];
                }
            });
        }); });
    });
    (0, vitest_1.describe)('Reactivity', function () {
        (0, vitest_1.it)('debe actualizar isStepValid cuando cambian los datos', function () { return __awaiter(void 0, void 0, void 0, function () {
            var vm;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        vm = wrapper.vm;
                        (0, vitest_1.expect)(vm.isStepValid).toBe(false);
                        vm.localData.first_name = 'Juan';
                        return [4 /*yield*/, (0, vue_1.nextTick)()];
                    case 1:
                        _a.sent();
                        (0, vitest_1.expect)(vm.isStepValid).toBe(false);
                        vm.localData.last_name = 'PÃ©rez';
                        return [4 /*yield*/, (0, vue_1.nextTick)()];
                    case 2:
                        _a.sent();
                        (0, vitest_1.expect)(vm.isStepValid).toBe(false);
                        vm.localData.birth_date = '2015-01-01';
                        return [4 /*yield*/, (0, vue_1.nextTick)()];
                    case 3:
                        _a.sent();
                        (0, vitest_1.expect)(vm.isStepValid).toBe(true);
                        return [2 /*return*/];
                }
            });
        }); });
        (0, vitest_1.it)('debe recalcular edad cuando cambia la fecha', function () { return __awaiter(void 0, void 0, void 0, function () {
            var vm, date1, date2;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        vm = wrapper.vm;
                        date1 = new Date();
                        date1.setFullYear(date1.getFullYear() - 5);
                        vm.localData.birth_date = date1.toISOString().split('T')[0];
                        return [4 /*yield*/, (0, vue_1.nextTick)()];
                    case 1:
                        _a.sent();
                        (0, vitest_1.expect)(vm.calculatedAge).toBe(5);
                        date2 = new Date();
                        date2.setFullYear(date2.getFullYear() - 10);
                        vm.localData.birth_date = date2.toISOString().split('T')[0];
                        return [4 /*yield*/, (0, vue_1.nextTick)()];
                    case 2:
                        _a.sent();
                        (0, vitest_1.expect)(vm.calculatedAge).toBe(10);
                        return [2 /*return*/];
                }
            });
        }); });
    });
    (0, vitest_1.describe)('Estilos y clases CSS', function () {
        (0, vitest_1.it)('debe tener la clase step-personal en el contenedor principal', function () {
            (0, vitest_1.expect)(wrapper.find('.step-personal').exists()).toBe(true);
        });
        (0, vitest_1.it)('debe aplicar las clases correctas al step-number', function () {
            var stepNumber = wrapper.find('.step-number');
            (0, vitest_1.expect)(stepNumber.exists()).toBe(true);
        });
        (0, vitest_1.it)('debe tener estructura del formulario en el HTML', function () {
            var html = wrapper.html();
            (0, vitest_1.expect)(html).toContain('form-grid');
        });
    });
});

============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\tests\pasos\Paso1StepPersonal.spec.ts
============================================================
import { describe, it, expect, beforeEach } from 'vitest'
import { mount } from '@vue/test-utils'
import { nextTick } from 'vue'
import Paso1StepPersonal from '../../src/components/forms/multi-step/pasos/Paso1StepPersonal.vue'

describe('Paso1StepPersonal.vue', () => {
  let wrapper: any

  const defaultProps = {
    formData: {
      first_name: '',
      last_name: '',
      rut: '',
      birth_date: '',
      gender: 'unspecified'
    }
  }

  const createWrapper = (props = defaultProps) => {
    return mount(Paso1StepPersonal, {
      props,
      global: {
        stubs: {
          FormKit: {
            template: `
              <div class="formkit-wrapper">
                <slot></slot>
              </div>
            `,
            props: ['name', 'modelValue', 'type', 'label', 'validation', 'placeholder', 'options', 'validationMessages', 'classes']
          },
          CheckCircleIcon: { 
            template: '<svg class="check-icon" data-testid="check-icon"></svg>' 
          },
          ExclamationCircleIcon: { 
            template: '<svg class="exclamation-icon" data-testid="exclamation-icon"></svg>' 
          }
        }
      }
    })
  }

  beforeEach(() => {
    wrapper = createWrapper()
  })

  describe('Renderizado', () => {
    it('debe renderizar el componente correctamente', () => {
      expect(wrapper.exists()).toBe(true)
    })

    it('debe mostrar el tÃ­tulo "Datos Personales"', () => {
      expect(wrapper.find('h2').text()).toBe('Datos Personales')
    })

    it('debe mostrar el nÃºmero de paso "1"', () => {
      expect(wrapper.find('.step-number').text()).toBe('1')
    })

    it('debe mostrar la descripciÃ³n del paso', () => {
      const description = wrapper.find('.step-title p')
      expect(description.exists()).toBe(true)
      expect(description.text()).toContain('InformaciÃ³n bÃ¡sica')
    })

    it('debe renderizar el header del paso con las clases correctas', () => {
      const header = wrapper.find('.step-header')
      expect(header.exists()).toBe(true)
      expect(header.classes()).toContain('step-header')
    })
  })

  describe('Estructura del componente', () => {
    it('debe tener el contenedor principal con clase step-personal', () => {
      expect(wrapper.find('.step-personal').exists()).toBe(true)
    })

    it('debe renderizar el formulario principal', () => {
      const form = wrapper.find('[id="personal-form"]')
      expect(form.exists()).toBe(true)
    })

    it('debe tener el contenedor form-grid', () => {
      const html = wrapper.html()
      expect(html).toContain('form-grid')
    })
  })

  describe('Campos del Formulario', () => {
    it('debe inicializar los campos vacÃ­os por defecto', () => {
      const vm = wrapper.vm as any
      expect(vm.localData.first_name).toBe('')
      expect(vm.localData.last_name).toBe('')
      expect(vm.localData.rut).toBe('')
      expect(vm.localData.birth_date).toBe('')
    })

    it('debe inicializar el gÃ©nero como "unspecified"', () => {
      const vm = wrapper.vm as any
      expect(vm.localData.gender).toBe('unspecified')
    })

    it('debe tener la estructura del formulario en el HTML', () => {
      const html = wrapper.html()
      expect(html).toContain('step-personal')
      expect(html).toContain('personal-form')
    })
  })

  describe('ValidaciÃ³n del Formulario', () => {
    it('debe marcar el paso como invÃ¡lido cuando los campos estÃ¡n vacÃ­os', () => {
      const vm = wrapper.vm as any
      expect(vm.isStepValid).toBe(false)
    })

    it('debe marcar el paso como vÃ¡lido cuando se completan los campos requeridos', async () => {
      const vm = wrapper.vm as any
      vm.localData.first_name = 'Juan'
      vm.localData.last_name = 'PÃ©rez'
      vm.localData.birth_date = '2015-01-01'
      
      await nextTick()
      expect(vm.isStepValid).toBe(true)
    })

    it('debe validar que los nombres tengan al menos 2 caracteres', async () => {
      const vm = wrapper.vm as any
      vm.localData.first_name = 'J'
      vm.localData.last_name = 'PÃ©rez'
      vm.localData.birth_date = '2015-01-01'
      
      await nextTick()
      expect(vm.isStepValid).toBe(false)
    })

    it('debe validar que los apellidos tengan al menos 2 caracteres', async () => {
      const vm = wrapper.vm as any
      vm.localData.first_name = 'Juan'
      vm.localData.last_name = 'P'
      vm.localData.birth_date = '2015-01-01'
      
      await nextTick()
      expect(vm.isStepValid).toBe(false)
    })

    it('debe requerir fecha de nacimiento', async () => {
      const vm = wrapper.vm as any
      vm.localData.first_name = 'Juan'
      vm.localData.last_name = 'PÃ©rez'
      vm.localData.birth_date = ''
      
      await nextTick()
      expect(vm.isStepValid).toBe(false)
    })

    it('debe permitir nombres con exactamente 2 caracteres', async () => {
      const vm = wrapper.vm as any
      vm.localData.first_name = 'Jo'
      vm.localData.last_name = 'PÃ©rez'
      vm.localData.birth_date = '2015-01-01'
      
      await nextTick()
      expect(vm.isStepValid).toBe(true)
    })

    it('debe permitir nombres largos', async () => {
      const vm = wrapper.vm as any
      vm.localData.first_name = 'Juan Carlos Alberto'
      vm.localData.last_name = 'PÃ©rez GonzÃ¡lez'
      vm.localData.birth_date = '2015-01-01'
      
      await nextTick()
      expect(vm.isStepValid).toBe(true)
    })

    it('debe validar correctamente con todos los campos completos', async () => {
      const vm = wrapper.vm as any
      vm.localData.first_name = 'MarÃ­a'
      vm.localData.last_name = 'GonzÃ¡lez'
      vm.localData.rut = '12.345.678-9'
      vm.localData.birth_date = '2015-03-15'
      vm.localData.gender = 'female'
      
      await nextTick()
      expect(vm.isStepValid).toBe(true)
    })
  })

  describe('CÃ¡lculo de Edad', () => {
    it('debe calcular la edad correctamente para 10 aÃ±os', async () => {
      const vm = wrapper.vm as any
      const birthDate = new Date()
      birthDate.setFullYear(birthDate.getFullYear() - 10)
      
      vm.localData.birth_date = birthDate.toISOString().split('T')[0]
      await nextTick()
      
      expect(vm.calculatedAge).toBe(10)
    })

    it('debe calcular la edad correctamente para 5 aÃ±os', async () => {
      const vm = wrapper.vm as any
      const birthDate = new Date()
      birthDate.setFullYear(birthDate.getFullYear() - 5)
      
      vm.localData.birth_date = birthDate.toISOString().split('T')[0]
      await nextTick()
      
      expect(vm.calculatedAge).toBe(5)
    })

    it('debe retornar null cuando no hay fecha de nacimiento', () => {
      const vm = wrapper.vm as any
      vm.localData.birth_date = ''
      expect(vm.calculatedAge).toBe(null)
    })

    it('debe renderizar la informaciÃ³n de edad cuando hay fecha vÃ¡lida', async () => {
      const vm = wrapper.vm as any
      const birthDate = new Date()
      birthDate.setFullYear(birthDate.getFullYear() - 8)
      
      vm.localData.birth_date = birthDate.toISOString().split('T')[0]
      await nextTick()
      
      // Verificar que el campo calculatedAge existe y es correcto
      expect(vm.calculatedAge).toBe(8)
      
      // Verificar en el HTML
      const html = wrapper.html()
      expect(html).toContain('8 aÃ±os')
    })

    it('debe mostrar texto de edad basado en fecha de nacimiento', async () => {
      const vm = wrapper.vm as any
      const birthDate = new Date()
      birthDate.setFullYear(birthDate.getFullYear() - 7)
      
      vm.localData.birth_date = birthDate.toISOString().split('T')[0]
      await nextTick()
      
      const html = wrapper.html()
      expect(html).toContain('Basado en la fecha de nacimiento')
    })

    it('no debe mostrar informaciÃ³n de edad cuando no hay fecha', async () => {
      const vm = wrapper.vm as any
      vm.localData.birth_date = ''
      await nextTick()
      
      expect(vm.calculatedAge).toBe(null)
      const html = wrapper.html()
      expect(html).not.toContain('aÃ±os')
    })

    it('debe calcular correctamente cuando el cumpleaÃ±os no ha ocurrido este aÃ±o', async () => {
      const vm = wrapper.vm as any
      const today = new Date()
      const birthDate = new Date(today.getFullYear() - 10, today.getMonth() + 1, today.getDate())
      
      vm.localData.birth_date = birthDate.toISOString().split('T')[0]
      await nextTick()
      
      // DeberÃ­a ser 9 aÃ±os porque el cumpleaÃ±os aÃºn no ocurre
      expect(vm.calculatedAge).toBe(9)
    })
  })

  describe('Eventos Emitidos', () => {
    it('debe emitir update:formData cuando cambian los datos', async () => {
      const vm = wrapper.vm as any
      vm.localData.first_name = 'Juan'
      vm.handleFormChange()
      
      await nextTick()
      expect(wrapper.emitted('update:formData')).toBeTruthy()
      expect(wrapper.emitted('update:formData')?.length).toBeGreaterThan(0)
    })

    it('debe emitir los datos correctos en update:formData', async () => {
      const vm = wrapper.vm as any
      vm.localData.first_name = 'MarÃ­a'
      vm.localData.last_name = 'LÃ³pez'
      vm.handleFormChange()
      
      await nextTick()
      const emitted = wrapper.emitted('update:formData')
      expect(emitted).toBeTruthy()
      expect(emitted![0][0]).toMatchObject({
        first_name: 'MarÃ­a',
        last_name: 'LÃ³pez'
      })
    })

    it('debe emitir validate con el estado correcto (vÃ¡lido)', async () => {
      const vm = wrapper.vm as any
      vm.localData.first_name = 'Juan'
      vm.localData.last_name = 'PÃ©rez'
      vm.localData.birth_date = '2015-01-01'
      
      vm.handleFormChange()
      await nextTick()
      
      const validateEvents = wrapper.emitted('validate')
      expect(validateEvents).toBeTruthy()
      expect(validateEvents![validateEvents!.length - 1]).toEqual([true])
    })

    it('debe emitir validate con false cuando el formulario es invÃ¡lido', async () => {
      const vm = wrapper.vm as any
      vm.localData.first_name = 'J'
      vm.handleFormChange()
      
      await nextTick()
      const validateEvents = wrapper.emitted('validate')
      expect(validateEvents).toBeTruthy()
      expect(validateEvents![validateEvents!.length - 1]).toEqual([false])
    })

    it('debe emitir ambos eventos al cambiar el formulario', async () => {
      const vm = wrapper.vm as any
      vm.localData.first_name = 'Test'
      vm.handleFormChange()
      
      await nextTick()
      expect(wrapper.emitted('update:formData')).toBeTruthy()
      expect(wrapper.emitted('validate')).toBeTruthy()
    })
  })

  describe('MÃ©todo validate expuesto', () => {
    it('debe exponer el mÃ©todo validate', () => {
      const vm = wrapper.vm as any
      expect(typeof vm.validate).toBe('function')
    })

    it('el mÃ©todo validate debe retornar true cuando es vÃ¡lido', async () => {
      const vm = wrapper.vm as any
      vm.localData.first_name = 'Juan'
      vm.localData.last_name = 'PÃ©rez'
      vm.localData.birth_date = '2015-01-01'
      
      await nextTick()
      const result = vm.validate()
      expect(result).toBe(true)
    })

    it('el mÃ©todo validate debe retornar false cuando es invÃ¡lido', async () => {
      const vm = wrapper.vm as any
      vm.localData.first_name = ''
      vm.localData.last_name = ''
      vm.localData.birth_date = ''
      
      await nextTick()
      const result = vm.validate()
      expect(result).toBe(false)
    })

    it('el mÃ©todo validate debe emitir el evento validate', () => {
      const vm = wrapper.vm as any
      vm.validate()
      expect(wrapper.emitted('validate')).toBeTruthy()
    })
  })

  describe('InicializaciÃ³n con datos previos', () => {
    it('debe cargar datos completos desde props', async () => {
      const propsWithData = {
        formData: {
          first_name: 'MarÃ­a',
          last_name: 'GonzÃ¡lez',
          rut: '12.345.678-9',
          birth_date: '2016-05-15',
          gender: 'female'
        }
      }

      const wrapperWithData = createWrapper(propsWithData)
      await nextTick()
      
      const vm = wrapperWithData.vm as any
      expect(vm.localData.first_name).toBe('MarÃ­a')
      expect(vm.localData.last_name).toBe('GonzÃ¡lez')
      expect(vm.localData.rut).toBe('12.345.678-9')
      expect(vm.localData.birth_date).toBe('2016-05-15')
      expect(vm.localData.gender).toBe('female')
    })

    it('debe mantener el gÃ©nero unspecified por defecto', () => {
      const vm = wrapper.vm as any
      expect(vm.localData.gender).toBe('unspecified')
    })

    it('debe cargar datos parciales correctamente', async () => {
      const partialProps = {
        formData: {
          first_name: 'Pedro',
          last_name: '',
          rut: '',
          birth_date: '',
          gender: 'male'
        }
      }

      const wrapperPartial = createWrapper(partialProps)
      await nextTick()
      
      const vm = wrapperPartial.vm as any
      expect(vm.localData.first_name).toBe('Pedro')
      expect(vm.localData.gender).toBe('male')
    })
  })

  describe('Indicador de validaciÃ³n', () => {
    it('debe tener informaciÃ³n de validaciÃ³n en el HTML', () => {
      const html = wrapper.html()
      expect(html).toContain('validation-info')
    })

    it('debe mostrar mensaje segÃºn estado de validaciÃ³n en HTML', async () => {
      await nextTick()
      const html = wrapper.html()
      expect(html).toContain('Complete los campos obligatorios')
    })

    it('debe cambiar mensaje cuando el formulario es vÃ¡lido', async () => {
      const vm = wrapper.vm as any
      vm.localData.first_name = 'Juan'
      vm.localData.last_name = 'PÃ©rez'
      vm.localData.birth_date = '2015-01-01'
      
      await nextTick()
      const html = wrapper.html()
      expect(html).toContain('Todos los campos requeridos estÃ¡n completos')
    })

    it('debe aplicar clase is-valid cuando el formulario es vÃ¡lido', async () => {
      const vm = wrapper.vm as any
      vm.localData.first_name = 'Juan'
      vm.localData.last_name = 'PÃ©rez'
      vm.localData.birth_date = '2015-01-01'
      
      await nextTick()
      const html = wrapper.html()
      expect(html).toContain('is-valid')
    })

    it('debe mostrar el icono de error cuando es invÃ¡lido', async () => {
      const vm = wrapper.vm as any
      await nextTick()
      
      // Verificar que el estado es invÃ¡lido
      expect(vm.isStepValid).toBe(false)
      
      // Verificar que existe el contenedor de validaciÃ³n y el icono SVG
      const validationIcon = wrapper.find('.validation-icon')
      expect(validationIcon.exists()).toBe(true)
      
      // Verificar que hay un SVG (el icono de error)
      const svg = validationIcon.find('svg')
      expect(svg.exists()).toBe(true)
    })

    it('debe mostrar el icono de Ã©xito cuando es vÃ¡lido', async () => {
      const vm = wrapper.vm as any
      vm.localData.first_name = 'Juan'
      vm.localData.last_name = 'PÃ©rez'
      vm.localData.birth_date = '2015-01-01'
      
      await nextTick()
      
      // Verificar que el estado es vÃ¡lido
      expect(vm.isStepValid).toBe(true)
      
      // Verificar que existe el contenedor de validaciÃ³n y el icono SVG
      const validationIcon = wrapper.find('.validation-icon')
      expect(validationIcon.exists()).toBe(true)
      
      // Verificar que hay un SVG (el icono de Ã©xito)
      const svg = validationIcon.find('svg')
      expect(svg.exists()).toBe(true)
      
      // Verificar que tiene la clase is-valid
      const validationInfo = wrapper.find('.validation-info')
      expect(validationInfo.classes()).toContain('is-valid')
    })
  })

  describe('Opciones de gÃ©nero', () => {
    it('debe tener las opciones de gÃ©nero definidas', () => {
      const vm = wrapper.vm as any
      expect(vm.genderOptions).toEqual({
        unspecified: 'No especifica',
        male: 'Masculino',
        female: 'Femenino',
        other: 'Otro'
      })
    })

    it('debe tener 4 opciones de gÃ©nero', () => {
      const vm = wrapper.vm as any
      const options = Object.keys(vm.genderOptions)
      expect(options.length).toBe(4)
    })

    it('debe incluir la opciÃ³n "No especifica"', () => {
      const vm = wrapper.vm as any
      expect(vm.genderOptions.unspecified).toBe('No especifica')
    })

    it('debe incluir las opciones binarias', () => {
      const vm = wrapper.vm as any
      expect(vm.genderOptions.male).toBe('Masculino')
      expect(vm.genderOptions.female).toBe('Femenino')
    })

    it('debe incluir la opciÃ³n "Otro"', () => {
      const vm = wrapper.vm as any
      expect(vm.genderOptions.other).toBe('Otro')
    })
  })

  describe('Campo RUT (opcional)', () => {
    it('debe permitir RUT vacÃ­o sin afectar validaciÃ³n', async () => {
      const vm = wrapper.vm as any
      vm.localData.first_name = 'Juan'
      vm.localData.last_name = 'PÃ©rez'
      vm.localData.birth_date = '2015-01-01'
      vm.localData.rut = ''
      
      await nextTick()
      expect(vm.isStepValid).toBe(true)
    })

    it('debe permitir RUT con formato vÃ¡lido', async () => {
      const vm = wrapper.vm as any
      vm.localData.first_name = 'Juan'
      vm.localData.last_name = 'PÃ©rez'
      vm.localData.birth_date = '2015-01-01'
      vm.localData.rut = '12.345.678-9'
      
      await nextTick()
      expect(vm.isStepValid).toBe(true)
    })
  })

  describe('Reactivity', () => {
    it('debe actualizar isStepValid cuando cambian los datos', async () => {
      const vm = wrapper.vm as any
      expect(vm.isStepValid).toBe(false)
      
      vm.localData.first_name = 'Juan'
      await nextTick()
      expect(vm.isStepValid).toBe(false)
      
      vm.localData.last_name = 'PÃ©rez'
      await nextTick()
      expect(vm.isStepValid).toBe(false)
      
      vm.localData.birth_date = '2015-01-01'
      await nextTick()
      expect(vm.isStepValid).toBe(true)
    })

    it('debe recalcular edad cuando cambia la fecha', async () => {
      const vm = wrapper.vm as any
      const date1 = new Date()
      date1.setFullYear(date1.getFullYear() - 5)
      vm.localData.birth_date = date1.toISOString().split('T')[0]
      await nextTick()
      expect(vm.calculatedAge).toBe(5)
      
      const date2 = new Date()
      date2.setFullYear(date2.getFullYear() - 10)
      vm.localData.birth_date = date2.toISOString().split('T')[0]
      await nextTick()
      expect(vm.calculatedAge).toBe(10)
    })
  })

  describe('Estilos y clases CSS', () => {
    it('debe tener la clase step-personal en el contenedor principal', () => {
      expect(wrapper.find('.step-personal').exists()).toBe(true)
    })

    it('debe aplicar las clases correctas al step-number', () => {
      const stepNumber = wrapper.find('.step-number')
      expect(stepNumber.exists()).toBe(true)
    })

    it('debe tener estructura del formulario en el HTML', () => {
      const html = wrapper.html()
      expect(html).toContain('form-grid')
    })
  })
})
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\tests\setup.ts
============================================================
import { config } from '@vue/test-utils'
import { plugin, defaultConfig } from '@formkit/vue'

// Mock de FormKit para tests
config.global.plugins = [
  [plugin, defaultConfig]
]

// Mock de heroicons si es necesario
config.global.stubs = {
  CheckCircleIcon: true,
  ExclamationCircleIcon: true
}
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\tsconfig.app.json
============================================================
{
  "extends": "./tsconfig.json",
  "compilerOptions": {
    "composite": true,

    // ğŸ‘‡ Rutas y alias
    "baseUrl": ".",
    "ignoreDeprecations": "6.0",
    "paths": {
      "@/*": ["src/*"]
    },

    // ConfiguraciÃ³n moderna para Vite + Vue 3 + TS
    "target": "ESNext",
    "module": "ESNext",
    "moduleResolution": "bundler",

    // LibrerÃ­as y compatibilidad
    "lib": ["ESNext", "DOM"],
    "jsx": "preserve",
    "esModuleInterop": true,
    "allowSyntheticDefaultImports": true,

    // Buenas prÃ¡cticas
    "strict": true,
    "skipLibCheck": true,

    // ğŸ‘‡ Obligatorio con composite: true
    "declaration": true,
    "emitDeclarationOnly": true,
    "declarationMap": true,

    // ğŸ‘‡ Redirige los .d.ts a una carpeta separada
    "outDir": "./types"
  },
  "include": ["src"]
}
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\tsconfig.json
============================================================
{
  "compilerOptions": {
    "target": "ES2020",
    "useDefineForClassFields": true,
    "module": "ESNext",
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "skipLibCheck": true,
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "resolveJsonModule": true,
    "isolatedModules": true,
    "moduleDetection": "force",
    "noEmit": true,
    "jsx": "preserve",
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true,
    "paths": {
      "@/*": ["./src/*"]
    },
    "types": ["vite/client"]
  },
  "include": [
    "src/**/*.ts", 
    "src/**/*.d.ts", 
    "src/**/*.tsx", 
    "src/**/*.vue"
  ]
}
============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\tsconfig.node.json
============================================================
{
  "extends": "./tsconfig.json",
  "compilerOptions": {
    "composite": true,
    "baseUrl": ".",
    "ignoreDeprecations": "5.0",
    "paths": {
      "@/*": ["./src/*"]
    },
    "target": "ESNext",
    "module": "ESNext",
    "moduleResolution": "bundler",
    "lib": ["ESNext", "DOM"],
    "jsx": "preserve",
    "esModuleInterop": true,
    "allowSyntheticDefaultImports": true,
    "strict": true,
    "skipLibCheck": true,
    "types": ["vite/client", "node"]
  },
  "include": ["vite.config.ts", "src/env.d.ts"]
}

============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\vite.config.d.ts
============================================================
declare const _default: import("vite").UserConfig;
export default _default;

============================================================
FILE: C:\Users\rene\Desktop\proyecto_escuea\propositodivermind\divermindtemplate\vite.config.ts
============================================================
import { defineConfig } from 'vitest/config'
import vue from '@vitejs/plugin-vue'
import { resolve } from 'path'

// https://vite.dev/config/
export default defineConfig({
  plugins: [vue()],
  resolve: {
    alias: {
      '@': resolve(__dirname, 'src'),
      'vue': 'vue/dist/vue.esm-bundler.js'
    }
  },
  test: {
    globals: true,
    environment: 'jsdom',
    setupFiles: ['./tests/setup.ts'],
    // ConfiguraciÃ³n adicional para Vue
    include: ['**/*.{test,spec}.{js,mjs,cjs,ts,mts,cts,jsx,tsx}'],
    coverage: {
      provider: 'v8',
      reporter: ['text', 'json', 'html'],
      exclude: [
        'node_modules/',
        'tests/',
        '**/*.spec.ts',
        '**/*.test.ts'
      ]
    }
  }
})